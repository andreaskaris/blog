
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Andreas Karis' blog about anything Kubernetes, OpenShift, Linux and Networking">
      
      
      
        <link rel="canonical" href="https://andreaskaris.github.io/blog/coding/server-side-apply/">
      
      
        <link rel="prev" href="../golang-ip-conversion/">
      
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Kubernetes Server Side Apply - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="RSS feed of created content" href="https://andreaskaris.github.io/blog/feed_rss_created.xml">
  <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="https://andreaskaris.github.io/blog/feed_rss_updated.xml">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#server-side-apply-in-kubernetes-controllers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Kubernetes Server Side Apply
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ceph/" class="md-tabs__link">
          
  
    
  
  Ceph

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux/" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../networking/" class="md-tabs__link">
          
  
    
  
  Networking

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openshift/" class="md-tabs__link">
          
  
    
  
  OpenShift and Kubernetes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openstack/" class="md-tabs__link">
          
  
    
  
  OpenStack

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Coding

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  
    
    <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../ceph/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Ceph
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../linux/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Linux
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../networking/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../openshift/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    OpenShift and Kubernetes
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../openstack/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    OpenStack
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coding
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Coding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operator-sdk-reconciliation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller Reconciliation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../golang-ip-conversion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Golang IP address conversion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Kubernetes Server Side Apply
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Kubernetes Server Side Apply
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-server-side-apply-is-of-interest-for-controller-developers" class="md-nav__link">
    <span class="md-ellipsis">
      Why Server-Side Apply is of interest for controller developers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-does-server-side-apply-look-like" class="md-nav__link">
    <span class="md-ellipsis">
      What does Server-Side Apply look like?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#current-status-for-server-side-apply-in-controller-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Current status for Server-Side Apply in controller-runtime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-management" class="md-nav__link">
    <span class="md-ellipsis">
      Field management
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partial-reconciliation-via-patch-statement-and-server-side-apply-with-the-controller-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Partial reconciliation via Patch statement and Server-Side Apply with the controller-runtime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skipping-getcreate-getupdate-with-patch-and-fully-specified-intent-for-constructive-controllers" class="md-nav__link">
    <span class="md-ellipsis">
      Skipping Get/Create Get/Update with Patch and fully specified intent for constructive controllers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
        </div>
      </div>
    </div>
  
  

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="server-side-apply-in-kubernetes-controllers">Server-Side Apply in Kubernetes controllers</h1>
<p>This blog post explores Server-Side Apply (SSA) in the context of <code class="highlight">controller-runtime</code> controllers. We'll examine how
kubectl sends server-side apply requests to understand the underlying mechanics, and demonstrate SSA implementation
using a small dummy controller built with the Operator SDK (kubebuilder). Through practical examples and network traces,
we'll see how <code class="highlight">controller-runtime</code> reconciles resources using SSA and how field management works in practice.</p>
<h2 id="why-server-side-apply-is-of-interest-for-controller-developers">Why Server-Side Apply is of interest for controller developers</h2>
<p>An <a href="https://kubernetes.io/blog/2022/10/20/advanced-server-side-apply/#reconstructive-controllers">upstream kubernetes project blog post</a>
states that SSA is an ideal tool for constructive controllers:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">This</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">controller</span><span class="w"> </span><span class="n">wasn</span><span class="s1">&#39;t really possible prior to SSA. The idea here is to (whenever something changes etc) reconstruct from scratch the fields of the object as the controller wishes them to be, and then apply the change to the server, letting it figure out the result. I now recommend that new controllers start out this way–it&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">less</span><span class="w"> </span><span class="n">fiddly</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">say</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">look</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">say</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">change</span><span class="o">.</span>

<span class="n">The</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span><span class="o">.</span>
</code></pre></div></td></tr></table></div>
<p>It also addresses one of the downsides of sending unneeded apply requests, but also states that this is likely not
an issue in real-life scenarios and that it also cannot easily be fixed by sending an extra GET to retrieve the existing
state:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">The</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">downside</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">may</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="nv">up</span><span class="w"> </span><span class="nv">sending</span><span class="w"> </span><span class="nv">unneeded</span><span class="w"> </span><span class="nv">apply</span><span class="w"> </span><span class="nv">requests</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">API</span><span class="w"> </span><span class="nv">server</span>,<span class="w"> </span><span class="nv">even</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">actually</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">already</span><span class="w"> </span><span class="nv">matches</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">controller</span>’<span class="nv">s</span><span class="w"> </span><span class="nv">desires</span>.<span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="nv">doesn</span><span class="err">&#39;t matter if it happens once in a while, but for extremely high-throughput controllers, it might cause a performance problem for the cluster–specifically, the API server. No-op writes are not written to storage (etcd) or broadcast to any watchers, so it’s not really that big of a deal. If you’re worried about this anyway, today you could use the method explained in the previous section, or you could still do it this way for now, and wait for an additional client-side mechanism to suppress zero-change applies.</span>

<span class="nv">To</span><span class="w"> </span><span class="nv">get</span><span class="w"> </span><span class="nv">around</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">downside</span>,<span class="w"> </span><span class="nv">why</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">GET</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="k">send</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">apply</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">object</span><span class="w"> </span><span class="nv">needs</span><span class="w"> </span><span class="nv">it</span>?<span class="w"> </span><span class="nv">Surprisingly</span>,<span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="nv">doesn</span><span class="err">&#39;t help much – a no-op apply is not very much more work for the API server than an extra GET; and an apply that changes things is cheaper than that same apply with a preceding GET. Worse, since it is a distributed system, something could change between your GET and apply, invalidating your computation</span>
</code></pre></div></td></tr></table></div>
<p>The upstream <a href="https://kubernetes.io/docs/reference/using-api/server-side-apply/#using-server-side-apply-in-a-controller">kubernetes documentation suggests</a>
using Server-Side Apply in controllers:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">Using</span><span class="w"> </span><span class="nx">Server</span><span class="o">-</span><span class="nx">Side</span><span class="w"> </span><span class="nx">Apply</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">controller</span>

<span class="nx">As</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">developer</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">controller</span><span class="p">,</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">Server</span><span class="o">-</span><span class="nx">Side</span><span class="w"> </span><span class="nx">Apply</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">way</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">simplify</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="nx">logic</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="nx">differences</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">read</span><span class="o">-</span><span class="nx">modify</span><span class="o">-</span><span class="nx">write</span><span class="w"> </span><span class="k">and</span><span class="o">/</span><span class="k">or</span><span class="w"> </span><span class="nx">patch</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">following</span><span class="p">:</span>

<span class="w">    </span><span class="nx">the</span><span class="w"> </span><span class="nx">applied</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="nx">must</span><span class="w"> </span><span class="nx">contain</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">fields</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="nx">cares</span><span class="w"> </span><span class="nx">about</span><span class="p">.</span>
<span class="w">    </span><span class="nx">there</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">no</span><span class="w"> </span><span class="nx">way</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">remove</span><span class="w"> </span><span class="nx">fields</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">haven</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">applied</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="p">(</span><span class="nx">controller</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">still</span><span class="w"> </span><span class="nx">send</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">patch</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">these</span><span class="w"> </span><span class="nx">use</span><span class="o">-</span><span class="nx">cases</span><span class="p">).</span>
<span class="w">    </span><span class="nx">the</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="nx">doesn</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">read</span><span class="w"> </span><span class="nx">beforehand</span><span class="p">;</span><span class="w"> </span><span class="nx">resourceVersion</span><span class="w"> </span><span class="nx">doesn</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">specified</span><span class="p">.</span>
</code></pre></div></td></tr></table></div>
<p>In addition, the documentation strongly recommends to force ownership of fields in case of conflicts:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">It</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">strongly</span><span class="w"> </span><span class="nv">recommended</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">controllers</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">always</span><span class="w"> </span><span class="nv">force</span><span class="w"> </span><span class="nv">conflicts</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">objects</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">they</span><span class="w"> </span><span class="nv">own</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">manage</span>,<span class="w"> </span><span class="nv">since</span><span class="w"> </span><span class="nv">they</span><span class="w"> </span><span class="nv">might</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">able</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">resolve</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">act</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">these</span><span class="w"> </span><span class="nv">conflicts</span>
</code></pre></div></td></tr></table></div>
<h2 id="what-does-server-side-apply-look-like">What does Server-Side Apply look like?</h2>
<p>Similar to a patch, Server-Side Apply allows a user to define only the fields that they want to be changed and to apply
those changes. In this section, we want to change the replica count for existing deployment <code class="highlight">reconciler</code> inside namespace
<code class="highlight">reconciler</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>test.yaml<span class="w"> </span>
apiVersion:<span class="w"> </span>apps/v1
kind:<span class="w"> </span>Deployment
metadata:
<span class="w">  </span>name:<span class="w"> </span>reconciler
<span class="w">  </span>namespace:<span class="w"> </span>reconciler
spec:
<span class="w">  </span>replicas:<span class="w"> </span><span class="m">8</span>
</code></pre></div></td></tr></table></div>
<p>We can then apply this change with SSA with kubectl by using the <code class="highlight">--server-side</code> flag:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>kubectl apply -f test.yaml --server-side
</code></pre></div></td></tr></table></div>
<p>Here's what server side apply looks like for the API, where <code class="highlight">Content-Type: application/apply-patch+yaml</code> indicates that
server side apply shall be used (https://kubernetes.io/docs/reference/using-api/server-side-apply/#api-implementation):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-v10<span class="w"> </span>-f<span class="w"> </span>test.yaml<span class="w"> </span>--server-side<span class="w"> </span>--force-conflicts
<span class="o">(</span>...<span class="o">)</span>
I0902<span class="w"> </span><span class="m">15</span>:48:02.616662<span class="w">  </span><span class="m">957821</span><span class="w"> </span>helper.go:269<span class="o">]</span><span class="w"> </span><span class="s2">&quot;Request Body&quot;</span><span class="w"> </span><span class="nv">body</span><span class="o">=</span>&lt;
<span class="w">        </span><span class="o">{</span><span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;kind&quot;</span>:<span class="s2">&quot;Deployment&quot;</span>,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;reconciler&quot;</span>,<span class="s2">&quot;namespace&quot;</span>:<span class="s2">&quot;reconciler&quot;</span><span class="o">}</span>,<span class="s2">&quot;spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;replicas&quot;</span>:8<span class="o">}}</span>
<span class="w"> </span>&gt;
I0902<span class="w"> </span><span class="m">15</span>:48:02.616722<span class="w">  </span><span class="m">957821</span><span class="w"> </span>round_trippers.go:527<span class="o">]</span><span class="w"> </span><span class="s2">&quot;Request&quot;</span><span class="w"> </span><span class="nv">curlCommand</span><span class="o">=</span>&lt;
<span class="w">        </span>curl<span class="w"> </span>-v<span class="w"> </span>-XPATCH<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/apply-patch+yaml&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;User-Agent: kubectl/v1.33.2 (linux/amd64) kubernetes/a57b6f7&quot;</span><span class="w"> </span><span class="s1">&#39;https://127.0.0.1:38503/apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=kubectl&amp;fieldValidation=Strict&amp;force=true&#39;</span>
<span class="w"> </span>&gt;
I0902<span class="w"> </span><span class="m">15</span>:48:02.625206<span class="w">  </span><span class="m">957821</span><span class="w"> </span>round_trippers.go:632<span class="o">]</span><span class="w"> </span><span class="s2">&quot;Response&quot;</span><span class="w"> </span><span class="nv">verb</span><span class="o">=</span><span class="s2">&quot;PATCH&quot;</span><span class="w"> </span><span class="nv">url</span><span class="o">=</span><span class="s2">&quot;https://127.0.0.1:38503/apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=kubectl&amp;fieldValidation=Strict&amp;force=true&quot;</span><span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="s2">&quot;200 OK&quot;</span><span class="w"> </span><span class="nv">headers</span><span class="o">=</span>&lt;
<span class="w">        </span>Audit-Id:<span class="w"> </span>eb6f9d6e-26bb-4c97-bb00-6f7f5da9db32
<span class="w">        </span>Cache-Control:<span class="w"> </span>no-cache,<span class="w"> </span>private
<span class="w">        </span>Content-Type:<span class="w"> </span>application/json
<span class="w">        </span>Date:<span class="w"> </span>Tue,<span class="w"> </span><span class="m">02</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">2025</span><span class="w"> </span><span class="m">13</span>:48:02<span class="w"> </span>GMT
<span class="w">        </span>X-Kubernetes-Pf-Flowschema-Uid:<span class="w"> </span>8391073b-d875-43da-9f1a-94ef82459735
<span class="w">        </span>X-Kubernetes-Pf-Prioritylevel-Uid:<span class="w"> </span>3f30e2d2-3e73-402b-98b1-9c0ddce8c521
<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">milliseconds</span><span class="o">=</span><span class="m">8</span><span class="w"> </span><span class="nv">getConnectionMilliseconds</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">serverProcessingMilliseconds</span><span class="o">=</span><span class="m">8</span>
I0902<span class="w"> </span><span class="m">15</span>:48:02.625362<span class="w">  </span><span class="m">957821</span><span class="w"> </span>helper.go:269<span class="o">]</span><span class="w"> </span><span class="s2">&quot;Response Body&quot;</span><span class="w"> </span><span class="nv">body</span><span class="o">=</span>&lt;
<span class="w">        </span><span class="o">{</span><span class="s2">&quot;kind&quot;</span>:<span class="s2">&quot;Deployment&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;reconciler&quot;</span>,<span class="s2">&quot;namespace&quot;</span>:<span class="s2">&quot;reconciler&quot;</span>,<span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;684b66af-77bf-4bc5-96f4-bf2c0018a5a5&quot;</span>,<span class="s2">&quot;resourceVersion&quot;</span>:<span class="s2">&quot;18761&quot;</span>,<span class="s2">&quot;generation&quot;</span>:13,<span class="s2">&quot;creationTimestamp&quot;</span>:<span class="s2">&quot;2025-09-02T10:53:31Z&quot;</span>,<span class="s2">&quot;annotations&quot;</span>:<span class="o">{</span><span class="s2">&quot;deployment.kubernetes.io/revision&quot;</span>:<span class="s2">&quot;1&quot;</span><span class="o">}</span>,<span class="s2">&quot;ownerReferences&quot;</span>:<span class="o">[{</span><span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;test.example.com/v1alpha1&quot;</span>,<span class="s2">&quot;kind&quot;</span>:<span class="s2">&quot;Reconciler&quot;</span>,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;reconciler-sample&quot;</span>,<span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;c8f0aab2-b8bd-438f-ad50-043e65017963&quot;</span>,<span class="s2">&quot;controller&quot;</span>:true,<span class="s2">&quot;blockOwnerDeletion&quot;</span>:true<span class="o">}]</span>,<span class="s2">&quot;managedFields&quot;</span>:<span class="o">[{</span><span class="s2">&quot;manager&quot;</span>:<span class="s2">&quot;reconciler-controller&quot;</span>,<span class="s2">&quot;operation&quot;</span>:<span class="s2">&quot;Apply&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;time&quot;</span>:<span class="s2">&quot;2025-09-02T12:04:06Z&quot;</span>,<span class="s2">&quot;fieldsType&quot;</span>:<span class="s2">&quot;FieldsV1&quot;</span>,<span class="s2">&quot;fieldsV1&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:ownerReferences&quot;</span>:<span class="o">{</span><span class="s2">&quot;k:{\&quot;uid\&quot;:\&quot;c8f0aab2-b8bd-438f-ad50-043e65017963\&quot;}&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:selector&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:strategy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:template&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:creationTimestamp&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:labels&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:app&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:containers&quot;</span>:<span class="o">{</span><span class="s2">&quot;k:{\&quot;name\&quot;:\&quot;netshoot\&quot;}&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:command&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:image&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:imagePullPolicy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:name&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:resources&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:allowPrivilegeEscalation&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:capabilities&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:drop&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:runAsNonRoot&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:runAsUser&quot;</span>:<span class="o">{}}}}</span>,<span class="s2">&quot;f:securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:runAsNonRoot&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:seccompProfile&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}}}}}}}</span>,<span class="o">{</span><span class="s2">&quot;manager&quot;</span>:<span class="s2">&quot;kubectl&quot;</span>,<span class="s2">&quot;operation&quot;</span>:<span class="s2">&quot;Apply&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;time&quot;</span>:<span class="s2">&quot;2025-09-02T13:48:02Z&quot;</span>,<span class="s2">&quot;fieldsType&quot;</span>:<span class="s2">&quot;FieldsV1&quot;</span>,<span class="s2">&quot;fieldsV1&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:replicas&quot;</span>:<span class="o">{}}}}</span>,<span class="o">{</span><span class="s2">&quot;manager&quot;</span>:<span class="s2">&quot;main&quot;</span>,<span class="s2">&quot;operation&quot;</span>:<span class="s2">&quot;Update&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;time&quot;</span>:<span class="s2">&quot;2025-09-02T10:53:31Z&quot;</span>,<span class="s2">&quot;fieldsType&quot;</span>:<span class="s2">&quot;FieldsV1&quot;</span>,<span class="s2">&quot;fieldsV1&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:ownerReferences&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;k:{\&quot;uid\&quot;:\&quot;c8f0aab2-b8bd-438f-ad50-043e65017963\&quot;}&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:progressDeadlineSeconds&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:revisionHistoryLimit&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:selector&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:strategy&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:rollingUpdate&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:maxSurge&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:maxUnavailable&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:template&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:labels&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:app&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:containers&quot;</span>:<span class="o">{</span><span class="s2">&quot;k:{\&quot;name\&quot;:\&quot;netshoot\&quot;}&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:command&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:image&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:imagePullPolicy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:name&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:resources&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:allowPrivilegeEscalation&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:capabilities&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:drop&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:runAsNonRoot&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:runAsUser&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:terminationMessagePath&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:terminationMessagePolicy&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:dnsPolicy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:restartPolicy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:schedulerName&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:runAsNonRoot&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:seccompProfile&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:terminationGracePeriodSeconds&quot;</span>:<span class="o">{}}}}}}</span>,<span class="o">{</span><span class="s2">&quot;manager&quot;</span>:<span class="s2">&quot;kube-controller-manager&quot;</span>,<span class="s2">&quot;operation&quot;</span>:<span class="s2">&quot;Update&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;time&quot;</span>:<span class="s2">&quot;2025-09-02T12:07:23Z&quot;</span>,<span class="s2">&quot;fieldsType&quot;</span>:<span class="s2">&quot;FieldsV1&quot;</span>,<span class="s2">&quot;fieldsV1&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:annotations&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:deployment.kubernetes.io/revision&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:status&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:availableReplicas&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:conditions&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;k:{\&quot;type\&quot;:\&quot;Available\&quot;}&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:lastTransitionTime&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:lastUpdateTime&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:message&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:reason&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:status&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;k:{\&quot;type\&quot;:\&quot;Progressing\&quot;}&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:lastTransitionTime&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:lastUpdateTime&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:message&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:reason&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:status&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:observedGeneration&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:readyReplicas&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:replicas&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:updatedReplicas&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;subresource&quot;</span>:<span class="s2">&quot;status&quot;</span><span class="o">}]}</span>,<span class="s2">&quot;spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;replicas&quot;</span>:8,<span class="s2">&quot;selector&quot;</span>:<span class="o">{</span><span class="s2">&quot;matchLabels&quot;</span>:<span class="o">{</span><span class="s2">&quot;app&quot;</span>:<span class="s2">&quot;reconciler-deployment&quot;</span><span class="o">}}</span>,<span class="s2">&quot;template&quot;</span>:<span class="o">{</span><span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;creationTimestamp&quot;</span>:null,<span class="s2">&quot;labels&quot;</span>:<span class="o">{</span><span class="s2">&quot;app&quot;</span>:<span class="s2">&quot;reconciler-deployment&quot;</span><span class="o">}}</span>,<span class="s2">&quot;spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;containers&quot;</span>:<span class="o">[{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span>,<span class="s2">&quot;image&quot;</span>:<span class="s2">&quot;nicolaka/netshoot&quot;</span>,<span class="s2">&quot;command&quot;</span>:<span class="o">[</span><span class="s2">&quot;sleep&quot;</span>,<span class="s2">&quot;infinity&quot;</span><span class="o">]</span>,<span class="s2">&quot;resources&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;terminationMessagePath&quot;</span>:<span class="s2">&quot;/dev/termination-log&quot;</span>,<span class="s2">&quot;terminationMessagePolicy&quot;</span>:<span class="s2">&quot;File&quot;</span>,<span class="s2">&quot;imagePullPolicy&quot;</span>:<span class="s2">&quot;IfNotPresent&quot;</span>,<span class="s2">&quot;securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;capabilities&quot;</span>:<span class="o">{</span><span class="s2">&quot;drop&quot;</span>:<span class="o">[</span><span class="s2">&quot;ALL&quot;</span><span class="o">]}</span>,<span class="s2">&quot;runAsUser&quot;</span>:1001,<span class="s2">&quot;runAsNonRoot&quot;</span>:false,<span class="s2">&quot;allowPrivilegeEscalation&quot;</span>:false<span class="o">}}]</span>,<span class="s2">&quot;restartPolicy&quot;</span>:<span class="s2">&quot;Always&quot;</span>,<span class="s2">&quot;terminationGracePeriodSeconds&quot;</span>:30,<span class="s2">&quot;dnsPolicy&quot;</span>:<span class="s2">&quot;ClusterFirst&quot;</span>,<span class="s2">&quot;securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;runAsNonRoot&quot;</span>:true,<span class="s2">&quot;seccompProfile&quot;</span>:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;RuntimeDefault&quot;</span><span class="o">}}</span>,<span class="s2">&quot;schedulerName&quot;</span>:<span class="s2">&quot;default-scheduler&quot;</span><span class="o">}}</span>,<span class="s2">&quot;strategy&quot;</span>:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;RollingUpdate&quot;</span>,<span class="s2">&quot;rollingUpdate&quot;</span>:<span class="o">{</span><span class="s2">&quot;maxUnavailable&quot;</span>:<span class="s2">&quot;25%&quot;</span>,<span class="s2">&quot;maxSurge&quot;</span>:<span class="s2">&quot;25%&quot;</span><span class="o">}}</span>,<span class="s2">&quot;revisionHistoryLimit&quot;</span>:10,<span class="s2">&quot;progressDeadlineSeconds&quot;</span>:600<span class="o">}</span>,<span class="s2">&quot;status&quot;</span>:<span class="o">{</span><span class="s2">&quot;observedGeneration&quot;</span>:12,<span class="s2">&quot;replicas&quot;</span>:14,<span class="s2">&quot;updatedReplicas&quot;</span>:14,<span class="s2">&quot;readyReplicas&quot;</span>:14,<span class="s2">&quot;availableReplicas&quot;</span>:14,<span class="s2">&quot;conditions&quot;</span>:<span class="o">[{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Progressing&quot;</span>,<span class="s2">&quot;status&quot;</span>:<span class="s2">&quot;True&quot;</span>,<span class="s2">&quot;lastUpdateTime&quot;</span>:<span class="s2">&quot;2025-09-02T10:53:32Z&quot;</span>,<span class="s2">&quot;lastTransitionTime&quot;</span>:<span class="s2">&quot;2025-09-02T10:53:31Z&quot;</span>,<span class="s2">&quot;reason&quot;</span>:<span class="s2">&quot;NewReplicaSetAvailable&quot;</span>,<span class="s2">&quot;message&quot;</span>:<span class="s2">&quot;ReplicaSet \&quot;reconciler-57ddfb79c9\&quot; has successfully progressed.&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Available&quot;</span>,<span class="s2">&quot;status&quot;</span>:<span class="s2">&quot;True&quot;</span>,<span class="s2">&quot;lastUpdateTime&quot;</span>:<span class="s2">&quot;2025-09-02T12:04:07Z&quot;</span>,<span class="s2">&quot;lastTransitionTime&quot;</span>:<span class="s2">&quot;2025-09-02T12:04:07Z&quot;</span>,<span class="s2">&quot;reason&quot;</span>:<span class="s2">&quot;MinimumReplicasAvailable&quot;</span>,<span class="s2">&quot;message&quot;</span>:<span class="s2">&quot;Deployment has minimum availability.&quot;</span><span class="o">}]}}</span>
<span class="w"> </span>&gt;
deployment.apps/reconciler<span class="w"> </span>serverside-applied
I0902<span class="w"> </span><span class="m">15</span>:48:02.625965<span class="w">  </span><span class="m">957821</span><span class="w"> </span>apply.go:548<span class="o">]</span><span class="w"> </span>Running<span class="w"> </span>apply<span class="w"> </span>post-processor<span class="w"> </span><span class="k">function</span>
</code></pre></div></td></tr></table></div>
<p>You can see in the above that the payload sent to the API server is exactly the minimal JSON containing the metadata and
the replica count.</p>
<p>There's an additional caveat - we had to specify the <code class="highlight">--force-conflicts</code> flag because kubectl was
not the field manager. Otherwise, we would get a conflict in cases that this object's <code class="highlight"><span class="na">.spec.replicas</span></code> field was managed
by a different manager. In the section about <code class="highlight">Field management</code>, we will understand why.</p>
<h2 id="current-status-for-server-side-apply-in-controller-runtime">Current status for Server-Side Apply in controller-runtime</h2>
<p>At time of this writing, Server-Side Apply can be used together with <code class="highlight">controller-runtime</code> in the form of a Patch statement:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">ctx</span><span class="o">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="o">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">Apply</span><span class="o">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">ForceOwnership</span><span class="o">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">FieldOwner</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Name</span><span class="p">));</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">!</span><span class="o">=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{}</span><span class="o">,</span><span class="w"> </span><span class="n">err</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Where <code class="highlight">client.Apply</code> tells the <code class="highlight">Patch</code> method to use the <a href="https://github.com/kubernetes/apimachinery/blob/2340d9bf7725073021aecf60ac5a4553ceaf305c/pkg/types/patch.go#L29">ApplyYAMLPatchType</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>ApplyYAMLPatchType      PatchType = &quot;application/apply-patch+yaml&quot;
</code></pre></div></td></tr></table></div>
<p>Using a <code class="highlight">Patch</code> with <code class="highlight">client.Apply</code> may work well in most cases for the <code class="highlight">controller-runtime</code>. However, the detailed
documentation for <a href="https://pkg.go.dev/k8s.io/client-go/applyconfigurations">applyconfigurations</a> states a caveat: the
standard library structs have many non-pointer fields and thus fields are set to their default values. On the other hand:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">Each</span><span class="w"> </span><span class="s">&quot;apply configuration&quot;</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">represents</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">same</span><span class="w"> </span><span class="nx">Kubernetes</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="nx">kind</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">corresponding</span><span class="w"> </span><span class="nx">go</span><span class="w"> </span><span class="nx">struct</span><span class="p">,</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">fields</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">pointers</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">make</span><span class="w"> </span><span class="nx">them</span><span class="w"> </span><span class="nx">optional</span><span class="p">,</span><span class="w"> </span><span class="nx">allowing</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">requests</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">accurately</span><span class="w"> </span><span class="nx">represented</span><span class="p">.</span>
</code></pre></div></td></tr></table></div>
<p>SSA was recently <a href="https://github.com/kubernetes-sigs/controller-runtime/issues/3183">made a first-class citizen</a> of the
<code class="highlight">controller-runtime</code> project, even though some pieces are still missing, such as <a href="github.com/kubernetes-sigs/kubebuilder/issues/2514">documentation</a>.
Therefore, in the near future, it should be fully documented how to use Server-Side Apply natively with the <code class="highlight">controller-runtime</code>.</p>
<h2 id="field-management">Field management</h2>
<p>Whether Server-Side Apply detects a conflict comes down to <a href="https://kubernetes.io/docs/reference/using-api/server-side-apply/#field-management">Field management</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">The</span><span class="w"> </span><span class="n">Kubernetes</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">tracks</span><span class="w"> </span><span class="n">managed</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">newly</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">objects</span><span class="o">.</span>

<span class="n">When</span><span class="w"> </span><span class="n">trying</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">owned</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">conflict</span><span class="o">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">signal</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">undo</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">collaborator</span><span class="s1">&#39;s changes. Writes to objects with managed fields can be forced, in which case the value of any conflicted field will be overridden, and the ownership will be transferred.</span>

<span class="n">Whenever</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">field</span><span class="s1">&#39;s value does change, ownership moves from its current manager to the manager making the change.</span>
</code></pre></div></td></tr></table></div>
<p>In order for us to understand how field management works, let's look at <a href="https://github.com/andreaskaris/reconciler-operator/blob/741884f5396b1ca5b0a7793fd4657fa5f2c4048f/internal/controller/reconciler_controller.go#L102">a small test operator</a>.
The operator has the following patch logic:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">Reconcile</span><span class="p">(</span><span class="n">ctx</span><span class="w"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">logger</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">logf</span><span class="o">.</span><span class="n">FromContext</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">TODO</span><span class="p">(</span><span class="n">user</span><span class="p">):</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">here</span>
<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;reconciler was called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">reconciler</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v1alpha1</span><span class="o">.</span><span class="n">Reconciler</span><span class="p">{}</span>
<span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="o">.</span><span class="n">NamespacedName</span><span class="p">,</span><span class="w"> </span><span class="n">reconciler</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">apierrors</span><span class="o">.</span><span class="n">IsNotFound</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;reconciler resource not found. Ignoring since object must be deleted&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">nil</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">requeue</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">request</span><span class="o">.</span>
<span class="w">        </span><span class="n">logger</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Failed to get reconciler&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">desiredDeployment</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">getReconcilerDeployment</span><span class="p">(</span><span class="n">reconciler</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;deployment is&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="p">)</span>

<span class="w">    </span><span class="n">currentDeployment</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">appsv1</span><span class="o">.</span><span class="n">Deployment</span><span class="p">{}</span>
<span class="w">    </span><span class="n">namespacedName</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">types</span><span class="o">.</span><span class="n">NamespacedName</span><span class="p">{</span><span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">Namespace</span><span class="p">:</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="o">.</span><span class="n">Namespace</span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">namespacedName</span><span class="p">,</span><span class="w"> </span><span class="n">currentDeployment</span><span class="p">);</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">apierrors</span><span class="o">.</span><span class="n">IsNotFound</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;creating deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="p">)</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="p">);</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">err</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">nil</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">requeue</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">request</span><span class="o">.</span>
<span class="w">        </span><span class="n">logger</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Failed to get deployment&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Patch</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="n">here</span><span class="o">!</span>
<span class="w">    </span><span class="n">desiredDeployment</span><span class="o">.</span><span class="n">APIVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;apps/v1&quot;</span>
<span class="w">    </span><span class="n">desiredDeployment</span><span class="o">.</span><span class="n">Kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment&quot;</span>
<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;patching deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">Apply</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">ForceOwnership</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">FieldOwner</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Name</span><span class="p">));</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">nil</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>In this concrete example, when the deployment is not present and when the operator first starts, the controller creates
the desired deployment because it does not yet exist:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T12</span><span class="o">:</span><span class="mi">19</span><span class="o">:</span><span class="mi">29</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">creating</span><span class="w"> </span><span class="n">deployment</span><span class="w">     </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;namespace&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;reconcileID&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;f136a051-e0c1-45a0-93dc-e7bb48fa552a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 6c9e435e-5edf-4a13-868d-d0b85aa09d1a 0xc00015a622 0xc00015a621}] [] []},Spec:DeploymentSpec{Replicas:*1,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] &lt;nil&gt; [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:*1001,RunAsNonRoot:*false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:*false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  &lt;nil&gt; &lt;nil&gt;  map[]   &lt;nil&gt;  false false false &lt;nil&gt; &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:*true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  &lt;nil&gt; nil [] &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; map[] [] &lt;nil&gt; nil &lt;nil&gt; [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>We can look at the managed fields, all of which belong to <code class="highlight"><span class="n">manager</span><span class="o">:</span><span class="w"> </span><span class="n">main</span></code> (and <code class="highlight">kube-controller-manager</code> for the <code class="highlight">status</code>)
as we went through the normal <code class="highlight">controller-runtime</code> creation logic:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>reconciler<span class="w"> </span>reconciler<span class="w"> </span>--show-managed-fields<span class="w"> </span>-o<span class="w"> </span>yaml
apiVersion:<span class="w"> </span>apps/v1
kind:<span class="w"> </span>Deployment
metadata:
<span class="w">  </span>annotations:
<span class="w">    </span>deployment.kubernetes.io/revision:<span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">  </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:29Z&quot;</span>
<span class="w">  </span>generation:<span class="w"> </span><span class="m">1</span>
<span class="w">  </span>managedFields:
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;6c9e435e-5edf-4a13-868d-d0b85aa09d1a&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:progressDeadlineSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:revisionHistoryLimit:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:
<span class="w">          </span>f:rollingUpdate:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxSurge:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxUnavailable:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:labels:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePath:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:dnsPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:restartPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:schedulerName:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:terminationGracePeriodSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>main
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:29Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:annotations:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:deployment.kubernetes.io/revision:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:status:
<span class="w">        </span>f:availableReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:conditions:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Available&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Progressing&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:observedGeneration:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:readyReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:updatedReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>kube-controller-manager
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>subresource:<span class="w"> </span>status
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:30Z&quot;</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div>
<p>We now trigger the reconciler loop again by making a change to the <code class="highlight">reconciler</code> object:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>patch<span class="w"> </span>reconciler<span class="w"> </span>reconciler-sample<span class="w"> </span>--type<span class="o">=</span><span class="s1">&#39;merge&#39;</span><span class="w"> </span>-p<span class="o">=</span><span class="s1">&#39;{&quot;spec&quot;:{&quot;replicas&quot;:2}}&#39;</span>
reconciler.test.example.com/reconciler-sample<span class="w"> </span>patched
</code></pre></div></td></tr></table></div>
<p>Now, the reconciler uses the <code class="highlight">Patch</code> method:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T12</span><span class="o">:</span><span class="mi">24</span><span class="o">:</span><span class="mi">31</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">patching</span><span class="w"> </span><span class="n">deployment</span><span class="w">     </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;namespace&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;reconcileID&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;21ff9b91-f540-455d-9266-ff9b83d3b3b0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 6c9e435e-5edf-4a13-868d-d0b85aa09d1a 0xc000680312 0xc000680311}] [] []},Spec:DeploymentSpec{Replicas:*2,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] &lt;nil&gt; [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:*1001,RunAsNonRoot:*false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:*false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  &lt;nil&gt; &lt;nil&gt;  map[]   &lt;nil&gt;  false false false &lt;nil&gt; &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:*true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  &lt;nil&gt; nil [] &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; map[] [] &lt;nil&gt; nil &lt;nil&gt; [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>And we can see that the field manager changes. We see an <code class="highlight">Apply</code> operation, and <code class="highlight"><span class="n">manager</span><span class="o">:</span><span class="w"> </span><span class="n">reconciler</span><span class="o">-</span><span class="n">controller</span></code> is
now the field manager, among others for the <code class="highlight"><span class="na">.spec.replica</span></code> field:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>reconciler<span class="w"> </span>reconciler<span class="w"> </span>--show-managed-fields<span class="w"> </span>-o<span class="w"> </span>yaml
apiVersion:<span class="w"> </span>apps/v1
kind:<span class="w"> </span>Deployment
metadata:
<span class="w">  </span>annotations:
<span class="w">    </span>deployment.kubernetes.io/revision:<span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">  </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:29Z&quot;</span>
<span class="w">  </span>generation:<span class="w"> </span><span class="m">2</span>
<span class="w">  </span>managedFields:
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;6c9e435e-5edf-4a13-868d-d0b85aa09d1a&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:creationTimestamp:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:labels:
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>reconciler-controller
<span class="w">    </span>operation:<span class="w"> </span>Apply
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:24:31Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;6c9e435e-5edf-4a13-868d-d0b85aa09d1a&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:progressDeadlineSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:revisionHistoryLimit:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:
<span class="w">          </span>f:rollingUpdate:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxSurge:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxUnavailable:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:labels:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePath:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:dnsPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:restartPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:schedulerName:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:terminationGracePeriodSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>main
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:29Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:annotations:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:deployment.kubernetes.io/revision:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:status:
<span class="w">        </span>f:availableReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:conditions:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Available&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Progressing&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:observedGeneration:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:readyReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:updatedReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>kube-controller-manager
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>subresource:<span class="w"> </span>status
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:24:32Z&quot;</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div>
<p>We now apply the following (partial) Deployment inside namespace <code class="highlight">reconciler</code> with name <code class="highlight">reconciler</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>test.yaml<span class="w"> </span>
apiVersion:<span class="w"> </span>apps/v1
kind:<span class="w"> </span>Deployment
metadata:
<span class="w">  </span>name:<span class="w"> </span>reconciler
<span class="w">  </span>namespace:<span class="w"> </span>reconciler
spec:
<span class="w">  </span>replicas:<span class="w"> </span><span class="m">8</span>
</code></pre></div></td></tr></table></div>
<p>This fails:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>test.yaml<span class="w"> </span>--server-side
error:<span class="w"> </span>Apply<span class="w"> </span>failed<span class="w"> </span>with<span class="w"> </span><span class="m">1</span><span class="w"> </span>conflict:<span class="w"> </span>conflict<span class="w"> </span>with<span class="w"> </span><span class="s2">&quot;reconciler-controller&quot;</span>:<span class="w"> </span>.spec.replicas
Please<span class="w"> </span>review<span class="w"> </span>the<span class="w"> </span>fields<span class="w"> </span>above--they<span class="w"> </span>currently<span class="w"> </span>have<span class="w"> </span>other<span class="w"> </span>managers.<span class="w"> </span>Here
are<span class="w"> </span>the<span class="w"> </span>ways<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span>resolve<span class="w"> </span>this<span class="w"> </span>warning:
*<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span>intend<span class="w"> </span>to<span class="w"> </span>manage<span class="w"> </span>all<span class="w"> </span>of<span class="w"> </span>these<span class="w"> </span>fields,<span class="w"> </span>please<span class="w"> </span>re-run<span class="w"> </span>the<span class="w"> </span>apply
<span class="w">  </span><span class="nb">command</span><span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span><span class="sb">`</span>--force-conflicts<span class="sb">`</span><span class="w"> </span>flag.
*<span class="w"> </span>If<span class="w"> </span>you<span class="w"> </span><span class="k">do</span><span class="w"> </span>not<span class="w"> </span>intend<span class="w"> </span>to<span class="w"> </span>manage<span class="w"> </span>all<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>fields,<span class="w"> </span>please<span class="w"> </span>edit<span class="w"> </span>your
<span class="w">  </span>manifest<span class="w"> </span>to<span class="w"> </span>remove<span class="w"> </span>references<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>fields<span class="w"> </span>that<span class="w"> </span>should<span class="w"> </span>keep<span class="w"> </span>their
<span class="w">  </span>current<span class="w"> </span>managers.
*<span class="w"> </span>You<span class="w"> </span>may<span class="w"> </span>co-own<span class="w"> </span>fields<span class="w"> </span>by<span class="w"> </span>updating<span class="w"> </span>your<span class="w"> </span>manifest<span class="w"> </span>to<span class="w"> </span>match<span class="w"> </span>the<span class="w"> </span>existing
<span class="w">  </span>value<span class="p">;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>this<span class="w"> </span><span class="k">case</span>,<span class="w"> </span>you<span class="err">&#39;</span>ll<span class="w"> </span>become<span class="w"> </span>the<span class="w"> </span>manager<span class="w"> </span><span class="k">if</span><span class="w"> </span>the<span class="w"> </span>other<span class="w"> </span>manager<span class="o">(</span>s<span class="o">)</span>
<span class="w">  </span>stop<span class="w"> </span>managing<span class="w"> </span>the<span class="w"> </span>field<span class="w"> </span><span class="o">(</span>remove<span class="w"> </span>it<span class="w"> </span>from<span class="w"> </span>their<span class="w"> </span>configuration<span class="o">)</span>.
See<span class="w"> </span>https://kubernetes.io/docs/reference/using-api/server-side-apply/#conflicts
</code></pre></div></td></tr></table></div>
<p>The reason is that the field manager for <code class="highlight"><span class="na">.spec.replicas</span></code> is set to <code class="highlight">reconciler-controller</code>, but the kubectl Server-Side
Apply has manager name <code class="highlight">kubectl</code>.</p>
<p>As already stated above, we can however, force the apply:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>test.yaml<span class="w"> </span>--server-side<span class="w"> </span>--force-conflicts
deployment.apps/reconciler<span class="w"> </span>serverside-applied
</code></pre></div></td></tr></table></div>
<p>Now, let's fetch the managed fields for the deployment:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>deployments<span class="w">  </span>-n<span class="w"> </span>reconciler<span class="w"> </span>reconciler<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w">  </span>--show-managed-fields<span class="w"> </span>
apiVersion:<span class="w"> </span>apps/v1
kind:<span class="w"> </span>Deployment
metadata:
<span class="w">  </span>annotations:
<span class="w">    </span>deployment.kubernetes.io/revision:<span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">  </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:29Z&quot;</span>
<span class="w">  </span>generation:<span class="w"> </span><span class="m">3</span>
<span class="w">  </span>managedFields:
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;6c9e435e-5edf-4a13-868d-d0b85aa09d1a&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:creationTimestamp:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:labels:
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>reconciler-controller
<span class="w">    </span>operation:<span class="w"> </span>Apply
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:24:31Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:spec:
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>kubectl
<span class="w">    </span>operation:<span class="w"> </span>Apply
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:33:02Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;6c9e435e-5edf-4a13-868d-d0b85aa09d1a&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:progressDeadlineSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:revisionHistoryLimit:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:
<span class="w">          </span>f:rollingUpdate:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxSurge:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxUnavailable:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:labels:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePath:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:dnsPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:restartPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:schedulerName:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:terminationGracePeriodSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div>
<p>In the above output, we can see that <code class="highlight"><span class="n">manager</span><span class="o">:</span><span class="w"> </span><span class="n">kubectl</span></code> last ran an <code class="highlight">Apply</code> operation and that it is the manager of
field <code class="highlight"><span class="na">.spec.replicas</span></code> now. Whereas <code class="highlight">reconciler-controller</code> is the manager of many of the other fields.</p>
<p>Now, let's trigger the controller's reconciler loop, again:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>patch<span class="w"> </span>reconciler<span class="w"> </span>reconciler-sample<span class="w"> </span>--type<span class="o">=</span><span class="s1">&#39;merge&#39;</span><span class="w"> </span>-p<span class="o">=</span><span class="s1">&#39;{&quot;spec&quot;:{&quot;replicas&quot;:3}}&#39;</span>
reconciler.test.example.com/reconciler-sample<span class="w"> </span>patched
</code></pre></div></td></tr></table></div>
<p>The reconciler's logic is triggered and the reconciler patches the deployment:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T12</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="mo">04</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">patching</span><span class="w"> </span><span class="n">deployment</span><span class="w">     </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;namespace&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;reconcileID&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;4493242e-dbd6-4a87-a25c-a00a2d9cd2ae&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 6c9e435e-5edf-4a13-868d-d0b85aa09d1a 0xc00071c262 0xc00071c261}] [] []},Spec:DeploymentSpec{Replicas:*3,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] &lt;nil&gt; [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:*1001,RunAsNonRoot:*false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:*false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  &lt;nil&gt; &lt;nil&gt;  map[]   &lt;nil&gt;  false false false &lt;nil&gt; &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:*true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  &lt;nil&gt; nil [] &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; map[] [] &lt;nil&gt; nil &lt;nil&gt; [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>After the next run of the reconciler, the entry with <code class="highlight"><span class="n">manager</span><span class="o">:</span><span class="w"> </span><span class="n">kubectl</span></code> is completely gone from the <code class="highlight">managedFields</code> and
instead the <code class="highlight"><span class="n">manager</span><span class="o">:</span><span class="w"> </span><span class="n">reconciler</span><span class="o">-</span><span class="n">controller</span></code> is again the manager of <code class="highlight"><span class="na">.spec.replicas</span></code>. This works because the operator
<a href="https://github.com/andreaskaris/reconciler-operator/blob/741884f5396b1ca5b0a7793fd4657fa5f2c4048f/internal/controller/reconciler_controller.go#L102">forces ownership</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>deployments<span class="w">  </span>-n<span class="w"> </span>reconciler<span class="w"> </span>reconciler<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w">  </span>--show-managed-fields<span class="w"> </span>
apiVersion:<span class="w"> </span>apps/v1
kind:<span class="w"> </span>Deployment
metadata:
<span class="w">  </span>annotations:
<span class="w">    </span>deployment.kubernetes.io/revision:<span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">  </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:29Z&quot;</span>
<span class="w">  </span>generation:<span class="w"> </span><span class="m">4</span>
<span class="w">  </span>managedFields:
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;6c9e435e-5edf-4a13-868d-d0b85aa09d1a&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:creationTimestamp:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:labels:
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>reconciler-controller
<span class="w">    </span>operation:<span class="w"> </span>Apply
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:35:04Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;6c9e435e-5edf-4a13-868d-d0b85aa09d1a&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:progressDeadlineSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:revisionHistoryLimit:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:
<span class="w">          </span>f:rollingUpdate:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxSurge:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxUnavailable:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:labels:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePath:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:dnsPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:restartPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:schedulerName:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:terminationGracePeriodSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>main
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:29Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:annotations:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:deployment.kubernetes.io/revision:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:status:
<span class="w">        </span>f:availableReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:conditions:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Available&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Progressing&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:observedGeneration:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:readyReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:updatedReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>kube-controller-manager
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>subresource:<span class="w"> </span>status
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:35:04Z&quot;</span>
<span class="o">(</span>...<span class="w"> </span>the<span class="w"> </span>kubectl<span class="w"> </span>Apply<span class="w"> </span>entry<span class="w"> </span>is<span class="w"> </span>completely<span class="w"> </span>gone,<span class="w"> </span>now<span class="w"> </span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div>
<p>Next, we make a manual edit to the deployment object:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>edit<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>reconciler<span class="w"> </span>reconciler
<span class="c1"># --&gt; Change replica count to 4.</span>
</code></pre></div></td></tr></table></div>
<p>This does not use Server-Side Apply, and changes the managed fields to:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>deployments<span class="w">  </span>-n<span class="w"> </span>reconciler<span class="w"> </span>reconciler<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w">  </span>--show-managed-fields<span class="w"> </span>
apiVersion:<span class="w"> </span>apps/v1
kind:<span class="w"> </span>Deployment
metadata:
<span class="w">  </span>annotations:
<span class="w">    </span>deployment.kubernetes.io/revision:<span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">  </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:29Z&quot;</span>
<span class="w">  </span>generation:<span class="w"> </span><span class="m">5</span>
<span class="w">  </span>managedFields:
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;6c9e435e-5edf-4a13-868d-d0b85aa09d1a&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:creationTimestamp:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:labels:
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>reconciler-controller
<span class="w">    </span>operation:<span class="w"> </span>Apply
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:35:04Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;6c9e435e-5edf-4a13-868d-d0b85aa09d1a&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:progressDeadlineSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:revisionHistoryLimit:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:
<span class="w">          </span>f:rollingUpdate:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxSurge:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:maxUnavailable:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:labels:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePath:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:terminationMessagePolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:dnsPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:restartPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:schedulerName:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:terminationGracePeriodSeconds:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>main
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:19:29Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:annotations:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:deployment.kubernetes.io/revision:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:status:
<span class="w">        </span>f:availableReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:conditions:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Available&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Progressing&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:observedGeneration:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:readyReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:updatedReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>kube-controller-manager
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>subresource:<span class="w"> </span>status
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:37:13Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:spec:
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>kubectl-edit
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T10:37:13Z&quot;</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div>
<p>From the above, you can see the <code class="highlight"><span class="n">manager</span><span class="o">:</span><span class="w"> </span><span class="n">kubectl</span><span class="o">-</span><span class="n">edit</span></code> is now the field manager of <code class="highlight"><span class="na">.spec.replicas</span></code> via <code class="highlight"><span class="n">operation</span><span class="o">:</span><span class="w"> </span><span class="n">Update</span></code>.</p>
<p>An explanation for why this did not create a conflict can be found in the
<a href="https://kubernetes.io/docs/reference/using-api/server-side-apply/#apply-and-update">kubernetes upstream documentation</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">Unless</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">specify</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">forced</span><span class="w"> </span><span class="nv">override</span>,<span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">apply</span><span class="w"> </span><span class="nv">operation</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">encounters</span><span class="w"> </span><span class="nv">field</span><span class="o">-</span><span class="nv">level</span><span class="w"> </span><span class="nv">conflicts</span><span class="w"> </span><span class="nv">always</span><span class="w"> </span><span class="nv">fails</span><span class="c1">; by contrast, if you make a change using update that would affect a managed field, a conflict never provokes failure of the operation.</span>

<span class="nv">All</span><span class="w"> </span><span class="nv">Server</span><span class="o">-</span><span class="nv">Side</span><span class="w"> </span><span class="nv">Apply</span><span class="w"> </span><span class="nv">patch</span><span class="w"> </span><span class="nv">requests</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">required</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">identify</span><span class="w"> </span><span class="nv">themselves</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">providing</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">fieldManager</span><span class="w"> </span><span class="nv">query</span><span class="w"> </span><span class="nv">parameter</span>,<span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">query</span><span class="w"> </span><span class="nv">parameter</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">optional</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="nv">operations</span>.<span class="w"> </span><span class="nv">Finally</span>,<span class="w"> </span><span class="nv">when</span><span class="w"> </span><span class="nv">using</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">Apply</span><span class="w"> </span><span class="nv">operation</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">cannot</span><span class="w"> </span><span class="nv">define</span><span class="w"> </span><span class="nv">managedFields</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">body</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">request</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">submit</span>.
</code></pre></div></td></tr></table></div>
<h2 id="partial-reconciliation-via-patch-statement-and-server-side-apply-with-the-controller-runtime">Partial reconciliation via Patch statement and Server-Side Apply with the controller-runtime</h2>
<p>Here's part of a packet capture which includes a <code class="highlight">PATCH</code> requests from the reconciler operator to the kubernetes API:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nf">PATCH</span> <span class="nn">/apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=reconciler-controller&amp;force=true</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">127.0.0.1:8001</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">main/v0.0.0 (linux/amd64) kubernetes/$Format</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">882</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/vnd.kubernetes.protobuf, */*</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/apply-patch+yaml</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>

{&quot;kind&quot;:&quot;Deployment&quot;,&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;metadata&quot;:{&quot;name&quot;:&quot;reconciler&quot;,&quot;namespace&quot;:&quot;reconciler&quot;,&quot;creationTimestamp&quot;:null,&quot;ownerReferences&quot;:[{&quot;apiVersion&quot;:&quot;test.example.com/v1alpha1&quot;,&quot;kind&quot;:&quot;Reconciler&quot;,&quot;name&quot;:&quot;reconciler-sample&quot;,&quot;uid&quot;:&quot;c8f0aab2-b8bd-438f-ad50-043e65017963&quot;,&quot;controller&quot;:true,&quot;blockOwnerDeletion&quot;:true}]},&quot;spec&quot;:{&quot;replicas&quot;:5,&quot;selector&quot;:{&quot;matchLabels&quot;:{&quot;app&quot;:&quot;reconciler-deployment&quot;}},&quot;template&quot;:{&quot;metadata&quot;:{&quot;creationTimestamp&quot;:null,&quot;labels&quot;:{&quot;app&quot;:&quot;reconciler-deployment&quot;}},&quot;spec&quot;:{&quot;containers&quot;:[{&quot;name&quot;:&quot;netshoot&quot;,&quot;image&quot;:&quot;nicolaka/netshoot&quot;,&quot;command&quot;:[&quot;sleep&quot;,&quot;infinity&quot;],&quot;resources&quot;:{},&quot;imagePullPolicy&quot;:&quot;IfNotPresent&quot;,&quot;securityContext&quot;:{&quot;capabilities&quot;:{&quot;drop&quot;:[&quot;ALL&quot;]},&quot;runAsUser&quot;:1001,&quot;runAsNonRoot&quot;:false,&quot;allowPrivilegeEscalation&quot;:false}}],&quot;securityContext&quot;:{&quot;runAsNonRoot&quot;:true,&quot;seccompProfile&quot;:{&quot;type&quot;:&quot;RuntimeDefault&quot;}}}},&quot;strategy&quot;:{}},&quot;status&quot;:{}}
</code></pre></div></td></tr></table></div>
<p>The reconciler in the above case sends the <a href="https://github.com/andreaskaris/reconciler-operator/blob/full-reconcile-ssa/internal/controller/reconciler_controller.go#L102">full deployment definition</a>
to the API server. However, we can modify the code to only send the modified replica count during a reconciliation loop:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="k">full</span><span class="o">-</span><span class="n">reconcile</span><span class="o">-</span><span class="n">ssa</span>
<span class="n">diff</span><span class="w"> </span><span class="c1">--git a/internal/controller/reconciler_controller.go b/internal/controller/reconciler_controller.go</span>
<span class="k">index</span><span class="w"> </span><span class="mi">121</span><span class="n">c1dc</span><span class="p">.</span><span class="mf">.4</span><span class="n">a6978e</span><span class="w"> </span><span class="mi">100644</span>
<span class="c1">--- a/internal/controller/reconciler_controller.go</span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">internal</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="n">reconciler_controller</span><span class="p">.</span><span class="k">go</span>
<span class="err">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">96</span><span class="p">,</span><span class="mi">6</span><span class="w"> </span><span class="o">+</span><span class="mi">96</span><span class="p">,</span><span class="mi">10</span><span class="w"> </span><span class="err">@@</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">Reconcile</span><span class="p">(</span><span class="n">ctx</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="n">ctrl</span><span class="p">.</span><span class="n">Request</span><span class="p">)</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Patch</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="n">here</span><span class="err">!</span>
<span class="o">+</span><span class="w">       </span><span class="n">desiredDeployment</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">getReconcilerDeploymentPatch</span><span class="p">(</span><span class="n">reconciler</span><span class="p">)</span>
<span class="o">+</span><span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="err">{</span>
<span class="o">+</span><span class="w">               </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="p">.</span><span class="k">Result</span><span class="err">{}</span><span class="p">,</span><span class="w"> </span><span class="n">err</span>
<span class="o">+</span><span class="w">       </span><span class="err">}</span>
<span class="w">        </span><span class="n">desiredDeployment</span><span class="p">.</span><span class="n">APIVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;apps/v1&quot;</span>
<span class="w">        </span><span class="n">desiredDeployment</span><span class="p">.</span><span class="n">Kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Deployment&quot;</span>
<span class="w">        </span><span class="n">logger</span><span class="p">.</span><span class="n">Info</span><span class="p">(</span><span class="ss">&quot;patching deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="p">)</span>
<span class="err">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">114</span><span class="p">,</span><span class="mi">6</span><span class="w"> </span><span class="o">+</span><span class="mi">118</span><span class="p">,</span><span class="mi">28</span><span class="w"> </span><span class="err">@@</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">SetupWithManager</span><span class="p">(</span><span class="n">mgr</span><span class="w"> </span><span class="n">ctrl</span><span class="p">.</span><span class="n">Manager</span><span class="p">)</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="n">Complete</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="w"> </span><span class="err">}</span>

<span class="o">+</span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">getReconcilerDeploymentPatch</span><span class="p">(</span>
<span class="o">+</span><span class="w">       </span><span class="n">reconciler</span><span class="w"> </span><span class="o">*</span><span class="n">v1alpha1</span><span class="p">.</span><span class="n">Reconciler</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">appsv1</span><span class="p">.</span><span class="n">Deployment</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="o">+</span><span class="w">       </span><span class="n">ls</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">map</span><span class="o">[</span><span class="n">string</span><span class="o">]</span><span class="n">string</span><span class="err">{</span>
<span class="o">+</span><span class="w">               </span><span class="ss">&quot;app&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;reconciler-deployment&quot;</span><span class="p">,</span>
<span class="o">+</span><span class="w">       </span><span class="err">}</span>
<span class="o">+</span>
<span class="o">+</span><span class="w">       </span><span class="n">dep</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">appsv1</span><span class="p">.</span><span class="n">Deployment</span><span class="err">{</span>
<span class="o">+</span><span class="w">               </span><span class="nl">ObjectMeta</span><span class="p">:</span><span class="w"> </span><span class="n">metav1</span><span class="p">.</span><span class="n">ObjectMeta</span><span class="err">{</span>
<span class="o">+</span><span class="w">                       </span><span class="nl">Name</span><span class="p">:</span><span class="w">      </span><span class="n">reconciler</span><span class="p">.</span><span class="n">Spec</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
<span class="o">+</span><span class="w">                       </span><span class="nl">Namespace</span><span class="p">:</span><span class="w"> </span><span class="n">reconciler</span><span class="p">.</span><span class="n">Spec</span><span class="p">.</span><span class="n">Namespace</span><span class="p">,</span>
<span class="o">+</span><span class="w">               </span><span class="err">}</span><span class="p">,</span>
<span class="o">+</span><span class="w">               </span><span class="nl">Spec</span><span class="p">:</span><span class="w"> </span><span class="n">appsv1</span><span class="p">.</span><span class="n">DeploymentSpec</span><span class="err">{</span>
<span class="o">+</span><span class="w">                       </span><span class="nl">Replicas</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">reconciler</span><span class="p">.</span><span class="n">Spec</span><span class="p">.</span><span class="n">Replicas</span><span class="p">,</span>
<span class="o">+</span><span class="w">                       </span><span class="nl">Selector</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metav1</span><span class="p">.</span><span class="n">LabelSelector</span><span class="err">{</span>
<span class="o">+</span><span class="w">                               </span><span class="nl">MatchLabels</span><span class="p">:</span><span class="w"> </span><span class="n">ls</span><span class="p">,</span>
<span class="o">+</span><span class="w">                       </span><span class="err">}</span><span class="p">,</span>
<span class="o">+</span><span class="w">               </span><span class="err">}</span><span class="p">,</span>
<span class="o">+</span><span class="w">       </span><span class="err">}</span>
<span class="o">+</span><span class="w">       </span><span class="k">return</span><span class="w"> </span><span class="n">dep</span><span class="p">,</span><span class="w"> </span><span class="n">nil</span>
<span class="o">+</span><span class="err">}</span>
<span class="o">+</span>
<span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">getReconcilerDeployment</span><span class="p">(</span>
<span class="w">        </span><span class="n">reconciler</span><span class="w"> </span><span class="o">*</span><span class="n">v1alpha1</span><span class="p">.</span><span class="n">Reconciler</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">appsv1</span><span class="p">.</span><span class="n">Deployment</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
</code></pre></div></td></tr></table></div>
<p>With <a href="https://github.com/andreaskaris/reconciler-operator/blob/69b73a2f96a82a82fdbe87cb265e6ac44e63fea5/internal/controller/reconciler_controller.go#L106">this change</a>, 
the PATCH requests then look as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nf">PATCH</span> <span class="nn">/apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=reconciler-controller&amp;force=true</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">127.0.0.1:8001</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">main/v0.0.0 (linux/amd64) kubernetes/$Format</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">312</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/vnd.kubernetes.protobuf, */*</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/apply-patch+yaml</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>

{&quot;kind&quot;:&quot;Deployment&quot;,&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;metadata&quot;:{&quot;name&quot;:&quot;reconciler&quot;,&quot;namespace&quot;:&quot;reconciler&quot;,&quot;creationTimestamp&quot;:null},&quot;spec&quot;:{&quot;replicas&quot;:7,&quot;selector&quot;:{&quot;matchLabels&quot;:{&quot;app&quot;:&quot;reconciler-deployment&quot;}},&quot;template&quot;:{&quot;metadata&quot;:{&quot;creationTimestamp&quot;:null},&quot;spec&quot;:{&quot;containers&quot;:null}},&quot;strategy&quot;:{}},&quot;status&quot;:{}}
</code></pre></div></td></tr></table></div>
<p>In the above diff, you can see that the DeploymentSpec includes and redefines the <code class="highlight">Spec.Selector</code>. This is required because
<code class="highlight">controller-runtime</code> does not fully implement first-citizen Server-Side Apply via the <code class="highlight">Apply</code> statement, yet.
If we did not redefine <code class="highlight"><span class="na">.spec.selector</span></code>, and the code looked as follows:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">git</span><span class="w"> </span><span class="n">diff</span>
<span class="n">diff</span><span class="w"> </span><span class="c1">--git a/internal/controller/reconciler_controller.go b/internal/controller/reconciler_controller.go</span>
<span class="k">index</span><span class="w"> </span><span class="mi">4</span><span class="n">a6978e</span><span class="p">..</span><span class="n">fc2de54</span><span class="w"> </span><span class="mi">100644</span>
<span class="c1">--- a/internal/controller/reconciler_controller.go</span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">internal</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="n">reconciler_controller</span><span class="p">.</span><span class="k">go</span>
<span class="err">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">121</span><span class="p">,</span><span class="mi">9</span><span class="w"> </span><span class="o">+</span><span class="mi">121</span><span class="p">,</span><span class="mi">9</span><span class="w"> </span><span class="err">@@</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">SetupWithManager</span><span class="p">(</span><span class="n">mgr</span><span class="w"> </span><span class="n">ctrl</span><span class="p">.</span><span class="n">Manager</span><span class="p">)</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="err">{</span>
<span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">getReconcilerDeploymentPatch</span><span class="p">(</span>
<span class="n">diff</span><span class="w"> </span><span class="c1">--git a/internal/controller/reconciler_controller.go b/internal/controller/reconciler_controller.go</span>
<span class="k">index</span><span class="w"> </span><span class="mi">4</span><span class="n">a6978e</span><span class="p">..</span><span class="n">fc2de54</span><span class="w"> </span><span class="mi">100644</span>
<span class="c1">--- a/internal/controller/reconciler_controller.go</span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">internal</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="n">reconciler_controller</span><span class="p">.</span><span class="k">go</span>
<span class="err">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">121</span><span class="p">,</span><span class="mi">9</span><span class="w"> </span><span class="o">+</span><span class="mi">121</span><span class="p">,</span><span class="mi">9</span><span class="w"> </span><span class="err">@@</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">SetupWithManager</span><span class="p">(</span><span class="n">mgr</span><span class="w"> </span><span class="n">ctrl</span><span class="p">.</span><span class="n">Manager</span><span class="p">)</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="err">{</span>
<span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">getReconcilerDeploymentPatch</span><span class="p">(</span>
<span class="w">        </span><span class="n">reconciler</span><span class="w"> </span><span class="o">*</span><span class="n">v1alpha1</span><span class="p">.</span><span class="n">Reconciler</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">appsv1</span><span class="p">.</span><span class="n">Deployment</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="o">-</span><span class="w">       </span><span class="n">ls</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">map</span><span class="o">[</span><span class="n">string</span><span class="o">]</span><span class="n">string</span><span class="err">{</span>
<span class="o">+</span><span class="w">       </span><span class="cm">/*ls := map[string]string{</span>
<span class="cm">                &quot;app&quot;: &quot;reconciler-deployment&quot;,</span>
<span class="cm">-       }</span>
<span class="cm">+       }*/</span>

<span class="w">        </span><span class="n">dep</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">appsv1</span><span class="p">.</span><span class="n">Deployment</span><span class="err">{</span>
<span class="w">                </span><span class="nl">ObjectMeta</span><span class="p">:</span><span class="w"> </span><span class="n">metav1</span><span class="p">.</span><span class="n">ObjectMeta</span><span class="err">{</span>
<span class="err">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">132</span><span class="p">,</span><span class="mi">9</span><span class="w"> </span><span class="o">+</span><span class="mi">132</span><span class="p">,</span><span class="mi">9</span><span class="w"> </span><span class="err">@@</span><span class="w"> </span><span class="n">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">getReconcilerDeploymentPatch</span><span class="p">(</span>
<span class="w">                </span><span class="err">}</span><span class="p">,</span>
<span class="w">                </span><span class="nl">Spec</span><span class="p">:</span><span class="w"> </span><span class="n">appsv1</span><span class="p">.</span><span class="n">DeploymentSpec</span><span class="err">{</span>
<span class="w">                        </span><span class="nl">Replicas</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">reconciler</span><span class="p">.</span><span class="n">Spec</span><span class="p">.</span><span class="n">Replicas</span><span class="p">,</span>
<span class="o">-</span><span class="w">                       </span><span class="nl">Selector</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">metav1</span><span class="p">.</span><span class="n">LabelSelector</span><span class="err">{</span>
<span class="o">+</span><span class="w">                       </span><span class="cm">/*Selector: &amp;metav1.LabelSelector{</span>
<span class="cm">                                MatchLabels: ls,</span>
<span class="cm">-                       },</span>
<span class="cm">+                       },*/</span>
<span class="w">                </span><span class="err">}</span><span class="p">,</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dep</span><span class="p">,</span><span class="w"> </span><span class="n">nil</span>
</code></pre></div></td></tr></table></div>
<p>We would get the following error message in the reconciler:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="n">03T10</span><span class="o">:</span><span class="mi">44</span><span class="o">:</span><span class="mi">31</span><span class="o">+</span><span class="mi">02</span><span class="o">:</span><span class="mi">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">patching</span><span class="w"> </span><span class="n">deployment</span><span class="w">     </span><span class="err">{</span><span class="s2">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reconciler&quot;</span><span class="o">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;reconciler-sample&quot;</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;namespace&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;reconciler-sample&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;reconcileID&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;52587ce8-308d-4611-aad5-67b4cbe17c2f&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;deployment&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[] map[] [] [] []},Spec:DeploymentSpec{Replicas:*9,Selector:nil,Template:{{      0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[] map[] [] [] []} {[] [] [] []  &lt;nil&gt; &lt;nil&gt;  map[]   &lt;nil&gt;  false false false &lt;nil&gt; nil []   nil  [] []  &lt;nil&gt; nil [] &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; map[] [] &lt;nil&gt; nil &lt;nil&gt; [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}&quot;</span><span class="err">}</span>
<span class="mi">2025</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="n">03T10</span><span class="o">:</span><span class="mi">44</span><span class="o">:</span><span class="mi">31</span><span class="o">+</span><span class="mi">02</span><span class="o">:</span><span class="mi">00</span><span class="w">       </span><span class="k">ERROR</span><span class="w">   </span><span class="n">Reconciler</span><span class="w"> </span><span class="k">error</span><span class="w">        </span><span class="err">{</span><span class="s2">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Reconciler&quot;</span><span class="o">:</span><span class="w"> </span><span class="err">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;reconciler-sample&quot;</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;namespace&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;reconciler-sample&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;reconcileID&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;52587ce8-308d-4611-aad5-67b4cbe17c2f&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Deployment.apps </span><span class="se">\&quot;</span><span class="s2">reconciler</span><span class="se">\&quot;</span><span class="s2"> is invalid: [spec.selector: Required value, spec.template.metadata.labels: Invalid value: map[string]string{</span><span class="se">\&quot;</span><span class="s2">app</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">reconciler-deployment</span><span class="se">\&quot;</span><span class="s2">}: `selector` does not match template `labels`, spec.selector: Invalid value: </span><span class="se">\&quot;</span><span class="s2">null</span><span class="se">\&quot;</span><span class="s2">: field is immutable]&quot;</span><span class="err">}</span>
</code></pre></div></td></tr></table></div>
<p>And the <code class="highlight">PATCH</code> statement would look like this, including a <code class="highlight">null</code> <code class="highlight"><span class="na">.spec.selector</span></code> causing the issue. We can also see that
other fields are transmitted with their default values:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nf">PATCH</span> <span class="nn">/apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=reconciler-controller&amp;force=true</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">127.0.0.1:8001</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">main/v0.0.0 (linux/amd64) kubernetes/$Format</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">269</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/vnd.kubernetes.protobuf, */*</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/apply-patch+yaml</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>

{&quot;kind&quot;:&quot;Deployment&quot;,&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;metadata&quot;:{&quot;name&quot;:&quot;reconciler&quot;,&quot;namespace&quot;:&quot;reconciler&quot;,&quot;creationTimestamp&quot;:null},&quot;spec&quot;:{&quot;replicas&quot;:9,&quot;selector&quot;:null,&quot;template&quot;:{&quot;metadata&quot;:{&quot;creationTimestamp&quot;:null},&quot;spec&quot;:{&quot;containers&quot;:null}},&quot;strategy&quot;:{}},&quot;status&quot;:{}}

HTTP/1.1 422 Unprocessable Entity
(...)
</code></pre></div></td></tr></table></div>
<p>For more details, see the documentation for <a href="https://pkg.go.dev/k8s.io/client-go/applyconfigurations">applyconfigurations</a>.</p>
<p>Compare this to the request that <code class="highlight">kubectl apply -f debugging/test.yaml --server-side</code> produces:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nf">PATCH</span> <span class="nn">/apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=kubectl&amp;fieldValidation=Strict&amp;force=false</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">127.0.0.1:8001</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">kubectl/v1.33.2 (linux/amd64) kubernetes/a57b6f7</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">125</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/apply-patch+yaml</span>
<span class="na">Kubectl-Command</span><span class="o">:</span> <span class="l">kubectl apply</span>
<span class="na">Kubectl-Session</span><span class="o">:</span> <span class="l">3bdd8423-e68d-4b30-9c1f-258b1e7630bd</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>

{&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;Deployment&quot;,&quot;metadata&quot;:{&quot;name&quot;:&quot;reconciler&quot;,&quot;namespace&quot;:&quot;reconciler&quot;},&quot;spec&quot;:{&quot;replicas&quot;:6}}
</code></pre></div></td></tr></table></div>
<p>It does not include the selector, nor any other default fields, thus this does not lead to a conflict, because
kubectl with Server-Side Apply <a href="https://github.com/kubernetes/kubernetes/blob/d9df4ecff77012e63164292ab900fd23b2a714e0/staging/src/k8s.io/kubectl/pkg/cmd/apply/apply.go#L579">encodes the entire JSON scheme</a>
as is into a <code class="highlight">[]byte</code>  and sends this as a <code class="highlight">PATCH</code> request.</p>
<h2 id="skipping-getcreate-getupdate-with-patch-and-fully-specified-intent-for-constructive-controllers">Skipping Get/Create Get/Update with Patch and fully specified intent for constructive controllers</h2>
<p>It is possible to take Server-Side Apply one step further and to use the <code class="highlight">Patch</code> method
<a href="https://github.com/andreaskaris/reconciler-operator/blob/97ab8c69effacb1c43fd7718a9f47144d5607d33/internal/controller/reconciler_controller.go#L82">for both object creation and updates</a>.
This simplifies the logic of the reconciler of
<a href="https://kubernetes.io/blog/2022/10/20/advanced-server-side-apply/#reconstructive-controllers">constructive controllers</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">func</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="n">ReconcilerReconciler</span><span class="p">)</span><span class="w"> </span><span class="n">Reconcile</span><span class="p">(</span><span class="n">ctx</span><span class="w"> </span><span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">logger</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">logf</span><span class="o">.</span><span class="n">FromContext</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">TODO</span><span class="p">(</span><span class="n">user</span><span class="p">):</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">here</span>
<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;reconciler was called&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">reconciler</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v1alpha1</span><span class="o">.</span><span class="n">Reconciler</span><span class="p">{}</span>
<span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">req</span><span class="o">.</span><span class="n">NamespacedName</span><span class="p">,</span><span class="w"> </span><span class="n">reconciler</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">apierrors</span><span class="o">.</span><span class="n">IsNotFound</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;reconciler resource not found. Ignoring since object must be deleted&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">nil</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">requeue</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">request</span><span class="o">.</span>
<span class="w">        </span><span class="n">logger</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Failed to get reconciler&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">desiredDeployment</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">getReconcilerDeployment</span><span class="p">(</span><span class="n">reconciler</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">err</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">desiredDeployment</span><span class="o">.</span><span class="n">APIVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;apps/v1&quot;</span>
<span class="w">    </span><span class="n">desiredDeployment</span><span class="o">.</span><span class="n">Kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Deployment&quot;</span>
<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;patching deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">Apply</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">ForceOwnership</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">FieldOwner</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Name</span><span class="p">));</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">err</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{},</span><span class="w"> </span><span class="n">nil</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Starting from a clean sheet, with only the kind <code class="highlight">reconciler</code> object with name <code class="highlight">reconciler-sample</code> present, this will only
send a single <code class="highlight">PATCH</code> request to the API server:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">samples</span>
<span class="n">$</span><span class="w"> </span><span class="n">go</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">cmd</span><span class="o">/</span><span class="n">main</span><span class="p">.</span><span class="n">go</span>
<span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T13</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mi">21</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">setup</span><span class="w">   </span><span class="n">starting</span><span class="w"> </span><span class="n">manager</span>
<span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T13</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mi">21</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">starting</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;health probe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;addr&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;[::]:8081&quot;</span><span class="p">}</span>
<span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T13</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mi">21</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">Starting</span><span class="w"> </span><span class="n">EventSource</span><span class="w">    </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;source&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;kind source: *v1alpha1.Reconciler&quot;</span><span class="p">}</span>
<span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T13</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mi">21</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">Starting</span><span class="w"> </span><span class="n">Controller</span><span class="w">     </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">}</span>
<span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T13</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mi">21</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">Starting</span><span class="w"> </span><span class="n">workers</span><span class="w">        </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;worker count&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T13</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mi">21</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">reconciler</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">called</span><span class="w">   </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;namespace&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;reconcileID&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;74304b1e-bb08-4e38-83fc-c888a64f8b6e&quot;</span><span class="p">}</span>
<span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T13</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mi">21</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">patching</span><span class="w"> </span><span class="n">deployment</span><span class="w">     </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;namespace&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;reconcileID&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;74304b1e-bb08-4e38-83fc-c888a64f8b6e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 259e2baf-46f9-47b4-b472-d7f17623b278 0xc000881982 0xc000881981}] [] []},Spec:DeploymentSpec{Replicas:*1,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] &lt;nil&gt; [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:*1001,RunAsNonRoot:*false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:*false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  &lt;nil&gt; &lt;nil&gt;  map[]   &lt;nil&gt;  false false false &lt;nil&gt; &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:*true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  &lt;nil&gt; nil [] &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; map[] [] &lt;nil&gt; nil &lt;nil&gt; [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code class="highlight"><span class="n">manager</span><span class="o">:</span><span class="w"> </span><span class="n">reconciler</span><span class="o">-</span><span class="n">controller</span></code> is now the only field manager with the exception of <code class="highlight">kube-controller-manager</code> for the
status field:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>deployments<span class="w">  </span>-n<span class="w"> </span>reconciler<span class="w"> </span>reconciler<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w">  </span>--show-managed-fields<span class="w"> </span>
apiVersion:<span class="w"> </span>apps/v1
kind:<span class="w"> </span>Deployment
metadata:
<span class="w">  </span>annotations:
<span class="w">    </span>deployment.kubernetes.io/revision:<span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="w">  </span>creationTimestamp:<span class="w"> </span><span class="s2">&quot;2025-09-03T11:04:21Z&quot;</span>
<span class="w">  </span>generation:<span class="w"> </span><span class="m">1</span>
<span class="w">  </span>managedFields:
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:ownerReferences:
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;259e2baf-46f9-47b4-b472-d7f17623b278&quot;</span><span class="o">}</span>:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:spec:
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:selector:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:strategy:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:template:
<span class="w">          </span>f:metadata:
<span class="w">            </span>f:creationTimestamp:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:labels:
<span class="w">              </span>f:app:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:spec:
<span class="w">            </span>f:containers:
<span class="w">              </span>k:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span><span class="o">}</span>:
<span class="w">                </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:command:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:image:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:imagePullPolicy:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:name:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:resources:<span class="w"> </span><span class="o">{}</span>
<span class="w">                </span>f:securityContext:
<span class="w">                  </span>f:allowPrivilegeEscalation:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:capabilities:
<span class="w">                    </span>f:drop:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">                  </span>f:runAsUser:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:securityContext:
<span class="w">              </span>f:runAsNonRoot:<span class="w"> </span><span class="o">{}</span>
<span class="w">              </span>f:seccompProfile:
<span class="w">                </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>reconciler-controller
<span class="w">    </span>operation:<span class="w"> </span>Apply
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T11:04:21Z&quot;</span>
<span class="w">  </span>-<span class="w"> </span>apiVersion:<span class="w"> </span>apps/v1
<span class="w">    </span>fieldsType:<span class="w"> </span>FieldsV1
<span class="w">    </span>fieldsV1:
<span class="w">      </span>f:metadata:
<span class="w">        </span>f:annotations:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>f:deployment.kubernetes.io/revision:<span class="w"> </span><span class="o">{}</span>
<span class="w">      </span>f:status:
<span class="w">        </span>f:availableReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:conditions:
<span class="w">          </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Available&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">          </span>k:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Progressing&quot;</span><span class="o">}</span>:
<span class="w">            </span>.:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastTransitionTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:lastUpdateTime:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:message:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:reason:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:status:<span class="w"> </span><span class="o">{}</span>
<span class="w">            </span>f:type:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:observedGeneration:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:readyReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:replicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">        </span>f:updatedReplicas:<span class="w"> </span><span class="o">{}</span>
<span class="w">    </span>manager:<span class="w"> </span>kube-controller-manager
<span class="w">    </span>operation:<span class="w"> </span>Update
<span class="w">    </span>subresource:<span class="w"> </span>status
<span class="w">    </span>time:<span class="w"> </span><span class="s2">&quot;2025-09-03T11:04:21Z&quot;</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div>
<p>And reconciliation works with the exact same logic:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>patch<span class="w"> </span>reconciler<span class="w"> </span>reconciler-sample<span class="w"> </span>--type<span class="o">=</span><span class="s1">&#39;merge&#39;</span><span class="w"> </span>-p<span class="o">=</span><span class="s1">&#39;{&quot;spec&quot;:{&quot;replicas&quot;:3}}&#39;</span>
reconciler.test.example.com/reconciler-sample<span class="w"> </span>patched
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T13</span><span class="o">:</span><span class="mo">07</span><span class="o">:</span><span class="mi">10</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">reconciler</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">called</span><span class="w">   </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;namespace&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;reconcileID&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;b0e3cf40-ad0d-4c71-95a9-a54d3f2db3aa&quot;</span><span class="p">}</span>
<span class="mi">2025-09</span><span class="mo">-03</span><span class="n">T13</span><span class="o">:</span><span class="mo">07</span><span class="o">:</span><span class="mi">10</span><span class="o">+</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w">       </span><span class="n">INFO</span><span class="w">    </span><span class="n">patching</span><span class="w"> </span><span class="n">deployment</span><span class="w">     </span><span class="p">{</span><span class="s">&quot;controller&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerGroup&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;test.example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;controllerKind&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Reconciler&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">},</span><span class="w"> </span><span class="s">&quot;namespace&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;reconciler-sample&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;reconcileID&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;b0e3cf40-ad0d-4c71-95a9-a54d3f2db3aa&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 259e2baf-46f9-47b4-b472-d7f17623b278 0xc000726662 0xc000726661}] [] []},Spec:DeploymentSpec{Replicas:*3,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] &lt;nil&gt; [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:*1001,RunAsNonRoot:*false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:*false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  &lt;nil&gt; &lt;nil&gt;  map[]   &lt;nil&gt;  false false false &lt;nil&gt; &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:*true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  &lt;nil&gt; nil [] &lt;nil&gt; &lt;nil&gt; &lt;nil&gt; map[] [] &lt;nil&gt; nil &lt;nil&gt; [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="conclusion">Conclusion</h2>
<p>In this blog post, we explored Server-Side Apply in the context of controller-runtime controllers. We started by examining
how kubectl uses Server-Side Apply and understanding the HTTP requests it generates to the API server. We then looked at
the current state of SSA support in controller-runtime and built a working example using the Operator SDK.</p>
<p>We looked at how field management works in practice by showing conflicts between different field managers and how ownership
transfers when using forced applies. We traced network packets to see the actual API requests generated by both kubectl
and controller-runtime implementations.</p>
<p>Finally, we showed how Server-Side Apply can simplify controller logic by eliminating the need for separate Get/Create
and Get/Update patterns, allowing controllers to use a single Patch operation for both object creation and updates.</p>
<p>Server-Side Apply simplifies controller logic by using a single approach for both creating and updating resources.
Instead of checking if an object exists and then choosing between Create or Update operations, controllers can use the
Patch method with <code class="highlight">client.Apply</code> for all cases.</p>
<p>This approach works particularly well for constructive controllers that want to declare the desired state of resources.
The controller builds the complete object definition and lets the Kubernetes API server handle the differences. Field
management ensures that conflicts are detected and ownership is tracked properly.</p>
<p>For new controllers, using the Patch method with <code class="highlight">client.Apply</code>, <code class="highlight">client.ForceOwnership</code>, and <code class="highlight">client.FieldOwner</code> provides
a clean and simple reconciliation pattern that handles both object creation and updates with the same code path.</p>
<p>In the near future, SSA will be fully implemented, supported and documented for the <code class="highlight">controller-runtime</code> and it will then
be best to use the native features instead of the Patch method.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 3, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.prune", "navigation.top", "navigation.path", "navigation.indexes", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>