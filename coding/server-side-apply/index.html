
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Andreas Karis' blog about anything Kubernetes, OpenShift, Linux and Networking">
      
      
      
        <link rel="canonical" href="https://andreaskaris.github.io/blog/coding/server-side-apply/">
      
      
        <link rel="prev" href="../golang-ip-conversion/">
      
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Kubernetes Server Side Apply - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="RSS feed of created content" href="https://andreaskaris.github.io/blog/feed_rss_created.xml">
  <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="https://andreaskaris.github.io/blog/feed_rss_updated.xml">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#server-side-apply-in-kubernetes-controllers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Kubernetes Server Side Apply
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ceph/" class="md-tabs__link">
          
  
    
  
  Ceph

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux/" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../networking/" class="md-tabs__link">
          
  
    
  
  Networking

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openshift/" class="md-tabs__link">
          
  
    
  
  OpenShift and Kubernetes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openstack/" class="md-tabs__link">
          
  
    
  
  OpenStack

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Coding

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  
    
    <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../ceph/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Ceph
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../linux/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Linux
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../networking/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../openshift/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    OpenShift and Kubernetes
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../openstack/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    OpenStack
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coding
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Coding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operator-sdk-reconciliation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller Reconciliation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../golang-ip-conversion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Golang IP address conversion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Kubernetes Server Side Apply
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Kubernetes Server Side Apply
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-server-side-apply-is-of-interest-for-controller-developers" class="md-nav__link">
    <span class="md-ellipsis">
      Why Server-Side Apply is of interest for controller developers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-does-server-side-apply-look-like" class="md-nav__link">
    <span class="md-ellipsis">
      What does Server-Side Apply look like?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#current-status-for-server-side-apply-in-controller-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      Current status for Server-Side Apply in controller-runtime
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#field-management" class="md-nav__link">
    <span class="md-ellipsis">
      Field management
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
        </div>
      </div>
    </div>
  
  

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="server-side-apply-in-kubernetes-controllers">Server-Side Apply in Kubernetes controllers</h1>
<p>This blog post explores Server-Side Apply (SSA) in the context of <code class="highlight">controller-runtime</code> controllers. We'll examine how
kubectl sends server-side apply requests to understand the underlying mechanics, and demonstrate SSA implementation
using a small dummy controller built with the Operator SDK (kubebuilder). Through practical examples and network traces,
we'll see how <code class="highlight">controller-runtime</code> reconciles resources using SSA and how field management works in practice.</p>
<h2 id="why-server-side-apply-is-of-interest-for-controller-developers">Why Server-Side Apply is of interest for controller developers</h2>
<p>An <a href="https://kubernetes.io/blog/2022/10/20/advanced-server-side-apply/#reconstructive-controllers">upstream kubernetes project blog post</a>
states that SSA is an ideal tool for constructive controllers:</p>
<blockquote>
<p>This kind of controller wasn't really possible prior to SSA. The idea here is to (whenever something changes etc) reconstruct from scratch the fields of the object as the controller wishes them to be, and then apply the change to the server, letting it figure out the result. I now recommend that new controllers start out this way–it's less fiddly to say what you want an object to look like than it is to say how you want it to change.</p>
<p>The client library supports this method of operation by default.</p>
</blockquote>
<p>It also addresses one of the downsides of sending unneeded apply requests, but also states that this is likely not
an issue in real-life scenarios and that it also cannot easily be fixed by sending an extra GET to retrieve the existing
state:</p>
<blockquote>
<p>The only downside is that you may end up sending unneeded apply requests to the API server, even if actually the object already matches your controller’s desires. This doesn't matter if it happens once in a while, but for extremely high-throughput controllers, it might cause a performance problem for the cluster–specifically, the API server. No-op writes are not written to storage (etcd) or broadcast to any watchers, so it’s not really that big of a deal. If you’re worried about this anyway, today you could use the method explained in the previous section, or you could still do it this way for now, and wait for an additional client-side mechanism to suppress zero-change applies.</p>
<p>To get around this downside, why not GET the object and only send your apply if the object needs it? Surprisingly, it doesn't help much – a no-op apply is not very much more work for the API server than an extra GET; and an apply that changes things is cheaper than that same apply with a preceding GET. Worse, since it is a distributed system, something could change between your GET and apply, invalidating your computation</p>
</blockquote>
<p>The upstream <a href="https://kubernetes.io/docs/reference/using-api/server-side-apply/#using-server-side-apply-in-a-controller">kubernetes documentation suggests</a>
using Server-Side Apply in controllers:</p>
<blockquote>
<p>Using Server-Side Apply in a controller</p>
<p>As a developer of a controller, you can use Server-Side Apply as a way to simplify the update logic of your controller. The main differences with a read-modify-write and/or patch are the following:</p>
<p>the applied object must contain all the fields that the controller cares about.
   there is no way to remove fields that haven't been applied by the controller before (controller can still send a patch or update for these use-cases).
   the object doesn't have to be read beforehand; resourceVersion doesn't have to be specified.</p>
</blockquote>
<p>In addition, the documentation strongly recommends to force ownership of fields in case of conflicts:</p>
<blockquote>
<p>It is strongly recommended for controllers to always force conflicts on objects that they own and manage, since they might not be able to resolve or act on these conflicts</p>
</blockquote>
<h2 id="what-does-server-side-apply-look-like">What does Server-Side Apply look like?</h2>
<p>Similar to a patch, Server-Side Apply allows a user to define only the fields that they want to be changed and to apply
those changes. In this section, we want to change the replica count for existing deployment <code class="highlight">reconciler</code> inside namespace
<code class="highlight">reconciler</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>test.yaml<span class="w"> </span>
apiVersion:<span class="w"> </span>apps/v1
kind:<span class="w"> </span>Deployment
metadata:
<span class="w">  </span>name:<span class="w"> </span>reconciler
<span class="w">  </span>namespace:<span class="w"> </span>reconciler
spec:
<span class="w">  </span>replicas:<span class="w"> </span><span class="m">8</span>
</code></pre></div></td></tr></table></div>
<p>We can then apply this change with SSA with kubectl by using the <code class="highlight">--server-side</code> flag:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>kubectl apply -f test.yaml --server-side
</code></pre></div></td></tr></table></div>
<p>Here's what server side apply looks like for the API, where <code class="highlight">Content-Type: application/apply-patch+yaml</code> indicates that
<a href="https://kubernetes.io/docs/reference/using-api/server-side-apply/#api-implementation">server side apply shall be used</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-v10<span class="w"> </span>-f<span class="w"> </span>test.yaml<span class="w"> </span>--server-side<span class="w"> </span>--force-conflicts
<span class="o">(</span>...<span class="o">)</span>
I0902<span class="w"> </span><span class="m">15</span>:48:02.616662<span class="w">  </span><span class="m">957821</span><span class="w"> </span>helper.go:269<span class="o">]</span><span class="w"> </span><span class="s2">&quot;Request Body&quot;</span><span class="w"> </span><span class="nv">body</span><span class="o">=</span>&lt;
<span class="w">        </span><span class="o">{</span><span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;kind&quot;</span>:<span class="s2">&quot;Deployment&quot;</span>,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;reconciler&quot;</span>,<span class="s2">&quot;namespace&quot;</span>:<span class="s2">&quot;reconciler&quot;</span><span class="o">}</span>,<span class="s2">&quot;spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;replicas&quot;</span>:8<span class="o">}}</span>
<span class="w"> </span>&gt;
I0902<span class="w"> </span><span class="m">15</span>:48:02.616722<span class="w">  </span><span class="m">957821</span><span class="w"> </span>round_trippers.go:527<span class="o">]</span><span class="w"> </span><span class="s2">&quot;Request&quot;</span><span class="w"> </span><span class="nv">curlCommand</span><span class="o">=</span>&lt;
<span class="w">        </span>curl<span class="w"> </span>-v<span class="w"> </span>-XPATCH<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Accept: application/json&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/apply-patch+yaml&quot;</span><span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;User-Agent: kubectl/v1.33.2 (linux/amd64) kubernetes/a57b6f7&quot;</span><span class="w"> </span><span class="s1">&#39;https://127.0.0.1:38503/apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=kubectl&amp;fieldValidation=Strict&amp;force=true&#39;</span>
<span class="w"> </span>&gt;
I0902<span class="w"> </span><span class="m">15</span>:48:02.625206<span class="w">  </span><span class="m">957821</span><span class="w"> </span>round_trippers.go:632<span class="o">]</span><span class="w"> </span><span class="s2">&quot;Response&quot;</span><span class="w"> </span><span class="nv">verb</span><span class="o">=</span><span class="s2">&quot;PATCH&quot;</span><span class="w"> </span><span class="nv">url</span><span class="o">=</span><span class="s2">&quot;https://127.0.0.1:38503/apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=kubectl&amp;fieldValidation=Strict&amp;force=true&quot;</span><span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="s2">&quot;200 OK&quot;</span><span class="w"> </span><span class="nv">headers</span><span class="o">=</span>&lt;
<span class="w">        </span>Audit-Id:<span class="w"> </span>eb6f9d6e-26bb-4c97-bb00-6f7f5da9db32
<span class="w">        </span>Cache-Control:<span class="w"> </span>no-cache,<span class="w"> </span>private
<span class="w">        </span>Content-Type:<span class="w"> </span>application/json
<span class="w">        </span>Date:<span class="w"> </span>Tue,<span class="w"> </span><span class="m">02</span><span class="w"> </span>Sep<span class="w"> </span><span class="m">2025</span><span class="w"> </span><span class="m">13</span>:48:02<span class="w"> </span>GMT
<span class="w">        </span>X-Kubernetes-Pf-Flowschema-Uid:<span class="w"> </span>8391073b-d875-43da-9f1a-94ef82459735
<span class="w">        </span>X-Kubernetes-Pf-Prioritylevel-Uid:<span class="w"> </span>3f30e2d2-3e73-402b-98b1-9c0ddce8c521
<span class="w"> </span>&gt;<span class="w"> </span><span class="nv">milliseconds</span><span class="o">=</span><span class="m">8</span><span class="w"> </span><span class="nv">getConnectionMilliseconds</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">serverProcessingMilliseconds</span><span class="o">=</span><span class="m">8</span>
I0902<span class="w"> </span><span class="m">15</span>:48:02.625362<span class="w">  </span><span class="m">957821</span><span class="w"> </span>helper.go:269<span class="o">]</span><span class="w"> </span><span class="s2">&quot;Response Body&quot;</span><span class="w"> </span><span class="nv">body</span><span class="o">=</span>&lt;
<span class="w">        </span><span class="o">{</span><span class="s2">&quot;kind&quot;</span>:<span class="s2">&quot;Deployment&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;reconciler&quot;</span>,<span class="s2">&quot;namespace&quot;</span>:<span class="s2">&quot;reconciler&quot;</span>,<span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;684b66af-77bf-4bc5-96f4-bf2c0018a5a5&quot;</span>,<span class="s2">&quot;resourceVersion&quot;</span>:<span class="s2">&quot;18761&quot;</span>,<span class="s2">&quot;generation&quot;</span>:13,<span class="s2">&quot;creationTimestamp&quot;</span>:<span class="s2">&quot;2025-09-02T10:53:31Z&quot;</span>,<span class="s2">&quot;annotations&quot;</span>:<span class="o">{</span><span class="s2">&quot;deployment.kubernetes.io/revision&quot;</span>:<span class="s2">&quot;1&quot;</span><span class="o">}</span>,<span class="s2">&quot;ownerReferences&quot;</span>:<span class="o">[{</span><span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;test.example.com/v1alpha1&quot;</span>,<span class="s2">&quot;kind&quot;</span>:<span class="s2">&quot;Reconciler&quot;</span>,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;reconciler-sample&quot;</span>,<span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;c8f0aab2-b8bd-438f-ad50-043e65017963&quot;</span>,<span class="s2">&quot;controller&quot;</span>:true,<span class="s2">&quot;blockOwnerDeletion&quot;</span>:true<span class="o">}]</span>,<span class="s2">&quot;managedFields&quot;</span>:<span class="o">[{</span><span class="s2">&quot;manager&quot;</span>:<span class="s2">&quot;reconciler-controller&quot;</span>,<span class="s2">&quot;operation&quot;</span>:<span class="s2">&quot;Apply&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;time&quot;</span>:<span class="s2">&quot;2025-09-02T12:04:06Z&quot;</span>,<span class="s2">&quot;fieldsType&quot;</span>:<span class="s2">&quot;FieldsV1&quot;</span>,<span class="s2">&quot;fieldsV1&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:ownerReferences&quot;</span>:<span class="o">{</span><span class="s2">&quot;k:{\&quot;uid\&quot;:\&quot;c8f0aab2-b8bd-438f-ad50-043e65017963\&quot;}&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:selector&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:strategy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:template&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:creationTimestamp&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:labels&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:app&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:containers&quot;</span>:<span class="o">{</span><span class="s2">&quot;k:{\&quot;name\&quot;:\&quot;netshoot\&quot;}&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:command&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:image&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:imagePullPolicy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:name&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:resources&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:allowPrivilegeEscalation&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:capabilities&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:drop&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:runAsNonRoot&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:runAsUser&quot;</span>:<span class="o">{}}}}</span>,<span class="s2">&quot;f:securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:runAsNonRoot&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:seccompProfile&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}}}}}}}</span>,<span class="o">{</span><span class="s2">&quot;manager&quot;</span>:<span class="s2">&quot;kubectl&quot;</span>,<span class="s2">&quot;operation&quot;</span>:<span class="s2">&quot;Apply&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;time&quot;</span>:<span class="s2">&quot;2025-09-02T13:48:02Z&quot;</span>,<span class="s2">&quot;fieldsType&quot;</span>:<span class="s2">&quot;FieldsV1&quot;</span>,<span class="s2">&quot;fieldsV1&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:replicas&quot;</span>:<span class="o">{}}}}</span>,<span class="o">{</span><span class="s2">&quot;manager&quot;</span>:<span class="s2">&quot;main&quot;</span>,<span class="s2">&quot;operation&quot;</span>:<span class="s2">&quot;Update&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;time&quot;</span>:<span class="s2">&quot;2025-09-02T10:53:31Z&quot;</span>,<span class="s2">&quot;fieldsType&quot;</span>:<span class="s2">&quot;FieldsV1&quot;</span>,<span class="s2">&quot;fieldsV1&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:ownerReferences&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;k:{\&quot;uid\&quot;:\&quot;c8f0aab2-b8bd-438f-ad50-043e65017963\&quot;}&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:progressDeadlineSeconds&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:revisionHistoryLimit&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:selector&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:strategy&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:rollingUpdate&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:maxSurge&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:maxUnavailable&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:template&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:labels&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:app&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:containers&quot;</span>:<span class="o">{</span><span class="s2">&quot;k:{\&quot;name\&quot;:\&quot;netshoot\&quot;}&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:command&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:image&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:imagePullPolicy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:name&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:resources&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:allowPrivilegeEscalation&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:capabilities&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:drop&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:runAsNonRoot&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:runAsUser&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;f:terminationMessagePath&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:terminationMessagePolicy&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:dnsPolicy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:restartPolicy&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:schedulerName&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:runAsNonRoot&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:seccompProfile&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:terminationGracePeriodSeconds&quot;</span>:<span class="o">{}}}}}}</span>,<span class="o">{</span><span class="s2">&quot;manager&quot;</span>:<span class="s2">&quot;kube-controller-manager&quot;</span>,<span class="s2">&quot;operation&quot;</span>:<span class="s2">&quot;Update&quot;</span>,<span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;apps/v1&quot;</span>,<span class="s2">&quot;time&quot;</span>:<span class="s2">&quot;2025-09-02T12:07:23Z&quot;</span>,<span class="s2">&quot;fieldsType&quot;</span>:<span class="s2">&quot;FieldsV1&quot;</span>,<span class="s2">&quot;fieldsV1&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:annotations&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:deployment.kubernetes.io/revision&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:status&quot;</span>:<span class="o">{</span><span class="s2">&quot;f:availableReplicas&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:conditions&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;k:{\&quot;type\&quot;:\&quot;Available\&quot;}&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:lastTransitionTime&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:lastUpdateTime&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:message&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:reason&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:status&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}</span>,<span class="s2">&quot;k:{\&quot;type\&quot;:\&quot;Progressing\&quot;}&quot;</span>:<span class="o">{</span><span class="s2">&quot;.&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:lastTransitionTime&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:lastUpdateTime&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:message&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:reason&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:status&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:type&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;f:observedGeneration&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:readyReplicas&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:replicas&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;f:updatedReplicas&quot;</span>:<span class="o">{}}}</span>,<span class="s2">&quot;subresource&quot;</span>:<span class="s2">&quot;status&quot;</span><span class="o">}]}</span>,<span class="s2">&quot;spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;replicas&quot;</span>:8,<span class="s2">&quot;selector&quot;</span>:<span class="o">{</span><span class="s2">&quot;matchLabels&quot;</span>:<span class="o">{</span><span class="s2">&quot;app&quot;</span>:<span class="s2">&quot;reconciler-deployment&quot;</span><span class="o">}}</span>,<span class="s2">&quot;template&quot;</span>:<span class="o">{</span><span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;creationTimestamp&quot;</span>:null,<span class="s2">&quot;labels&quot;</span>:<span class="o">{</span><span class="s2">&quot;app&quot;</span>:<span class="s2">&quot;reconciler-deployment&quot;</span><span class="o">}}</span>,<span class="s2">&quot;spec&quot;</span>:<span class="o">{</span><span class="s2">&quot;containers&quot;</span>:<span class="o">[{</span><span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;netshoot&quot;</span>,<span class="s2">&quot;image&quot;</span>:<span class="s2">&quot;nicolaka/netshoot&quot;</span>,<span class="s2">&quot;command&quot;</span>:<span class="o">[</span><span class="s2">&quot;sleep&quot;</span>,<span class="s2">&quot;infinity&quot;</span><span class="o">]</span>,<span class="s2">&quot;resources&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;terminationMessagePath&quot;</span>:<span class="s2">&quot;/dev/termination-log&quot;</span>,<span class="s2">&quot;terminationMessagePolicy&quot;</span>:<span class="s2">&quot;File&quot;</span>,<span class="s2">&quot;imagePullPolicy&quot;</span>:<span class="s2">&quot;IfNotPresent&quot;</span>,<span class="s2">&quot;securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;capabilities&quot;</span>:<span class="o">{</span><span class="s2">&quot;drop&quot;</span>:<span class="o">[</span><span class="s2">&quot;ALL&quot;</span><span class="o">]}</span>,<span class="s2">&quot;runAsUser&quot;</span>:1001,<span class="s2">&quot;runAsNonRoot&quot;</span>:false,<span class="s2">&quot;allowPrivilegeEscalation&quot;</span>:false<span class="o">}}]</span>,<span class="s2">&quot;restartPolicy&quot;</span>:<span class="s2">&quot;Always&quot;</span>,<span class="s2">&quot;terminationGracePeriodSeconds&quot;</span>:30,<span class="s2">&quot;dnsPolicy&quot;</span>:<span class="s2">&quot;ClusterFirst&quot;</span>,<span class="s2">&quot;securityContext&quot;</span>:<span class="o">{</span><span class="s2">&quot;runAsNonRoot&quot;</span>:true,<span class="s2">&quot;seccompProfile&quot;</span>:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;RuntimeDefault&quot;</span><span class="o">}}</span>,<span class="s2">&quot;schedulerName&quot;</span>:<span class="s2">&quot;default-scheduler&quot;</span><span class="o">}}</span>,<span class="s2">&quot;strategy&quot;</span>:<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;RollingUpdate&quot;</span>,<span class="s2">&quot;rollingUpdate&quot;</span>:<span class="o">{</span><span class="s2">&quot;maxUnavailable&quot;</span>:<span class="s2">&quot;25%&quot;</span>,<span class="s2">&quot;maxSurge&quot;</span>:<span class="s2">&quot;25%&quot;</span><span class="o">}}</span>,<span class="s2">&quot;revisionHistoryLimit&quot;</span>:10,<span class="s2">&quot;progressDeadlineSeconds&quot;</span>:600<span class="o">}</span>,<span class="s2">&quot;status&quot;</span>:<span class="o">{</span><span class="s2">&quot;observedGeneration&quot;</span>:12,<span class="s2">&quot;replicas&quot;</span>:14,<span class="s2">&quot;updatedReplicas&quot;</span>:14,<span class="s2">&quot;readyReplicas&quot;</span>:14,<span class="s2">&quot;availableReplicas&quot;</span>:14,<span class="s2">&quot;conditions&quot;</span>:<span class="o">[{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Progressing&quot;</span>,<span class="s2">&quot;status&quot;</span>:<span class="s2">&quot;True&quot;</span>,<span class="s2">&quot;lastUpdateTime&quot;</span>:<span class="s2">&quot;2025-09-02T10:53:32Z&quot;</span>,<span class="s2">&quot;lastTransitionTime&quot;</span>:<span class="s2">&quot;2025-09-02T10:53:31Z&quot;</span>,<span class="s2">&quot;reason&quot;</span>:<span class="s2">&quot;NewReplicaSetAvailable&quot;</span>,<span class="s2">&quot;message&quot;</span>:<span class="s2">&quot;ReplicaSet \&quot;reconciler-57ddfb79c9\&quot; has successfully progressed.&quot;</span><span class="o">}</span>,<span class="o">{</span><span class="s2">&quot;type&quot;</span>:<span class="s2">&quot;Available&quot;</span>,<span class="s2">&quot;status&quot;</span>:<span class="s2">&quot;True&quot;</span>,<span class="s2">&quot;lastUpdateTime&quot;</span>:<span class="s2">&quot;2025-09-02T12:04:07Z&quot;</span>,<span class="s2">&quot;lastTransitionTime&quot;</span>:<span class="s2">&quot;2025-09-02T12:04:07Z&quot;</span>,<span class="s2">&quot;reason&quot;</span>:<span class="s2">&quot;MinimumReplicasAvailable&quot;</span>,<span class="s2">&quot;message&quot;</span>:<span class="s2">&quot;Deployment has minimum availability.&quot;</span><span class="o">}]}}</span>
<span class="w"> </span>&gt;
deployment.apps/reconciler<span class="w"> </span>serverside-applied
I0902<span class="w"> </span><span class="m">15</span>:48:02.625965<span class="w">  </span><span class="m">957821</span><span class="w"> </span>apply.go:548<span class="o">]</span><span class="w"> </span>Running<span class="w"> </span>apply<span class="w"> </span>post-processor<span class="w"> </span><span class="k">function</span>
</code></pre></div></td></tr></table></div>
<p>You can see in the above that the payload sent to the API server is exactly the minimal JSON containing the metadata and
the replica count.</p>
<p>There's an additional caveat - we had to specify the <code class="highlight">--force-conflicts</code> flag because kubectl was
not the field manager. Otherwise, we would get a conflict in cases that this object's <code class="highlight"><span class="na">.spec.replicas</span></code> field was managed
by a different manager. In the section about <code class="highlight">Field management</code>, we will understand why.</p>
<h2 id="current-status-for-server-side-apply-in-controller-runtime">Current status for Server-Side Apply in controller-runtime</h2>
<p>At time of this writing, Server-Side Apply can be used together with <code class="highlight">controller-runtime</code> in the form of a Patch statement:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">ctx</span><span class="o">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="o">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">Apply</span><span class="o">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">ForceOwnership</span><span class="o">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">FieldOwner</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Name</span><span class="p">));</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">!</span><span class="o">=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{}</span><span class="o">,</span><span class="w"> </span><span class="n">err</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Where <code class="highlight">client.Apply</code> tells the <code class="highlight">Patch</code> method to use the <a href="https://github.com/kubernetes/apimachinery/blob/2340d9bf7725073021aecf60ac5a4553ceaf305c/pkg/types/patch.go#L29">ApplyYAMLPatchType</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>ApplyYAMLPatchType      PatchType = &quot;application/apply-patch+yaml&quot;
</code></pre></div></td></tr></table></div>
<p>Using a <code class="highlight">Patch</code> with <code class="highlight">client.Apply</code> may work well in most cases for the <code class="highlight">controller-runtime</code>. However, the detailed
documentation for <a href="https://pkg.go.dev/k8s.io/client-go/applyconfigurations">applyconfigurations</a> states a caveat: the
standard library structs have many non-pointer fields and thus fields are set to their default values. On the other hand:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">Each</span><span class="w"> </span><span class="s">&quot;apply configuration&quot;</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">represents</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">same</span><span class="w"> </span><span class="nx">Kubernetes</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="nx">kind</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">corresponding</span><span class="w"> </span><span class="nx">go</span><span class="w"> </span><span class="nx">struct</span><span class="p">,</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">fields</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">pointers</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">make</span><span class="w"> </span><span class="nx">them</span><span class="w"> </span><span class="nx">optional</span><span class="p">,</span><span class="w"> </span><span class="nx">allowing</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">requests</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">accurately</span><span class="w"> </span><span class="nx">represented</span><span class="p">.</span>
</code></pre></div></td></tr></table></div>
<p>SSA was recently <a href="https://github.com/kubernetes-sigs/controller-runtime/issues/3183">made a first-class citizen</a> of the
<code class="highlight">controller-runtime</code> project, even though some pieces are still missing, such as <a href="github.com/kubernetes-sigs/kubebuilder/issues/2514">documentation</a>.
Therefore, in the near future, it should be fully documented how to use Server-Side Apply natively with the <code class="highlight">controller-runtime</code>.</p>
<h2 id="field-management">Field management</h2>
<p>Whether Server-Side Apply detects a conflict comes down to <a href="https://kubernetes.io/docs/reference/using-api/server-side-apply/#field-management">Field management</a>:</p>
<blockquote>
<p>The Kubernetes API server tracks managed fields for all newly created objects.</p>
<p>When trying to apply an object, fields that have a different value and are owned by another manager will result in a conflict. This is done in order to signal that the operation might undo another collaborator's changes. Writes to objects with managed fields can be forced, in which case the value of any conflicted field will be overridden, and the ownership will be transferred.</p>
<p>Whenever a field's value does change, ownership moves from its current manager to the manager making the change.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="ow">In</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">understand</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">management</span><span class="w"> </span><span class="n">works</span><span class="p">,</span><span class="w"> </span><span class="n">let</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">look</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="o">[</span><span class="n">a small test operator</span><span class="o">]</span><span class="p">(</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">andreaskaris</span><span class="o">/</span><span class="n">reconciler</span><span class="o">-</span><span class="n">operator</span><span class="o">/</span><span class="k">blob</span><span class="o">/</span><span class="mi">741884</span><span class="n">f5396b1ca5b0a7793fd4657fa5f2c4048f</span><span class="o">/</span><span class="n">internal</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="n">reconciler_controller</span><span class="p">.</span><span class="k">go</span><span class="n">#L102</span><span class="p">).</span>
<span class="n">The</span><span class="w"> </span><span class="n">operator</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">patch</span><span class="w"> </span><span class="nl">logic</span><span class="p">:</span>
</code></pre></div></td></tr></table></div>
func (r *ReconcilerReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) {
    logger := logf.FromContext(ctx)</p>
</blockquote>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// TODO(user): your logic here</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;reconciler was called&quot;</span><span class="p">)</span>
<span class="nx">reconciler</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">v1alpha1</span><span class="p">.</span><span class="nx">Reconciler</span><span class="p">{}</span>
<span class="nx">err</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">NamespacedName</span><span class="p">,</span><span class="w"> </span><span class="nx">reconciler</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">apierrors</span><span class="p">.</span><span class="nx">IsNotFound</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;reconciler resource not found. Ignoring since object must be deleted&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">nil</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Error reading the object - requeue the request.</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Failed to get reconciler&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="nx">desiredDeployment</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">getReconcilerDeployment</span><span class="p">(</span><span class="nx">reconciler</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;deployment is&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">desiredDeployment</span><span class="p">)</span>

<span class="nx">currentDeployment</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">appsv1</span><span class="p">.</span><span class="nx">Deployment</span><span class="p">{}</span>
<span class="nx">namespacedName</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="nx">types</span><span class="p">.</span><span class="nx">NamespacedName</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">desiredDeployment</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">Namespace</span><span class="p">:</span><span class="w"> </span><span class="nx">desiredDeployment</span><span class="p">.</span><span class="nx">Namespace</span><span class="p">}</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">namespacedName</span><span class="p">,</span><span class="w"> </span><span class="nx">currentDeployment</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">apierrors</span><span class="p">.</span><span class="nx">IsNotFound</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;creating deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">desiredDeployment</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">desiredDeployment</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">nil</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// Error reading the object - requeue the request.</span>
<span class="w">    </span><span class="nx">logger</span><span class="p">.</span><span class="nx">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Failed to get deployment&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="c1">// Patch the deployment here!</span>
<span class="nx">desiredDeployment</span><span class="p">.</span><span class="nx">APIVersion</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;apps/v1&quot;</span>
<span class="nx">desiredDeployment</span><span class="p">.</span><span class="nx">Kind</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;Deployment&quot;</span>
<span class="nx">logger</span><span class="p">.</span><span class="nx">Info</span><span class="p">(</span><span class="s">&quot;patching deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">desiredDeployment</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Patch</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">desiredDeployment</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">Apply</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">ForceOwnership</span><span class="p">,</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">FieldOwner</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Name</span><span class="p">));</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">err</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="nx">ctrl</span><span class="p">.</span><span class="nx">Result</span><span class="p">{},</span><span class="w"> </span><span class="nx">nil</span>
</code></pre></div></td></tr></table></div>
<p>}
<code class="highlight">In this concrete example, when the deployment is not present and when the operator first starts, the controller createsthe desired deployment because it does not yet exist:</code>
2025-09-03T12:19:29+02:00       INFO    creating deployment     {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "Reconciler": {"name":"reconciler-sample"}, "namespace": "", "name": "reconciler-sample", "reconcileID": "f136a051-e0c1-45a0-93dc-e7bb48fa552a", "deployment": "&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 6c9e435e-5edf-4a13-868d-d0b85aa09d1a 0xc00015a622 0xc00015a621}] [] []},Spec:DeploymentSpec{Replicas:<em>1,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] <nil> [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:</em>1001,RunAsNonRoot:<em>false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:</em>false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  <nil> <nil>  map[]   <nil>  false false false <nil> &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:<em>true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  <nil> nil [] <nil> <nil> <nil> map[] [] <nil> nil <nil> [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}"}
<code class="highlight"><span class="n">We</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">look</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">managed</span><span class="w"> </span><span class="k">fields</span><span class="p">,</span><span class="w"> </span><span class="k">all</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">belong</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n n-Quoted">`manager: main`</span><span class="w"> </span><span class="p">(</span><span class="k">and</span><span class="w"> </span><span class="n n-Quoted">`kube-controller-manager`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n n-Quoted">`status`</span><span class="p">)</span><span class="k">as</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">went</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n n-Quoted">`controller-runtime`</span><span class="w"> </span><span class="n">creation</span><span class="w"> </span><span class="n">logic</span><span class="o">:</span></code>
$ kubectl get deployment -n reconciler reconciler --show-managed-fields -o yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
  creationTimestamp: "2025-09-03T10:19:29Z"
  generation: 1
  managedFields:
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          .: {}
          k:{"uid":"6c9e435e-5edf-4a13-868d-d0b85aa09d1a"}: {}
      f:spec:
        f:progressDeadlineSeconds: {}
        f:replicas: {}
        f:revisionHistoryLimit: {}
        f:selector: {}
        f:strategy:
          f:rollingUpdate:
            .: {}
            f:maxSurge: {}
            f:maxUnavailable: {}
          f:type: {}
        f:template:
          f:metadata:
            f:labels:
              .: {}
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  .: {}
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    .: {}
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
                f:terminationMessagePath: {}
                f:terminationMessagePolicy: {}
            f:dnsPolicy: {}
            f:restartPolicy: {}
            f:schedulerName: {}
            f:securityContext:
              .: {}
              f:runAsNonRoot: {}
              f:seccompProfile:
                .: {}
                f:type: {}
            f:terminationGracePeriodSeconds: {}
    manager: main
    operation: Update
    time: "2025-09-03T10:19:29Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .: {}
          f:deployment.kubernetes.io/revision: {}
      f:status:
        f:availableReplicas: {}
        f:conditions:
          .: {}
          k:{"type":"Available"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
          k:{"type":"Progressing"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
        f:observedGeneration: {}
        f:readyReplicas: {}
        f:replicas: {}
        f:updatedReplicas: {}
    manager: kube-controller-manager
    operation: Update
    subresource: status
    time: "2025-09-03T10:19:30Z"
(...)
<code class="highlight"><span class="n">We</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="k">trigger</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reconciler</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">making</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">change</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n n-Quoted">`reconciler`</span><span class="w"> </span><span class="n">object</span><span class="o">:</span></code>
$ kubectl patch reconciler reconciler-sample --type='merge' -p='{"spec":{"replicas":2}}'
reconciler.test.example.com/reconciler-sample patched
<code class="highlight"><span class="n">Now</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reconciler</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n n-Quoted">`Patch`</span><span class="w"> </span><span class="n">method</span><span class="o">:</span></code>
2025-09-03T12:24:31+02:00       INFO    patching deployment     {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "Reconciler": {"name":"reconciler-sample"}, "namespace": "", "name": "reconciler-sample", "reconcileID": "21ff9b91-f540-455d-9266-ff9b83d3b3b0", "deployment": "&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 6c9e435e-5edf-4a13-868d-d0b85aa09d1a 0xc000680312 0xc000680311}] [] []},Spec:DeploymentSpec{Replicas:</em>2,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] <nil> [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:<em>1001,RunAsNonRoot:</em>false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:<em>false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  <nil> <nil>  map[]   <nil>  false false false <nil> &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:</em>true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  <nil> nil [] <nil> <nil> <nil> map[] [] <nil> nil <nil> [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}"}
<code class="highlight"><span class="k">And</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="n">changes</span><span class="p">.</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n n-Quoted">`Apply`</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n n-Quoted">`manager: reconciler-controller`</span><span class="w"> </span><span class="k">is</span><span class="n">now</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">manager</span><span class="p">,</span><span class="w"> </span><span class="n">among</span><span class="w"> </span><span class="k">others</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n n-Quoted">`.spec.replica`</span><span class="w"> </span><span class="n">field</span><span class="o">:</span></code>
$ kubectl get deployment -n reconciler reconciler --show-managed-fields -o yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
  creationTimestamp: "2025-09-03T10:19:29Z"
  generation: 2
  managedFields:
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          k:{"uid":"6c9e435e-5edf-4a13-868d-d0b85aa09d1a"}: {}
      f:spec:
        f:replicas: {}
        f:selector: {}
        f:strategy: {}
        f:template:
          f:metadata:
            f:creationTimestamp: {}
            f:labels:
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
            f:securityContext:
              f:runAsNonRoot: {}
              f:seccompProfile:
                f:type: {}
    manager: reconciler-controller
    operation: Apply
    time: "2025-09-03T10:24:31Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          .: {}
          k:{"uid":"6c9e435e-5edf-4a13-868d-d0b85aa09d1a"}: {}
      f:spec:
        f:progressDeadlineSeconds: {}
        f:revisionHistoryLimit: {}
        f:selector: {}
        f:strategy:
          f:rollingUpdate:
            .: {}
            f:maxSurge: {}
            f:maxUnavailable: {}
          f:type: {}
        f:template:
          f:metadata:
            f:labels:
              .: {}
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  .: {}
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    .: {}
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
                f:terminationMessagePath: {}
                f:terminationMessagePolicy: {}
            f:dnsPolicy: {}
            f:restartPolicy: {}
            f:schedulerName: {}
            f:securityContext:
              .: {}
              f:runAsNonRoot: {}
              f:seccompProfile:
                .: {}
                f:type: {}
            f:terminationGracePeriodSeconds: {}
    manager: main
    operation: Update
    time: "2025-09-03T10:19:29Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .: {}
          f:deployment.kubernetes.io/revision: {}
      f:status:
        f:availableReplicas: {}
        f:conditions:
          .: {}
          k:{"type":"Available"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
          k:{"type":"Progressing"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
        f:observedGeneration: {}
        f:readyReplicas: {}
        f:replicas: {}
        f:updatedReplicas: {}
    manager: kube-controller-manager
    operation: Update
    subresource: status
    time: "2025-09-03T10:24:32Z"
(...)
<code class="highlight"><span class="n">We</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">following</span><span class="w"> </span><span class="p">(</span><span class="k">partial</span><span class="p">)</span><span class="w"> </span><span class="n">Deployment</span><span class="w"> </span><span class="n">inside</span><span class="w"> </span><span class="n">namespace</span><span class="w"> </span><span class="n n-Quoted">`reconciler`</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="n n-Quoted">`reconciler`</span><span class="o">:</span></code>
$ cat test.yaml 
apiVersion: apps/v1
kind: Deployment
metadata:
  name: reconciler
  namespace: reconciler
spec:
  replicas: 8
<code class="highlight">This fails:</code>
$ kubectl apply -f test.yaml --server-side
error: Apply failed with 1 conflict: conflict with "reconciler-controller": .spec.replicas
Please review the fields above--they currently have other managers. Here
are the ways you can resolve this warning:
* If you intend to manage all of these fields, please re-run the apply
  command with the <code class="highlight">--force-conflicts</code> flag.
* If you do not intend to manage all of the fields, please edit your
  manifest to remove references to the fields that should keep their
  current managers.
* You may co-own fields by updating your manifest to match the existing
  value; in this case, you'll become the manager if the other manager(s)
  stop managing the field (remove it from their configuration).
See https://kubernetes.io/docs/reference/using-api/server-side-apply/#conflicts
<code class="highlight"><span class="n">The</span><span class="w"> </span><span class="n">reason</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n n-Quoted">`.spec.replicas`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n n-Quoted">`reconciler-controller`</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">kubectl</span><span class="w"> </span><span class="k">Server</span><span class="o">-</span><span class="n">Side</span><span class="n">Apply</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="n n-Quoted">`kubectl`</span><span class="p">.</span><span class="k">As</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">stated</span><span class="w"> </span><span class="n">above</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">however</span><span class="p">,</span><span class="w"> </span><span class="k">force</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">apply</span><span class="o">:</span></code>
$ kubectl apply -f test.yaml --server-side --force-conflicts
deployment.apps/reconciler serverside-applied
<code class="highlight"><span class="nv">Now</span>,<span class="w"> </span><span class="nv">let</span><span class="err">&#39;s fetch the managed fields for the deployment:</span></code>
$ kubectl get deployments  -n reconciler reconciler -o yaml  --show-managed-fields 
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
  creationTimestamp: "2025-09-03T10:19:29Z"
  generation: 3
  managedFields:
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          k:{"uid":"6c9e435e-5edf-4a13-868d-d0b85aa09d1a"}: {}
      f:spec:
        f:selector: {}
        f:strategy: {}
        f:template:
          f:metadata:
            f:creationTimestamp: {}
            f:labels:
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
            f:securityContext:
              f:runAsNonRoot: {}
              f:seccompProfile:
                f:type: {}
    manager: reconciler-controller
    operation: Apply
    time: "2025-09-03T10:24:31Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:spec:
        f:replicas: {}
    manager: kubectl
    operation: Apply
    time: "2025-09-03T10:33:02Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          .: {}
          k:{"uid":"6c9e435e-5edf-4a13-868d-d0b85aa09d1a"}: {}
      f:spec:
        f:progressDeadlineSeconds: {}
        f:revisionHistoryLimit: {}
        f:selector: {}
        f:strategy:
          f:rollingUpdate:
            .: {}
            f:maxSurge: {}
            f:maxUnavailable: {}
          f:type: {}
        f:template:
          f:metadata:
            f:labels:
              .: {}
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  .: {}
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    .: {}
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
                f:terminationMessagePath: {}
                f:terminationMessagePolicy: {}
            f:dnsPolicy: {}
            f:restartPolicy: {}
            f:schedulerName: {}
            f:securityContext:
              .: {}
              f:runAsNonRoot: {}
              f:seccompProfile:
                .: {}
                f:type: {}
            f:terminationGracePeriodSeconds: {}
(...)
<code class="highlight"><span class="k">In</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n n-Quoted">`manager: kubectl`</span><span class="w"> </span><span class="k">last</span><span class="w"> </span><span class="n">ran</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n n-Quoted">`Apply`</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">of</span><span class="n">field</span><span class="w"> </span><span class="n n-Quoted">`.spec.replicas`</span><span class="w"> </span><span class="n">now</span><span class="p">.</span><span class="w"> </span><span class="n">Whereas</span><span class="w"> </span><span class="n n-Quoted">`reconciler-controller`</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="k">fields</span><span class="p">.</span><span class="n">Now</span><span class="p">,</span><span class="w"> </span><span class="n">let</span><span class="s1">&#39;s trigger the controller&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">reconciler</span><span class="w"> </span><span class="k">loop</span><span class="p">,</span><span class="w"> </span><span class="n">again</span><span class="o">:</span></code>
$ kubectl patch reconciler reconciler-sample --type='merge' -p='{"spec":{"replicas":3}}'
reconciler.test.example.com/reconciler-sample patched
<code class="highlight">The reconciler&#39;s logic is triggered and the reconciler patches the deployment:</code>
2025-09-03T12:35:04+02:00       INFO    patching deployment     {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "Reconciler": {"name":"reconciler-sample"}, "namespace": "", "name": "reconciler-sample", "reconcileID": "4493242e-dbd6-4a87-a25c-a00a2d9cd2ae", "deployment": "&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 6c9e435e-5edf-4a13-868d-d0b85aa09d1a 0xc00071c262 0xc00071c261}] [] []},Spec:DeploymentSpec{Replicas:<em>3,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] <nil> [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:</em>1001,RunAsNonRoot:<em>false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:</em>false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  <nil> <nil>  map[]   <nil>  false false false <nil> &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:*true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  <nil> nil [] <nil> <nil> <nil> map[] [] <nil> nil <nil> [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}"}
<code class="highlight"><span class="n">After</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reconciler</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="err">`</span><span class="n">manager</span><span class="o">:</span><span class="w"> </span><span class="n">kubectl</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">completely</span><span class="w"> </span><span class="n">gone</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">managedFields</span><span class="err">`</span><span class="w"> </span><span class="n">and</span><span class="n">instead</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">manager</span><span class="o">:</span><span class="w"> </span><span class="n">reconciler</span><span class="o">-</span><span class="n">controller</span><span class="err">`</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">again</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="err">`</span><span class="p">.</span><span class="n">spec</span><span class="p">.</span><span class="n">replicas</span><span class="err">`</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">operator</span><span class="p">[</span><span class="n">forces</span><span class="w"> </span><span class="n">ownership</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/andreaskaris/reconciler-operator/blob/741884f5396b1ca5b0a7793fd4657fa5f2c4048f/internal/controller/reconciler_controller.go#L102):</span></code>
$ kubectl get deployments  -n reconciler reconciler -o yaml  --show-managed-fields 
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
  creationTimestamp: "2025-09-03T10:19:29Z"
  generation: 4
  managedFields:
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          k:{"uid":"6c9e435e-5edf-4a13-868d-d0b85aa09d1a"}: {}
      f:spec:
        f:replicas: {}
        f:selector: {}
        f:strategy: {}
        f:template:
          f:metadata:
            f:creationTimestamp: {}
            f:labels:
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
            f:securityContext:
              f:runAsNonRoot: {}
              f:seccompProfile:
                f:type: {}
    manager: reconciler-controller
    operation: Apply
    time: "2025-09-03T10:35:04Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          .: {}
          k:{"uid":"6c9e435e-5edf-4a13-868d-d0b85aa09d1a"}: {}
      f:spec:
        f:progressDeadlineSeconds: {}
        f:revisionHistoryLimit: {}
        f:selector: {}
        f:strategy:
          f:rollingUpdate:
            .: {}
            f:maxSurge: {}
            f:maxUnavailable: {}
          f:type: {}
        f:template:
          f:metadata:
            f:labels:
              .: {}
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  .: {}
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    .: {}
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
                f:terminationMessagePath: {}
                f:terminationMessagePolicy: {}
            f:dnsPolicy: {}
            f:restartPolicy: {}
            f:schedulerName: {}
            f:securityContext:
              .: {}
              f:runAsNonRoot: {}
              f:seccompProfile:
                .: {}
                f:type: {}
            f:terminationGracePeriodSeconds: {}
    manager: main
    operation: Update
    time: "2025-09-03T10:19:29Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .: {}
          f:deployment.kubernetes.io/revision: {}
      f:status:
        f:availableReplicas: {}
        f:conditions:
          .: {}
          k:{"type":"Available"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
          k:{"type":"Progressing"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
        f:observedGeneration: {}
        f:readyReplicas: {}
        f:replicas: {}
        f:updatedReplicas: {}
    manager: kube-controller-manager
    operation: Update
    subresource: status
    time: "2025-09-03T10:35:04Z"
(... the kubectl Apply entry is completely gone, now ...)
<code class="highlight"><span class="k">Next</span>,<span class="w"> </span><span class="nv">we</span><span class="w"> </span><span class="nv">make</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">manual</span><span class="w"> </span><span class="nv">edit</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">deployment</span><span class="w"> </span><span class="nv">object</span>:</code>
$ kubectl edit deployment -n reconciler reconciler</p>
<h1 id="-change-replica-count-to-4">--&gt; Change replica count to 4.</h1>
<p><code class="highlight">This does not use Server-Side Apply, and changes the managed fields to:</code>
$ kubectl get deployments  -n reconciler reconciler -o yaml  --show-managed-fields 
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
  creationTimestamp: "2025-09-03T10:19:29Z"
  generation: 5
  managedFields:
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          k:{"uid":"6c9e435e-5edf-4a13-868d-d0b85aa09d1a"}: {}
      f:spec:
        f:selector: {}
        f:strategy: {}
        f:template:
          f:metadata:
            f:creationTimestamp: {}
            f:labels:
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
            f:securityContext:
              f:runAsNonRoot: {}
              f:seccompProfile:
                f:type: {}
    manager: reconciler-controller
    operation: Apply
    time: "2025-09-03T10:35:04Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          .: {}
          k:{"uid":"6c9e435e-5edf-4a13-868d-d0b85aa09d1a"}: {}
      f:spec:
        f:progressDeadlineSeconds: {}
        f:revisionHistoryLimit: {}
        f:selector: {}
        f:strategy:
          f:rollingUpdate:
            .: {}
            f:maxSurge: {}
            f:maxUnavailable: {}
          f:type: {}
        f:template:
          f:metadata:
            f:labels:
              .: {}
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  .: {}
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    .: {}
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
                f:terminationMessagePath: {}
                f:terminationMessagePolicy: {}
            f:dnsPolicy: {}
            f:restartPolicy: {}
            f:schedulerName: {}
            f:securityContext:
              .: {}
              f:runAsNonRoot: {}
              f:seccompProfile:
                .: {}
                f:type: {}
            f:terminationGracePeriodSeconds: {}
    manager: main
    operation: Update
    time: "2025-09-03T10:19:29Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .: {}
          f:deployment.kubernetes.io/revision: {}
      f:status:
        f:availableReplicas: {}
        f:conditions:
          .: {}
          k:{"type":"Available"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
          k:{"type":"Progressing"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
        f:observedGeneration: {}
        f:readyReplicas: {}
        f:replicas: {}
        f:updatedReplicas: {}
    manager: kube-controller-manager
    operation: Update
    subresource: status
    time: "2025-09-03T10:37:13Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:spec:
        f:replicas: {}
    manager: kubectl-edit
    operation: Update
    time: "2025-09-03T10:37:13Z"
(...)
<code class="highlight"><span class="nv">From</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">above</span>,<span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">see</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span>`<span class="nv">manager</span>:<span class="w"> </span><span class="nv">kubectl</span><span class="o">-</span><span class="nv">edit</span>`<span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">field</span><span class="w"> </span><span class="nv">manager</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span>`.<span class="nv">spec</span>.<span class="nv">replicas</span>`<span class="w"> </span><span class="nv">via</span><span class="w"> </span>`<span class="nv">operation</span>:<span class="w"> </span><span class="nv">Update</span>`.<span class="nv">An</span><span class="w"> </span><span class="nv">explanation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">why</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">did</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">create</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">conflict</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">found</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span>[<span class="nv">kubernetes</span><span class="w"> </span><span class="nv">upstream</span><span class="w"> </span><span class="nv">documentation</span>]<span class="ss">(</span><span class="nv">https</span>:<span class="o">//</span><span class="nv">kubernetes</span>.<span class="nv">io</span><span class="o">/</span><span class="nv">docs</span><span class="o">/</span><span class="nv">reference</span><span class="o">/</span><span class="nv">using</span><span class="o">-</span><span class="nv">api</span><span class="o">/</span><span class="nv">server</span><span class="o">-</span><span class="nv">side</span><span class="o">-</span><span class="nv">apply</span><span class="o">/</span>#<span class="nv">apply</span><span class="o">-</span><span class="nv">and</span><span class="o">-</span><span class="nv">update</span><span class="ss">)</span>:</code>
Unless you specify a forced override, an apply operation that encounters field-level conflicts always fails; by contrast, if you make a change using update that would affect a managed field, a conflict never provokes failure of the operation.</p>
<p>All Server-Side Apply patch requests are required to identify themselves by providing a fieldManager query parameter, while the query parameter is optional for update operations. Finally, when using the Apply operation you cannot define managedFields in the body of the request that you submit.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">## Partial reconciliation via Patch statement and Server-Side Apply with the controller-runtime</span>

<span class="n">Here</span><span class="s1">&#39;s part of a packet capture which includes a `PATCH` requests from the reconciler operator to the kubernetes API:</span>
</code></pre></div></td></tr></table></div>
PATCH /apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=reconciler-controller&amp;force=true HTTP/1.1
Host: 127.0.0.1:8001
User-Agent: main/v0.0.0 (linux/amd64) kubernetes/$Format
Content-Length: 882
Accept: application/vnd.kubernetes.protobuf, <em>/</em>
Content-Type: application/apply-patch+yaml
Accept-Encoding: gzip</p>
<p>{"kind":"Deployment","apiVersion":"apps/v1","metadata":{"name":"reconciler","namespace":"reconciler","creationTimestamp":null,"ownerReferences":[{"apiVersion":"test.example.com/v1alpha1","kind":"Reconciler","name":"reconciler-sample","uid":"c8f0aab2-b8bd-438f-ad50-043e65017963","controller":true,"blockOwnerDeletion":true}]},"spec":{"replicas":5,"selector":{"matchLabels":{"app":"reconciler-deployment"}},"template":{"metadata":{"creationTimestamp":null,"labels":{"app":"reconciler-deployment"}},"spec":{"containers":[{"name":"netshoot","image":"nicolaka/netshoot","command":["sleep","infinity"],"resources":{},"imagePullPolicy":"IfNotPresent","securityContext":{"capabilities":{"drop":["ALL"]},"runAsUser":1001,"runAsNonRoot":false,"allowPrivilegeEscalation":false}}],"securityContext":{"runAsNonRoot":true,"seccompProfile":{"type":"RuntimeDefault"}}}},"strategy":{}},"status":{}}
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">The</span><span class="w"> </span><span class="n">reconciler</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">sends</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">[</span><span class="n">full deployment definition</span><span class="o">]</span><span class="p">(</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">andreaskaris</span><span class="o">/</span><span class="n">reconciler</span><span class="o">-</span><span class="n">operator</span><span class="o">/</span><span class="k">blob</span><span class="o">/</span><span class="k">full</span><span class="o">-</span><span class="n">reconcile</span><span class="o">-</span><span class="n">ssa</span><span class="o">/</span><span class="n">internal</span><span class="o">/</span><span class="n">controller</span><span class="o">/</span><span class="n">reconciler_controller</span><span class="p">.</span><span class="k">go</span><span class="n">#L102</span><span class="p">)</span>
<span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="n">server</span><span class="p">.</span><span class="w"> </span><span class="n">However</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">modify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">modified</span><span class="w"> </span><span class="n">replica</span><span class="w"> </span><span class="nf">count</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">reconciliation</span><span class="w"> </span><span class="nl">loop</span><span class="p">:</span>
</code></pre></div></td></tr></table></div>
$ git diff full-reconcile-ssa
diff --git a/internal/controller/reconciler_controller.go b/internal/controller/reconciler_controller.go
index 121c1dc..4a6978e 100644
--- a/internal/controller/reconciler_controller.go
+++ b/internal/controller/reconciler_controller.go
@@ -96,6 +96,10 @@ func (r *ReconcilerReconciler) Reconcile(ctx context.Context, req ctrl.Request)
        }</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="c1">// Patch the deployment here!</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>desiredDeployment, err = r.getReconcilerDeploymentPatch(reconciler)</li>
<li>if err != nil {</li>
<li>return ctrl.Result{}, err</li>
<li>}
        desiredDeployment.APIVersion = "apps/v1"
        desiredDeployment.Kind = "Deployment"
        logger.Info("patching deployment", "deployment", desiredDeployment)
@@ -114,6 +118,28 @@ func (r *ReconcilerReconciler) SetupWithManager(mgr ctrl.Manager) error {
                Complete(r)
 }</li>
</ul>
<p>+func (r <em>ReconcilerReconciler) getReconcilerDeploymentPatch(
+       reconciler </em>v1alpha1.Reconciler) (<em>appsv1.Deployment, error) {
+       ls := map[string]string{
+               "app": "reconciler-deployment",
+       }
+
+       dep := &amp;appsv1.Deployment{
+               ObjectMeta: metav1.ObjectMeta{
+                       Name:      reconciler.Spec.Name,
+                       Namespace: reconciler.Spec.Namespace,
+               },
+               Spec: appsv1.DeploymentSpec{
+                       Replicas: &amp;reconciler.Spec.Replicas,
+                       Selector: &amp;metav1.LabelSelector{
+                               MatchLabels: ls,
+                       },
+               },
+       }
+       return dep, nil
+}
+
 func (r </em>ReconcilerReconciler) getReconcilerDeployment(
        reconciler <em>v1alpha1.Reconciler) (</em>appsv1.Deployment, error) {
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">With</span><span class="w"> </span><span class="p">[</span><span class="n">this</span><span class="w"> </span><span class="n">change</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/andreaskaris/reconciler-operator/blob/69b73a2f96a82a82fdbe87cb265e6ac44e63fea5/internal/controller/reconciler_controller.go#L106), </span>
<span class="n">the</span><span class="w"> </span><span class="n">PATCH</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">look</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">follows</span><span class="o">:</span>
</code></pre></div></td></tr></table></div>
PATCH /apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=reconciler-controller&amp;force=true HTTP/1.1
Host: 127.0.0.1:8001
User-Agent: main/v0.0.0 (linux/amd64) kubernetes/$Format
Content-Length: 312
Accept: application/vnd.kubernetes.protobuf, <em>/</em>
Content-Type: application/apply-patch+yaml
Accept-Encoding: gzip</p>
<p>{"kind":"Deployment","apiVersion":"apps/v1","metadata":{"name":"reconciler","namespace":"reconciler","creationTimestamp":null},"spec":{"replicas":7,"selector":{"matchLabels":{"app":"reconciler-deployment"}},"template":{"metadata":{"creationTimestamp":null},"spec":{"containers":null}},"strategy":{}},"status":{}}
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">In</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">above</span><span class="w"> </span><span class="n">diff</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">DeploymentSpec</span><span class="w"> </span><span class="n">includes</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">redefines</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n n-Quoted">`Spec.Selector`</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">because</span>
<span class="n n-Quoted">`controller-runtime`</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">fully</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="k">first</span><span class="o">-</span><span class="n">citizen</span><span class="w"> </span><span class="k">Server</span><span class="o">-</span><span class="n">Side</span><span class="w"> </span><span class="n">Apply</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n n-Quoted">`Apply`</span><span class="w"> </span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="n">yet</span><span class="p">.</span>
<span class="k">If</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">did</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">redefine</span><span class="w"> </span><span class="n n-Quoted">`.spec.selector`</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">code</span><span class="w"> </span><span class="n">looked</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">follows</span><span class="o">:</span>
</code></pre></div></td></tr></table></div>
$ git diff
diff --git a/internal/controller/reconciler_controller.go b/internal/controller/reconciler_controller.go
index 4a6978e..fc2de54 100644
--- a/internal/controller/reconciler_controller.go
+++ b/internal/controller/reconciler_controller.go
@@ -121,9 +121,9 @@ func (r <em>ReconcilerReconciler) SetupWithManager(mgr ctrl.Manager) error {
 func (r </em>ReconcilerReconciler) getReconcilerDeploymentPatch(
diff --git a/internal/controller/reconciler_controller.go b/internal/controller/reconciler_controller.go
index 4a6978e..fc2de54 100644
--- a/internal/controller/reconciler_controller.go
+++ b/internal/controller/reconciler_controller.go
@@ -121,9 +121,9 @@ func (r <em>ReconcilerReconciler) SetupWithManager(mgr ctrl.Manager) error {
 func (r </em>ReconcilerReconciler) getReconcilerDeploymentPatch(
        reconciler <em>v1alpha1.Reconciler) (</em>appsv1.Deployment, error) {
-       ls := map[string]string{
+       /<em>ls := map[string]string{
                "app": "reconciler-deployment",
-       }
+       }</em>/</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="n">dep</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">appsv1</span><span class="o">.</span><span class="n">Deployment</span><span class="p">{</span>
<span class="w">            </span><span class="n">ObjectMeta</span><span class="o">:</span><span class="w"> </span><span class="n">metav1</span><span class="o">.</span><span class="n">ObjectMeta</span><span class="p">{</span>
</code></pre></div></td></tr></table></div>
<p>@@ -132,9 +132,9 @@ func (r <em>ReconcilerReconciler) getReconcilerDeploymentPatch(
                },
                Spec: appsv1.DeploymentSpec{
                        Replicas: &amp;reconciler.Spec.Replicas,
-                       Selector: &amp;metav1.LabelSelector{
+                       /</em>Selector: &amp;metav1.LabelSelector{
                                MatchLabels: ls,
-                       },
+                       },<em>/
                },
        }
        return dep, nil
<code class="highlight">We would get the following error message in the reconciler:</code>
2025-09-03T10:44:31+02:00       INFO    patching deployment     {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "Reconciler": {"name":"reconciler-sample"}, "namespace": "", "name": "reconciler-sample", "reconcileID": "52587ce8-308d-4611-aad5-67b4cbe17c2f", "deployment": "&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[] map[] [] [] []},Spec:DeploymentSpec{Replicas:</em>9,Selector:nil,Template:{{      0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[] map[] [] [] []} {[] [] [] []  <nil> <nil>  map[]   <nil>  false false false <nil> nil []   nil  [] []  <nil> nil [] <nil> <nil> <nil> map[] [] <nil> nil <nil> [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}"}
2025-09-03T10:44:31+02:00       ERROR   Reconciler error        {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "Reconciler": {"name":"reconciler-sample"}, "namespace": "", "name": "reconciler-sample", "reconcileID": "52587ce8-308d-4611-aad5-67b4cbe17c2f", "error": "Deployment.apps \"reconciler\" is invalid: [spec.selector: Required value, spec.template.metadata.labels: Invalid value: map[string]string{\"app\":\"reconciler-deployment\"}: <code class="highlight">selector</code> does not match template <code class="highlight">labels</code>, spec.selector: Invalid value: \"null\": field is immutable]"}
<code class="highlight"><span class="k">And</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n n-Quoted">`PATCH`</span><span class="w"> </span><span class="n">statement</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="n">look</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">including</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n n-Quoted">`null`</span><span class="w"> </span><span class="n n-Quoted">`.spec.selector`</span><span class="w"> </span><span class="n">causing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">issue</span><span class="p">.</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">that</span><span class="n">other</span><span class="w"> </span><span class="k">fields</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">transmitted</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">values</span><span class="o">:</span></code>
PATCH /apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=reconciler-controller&amp;force=true HTTP/1.1
Host: 127.0.0.1:8001
User-Agent: main/v0.0.0 (linux/amd64) kubernetes/$Format
Content-Length: 269
Accept: application/vnd.kubernetes.protobuf, <em>/</em>
Content-Type: application/apply-patch+yaml
Accept-Encoding: gzip</p>
<p>{"kind":"Deployment","apiVersion":"apps/v1","metadata":{"name":"reconciler","namespace":"reconciler","creationTimestamp":null},"spec":{"replicas":9,"selector":null,"template":{"metadata":{"creationTimestamp":null},"spec":{"containers":null}},"strategy":{}},"status":{}}</p>
<p>HTTP/1.1 422 Unprocessable Entity
(...)
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">For</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">details</span><span class="p">,</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">documentation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">[</span><span class="n">applyconfigurations</span><span class="o">]</span><span class="p">(</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">pkg</span><span class="p">.</span><span class="k">go</span><span class="p">.</span><span class="n">dev</span><span class="o">/</span><span class="n">k8s</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">client</span><span class="o">-</span><span class="k">go</span><span class="o">/</span><span class="n">applyconfigurations</span><span class="p">).</span>

<span class="n">Compare</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="err">`</span><span class="n">kubectl</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">debugging</span><span class="o">/</span><span class="n">test</span><span class="p">.</span><span class="n">yaml</span><span class="w"> </span><span class="c1">--server-side` produces:</span>
</code></pre></div></td></tr></table></div>
PATCH /apis/apps/v1/namespaces/reconciler/deployments/reconciler?fieldManager=kubectl&amp;fieldValidation=Strict&amp;force=false HTTP/1.1
Host: 127.0.0.1:8001
User-Agent: kubectl/v1.33.2 (linux/amd64) kubernetes/a57b6f7
Content-Length: 125
Accept: application/json
Content-Type: application/apply-patch+yaml
Kubectl-Command: kubectl apply
Kubectl-Session: 3bdd8423-e68d-4b30-9c1f-258b1e7630bd
Accept-Encoding: gzip</p>
<p>{"apiVersion":"apps/v1","kind":"Deployment","metadata":{"name":"reconciler","namespace":"reconciler"},"spec":{"replicas":6}}
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">It</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">selector</span><span class="p">,</span><span class="w"> </span><span class="n">nor</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">fields</span><span class="p">,</span><span class="w"> </span><span class="n">thus</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">does</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">lead</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">conflict</span><span class="p">,</span><span class="w"> </span><span class="n">because</span>
<span class="n">kubectl</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">Server</span><span class="o">-</span><span class="n">Side</span><span class="w"> </span><span class="n">Apply</span><span class="w"> </span><span class="p">[</span><span class="n">encodes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">entire</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">scheme</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/kubernetes/kubernetes/blob/d9df4ecff77012e63164292ab900fd23b2a714e0/staging/src/k8s.io/kubectl/pkg/cmd/apply/apply.go#L579)</span>
<span class="n">as</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="p">[]</span><span class="n">byte</span><span class="err">`</span><span class="w">  </span><span class="n">and</span><span class="w"> </span><span class="n">sends</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="err">`</span><span class="n">PATCH</span><span class="err">`</span><span class="w"> </span><span class="n">request</span><span class="p">.</span>

<span class="cp">## Skipping Get/Create Get/Update with Patch and fully specified intent for constructive controllers</span>

<span class="n">It</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">take</span><span class="w"> </span><span class="n">Server</span><span class="o">-</span><span class="n">Side</span><span class="w"> </span><span class="n">Apply</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">step</span><span class="w"> </span><span class="n">further</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">Patch</span><span class="err">`</span><span class="w"> </span><span class="n">method</span>
<span class="p">[</span><span class="k">for</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">creation</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">updates</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/andreaskaris/reconciler-operator/blob/97ab8c69effacb1c43fd7718a9f47144d5607d33/internal/controller/reconciler_controller.go#L82).</span>
<span class="n">This</span><span class="w"> </span><span class="n">simplifies</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">reconciler</span><span class="w"> </span><span class="n">of</span>
<span class="p">[</span><span class="n">constructive</span><span class="w"> </span><span class="n">controllers</span><span class="p">](</span><span class="w"> </span><span class="n">https</span><span class="o">:</span><span class="c1">//kubernetes.io/blog/2022/10/20/advanced-server-side-apply/#reconstructive-controllers):</span>
</code></pre></div></td></tr></table></div>
func (r *ReconcilerReconciler) Reconcile(ctx context.Context, req ctrl.Request) (ctrl.Result, error) {
    logger := logf.FromContext(ctx)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="n">TODO</span><span class="p">(</span><span class="n">user</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">here</span>
<span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">&quot;reconciler was called&quot;</span><span class="p">)</span>
<span class="n">reconciler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v1alpha1</span><span class="o">.</span><span class="n">Reconciler</span><span class="p">{}</span>
<span class="n">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">ctx</span><span class="o">,</span><span class="w"> </span><span class="n">req</span><span class="o">.</span><span class="n">NamespacedName</span><span class="o">,</span><span class="w"> </span><span class="n">reconciler</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">!</span><span class="o">=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">apierrors</span><span class="o">.</span><span class="n">IsNotFound</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">&quot;reconciler resource not found. Ignoring since object must be deleted&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{}</span><span class="o">,</span><span class="w"> </span><span class="n">nil</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">requeue</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">request</span><span class="o">.</span>
<span class="w">    </span><span class="n">logger</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="n">err</span><span class="o">,</span><span class="w"> </span><span class="s">&quot;Failed to get reconciler&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{}</span><span class="o">,</span><span class="w"> </span><span class="n">err</span>
<span class="p">}</span>

<span class="n">desiredDeployment</span><span class="o">,</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">getReconcilerDeployment</span><span class="p">(</span><span class="n">reconciler</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">!</span><span class="o">=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{}</span><span class="o">,</span><span class="w"> </span><span class="n">err</span>
<span class="p">}</span>
<span class="n">desiredDeployment</span><span class="o">.</span><span class="n">APIVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;apps/v1&quot;</span>
<span class="n">desiredDeployment</span><span class="o">.</span><span class="n">Kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Deployment&quot;</span>
<span class="n">logger</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="s">&quot;patching deployment&quot;</span><span class="o">,</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span><span class="o">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">r</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">ctx</span><span class="o">,</span><span class="w"> </span><span class="n">desiredDeployment</span><span class="o">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">Apply</span><span class="o">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">ForceOwnership</span><span class="o">,</span><span class="w"> </span><span class="n">client</span><span class="o">.</span><span class="n">FieldOwner</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">Name</span><span class="p">));</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">!</span><span class="o">=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{}</span><span class="o">,</span><span class="w"> </span><span class="n">err</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="n">ctrl</span><span class="o">.</span><span class="n">Result</span><span class="p">{}</span><span class="o">,</span><span class="w"> </span><span class="n">nil</span>
</code></pre></div></td></tr></table></div>
<p>}
<code class="highlight"><span class="k">Starting</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">clean</span><span class="w"> </span><span class="n">sheet</span><span class="p">,</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n n-Quoted">`reconciler`</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="k">name</span><span class="w"> </span><span class="n n-Quoted">`reconciler-sample`</span><span class="w"> </span><span class="n">present</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">only</span><span class="n">send</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n n-Quoted">`PATCH`</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">API</span><span class="w"> </span><span class="k">server</span><span class="o">:</span></code>
$ make samples
$ go run ./cmd/main.go
2025-09-03T13:04:21+02:00       INFO    setup   starting manager
2025-09-03T13:04:21+02:00       INFO    starting server {"name": "health probe", "addr": "[::]:8081"}
2025-09-03T13:04:21+02:00       INFO    Starting EventSource    {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "source": "kind source: <em>v1alpha1.Reconciler"}
2025-09-03T13:04:21+02:00       INFO    Starting Controller     {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler"}
2025-09-03T13:04:21+02:00       INFO    Starting workers        {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "worker count": 1}
2025-09-03T13:04:21+02:00       INFO    reconciler was called   {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "Reconciler": {"name":"reconciler-sample"}, "namespace": "", "name": "reconciler-sample", "reconcileID": "74304b1e-bb08-4e38-83fc-c888a64f8b6e"}
2025-09-03T13:04:21+02:00       INFO    patching deployment     {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "Reconciler": {"name":"reconciler-sample"}, "namespace": "", "name": "reconciler-sample", "reconcileID": "74304b1e-bb08-4e38-83fc-c888a64f8b6e", "deployment": "&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 259e2baf-46f9-47b4-b472-d7f17623b278 0xc000881982 0xc000881981}] [] []},Spec:DeploymentSpec{Replicas:</em>1,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] <nil> [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:<em>1001,RunAsNonRoot:</em>false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:<em>false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  <nil> <nil>  map[]   <nil>  false false false <nil> &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:</em>true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  <nil> nil [] <nil> <nil> <nil> map[] [] <nil> nil <nil> [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}"}
<code class="highlight">`<span class="nv">manager</span>:<span class="w"> </span><span class="nv">reconciler</span><span class="o">-</span><span class="nv">controller</span>`<span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">now</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">field</span><span class="w"> </span><span class="nv">manager</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">exception</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span>`<span class="nv">kube</span><span class="o">-</span><span class="nv">controller</span><span class="o">-</span><span class="nv">manager</span>`<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">the</span><span class="nv">status</span><span class="w"> </span><span class="nv">field</span>:</code>
$ kubectl get deployments  -n reconciler reconciler -o yaml  --show-managed-fields 
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "1"
  creationTimestamp: "2025-09-03T11:04:21Z"
  generation: 1
  managedFields:
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:ownerReferences:
          k:{"uid":"259e2baf-46f9-47b4-b472-d7f17623b278"}: {}
      f:spec:
        f:replicas: {}
        f:selector: {}
        f:strategy: {}
        f:template:
          f:metadata:
            f:creationTimestamp: {}
            f:labels:
              f:app: {}
          f:spec:
            f:containers:
              k:{"name":"netshoot"}:
                .: {}
                f:command: {}
                f:image: {}
                f:imagePullPolicy: {}
                f:name: {}
                f:resources: {}
                f:securityContext:
                  f:allowPrivilegeEscalation: {}
                  f:capabilities:
                    f:drop: {}
                  f:runAsNonRoot: {}
                  f:runAsUser: {}
            f:securityContext:
              f:runAsNonRoot: {}
              f:seccompProfile:
                f:type: {}
    manager: reconciler-controller
    operation: Apply
    time: "2025-09-03T11:04:21Z"
  - apiVersion: apps/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .: {}
          f:deployment.kubernetes.io/revision: {}
      f:status:
        f:availableReplicas: {}
        f:conditions:
          .: {}
          k:{"type":"Available"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
          k:{"type":"Progressing"}:
            .: {}
            f:lastTransitionTime: {}
            f:lastUpdateTime: {}
            f:message: {}
            f:reason: {}
            f:status: {}
            f:type: {}
        f:observedGeneration: {}
        f:readyReplicas: {}
        f:replicas: {}
        f:updatedReplicas: {}
    manager: kube-controller-manager
    operation: Update
    subresource: status
    time: "2025-09-03T11:04:21Z"
(...)
<code class="highlight">And reconciliation works with the exact same logic:</code>
$ kubectl patch reconciler reconciler-sample --type='merge' -p='{"spec":{"replicas":3}}'
reconciler.test.example.com/reconciler-sample patched
<code class="highlight"></code>
2025-09-03T13:07:10+02:00       INFO    reconciler was called   {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "Reconciler": {"name":"reconciler-sample"}, "namespace": "", "name": "reconciler-sample", "reconcileID": "b0e3cf40-ad0d-4c71-95a9-a54d3f2db3aa"}
2025-09-03T13:07:10+02:00       INFO    patching deployment     {"controller": "reconciler", "controllerGroup": "test.example.com", "controllerKind": "Reconciler", "Reconciler": {"name":"reconciler-sample"}, "namespace": "", "name": "reconciler-sample", "reconcileID": "b0e3cf40-ad0d-4c71-95a9-a54d3f2db3aa", "deployment": "&amp;Deployment{ObjectMeta:{reconciler  reconciler    0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[] map[] [{test.example.com/v1alpha1 Reconciler reconciler-sample 259e2baf-46f9-47b4-b472-d7f17623b278 0xc000726662 0xc000726661}] [] []},Spec:DeploymentSpec{Replicas:<em>3,Selector:&amp;v1.LabelSelector{MatchLabels:map[string]string{app: reconciler-deployment,},MatchExpressions:[]LabelSelectorRequirement{},},Template:{{      0 0001-01-01 00:00:00 +0000 UTC <nil> <nil> map[app:reconciler-deployment] map[] [] [] []} {[] [] [{netshoot nicolaka/netshoot [sleep infinity] []  [] [] [] {map[] map[] []} [] <nil> [] [] nil nil nil nil   IfNotPresent SecurityContext{Capabilities:&amp;Capabilities{Add:[],Drop:[ALL],},Privileged:nil,SELinuxOptions:nil,RunAsUser:</em>1001,RunAsNonRoot:<em>false,ReadOnlyRootFilesystem:nil,AllowPrivilegeEscalation:</em>false,RunAsGroup:nil,ProcMount:nil,WindowsOptions:nil,SeccompProfile:nil,AppArmorProfile:nil,} false false false}] []  <nil> <nil>  map[]   <nil>  false false false <nil> &amp;PodSecurityContext{SELinuxOptions:nil,RunAsUser:nil,RunAsNonRoot:*true,SupplementalGroups:[],FSGroup:nil,RunAsGroup:nil,Sysctls:[]Sysctl{},WindowsOptions:nil,FSGroupChangePolicy:nil,SeccompProfile:&amp;SeccompProfile{Type:RuntimeDefault,LocalhostProfile:nil,},AppArmorProfile:nil,SupplementalGroupsPolicy:nil,SELinuxChangePolicy:nil,} []   nil  [] []  <nil> nil [] <nil> <nil> <nil> map[] [] <nil> nil <nil> [] [] nil}},Strategy:DeploymentStrategy{Type:,RollingUpdate:nil,},MinReadySeconds:0,RevisionHistoryLimit:nil,Paused:false,ProgressDeadlineSeconds:nil,},Status:DeploymentStatus{ObservedGeneration:0,Replicas:0,UpdatedReplicas:0,AvailableReplicas:0,UnavailableReplicas:0,Conditions:[]DeploymentCondition{},ReadyReplicas:0,CollisionCount:nil,TerminatingReplicas:nil,},}"}
```</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this blog post, we explored Server-Side Apply in the context of controller-runtime controllers. We started by examining
how kubectl uses Server-Side Apply and understanding the HTTP requests it generates to the API server. We then looked at
the current state of SSA support in controller-runtime and built a working example using the Operator SDK.</p>
<p>We looked at how field management works in practice by showing conflicts between different field managers and how ownership
transfers when using forced applies. We traced network packets to see the actual API requests generated by both kubectl
and controller-runtime implementations.</p>
<p>Finally, we showed how Server-Side Apply can simplify controller logic by eliminating the need for separate Get/Create
and Get/Update patterns, allowing controllers to use a single Patch operation for both object creation and updates.</p>
<p>Server-Side Apply simplifies controller logic by using a single approach for both creating and updating resources.
Instead of checking if an object exists and then choosing between Create or Update operations, controllers can use the
Patch method with <code class="highlight">client.Apply</code> for all cases.</p>
<p>This approach works particularly well for constructive controllers that want to declare the desired state of resources.
The controller builds the complete object definition and lets the Kubernetes API server handle the differences. Field
management ensures that conflicts are detected and ownership is tracked properly.</p>
<p>For new controllers, using the Patch method with <code class="highlight">client.Apply</code>, <code class="highlight">client.ForceOwnership</code>, and <code class="highlight">client.FieldOwner</code> provides
a clean and simple reconciliation pattern that handles both object creation and updates with the same code path.</p>
<p>In the near future, SSA will be fully implemented, supported and documented for the <code class="highlight">controller-runtime</code> and it will then
be best to use the native features instead of the Patch method.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 3, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.prune", "navigation.top", "navigation.path", "navigation.indexes", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>