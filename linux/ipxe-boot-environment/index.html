
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Andreas Karis' blog about anything Kubernetes, OpenShift, Linux and Networking">
      
      
      
        <link rel="canonical" href="https://andreaskaris.github.io/blog/linux/ipxe-boot-environment/">
      
      
        <link rel="prev" href="../hugepages/">
      
      
        <link rel="next" href="../java-idrac-issues/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>iPXE boot environment on Fedora - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="RSS feed of created content" href="https://andreaskaris.github.io/blog/feed_rss_created.xml">
  <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="https://andreaskaris.github.io/blog/feed_rss_updated.xml">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#setting-up-an-ipxe-boot-environment-under-fedora" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              iPXE boot environment on Fedora
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ceph/" class="md-tabs__link">
          
  
    
  
  Ceph

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../networking/" class="md-tabs__link">
          
  
    
  
  Networking

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openshift/" class="md-tabs__link">
          
  
    
  
  OpenShift and Kubernetes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openstack/" class="md-tabs__link">
          
  
    
  
  OpenStack

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../coding/" class="md-tabs__link">
          
  
    
  
  Coding

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  
    
    <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../ceph/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Ceph
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cgroups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cgroups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containers in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hugepages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugepages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    iPXE boot environment on Fedora
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    iPXE boot environment on Fedora
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Install dependencies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-dnsmasq-and-tftp" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up dnsmasq and tftp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-httpd-and-images" class="md-nav__link">
    <span class="md-ellipsis">
      Configure httpd and images
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../java-idrac-issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java Idrac Issues
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../meson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    meson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../namespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    namespaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../old_java_version_with_xorgs_in_container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Old Java inside a container with xorgs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../protect-lenovo-battery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Protect Lenovo laptop battery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../org-gnome-shell-overrides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workaround for org.gnome.shell.overrides not installed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resetting-libvirt-qcow-attributes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resetting libvirt qcow attributes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../get-process-cgroup-info-and-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retrieving process cgroup resource usage and limit info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../libvirt-uefi-without-secureboot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RHEL Booting a virtual machine with UEFI but without secure boot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../setting-journalctl-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting journalctl limits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cgroups_cpu_quota/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using cgroups for CFS bandwidth control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../udev-ethtool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    udev rules to apply ethtool settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../selinux-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SELinux Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../set-tun-mac-privileges/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting TAP MAC address w/o NET_ADMIN Caps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../networking/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../openshift/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    OpenShift and Kubernetes
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../openstack/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    OpenStack
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../coding/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Coding
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
        </div>
      </div>
    </div>
  
  

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="setting-up-an-ipxe-boot-environment-under-fedora">Setting up an iPXE boot environment under Fedora</h1>
<p>In order to get a working iPXE boot environment, you need to set up dnsmasq/tftp and httpd. dnsmasq is used as the DHCP server, if needed as the DNS server (although disabled in the following example) and as the tftp server. httpd will serve the actual images to boot from.</p>
<p>The following steps are a manual walkthrough of the steps taken in <a href="https://github.com/andreaskaris/fedora-ipxe-container">https://github.com/andreaskaris/fedora-ipxe-container</a>.</p>
<h2 id="install-dependencies">Install dependencies</h2>
<p>Install required dependencies:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>yum install ipxe-bootimgs dnsmasq httpd -y
</code></pre></div></td></tr></table></div></p>
<h2 id="setting-up-dnsmasq-and-tftp">Setting up dnsmasq and tftp</h2>
<p>Create required directories:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>mkdir /tftpboot
mkdir /dhcphosts
</code></pre></div></td></tr></table></div></p>
<p>Create the following configuration for dnsmasq and adjust according to your needs.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="err">&#39;</span><span class="nx">EOF</span><span class="err">&#39;</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">dnsmasq</span><span class="p">.</span><span class="nx">conf</span>
<span class="err">#</span><span class="w"> </span><span class="nx">enable</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">required</span>
<span class="err">#</span><span class="nx">log</span><span class="o">-</span><span class="nx">queries</span>
<span class="err">#</span><span class="nx">log</span><span class="o">-</span><span class="nx">dhcp</span>

<span class="err">#</span><span class="w"> </span><span class="nx">disable</span><span class="w"> </span><span class="nx">DNS</span><span class="w"> </span><span class="nx">server</span>
<span class="nx">port</span><span class="p">=</span><span class="mi">0</span>

<span class="nx">listen</span><span class="o">-</span><span class="nx">address</span><span class="p">=</span><span class="m m-Double">192.168.123.1</span>
<span class="kd">interface</span><span class="p">=</span><span class="nx">baremetal</span>

<span class="err">#</span><span class="w"> </span><span class="nx">enable</span><span class="w"> </span><span class="nx">built</span><span class="o">-</span><span class="k">in</span><span class="w"> </span><span class="nx">tftp</span><span class="w"> </span><span class="nx">server</span>
<span class="nx">enable</span><span class="o">-</span><span class="nx">tftp</span>
<span class="nx">tftp</span><span class="o">-</span><span class="nx">root</span><span class="p">=</span><span class="o">/</span><span class="nx">tftpboot</span>

<span class="err">#</span><span class="w"> </span><span class="nx">DHCP</span><span class="w"> </span><span class="nx">range</span><span class="w"> </span><span class="m m-Double">192.168.123.200</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m m-Double">192.168.123.250</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="nx">range</span><span class="p">=</span><span class="m m-Double">192.168.123.200</span><span class="p">,</span><span class="m m-Double">192.168.123.250</span><span class="p">,</span><span class="m m-Double">255.255.255.0</span><span class="p">,</span><span class="mi">24</span><span class="nx">h</span>

<span class="err">#</span><span class="w"> </span><span class="nx">Default</span><span class="w"> </span><span class="nx">gateway</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="nx">option</span><span class="p">=</span><span class="mi">3</span><span class="p">,</span><span class="m m-Double">192.168.123.1</span>

<span class="nx">dhcp</span><span class="o">-</span><span class="nx">option</span><span class="p">=</span><span class="mi">6</span><span class="p">,</span><span class="m m-Double">192.168.123.1</span>

<span class="err">#</span><span class="w"> </span><span class="nx">Domain</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">homelab</span><span class="p">.</span><span class="nx">net</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="nx">option</span><span class="p">=</span><span class="mi">15</span><span class="p">,</span><span class="nx">example</span><span class="p">.</span><span class="nx">com</span>

<span class="err">#</span><span class="w"> </span><span class="nx">Broadcast</span><span class="w"> </span><span class="nx">address</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="nx">option</span><span class="p">=</span><span class="mi">28</span><span class="p">,</span><span class="m m-Double">192.168.123.255</span>

<span class="err">#</span><span class="w"> </span><span class="nx">Set</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="nx">MTU</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="mi">9000</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="p">(</span><span class="nx">jumbo</span><span class="w"> </span><span class="nx">frame</span><span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="nx">Enable</span><span class="w"> </span><span class="nx">only</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">network</span><span class="w"> </span><span class="nx">supports</span><span class="w"> </span><span class="nx">it</span>
<span class="err">#</span><span class="w"> </span><span class="nx">dhcp</span><span class="o">-</span><span class="nx">option</span><span class="p">=</span><span class="mi">26</span><span class="p">,</span><span class="mi">9000</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="nx">option</span><span class="o">-</span><span class="nx">force</span><span class="p">=</span><span class="mi">26</span><span class="p">,</span><span class="mi">9000</span>


<span class="err">#</span><span class="w"> </span><span class="nx">Tag</span><span class="w"> </span><span class="nx">dhcp</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">iPXE</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="k">match</span><span class="p">=</span><span class="nx">set</span><span class="p">:</span><span class="nx">ipxe</span><span class="p">,</span><span class="mi">175</span>

<span class="err">#</span><span class="w"> </span><span class="nx">inspect</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">vendor</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">tag</span><span class="w"> </span><span class="nx">BIOS</span><span class="w"> </span><span class="nx">client</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="nx">vendorclass</span><span class="p">=</span><span class="nx">BIOS</span><span class="p">,</span><span class="nx">PXEClient</span><span class="p">:</span><span class="nx">Arch</span><span class="p">:</span><span class="mi">00000</span>

<span class="err">#</span><span class="w"> </span><span class="mi">1</span><span class="nx">st</span><span class="w"> </span><span class="nx">boot</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Legacy</span><span class="w"> </span><span class="nx">BIOS</span><span class="w"> </span><span class="nx">client</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="nx">boot</span><span class="p">=</span><span class="nx">tag</span><span class="p">:!</span><span class="nx">ipxe</span><span class="p">,</span><span class="nx">tag</span><span class="p">:</span><span class="nx">BIOS</span><span class="p">,</span><span class="nx">undionly</span><span class="p">.</span><span class="nx">kpxe</span><span class="p">,</span><span class="m m-Double">192.168.123.1</span>

<span class="err">#</span><span class="w"> </span><span class="mi">1</span><span class="nx">st</span><span class="w"> </span><span class="nx">boot</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">EFI</span><span class="w"> </span><span class="nx">client</span>
<span class="err">#</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">moment</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">non</span><span class="o">-</span><span class="nx">BIOS</span><span class="w"> </span><span class="nx">clients</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">considered</span>
<span class="err">#</span><span class="w"> </span><span class="nx">EFI</span><span class="w"> </span><span class="nx">client</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="nx">boot</span><span class="p">=</span><span class="nx">tag</span><span class="p">:!</span><span class="nx">ipxe</span><span class="p">,</span><span class="nx">tag</span><span class="p">:!</span><span class="nx">BIOS</span><span class="p">,</span><span class="nx">ipxe</span><span class="p">.</span><span class="nx">efi</span><span class="p">,</span><span class="m m-Double">192.168.123.1</span>

<span class="err">#</span><span class="w"> </span><span class="mi">2</span><span class="nx">nd</span><span class="w"> </span><span class="nx">boot</span><span class="w"> </span><span class="nx">file</span>
<span class="nx">dhcp</span><span class="o">-</span><span class="nx">boot</span><span class="p">=</span><span class="nx">tag</span><span class="p">:</span><span class="nx">ipxe</span><span class="p">,</span><span class="nx">menu</span><span class="o">/</span><span class="nx">boot</span><span class="p">.</span><span class="nx">ipxe</span>
<span class="nx">EOF</span>
</code></pre></div></td></tr></table></div></p>
<p>Within the DHCP range, create a range of static leases:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>cat &lt;&lt;&#39;EOF&#39; &gt; /dhcphosts/hosts 
52:54:00:00:00:01,192.168.123.200,node-0
52:54:00:00:00:01,192.168.123.201,node-1
EOF
</code></pre></div></td></tr></table></div></p>
<p>Run dnsmasq in the foreground for testing:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>/usr/sbin/dnsmasq -k --dhcp-hostsdir=/dhcphosts --bind-interfaces --log-facility=/dev/stdout
</code></pre></div></td></tr></table></div></p>
<p>Obviously, this should better be run as a service:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="na">cat &lt;&lt;&#39;EOF&#39; &gt; /etc/systemd/system/dnsmasq-custom.service </span>
<span class="na">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">DNS caching server.</span>
<span class="na">After</span><span class="o">=</span><span class="s">network.target</span>

<span class="k">[Service]</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/sbin/dnsmasq -k --dhcp-hostsdir=/dhcphosts --bind-interfaces</span>
<span class="na">Type</span><span class="o">=</span><span class="s">forking</span>
<span class="na">PIDFile</span><span class="o">=</span><span class="s">/run/dnsmasq.pid</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
<span class="err">EOF</span>
<span class="err">systemctl daemon-reload</span>
<span class="err">systemctl enable --now dnsmasq-custom</span>
</code></pre></div></td></tr></table></div></p>
<p>Create files <code class="highlight">/tftpboot/ipxe.efi</code>, <code class="highlight">/tftpboot/undionly.kpxe</code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>RUN cp /usr/share/ipxe/undionly.kpxe /tftpboot
RUN cp /usr/share/ipxe/ipxe-x86_64.efi /tftpboot/ipxe.efi
</code></pre></div></td></tr></table></div></p>
<p>Create the PXE boot menu:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code>cat<span class="w"> </span><span class="err">&lt;&lt;</span>&#39;EOF&#39;<span class="w"> </span>&gt;<span class="w"> </span>/tftpboot/menu/boot.ipxe<span class="w"> </span>
#!ipxe<span class="w"> </span>

menu<span class="w"> </span>PXE<span class="w"> </span>Boot<span class="w"> </span>Options

item<span class="w"> </span>fedora<span class="w"> </span>fedora
item<span class="w"> </span>openshift-master<span class="w"> </span>openshift-master
item<span class="w"> </span>openshift-bootstrap<span class="w"> </span>openshift-bootstrap
item<span class="w"> </span>openshift-worker<span class="w"> </span>openshift-worker

item<span class="w"> </span>shell<span class="w"> </span>iPXE<span class="w"> </span>shell
item<span class="w"> </span>exit<span class="w">  </span>Exit<span class="w"> </span>to<span class="w"> </span>BIOS

choose<span class="w"> </span>--default<span class="w"> </span>exit<span class="w"> </span>--timeout<span class="w"> </span>10000<span class="w"> </span>option<span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span>goto<span class="w"> </span><span class="cp">${</span><span class="n">option</span><span class="cp">}</span>

:fedora
set<span class="w"> </span>server_root<span class="w"> </span>http://192.168.123.1:8081/fedora/
initrd<span class="w"> </span><span class="cp">${</span><span class="n">server_root</span><span class="cp">}</span>/initrd.img
kernel<span class="w"> </span><span class="cp">${</span><span class="n">server_root</span><span class="cp">}</span>/vmlinuz<span class="w"> </span>ip=dhcp<span class="w"> </span>ipv6.disable<span class="w"> </span>initrd=initrd.img<span class="w"> </span>inst.ks=<span class="cp">${</span><span class="n">server_root</span><span class="cp">}</span>/kickstart.cfg
boot

:shell
shell

:exit
exit
</code></pre></div></td></tr></table></div></p>
<h2 id="configure-httpd-and-images">Configure httpd and images</h2>
<p>Prepare httpd:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>systemctl enable --now httpd
</code></pre></div></td></tr></table></div></p>
<p>Now, download and add Fedora to be booted from iPXE:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="err">&#39;</span><span class="n">EOF</span><span class="err">&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">example_netinstall</span><span class="p">.</span><span class="n">sh</span>
<span class="cp">#!/bin/bash</span>

<span class="n">echo</span><span class="w"> </span><span class="s">&quot;Installing Fedora PXE boot image for debugging&quot;</span>
<span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">L</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">fedora</span><span class="p">.</span><span class="n">iso</span><span class="w"> </span><span class="s">&quot;https://download.fedoraproject.org/pub/fedora/linux/releases/32/Server/x86_64/iso/Fedora-Server-dvd-x86_64-32-1.6.iso&quot;</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">fedora</span>
<span class="n">mkdir</span><span class="w"> </span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">fedora</span><span class="o">/</span><span class="n">dvd</span><span class="w"> </span><span class="o">-</span><span class="n">p</span>
<span class="n">mount</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">fedora</span><span class="p">.</span><span class="n">iso</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">fedora</span>
<span class="err">\</span><span class="n">cp</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">fedora</span><span class="cm">/* /var/www/html/fedora/dvd/.</span>
<span class="cm">\cp /var/www/html/fedora/dvd/images/pxeboot/* /var/www/html/fedora/.</span>
<span class="cm">umount /mnt/fedora</span>
<span class="cm">source config </span>
<span class="cm">cat &lt;&lt; EOF &gt; /var/www/html/fedora/kickstart.cfg</span>
<span class="cm">url --url http://${PXE_LISTEN_ADDRESS}:${PXE_LISTEN_PORT}/fedora/dvd/</span>
<span class="cm">timezone --utc America/New_York</span>
<span class="cm">lang en_US.UTF-8</span>
<span class="cm">keyboard us</span>
<span class="cm">rootpw --plaintext password</span>
<span class="cm">reboot</span>
<span class="cm">firstboot --disable</span>
<span class="cm">services --enabled=&quot;sshd,chronyd&quot;</span>
<span class="cm">zerombr</span>
<span class="cm">clearpart --all</span>
<span class="cm">autopart --type lvm</span>
<span class="cm">%packages</span>
<span class="cm">@core</span>
<span class="cm">%end</span>
<span class="cm">EOF</span>
<span class="cm">bash example_netinstall.sh</span>
</code></pre></div></td></tr></table></div></p>
<p>You should not be able to iPXE boot your server.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">June 25, 2021</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.prune", "navigation.top", "navigation.path", "navigation.indexes", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>