
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.6">
    
    
      
        <title>Accept Source Routing - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2c0c5eaf.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="red">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#accept-source-routing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Accept Source Routing
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Ceph
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Ceph" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Ceph
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../ceph/ceph-manual-test/" class="md-nav__link">
        Ceph manual test with qemu
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Containers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Containers" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Containers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/analyzing-cni/" class="md-nav__link">
        Analyzing CNI calls
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        cgroups
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        Containers in Linux
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/list_docker_registry_containers/" class="md-nav__link">
        List container images in registry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        namespaces
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Linux
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        cgroups
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        Containers in Linux
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/hugepages/" class="md-nav__link">
        Hugepages
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/ipxe-boot-environment/" class="md-nav__link">
        iPXE boot environment on Fedora
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/java-idrac-issues/" class="md-nav__link">
        Java Idrac Issues
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/meson/" class="md-nav__link">
        meson
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        namespaces
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/old_java_version_with_xorgs_in_container/" class="md-nav__link">
        Old Java inside a container with xorgs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/get-process-cgroup-info-and-limits/" class="md-nav__link">
        Retrieving process cgroup resource usage and limit info
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/libvirt-uefi-without-secureboot/" class="md-nav__link">
        RHEL Booting a virtual machine with UEFI but without secure boot
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/setting-journalctl-limits/" class="md-nav__link">
        Setting journalctl limits
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        Networking
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Networking" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Accept Source Routing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Accept Source Routing
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ipv4" class="md-nav__link">
    IPv4
  </a>
  
    <nav class="md-nav" aria-label="IPv4">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-setup" class="md-nav__link">
    Test setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-in-a-live-systems-source-routing-disabled" class="md-nav__link">
    Testing in a live systems - source routing disabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-in-a-live-systems-source-routing-enabled" class="md-nav__link">
    Testing in a live systems - source routing enabled
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ipv6" class="md-nav__link">
    IPv6
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../arp_and_the_neighbor_table/" class="md-nav__link">
        ARP and the Neighbor table
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../bpf-and-tcpdump/" class="md-nav__link">
        BPF and tcpdump
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../bonding_in_linux/" class="md-nav__link">
        Bonding in Linux
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../juniper_x520/" class="md-nav__link">
        Configure Juniper switch
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../haproxy-and-h2c/" class="md-nav__link">
        haproxy and HTTP/2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../install-openvswitch-on-rocky/" class="md-nav__link">
        Install Open vSwitch on Rocky Linux 8
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../geneve_tunneling/" class="md-nav__link">
        Geneve tunneling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../netlink/" class="md-nav__link">
        Netlink
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ovn_standalone_on_fedora31/" class="md-nav__link">
        OVN standalone on Fedora 31
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ovs_recirculation/" class="md-nav__link">
        OVS packet recirculation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ovs-vxlan-tunnels-and-dscp/" class="md-nav__link">
        OVS VXLAN tunnels and DSCP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ovs_with_gdb/" class="md-nav__link">
        OVS with GDB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sctp/" class="md-nav__link">
        SCTP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../useful-commands/" class="md-nav__link">
        Useful commands
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../wireguard/" class="md-nav__link">
        Wireguard
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        OpenShift
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="OpenShift" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          OpenShift
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/alertmanager/" class="md-nav__link">
        AlertManager
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/cpu-manager-with-custom-machine-config-pool/" class="md-nav__link">
        CPU manager with custom MachineConfigPool
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/crio-conmon-runc/" class="md-nav__link">
        Crio vs conmon vs runc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/etcd_perf/" class="md-nav__link">
        Etcd Performance tests
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/get-vs-list-api-calls/" class="md-nav__link">
        Get vs List API Calls
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_httpbin_tshark_sidecar/" class="md-nav__link">
        Httpbin tshark sidecar container
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kubernetes_cluster/" class="md-nav__link">
        Hints for installing kubernetes on Fedora
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/HPA/" class="md-nav__link">
        Horizontal Pod Autoscaler
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/how_rhcos_updates_work/" class="md-nav__link">
        How RHCOS updates work
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ocp4-infra-nodes-with-machineset-without-worker-label/" class="md-nav__link">
        Infra nodes with MachineSets without worker label
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ingresscontroller_router_sharding_ocp_on_osp/" class="md-nav__link">
        Ingress Controller Sharding OCP on OSP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ingress-controller-sharding-on-separate-vip/" class="md-nav__link">
        Ingress Controller Sharding on separate VIP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_mirror_registry/" class="md-nav__link">
        Installing a cluster with a mirror registry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/istio-1.6-on-ocp.4.x/" class="md-nav__link">
        Istio 1.6 on OpenShift 4.x
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kata/" class="md-nav__link">
        kata containers and the kata operatora
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ovn-kind-hybrid-overlay/" class="md-nav__link">
        Kind with OVN Kubernetes Hybrid Overlay
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kind-with-private-registry/" class="md-nav__link">
        Kind with private registry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/mounting-container-image/" class="md-nav__link">
        Mount a container image
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/install_openshift_on_openstack/" class="md-nav__link">
        OpenShift on OpenStack
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/private-registry/" class="md-nav__link">
        Private container registry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/proxy-ocp-4.5/" class="md-nav__link">
        Proxy OCP 4.5
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/scc/" class="md-nav__link">
        Security Context Constraints (SCC)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/fix-selinux-labels-coreos/" class="md-nav__link">
        SElinux labels fix
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sctp/" class="md-nav__link">
        SCTP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_troubleshooting_etcd_state/" class="md-nav__link">
        Troubleshooting etcd state
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/useful-ocp-commands/" class="md-nav__link">
        Useful commands for OpenShift
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/useful-ocp-sdn-commands/" class="md-nav__link">
        Useful commands for OpenShift SDN
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/troubleshooting_openshift_on_openstack_worker_creation/" class="md-nav__link">
        Troubleshooting OpenShift on OpenStack worker creation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        OpenStack
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="OpenStack" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          OpenStack
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/reattach_to_running_deployment/" class="md-nav__link">
        Reattach to running deployment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/using_clouds_yaml/" class="md-nav__link">
        Using clouds.yaml
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        OperatorSDK
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="OperatorSDK" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          OperatorSDK
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-sdk/operator-sdk-reconciliation/" class="md-nav__link">
        Controller Reconciliation
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="accept-source-routing">Accept source routing</h1>
<p><strong>Note:</strong> I could only test this for IPv4. For IPv6, the kernel seems to be hardened by default.</p>
<h2 id="ipv4">IPv4</h2>
<p>On RHEL, the default settings for IPv4 will look something like this:</p>
<pre><code># sysctl -a | grep source_route | grep ipv4
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.br-ext.accept_source_route = 1
net.ipv4.conf.br-vxlan.accept_source_route = 1
net.ipv4.conf.br0.accept_source_route = 1
net.ipv4.conf.default.accept_source_route = 1
net.ipv4.conf.eth0.accept_source_route = 1
net.ipv4.conf.eth1.accept_source_route = 1
net.ipv4.conf.lo.accept_source_route = 1
net.ipv4.conf.ovs-system.accept_source_route = 1
net.ipv4.conf.vxlan_sys_4789.accept_source_route = 1
</code></pre>
<p><code>net.ipv4.conf.all.accept_source_route = 0</code> will override anything else.</p>
<p>The documentation clearly states that this is a logical AND relationship:
<a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt</a></p>
<pre><code>accept_source_route - BOOLEAN
    Accept packets with SRR option.
    conf/all/accept_source_route must also be set to TRUE to accept packets
    with SRR option on the interface
    default TRUE (router)
        FALSE (host)
</code></pre>
<p>Having a look at the kernel code:
* <a href="https://github.com/torvalds/linux/blob/8efd0d9c316af470377894a6a0f9ff63ce18c177/include/linux/inetdevice.h#L103">https://github.com/torvalds/linux/blob/8efd0d9c316af470377894a6a0f9ff63ce18c177/include/linux/inetdevice.h#L103</a>
* <a href="https://github.com/torvalds/linux/blob/8efd0d9c316af470377894a6a0f9ff63ce18c177/include/linux/inetdevice.h#L83">https://github.com/torvalds/linux/blob/8efd0d9c316af470377894a6a0f9ff63ce18c177/include/linux/inetdevice.h#L83</a>
* <a href="https://github.com/torvalds/linux/blob/8efd0d9c316af470377894a6a0f9ff63ce18c177/include/linux/inetdevice.h#L56">https://github.com/torvalds/linux/blob/8efd0d9c316af470377894a6a0f9ff63ce18c177/include/linux/inetdevice.h#L56</a></p>
<p>The actual drop for IPv4 is happening here:
* <a href="https://github.com/torvalds/linux/blob/5bfc75d92efd494db37f5c4c173d3639d4772966/net/ipv4/ip_input.c#L293">https://github.com/torvalds/linux/blob/5bfc75d92efd494db37f5c4c173d3639d4772966/net/ipv4/ip_input.c#L293</a></p>
<p>We should be able to see what's happening if we enable martian logging:
* <a href="https://github.com/torvalds/linux/blob/5bfc75d92efd494db37f5c4c173d3639d4772966/net/ipv4/ip_input.c#L290">https://github.com/torvalds/linux/blob/5bfc75d92efd494db37f5c4c173d3639d4772966/net/ipv4/ip_input.c#L290</a></p>
<h3 id="test-setup">Test setup</h3>
<p>I tested with forwarding on:</p>
<pre><code>[root@centos84 ~]# sysctl -a | grep ip_forward
net.ipv4.ip_forward = 1
net.ipv4.ip_forward_update_priority = 1
net.ipv4.ip_forward_use_pmtu = 0
[root@centos84 ~]# sysctl -a | grep forward | grep eth0
net.ipv4.conf.eth0.bc_forwarding = 0
net.ipv4.conf.eth0.forwarding = 1
net.ipv4.conf.eth0.mc_forwarding = 0
net.ipv6.conf.eth0.forwarding = 0
net.ipv6.conf.eth0.mc_forwarding = 0
</code></pre>
<p>The traceroute command <code>traceroute -I 192.168.122.6 -g 192.168.122.6</code> that I'm using below yields the following IPv4 header + ICMP message:</p>
<pre><code>(...)
Internet Protocol Version 4, Src: 192.168.122.1, Dst: 192.168.122.6, Via: 192.168.122.6
    0100 .... = Version: 4
    .... 1000 = Header Length: 32 bytes (8)
    Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)
        0000 00.. = Differentiated Services Codepoint: Default (0)
        .... ..00 = Explicit Congestion Notification: Not ECN-Capable Transport (0)
    Total Length: 72
    Identification: 0x8307 (33543)
    Flags: 0x0000
        0... .... .... .... = Reserved bit: Not set
        .0.. .... .... .... = Don't fragment: Not set
        ..0. .... .... .... = More fragments: Not set
        ...0 0000 0000 0000 = Fragment offset: 0
    Time to live: 6
    Protocol: ICMP (1)
    Header checksum: 0x3770 [validation disabled]
    [Header checksum status: Unverified]
    Source: 192.168.122.1
    Current Route: 192.168.122.6
    Options: (12 bytes), Loose Source Route
        IP Option - No-Operation (NOP)
            Type: 1
                0... .... = Copy on fragmentation: No
                .00. .... = Class: Control (0)
                ...0 0001 = Number: No-Operation (NOP) (1)
        IP Option - Loose Source Route (11 bytes)
            Type: 131
                1... .... = Copy on fragmentation: Yes
                .00. .... = Class: Control (0)
                ...0 0011 = Number: Loose source route (3)
            Length: 11
            Pointer: 4
            Source Route: 192.168.122.6 &lt;- (next)
            Destination: 192.168.122.6
Internet Control Message Protocol
    Type: 8 (Echo (ping) request)
    Code: 0
    Checksum: 0x822c [correct]
    [Checksum Status: Good]
    Identifier (BE): 62 (0x003e)
    Identifier (LE): 15872 (0x3e00)
    Sequence number (BE): 16 (0x0010)
    Sequence number (LE): 4096 (0x1000)
    Data (32 bytes)

0000  48 49 4a 4b 4c 4d 4e 4f 50 51 52 53 54 55 56 57   HIJKLMNOPQRSTUVW
0010  58 59 5a 5b 5c 5d 5e 5f 60 61 62 63 64 65 66 67   XYZ[\]^_`abcdefg
        Data: 48494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f...
        [Length: 32]
</code></pre>
<h3 id="testing-in-a-live-systems-source-routing-disabled">Testing in a live systems - source routing disabled</h3>
<p>Here's how this can be tested, on my CentOS 8.4 system:</p>
<pre><code>[root@centos84 ~]# ip a | grep 192.168.122.6
    inet 192.168.122.6/24 brd 192.168.122.255 scope global dynamic noprefixroute eth0
[root@centos84 ~]# sysctl -a | grep source_route | grep ipv4
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.br-ext.accept_source_route = 1
net.ipv4.conf.br-vxlan.accept_source_route = 1
net.ipv4.conf.br0.accept_source_route = 1
net.ipv4.conf.default.accept_source_route = 1
net.ipv4.conf.eth0.accept_source_route = 1
net.ipv4.conf.eth1.accept_source_route = 1
net.ipv4.conf.lo.accept_source_route = 1
net.ipv4.conf.ovs-system.accept_source_route = 1
net.ipv4.conf.vxlan_sys_4789.accept_source_route = 1
[root@centos84 ~]# dropwatch -lkas
Initalizing kallsyms db
dropwatch&gt; start
Enabling monitoring...
Kernel monitoring activated.
Issue Ctrl-C to stop monitoring
(...)
</code></pre>
<p>Now, go to a second CLI, and run:</p>
<pre><code>[akaris@linux ~]$ traceroute -I 192.168.122.6 -g 192.168.122.6
traceroute to 192.168.122.6 (192.168.122.6), 30 hops max, 72 byte packets^C
[akaris@linux ~]$ timeout 5 traceroute -I 192.168.122.6 -g 192.168.122.6
traceroute to 192.168.122.6 (192.168.122.6), 30 hops max, 72 byte packets
[akaris@linux ~]$ 
[akaris@linux ~]$ timeout 5 traceroute -I 192.168.122.6 -g 192.168.122.6
traceroute to 192.168.122.6 (192.168.122.6), 30 hops max, 72 byte packets
[akaris@linux ~]$ 
</code></pre>
<p>As you can see, the traceroute will fail, and dropwatch on the first CLI will report 16 drops
from the traceroute in ip_rcv_finish:</p>
<pre><code>(...)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
16 drops at ip_rcv_finish+20d (0xffffffff8625274d)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
16 drops at ip_rcv_finish+20d (0xffffffff8625274d)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
16 drops at ip_rcv_finish+20d (0xffffffff8625274d)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
^CGot a stop message
dropwatch&gt; stop
</code></pre>
<p>You can also enable log martians (yes, <em>this</em> one is OR'ed, ironically) ...
<a href="https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt">https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt</a></p>
<pre><code>log_martians - BOOLEAN
    Log packets with impossible addresses to kernel log.
    log_martians for the interface will be enabled if at least one of
    conf/{all,interface}/log_martians is set to TRUE,
    it will be disabled otherwise
</code></pre>
<p>And upon source route drop, one will be able to see messages containing string <code>IPv4: source route option</code> in the logs:</p>
<pre><code>[root@centos84 ~]# sysctl -w net.ipv4.conf.all.log_martians=1
net.ipv4.conf.all.log_martians = 1
[root@centos84 ~]# sysctl -a | grep martians
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.br-ext.log_martians = 0
net.ipv4.conf.br-vxlan.log_martians = 0
net.ipv4.conf.br0.log_martians = 0
net.ipv4.conf.default.log_martians = 0
net.ipv4.conf.eth0.log_martians = 0
net.ipv4.conf.eth1.log_martians = 0
net.ipv4.conf.lo.log_martians = 0
net.ipv4.conf.ovs-system.log_martians = 0
net.ipv4.conf.vxlan_sys_4789.log_martians = 0
[root@centos84 ~]# sysctl -a | grep source_route | grep ipv4
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.br-ext.accept_source_route = 1
net.ipv4.conf.br-vxlan.accept_source_route = 1
net.ipv4.conf.br0.accept_source_route = 1
net.ipv4.conf.default.accept_source_route = 1
net.ipv4.conf.eth0.accept_source_route = 1
net.ipv4.conf.eth1.accept_source_route = 1
net.ipv4.conf.lo.accept_source_route = 1
net.ipv4.conf.ovs-system.accept_source_route = 1
net.ipv4.conf.vxlan_sys_4789.accept_source_route = 1
[root@centos84 ~]# journalctl -f
(... sending source route packets here ...)

Jan 21 10:01:01 centos84 CROND[17134]: (root) CMD (run-parts /etc/cron.hourly)
Jan 21 10:01:01 centos84 run-parts[17137]: (/etc/cron.hourly) starting 0anacron
Jan 21 10:01:01 centos84 anacron[17143]: Anacron started on 2022-01-21
Jan 21 10:01:01 centos84 run-parts[17145]: (/etc/cron.hourly) finished 0anacron
Jan 21 10:01:01 centos84 anacron[17143]: Will run job `cron.daily' in 21 min.
Jan 21 10:01:01 centos84 anacron[17143]: Jobs will be executed sequentially
Jan 21 10:01:01 centos84 kernel: net_ratelimit: 6 callbacks suppressed
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:01 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6

(... sending source route packets here ...)

Jan 21 10:01:08 centos84 kernel: net_ratelimit: 6 callbacks suppressed
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
Jan 21 10:01:08 centos84 kernel: IPv4: source route option 192.168.122.1 -&gt; 192.168.122.6
^C
</code></pre>
<h3 id="testing-in-a-live-systems-source-routing-enabled">Testing in a live systems - source routing enabled</h3>
<p>Now, I tested enabling source routing with <code>net.ipv4.conf.all.accept_source_route = 1</code>:</p>
<pre><code>[root@centos84 ~]# sysctl -w net.ipv4.conf.all.accept_source_route=1
net.ipv4.conf.all.accept_source_route = 1
[root@centos84 ~]# sysctl -a | grep source_route | grep ipv4
net.ipv4.conf.all.accept_source_route = 1
net.ipv4.conf.br-ext.accept_source_route = 1
net.ipv4.conf.br-vxlan.accept_source_route = 1
net.ipv4.conf.br0.accept_source_route = 1
net.ipv4.conf.default.accept_source_route = 1
net.ipv4.conf.eth0.accept_source_route = 1
net.ipv4.conf.eth1.accept_source_route = 1
net.ipv4.conf.lo.accept_source_route = 1
net.ipv4.conf.ovs-system.accept_source_route = 1
net.ipv4.conf.vxlan_sys_4789.accept_source_route = 1
[root@centos84 ~]# dropwatch -lkas
Initalizing kallsyms db
dropwatch&gt; start
Enabling monitoring...
Kernel monitoring activated.
Issue Ctrl-C to stop monitoring
(...)
</code></pre>
<p>Now, my traceroute with the source route option set works:</p>
<pre><code>[akaris@linux ~]$ timeout 5 traceroute -I 192.168.122.6 -g 192.168.122.6
traceroute to 192.168.122.6 (192.168.122.6), 30 hops max, 72 byte packets
 1  centos84 (192.168.122.6)  0.526 ms  0.509 ms  0.494 ms
[akaris@linux ~]$ timeout 5 traceroute -I 192.168.122.6 -g 192.168.122.6
traceroute to 192.168.122.6 (192.168.122.6), 30 hops max, 72 byte packets
 1  centos84 (192.168.122.6)  0.459 ms  0.433 ms  0.425 ms
[akaris@linux ~]$ timeout 5 traceroute -I 192.168.122.6 -g 192.168.122.6
traceroute to 192.168.122.6 (192.168.122.6), 30 hops max, 72 byte packets
 1  centos84 (192.168.122.6)  0.424 ms  0.388 ms  0.387 ms
[akaris@linux ~]$ timeout 5 traceroute -I 192.168.122.6 -g 192.168.122.6
traceroute to 192.168.122.6 (192.168.122.6), 30 hops max, 72 byte packets
 1  centos84 (192.168.122.6)  0.475 ms  0.460 ms  0.455 ms
[akaris@linux ~]$ timeout 5 traceroute -I 192.168.122.6 -g 192.168.122.6
traceroute to 192.168.122.6 (192.168.122.6), 30 hops max, 72 byte packets
 1  centos84 (192.168.122.6)  0.571 ms  0.546 ms  0.538 ms
[akaris@linux ~]$ 
</code></pre>
<p>And dropwatch only shows unrelated drops elsewhere:</p>
<pre><code>(...)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
2 drops at __init_scratch_end+37b6e440 (0xffffffffc076e440)
^CGot a stop message
dropwatch&gt; 
</code></pre>
<p>And the kernel with martian logging on does not report anything.</p>
<h2 id="ipv6">IPv6</h2>
<p>For IPv6, the default settings on RHEL for source routing will yield something like this:</p>
<pre><code># sysctl -a | grep source_route | grep ipv6
net.ipv6.conf.all.accept_source_route = 0
net.ipv6.conf.br-ext.accept_source_route = 0
net.ipv6.conf.br-vxlan.accept_source_route = 0
net.ipv6.conf.br0.accept_source_route = 0
net.ipv6.conf.default.accept_source_route = 0
net.ipv6.conf.eth0.accept_source_route = 0
net.ipv6.conf.eth1.accept_source_route = 0
net.ipv6.conf.lo.accept_source_route = 0
net.ipv6.conf.ovs-system.accept_source_route = 0
net.ipv6.conf.vxlan_sys_4789.accept_source_route = 0
</code></pre>
<p>For IPv6, I tried crafting RH0 type packets, but failed miserably at the task. With that said, the kernel only ever accepts RH2 and the default is off, anyway: 
[https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt(https://www.kernel.org/doc/Documentation/networking/ip-sysctl.txt:)</p>
<pre><code>accept_source_route - INTEGER
    Accept source routing (routing extension header).

    &gt;= 0: Accept only routing header type 2.
    &lt; 0: Do not accept routing header.

    Default: 0
</code></pre>
<p>It looks like this was merged 14 years ago, so we should be good ;-) <a href="https://github.com/torvalds/linux/commit/bb4dbf9e61d0801927e7df2569bb3dd8287ea301">https://github.com/torvalds/linux/commit/bb4dbf9e61d0801927e7df2569bb3dd8287ea301</a>
The following article on LWN might be of interest, too: <a href="https://lwn.net/Articles/232781/">https://lwn.net/Articles/232781/</a></p>
<p>But then, a more thorough test could use scapy or some other tool to actually craft a corret packet.</p>
<p>For IPv6 code, the relevant part might be here, but I have a very limited understanding of the kernel code:
<a href="https://github.com/torvalds/linux/blob/8efd0d9c316af470377894a6a0f9ff63ce18c177/net/ipv6/exthdrs.c#L687-690">https://github.com/torvalds/linux/blob/8efd0d9c316af470377894a6a0f9ff63ce18c177/net/ipv6/exthdrs.c#L687-690</a></p>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 21, 2022</span>
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../../linux/setting-journalctl-limits/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Setting journalctl limits
            </div>
          </div>
        </a>
      
      
        <a href="../arp_and_the_neighbor_table/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              ARP and the Neighbor table
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1c7c35e.min.js"></script>
      
    
  </body>
</html>