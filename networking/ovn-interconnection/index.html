
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Andreas Karis' blog about anything Kubernetes, OpenShift, Linux and Networking">
      
      
      
        <link rel="canonical" href="https://andreaskaris.github.io/blog/networking/ovn-interconnection/">
      
      
        <link rel="prev" href="../juniper_x520/">
      
      
        <link rel="next" href="../haproxy-and-h2c/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>Hands-on with OVN Interconnection - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="RSS feed of created content" href="https://andreaskaris.github.io/blog/feed_rss_created.xml">
  <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="https://andreaskaris.github.io/blog/feed_rss_updated.xml">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hands-on with OVN Interconnection
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../ceph/" class="md-tabs__link">
        Ceph
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../linux/" class="md-tabs__link">
        Linux
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        Networking
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../openshift/" class="md-tabs__link">
        OpenShift and Kubernetes
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../openstack/" class="md-tabs__link">
        OpenStack
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../coding/" class="md-tabs__link">
        Coding
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  
    
    <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ceph/">Ceph</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Ceph
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ceph/ceph-manual-test/" class="md-nav__link">
        Ceph manual test with qemu
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../linux/">Linux</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        cgroups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        Containers in Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/hugepages/" class="md-nav__link">
        Hugepages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/ipxe-boot-environment/" class="md-nav__link">
        iPXE boot environment on Fedora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/java-idrac-issues/" class="md-nav__link">
        Java Idrac Issues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/meson/" class="md-nav__link">
        meson
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        namespaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/old_java_version_with_xorgs_in_container/" class="md-nav__link">
        Old Java inside a container with xorgs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/org-gnome-shell-overrides/" class="md-nav__link">
        Workaround for org.gnome.shell.overrides not installed
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/get-process-cgroup-info-and-limits/" class="md-nav__link">
        Retrieving process cgroup resource usage and limit info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/libvirt-uefi-without-secureboot/" class="md-nav__link">
        RHEL Booting a virtual machine with UEFI but without secure boot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/setting-journalctl-limits/" class="md-nav__link">
        Setting journalctl limits
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups_cpu_quota/" class="md-nav__link">
        Using cgroups for CFS bandwidth control
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Networking</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../accept-source-routing/" class="md-nav__link">
        Accept Source Routing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../arp_and_the_neighbor_table/" class="md-nav__link">
        ARP and the Neighbor table
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bpf-and-tcpdump/" class="md-nav__link">
        BPF and tcpdump
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bonding_in_linux/" class="md-nav__link">
        Bonding in Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../juniper_x520/" class="md-nav__link">
        Configure Juniper switch
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Hands-on with OVN Interconnection
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../haproxy-and-h2c/" class="md-nav__link">
        haproxy and HTTP/2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install-openvswitch-on-rocky/" class="md-nav__link">
        Install Open vSwitch on Rocky Linux 8
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../geneve_tunneling/" class="md-nav__link">
        Geneve tunneling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../netlink/" class="md-nav__link">
        Netlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ovn_standalone_on_fedora/" class="md-nav__link">
        OVN standalone on Fedora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ovs_recirculation/" class="md-nav__link">
        OVS packet recirculation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ovs-vxlan-tunnels-and-dscp/" class="md-nav__link">
        OVS VXLAN tunnels and DSCP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ovs_with_gdb/" class="md-nav__link">
        OVS with GDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../packet-tracing-with-ovn/" class="md-nav__link">
        Packet tracing with OVN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sctp/" class="md-nav__link">
        SCTP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../useful-commands/" class="md-nav__link">
        Useful commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wireguard/" class="md-nav__link">
        Wireguard
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../openshift/">OpenShift and Kubernetes</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          OpenShift and Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/alertmanager/" class="md-nav__link">
        AlertManager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/analyzing-cni/" class="md-nav__link">
        Analyzing CNI calls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ocp-custom-release-image/" class="md-nav__link">
        Building custom release images for OpenShift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/cpu-manager-with-custom-machine-config-pool/" class="md-nav__link">
        CPU manager with custom MachineConfigPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/crio-conmon-runc/" class="md-nav__link">
        Crio vs conmon vs runc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/dedicated-service-monitors/" class="md-nav__link">
        DedicatedServiceMonitors in OpenShift Monitoring
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/etcd_perf/" class="md-nav__link">
        Etcd Performance tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/get-vs-list-api-calls/" class="md-nav__link">
        Get vs List API Calls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_httpbin_tshark_sidecar/" class="md-nav__link">
        Httpbin tshark sidecar container
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kubernetes_cluster/" class="md-nav__link">
        Hints for installing kubernetes on Fedora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/HPA/" class="md-nav__link">
        Horizontal Pod Autoscaler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/how_rhcos_updates_work/" class="md-nav__link">
        How RHCOS updates work
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kubelet-filesystems/" class="md-nav__link">
        How kubelet monitors filesystems
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ocp4-infra-nodes-with-machineset-without-worker-label/" class="md-nav__link">
        Infra nodes with MachineSets without worker label
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ingresscontroller_router_sharding_ocp_on_osp/" class="md-nav__link">
        Ingress Controller Sharding OCP on OSP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ingress-controller-sharding-on-separate-vip/" class="md-nav__link">
        Ingress Controller Sharding on separate VIP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_mirror_registry/" class="md-nav__link">
        Installing a cluster with a mirror registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/istio-1.6-on-ocp.4.x/" class="md-nav__link">
        Istio 1.6 on OpenShift 4.x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kata/" class="md-nav__link">
        kata containers and the kata operatora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ovn-kind-hybrid-overlay/" class="md-nav__link">
        Kind with OVN Kubernetes Hybrid Overlay
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kind-with-private-registry/" class="md-nav__link">
        Kind with private registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/list_docker_registry_containers/" class="md-nav__link">
        List container images in registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/mounting-container-image/" class="md-nav__link">
        Mount a container image
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/install_openshift_on_openstack/" class="md-nav__link">
        OpenShift on OpenStack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/patch-service-loadbalancer-ingress-ip/" class="md-nav__link">
        Patch status.loadBalancer.ingress IP manually
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/private-registry/" class="md-nav__link">
        Private container registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/proxy-ocp-4.5/" class="md-nav__link">
        Proxy OCP 4.5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/rpm-ostree-failed-to-find-image/" class="md-nav__link">
        rpm-ostreed failed to find image
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/seccomp-defaults-ocp/" class="md-nav__link">
        Seccomp defaults in Red Hat OpenShift Container Platform
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/scc/" class="md-nav__link">
        Security Context Constraints (SCC)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift-scc-with-mutating-webhooks/" class="md-nav__link">
        SCCs and mutating webhooks - a lesson learned
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/fix-selinux-labels-coreos/" class="md-nav__link">
        SElinux labels fix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sctp/" class="md-nav__link">
        SCTP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_troubleshooting_etcd_state/" class="md-nav__link">
        Troubleshooting etcd state
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/useful-ocp-commands/" class="md-nav__link">
        Useful commands for OpenShift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/useful-ocp-sdn-commands/" class="md-nav__link">
        Useful commands for OpenShift SDN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/troubleshooting_openshift_on_openstack_worker_creation/" class="md-nav__link">
        Troubleshooting OpenShift on OpenStack worker creation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../openstack/">OpenStack</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          OpenStack
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/reattach_to_running_deployment/" class="md-nav__link">
        Reattach to running deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/using_clouds_yaml/" class="md-nav__link">
        Using clouds.yaml
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../coding/">Coding</a>
          
            <label for="__nav_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Coding
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/operator-sdk-reconciliation/" class="md-nav__link">
        Controller Reconciliation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/vimrc/" class="md-nav__link">
        My vimrc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/golang-ip-conversion/" class="md-nav__link">
        Golang IP address conversion
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
        </div>
      </div>
    </div>
  
  
    
    <!--
    <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
</nav>
        </div>
      </div>
    </div>
    -->
  

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="hands-on-with-ovn-interconnection-ovn-ic">Hands-on with OVN Interconnection (OVN IC)</h1>
<p><a href="https://docs.ovn.org/en/latest/tutorials/ovn-interconnection.html">OVN Interconnection</a> (OVN IC) allows administrators to interconnect multiple independent OVN deployments via so-called transit switches. In this blog post, let's have a look at how we can configure 2 standalone OVN deployments and use OVN IC to route traffic between these environments.</p>
<h2 id="introduction-to-the-test-environment">Introduction to the test environment</h2>
<p>We will use a setup consisting of 3 machines, named ovn1 (192.168.122.26), ovn2 (192.168.122.177) and ovn3 (192.168.122.54). Each machine’s primary interface is called <code class="highlight">if0</code>, and OVN geneve tunnels are established via these interfaces. The machines run Red Hat Enterprise Linux 9.2.</p>
<p><img alt="ovn-interconnection01" src="https://github.com/andreaskaris/blog/assets/3291433/29a9df6e-3edc-45cd-86fd-c5725ba52865" /></p>
<p>All machines can reach each other via their hostname, by a mapping in <code class="highlight">/etc/hosts</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code># cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.122.26 ovn1
192.168.122.177 ovn2
192.168.122.54 ovn3
</code></pre></div></td></tr></table></div>
<h2 id="setting-up-ovn-control-plane-components">Setting up OVN control plane components</h2>
<p>We are first going to configure the control plane components. In order to do so, we will configure 2 OVN interconnection availability zones. The first zone consists of ovn1 and ovn2, where ovn1 hosts the OVN control plane and both ovn1 and ovn2 run ovn-controller. The second zone consists of ovn3 which runs a second OVN control plane and ovn-controller.</p>
<p><img alt="ovn-interconnection02" src="https://github.com/andreaskaris/blog/assets/3291433/1d732562-4845-4b7c-bb17-ea6beda92116" /></p>
<h3 id="setting-up-ovn-common-setup">Setting up OVN common setup</h3>
<p>On all machines, we enable the OpenShift 4.13 and Fast Data Path repositories which allow us to pull recent versions of Open vSwitch and OVN:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>subscription-manager repos –enable=rhocp-4.13-for-rhel-9-x86_64-rpms
subscription-manager repos --enable=fast-datapath-for-rhel-9-x86_64-rpms
</code></pre></div></td></tr></table></div>
<p>And we install Open vSwitch and OVN:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>yum install openvswitch3.1 -y
yum install ovn23.09 ovn23.09-central ovn23.09-host -y
</code></pre></div></td></tr></table></div>
<p>We enable Open vSwitch and ovn-controller on all hosts and start them right away:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>systemctl enable --now openvswitch
systemctl enable --now ovn-controller
</code></pre></div></td></tr></table></div>
<h3 id="setting-up-ovn-hosts-for-standalone-availability-zone-0">Setting up OVN hosts for standalone availability zone 0</h3>
<p>On ovn1, we enable the OVN control plane with:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="nx">EOF</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">sysconfig</span><span class="o">/</span><span class="nx">ovn</span>
<span class="nx">OVN_NORTHD_OPTS</span><span class="p">=</span><span class="s">&quot;--db-nb-addr=$(hostname) --db-nb-create-insecure-remote=yes --db-sb-addr=$(hostname)  --db-sb-create-insecure-remote=yes  --db-nb-cluster-local-addr=$(hostname) --db-sb-cluster-local-addr=$(hostname) --ovn-northd-nb-db=tcp:$(hostname):6641 --ovn-northd-sb-db=tcp:$(hostname):6642&quot;</span>
<span class="nx">EOF</span>
<span class="nx">systemctl</span><span class="w"> </span><span class="nx">enable</span><span class="w"> </span><span class="o">--</span><span class="nx">now</span><span class="w"> </span><span class="nx">ovn</span><span class="o">-</span><span class="nx">northd</span>
</code></pre></div></td></tr></table></div>
<p>On both ovn1 and ovn2, we instruct OVS and ovn-controller to connect to the OVN control plane with:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">OVN_REMOTE</span><span class="p">=</span><span class="nx">ovn1</span>
<span class="nx">ENCAP_IP</span><span class="p">=</span><span class="err">$</span><span class="p">(</span><span class="nx">ip</span><span class="w"> </span><span class="o">--</span><span class="nx">json</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">ls</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">if0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">jq</span><span class="w"> </span><span class="o">-</span><span class="nx">r</span><span class="w"> </span><span class="err">&#39;</span><span class="p">.[</span><span class="mi">0</span><span class="p">].</span><span class="nx">addr_info</span><span class="p">[]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">select</span><span class="p">(.</span><span class="nx">family</span><span class="o">==</span><span class="s">&quot;inet&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">.</span><span class="nx">local</span><span class="err">&#39;</span><span class="p">)</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="kd">external</span><span class="o">-</span><span class="nx">ids</span><span class="p">:</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">remote</span><span class="p">=</span><span class="nx">tcp</span><span class="p">:</span><span class="err">$</span><span class="p">{</span><span class="nx">OVN_REMOTE</span><span class="p">}:</span><span class="mi">6642</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="kd">external</span><span class="o">-</span><span class="nx">ids</span><span class="p">:</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">encap</span><span class="o">-</span><span class="nx">ip</span><span class="p">=</span><span class="err">$</span><span class="p">{</span><span class="nx">ENCAP_IP</span><span class="p">}</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="kd">external</span><span class="o">-</span><span class="nx">ids</span><span class="p">:</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">encap</span><span class="o">-</span><span class="k">type</span><span class="p">=</span><span class="nx">geneve</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="kd">external</span><span class="o">-</span><span class="nx">ids</span><span class="p">:</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">bridge</span><span class="p">=</span><span class="nx">br</span><span class="o">-</span><span class="nx">int</span>
</code></pre></div></td></tr></table></div>
<p>At this point in time, we should see the 2 chassis in OVN’s SBDB on ovn1:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@ovn1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ovn</span><span class="o">-</span><span class="n">nbctl</span><span class="w"> </span><span class="n">show</span>
<span class="o">[</span><span class="n">root@ovn1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ovn</span><span class="o">-</span><span class="n">sbctl</span><span class="w"> </span><span class="n">show</span>
<span class="n">Chassis</span><span class="w"> </span><span class="ss">&quot;ed34fbb9-e3e6-4ee7-92a2-3bdebb50cc79&quot;</span>
<span class="w">    </span><span class="nl">hostname</span><span class="p">:</span><span class="w"> </span><span class="n">ovn2</span>
<span class="w">    </span><span class="n">Encap</span><span class="w"> </span><span class="n">geneve</span>
<span class="w">        </span><span class="nl">ip</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.122.177&quot;</span>
<span class="w">        </span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">csum</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
<span class="n">Chassis</span><span class="w"> </span><span class="ss">&quot;0672211f-aaec-42dc-bfa0-06ab3df285de&quot;</span>
<span class="w">    </span><span class="nl">hostname</span><span class="p">:</span><span class="w"> </span><span class="n">ovn1</span>
<span class="w">    </span><span class="n">Encap</span><span class="w"> </span><span class="n">geneve</span>
<span class="w">        </span><span class="nl">ip</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.122.26&quot;</span>
<span class="w">        </span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">csum</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="setting-up-ovn-hosts-for-standalone-availability-zone-1">Setting up OVN hosts for standalone availability zone 1</h3>
<p>On ovn3, we enable the OVN control plane with:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="nx">EOF</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">sysconfig</span><span class="o">/</span><span class="nx">ovn</span>
<span class="nx">OVN_NORTHD_OPTS</span><span class="p">=</span><span class="s">&quot;--db-nb-addr=$(hostname) --db-nb-create-insecure-remote=yes --db-sb-addr=$(hostname)  --db-sb-create-insecure-remote=yes  --db-nb-cluster-local-addr=$(hostname) --db-sb-cluster-local-addr=$(hostname) --ovn-northd-nb-db=tcp:$(hostname):6641 --ovn-northd-sb-db=tcp:$(hostname):6642&quot;</span>
<span class="nx">EOF</span>
<span class="nx">systemctl</span><span class="w"> </span><span class="nx">enable</span><span class="w"> </span><span class="o">--</span><span class="nx">now</span><span class="w"> </span><span class="nx">ovn</span><span class="o">-</span><span class="nx">northd</span>
</code></pre></div></td></tr></table></div>
<p>On ovn3, we instruct OVS and ovn-controller to connect to the OVN control plane with:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">OVN_REMOTE</span><span class="p">=</span><span class="nx">ovn3</span>
<span class="nx">ENCAP_IP</span><span class="p">=</span><span class="err">$</span><span class="p">(</span><span class="nx">ip</span><span class="w"> </span><span class="o">--</span><span class="nx">json</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">ls</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">if0</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">jq</span><span class="w"> </span><span class="o">-</span><span class="nx">r</span><span class="w"> </span><span class="err">&#39;</span><span class="p">.[</span><span class="mi">0</span><span class="p">].</span><span class="nx">addr_info</span><span class="p">[]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">select</span><span class="p">(.</span><span class="nx">family</span><span class="o">==</span><span class="s">&quot;inet&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">.</span><span class="nx">local</span><span class="err">&#39;</span><span class="p">)</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="kd">external</span><span class="o">-</span><span class="nx">ids</span><span class="p">:</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">remote</span><span class="p">=</span><span class="nx">tcp</span><span class="p">:</span><span class="err">$</span><span class="p">{</span><span class="nx">OVN_REMOTE</span><span class="p">}:</span><span class="mi">6642</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="kd">external</span><span class="o">-</span><span class="nx">ids</span><span class="p">:</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">encap</span><span class="o">-</span><span class="nx">ip</span><span class="p">=</span><span class="err">$</span><span class="p">{</span><span class="nx">ENCAP_IP</span><span class="p">}</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="kd">external</span><span class="o">-</span><span class="nx">ids</span><span class="p">:</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">encap</span><span class="o">-</span><span class="k">type</span><span class="p">=</span><span class="nx">geneve</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">open</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="kd">external</span><span class="o">-</span><span class="nx">ids</span><span class="p">:</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">bridge</span><span class="p">=</span><span class="nx">br</span><span class="o">-</span><span class="nx">int</span>
</code></pre></div></td></tr></table></div>
<p>At this point in time, we should see the ovn3 chassis in OVN’s SBDB on ovn3:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@ovn3 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ovn</span><span class="o">-</span><span class="n">nbctl</span><span class="w"> </span><span class="n">show</span>
<span class="o">[</span><span class="n">root@ovn3 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ovn</span><span class="o">-</span><span class="n">sbctl</span><span class="w"> </span><span class="n">show</span>
<span class="n">Chassis</span><span class="w"> </span><span class="ss">&quot;5f72f95b-80a3-4a77-8aab-58875dfd2a67&quot;</span>
<span class="w">    </span><span class="nl">hostname</span><span class="p">:</span><span class="w"> </span><span class="n">ovn3</span>
<span class="w">    </span><span class="n">Encap</span><span class="w"> </span><span class="n">geneve</span>
<span class="w">        </span><span class="nl">ip</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.122.54&quot;</span>
<span class="w">        </span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">csum</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="setting-up-ovn-hosts-for-ovn-ic">Setting up OVN hosts for OVN IC</h3>
<blockquote>
<p><strong>Note:</strong> We could also set up OVN IC after fully configuring all OVN elements such as hosts, switches and routers in both az0 and az1. However, to make things clearer, we already set up all required OVN IC control plane elements during the setup phase.</p>
</blockquote>
<p>In order to connect the 2 independent availability zones 0 and 1, we must now add OVN Interconnection to both OVN control plane nodes, thus ovn1 and ovn3. ovn1 will host the OVN IC database and both ovn1’s and ovn3’s OVN IC daemon will connect to this database.</p>
<p><img alt="ovn-interconnection03" src="https://github.com/andreaskaris/blog/assets/3291433/28f5a64c-b40d-4ab2-823a-82579bccc465" /></p>
<p>Only on ovn1, enable and run the standalone OVN IC database daemon which will start the IC NBDB and IC SBDB:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="na">cat &lt;&lt;&#39;EOF&#39; &gt; /etc/systemd/system/ovn-ic-ovsdb-standalone.service</span>
<span class="na">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">OVN IC database daemon</span>
<span class="na">After</span><span class="o">=</span><span class="s">syslog.target</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">oneshot</span>
<span class="na">RemainAfterExit</span><span class="o">=</span><span class="s">yes</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/share/ovn/scripts/ovn-ctl --db-ic-nb-create-insecure-remote=yes </span>\
<span class="w">          </span><span class="s">--db-ic-sb-create-insecure-remote=yes start_ic_ovsdb</span>
<span class="na">ExecStop</span><span class="o">=</span><span class="s">/usr/share/ovn/scripts/ovn-ctl stop_ic_ovsdb</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
<span class="err">EOF</span>
<span class="err">systemctl daemon-reload</span>
<span class="err">systemctl enable --now ovn-ic-ovsdb-standalone</span>
</code></pre></div></td></tr></table></div>
<p>On each independent OVN instance, enable the OVN IC Daemon. On ovn1 and ovn3 run:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="na">GLOBAL_DB</span><span class="o">=</span><span class="s">ovn1</span>
<span class="na">cat &lt;&lt;EOF &gt; /etc/systemd/system/ovn-ic-daemon.service</span>
<span class="na">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">OVN IC management daemon</span>
<span class="na">After</span><span class="o">=</span><span class="s">syslog.target</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">oneshot</span>
<span class="na">RemainAfterExit</span><span class="o">=</span><span class="s">yes</span>
<span class="na">EnvironmentFile</span><span class="o">=</span><span class="s">-/etc/sysconfig/ovn-ic</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/share/ovn/scripts/ovn-ctl start_ic --ovn-ic-nb-db=tcp:${GLOBAL_DB}:6645 --ovn-ic-sb-db=tcp:${GLOBAL_DB}:6646 --ovn-northd-nb-db=tcp:$(hostname):6641 --ovn-northd-sb-db=tcp:$(hostname):6642</span>
<span class="na">ExecStop</span><span class="o">=</span><span class="s">/usr/share/ovn/scripts/ovn-ctl stop_ic</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
<span class="err">EOF</span>
<span class="err">systemctl daemon-reload</span>
<span class="err">systemctl enable --now ovn-ic-daemon</span>
</code></pre></div></td></tr></table></div>
<p>Set the availability zone name for both zones and enable interconnection. On ovn1, run:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>ovn-nbctl set NB_Global . name=az0
ovs-vsctl set open_vswitch . external_ids:ovn-is-interconn=true
</code></pre></div></td></tr></table></div>
<p>On ovn3, run:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>ovn-nbctl set NB_Global . name=az1
ovs-vsctl set open_vswitch . external_ids:ovn-is-interconn=true
</code></pre></div></td></tr></table></div>
<p>Now, make sure that the OVN IC SBDB can find both availability-zones:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">ovn1</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="err">#</span><span class="w">  </span><span class="nx">ovn</span><span class="o">-</span><span class="nx">ic</span><span class="o">-</span><span class="nx">sbctl</span><span class="w"> </span><span class="nx">show</span>
<span class="nx">availability</span><span class="o">-</span><span class="nx">zone</span><span class="w"> </span><span class="nx">az0</span>
<span class="w">    </span><span class="nx">gateway</span><span class="w"> </span><span class="mi">0672211</span><span class="nx">f</span><span class="o">-</span><span class="nx">aaec</span><span class="o">-</span><span class="mi">42</span><span class="nx">dc</span><span class="o">-</span><span class="nx">bfa0</span><span class="o">-</span><span class="mi">06</span><span class="nx">ab3df285de</span>
<span class="w">        </span><span class="nx">hostname</span><span class="p">:</span><span class="w"> </span><span class="nx">ovn1</span>
<span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">geneve</span>
<span class="w">            </span><span class="nx">ip</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">192.168.122.26</span>
<span class="nx">availability</span><span class="o">-</span><span class="nx">zone</span><span class="w"> </span><span class="nx">az1</span>
<span class="w">    </span><span class="nx">gateway</span><span class="w"> </span><span class="mi">5</span><span class="nx">f72f95b</span><span class="o">-</span><span class="mi">80</span><span class="nx">a3</span><span class="o">-</span><span class="mi">4</span><span class="nx">a77</span><span class="o">-</span><span class="mi">8</span><span class="nx">aab</span><span class="o">-</span><span class="mi">58875</span><span class="nx">dfd2a67</span>
<span class="w">        </span><span class="nx">hostname</span><span class="p">:</span><span class="w"> </span><span class="nx">ovn3</span>
<span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">geneve</span>
<span class="w">            </span><span class="nx">ip</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">192.168.122.54</span>
</code></pre></div></td></tr></table></div>
<p>The IC daemon on ovn1 should also have populated the OVN SB chassis table with ovn3’s chassis:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@ovn1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ovn</span><span class="o">-</span><span class="n">sbctl</span><span class="w"> </span><span class="n">show</span>
<span class="n">Chassis</span><span class="w"> </span><span class="ss">&quot;ed34fbb9-e3e6-4ee7-92a2-3bdebb50cc79&quot;</span>
<span class="w">    </span><span class="nl">hostname</span><span class="p">:</span><span class="w"> </span><span class="n">ovn2</span>
<span class="w">    </span><span class="n">Encap</span><span class="w"> </span><span class="n">geneve</span>
<span class="w">        </span><span class="nl">ip</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.122.177&quot;</span>
<span class="w">        </span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">csum</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
<span class="n">Chassis</span><span class="w"> </span><span class="ss">&quot;0672211f-aaec-42dc-bfa0-06ab3df285de&quot;</span>
<span class="w">    </span><span class="nl">hostname</span><span class="p">:</span><span class="w"> </span><span class="n">ovn1</span>
<span class="w">    </span><span class="n">Encap</span><span class="w"> </span><span class="n">geneve</span>
<span class="w">        </span><span class="nl">ip</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.122.26&quot;</span>
<span class="w">        </span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">csum</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
<span class="n">Chassis</span><span class="w"> </span><span class="ss">&quot;5f72f95b-80a3-4a77-8aab-58875dfd2a67&quot;</span>
<span class="w">    </span><span class="nl">hostname</span><span class="p">:</span><span class="w"> </span><span class="n">ovn3</span>
<span class="w">    </span><span class="n">Encap</span><span class="w"> </span><span class="n">geneve</span>
<span class="w">        </span><span class="nl">ip</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.122.54&quot;</span>
<span class="w">        </span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">csum</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
</code></pre></div></td></tr></table></div>
<p>And the same should have happened on ovn3 with ovn1’s chassis:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@ovn3 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ovn</span><span class="o">-</span><span class="n">sbctl</span><span class="w"> </span><span class="n">show</span>
<span class="n">Chassis</span><span class="w"> </span><span class="ss">&quot;5f72f95b-80a3-4a77-8aab-58875dfd2a67&quot;</span>
<span class="w">    </span><span class="nl">hostname</span><span class="p">:</span><span class="w"> </span><span class="n">ovn3</span>
<span class="w">    </span><span class="n">Encap</span><span class="w"> </span><span class="n">geneve</span>
<span class="w">        </span><span class="nl">ip</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.122.54&quot;</span>
<span class="w">        </span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">csum</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
<span class="n">Chassis</span><span class="w"> </span><span class="ss">&quot;0672211f-aaec-42dc-bfa0-06ab3df285de&quot;</span>
<span class="w">    </span><span class="nl">hostname</span><span class="p">:</span><span class="w"> </span><span class="n">ovn1</span>
<span class="w">    </span><span class="n">Encap</span><span class="w"> </span><span class="n">geneve</span>
<span class="w">        </span><span class="nl">ip</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;192.168.122.26&quot;</span>
<span class="w">        </span><span class="nl">options</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">csum</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="err">}</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="configuring-the-dataplane-hosts-and-virtual-networks">Configuring the dataplane - hosts and virtual networks</h2>
<p>In both availability zones, we will simulate virtual hosts and connect them to each other via OVN virtual networks.</p>
<h3 id="configuring-the-dataplane-inside-availability-zone-0">Configuring the dataplane inside availability zone 0</h3>
<p>We will now simulate 2 hosts, each of which resides inside its own subnet on its own machine. The simulated hosts will be able to communicate via OVN router <code class="highlight">r1</code>:</p>
<p><img alt="ovn-interconnection04" src="https://github.com/andreaskaris/blog/assets/3291433/7f700f88-d60b-4d40-a81e-3a694a5325bd" /></p>
<p>On ovn1, configure veth01:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">ns0</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">veth01</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">veth</span><span class="w"> </span><span class="nx">peer</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">port01</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">port01</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth01</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">ns0</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">lo</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth01</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">veth01</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="m m-Double">10.0.0.1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth01</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">via</span><span class="w"> </span><span class="m m-Double">10.0.0.254</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">add</span><span class="o">-</span><span class="nx">port</span><span class="w"> </span><span class="nx">br</span><span class="o">-</span><span class="nx">int</span><span class="w"> </span><span class="nx">port01</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">Interface</span><span class="w"> </span><span class="nx">port01</span><span class="w"> </span><span class="nx">external_ids</span><span class="p">:</span><span class="nx">iface</span><span class="o">-</span><span class="nx">id</span><span class="p">=</span><span class="nx">port01</span>
</code></pre></div></td></tr></table></div>
<p>On ovn2, configure veth02:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">ns0</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">veth02</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">veth</span><span class="w"> </span><span class="nx">peer</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">port02</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">port02</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth02</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">ns0</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">lo</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth02</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">veth02</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">02</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="m m-Double">10.0.1.1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth02</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">via</span><span class="w"> </span><span class="m m-Double">10.0.1.254</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">add</span><span class="o">-</span><span class="nx">port</span><span class="w"> </span><span class="nx">br</span><span class="o">-</span><span class="nx">int</span><span class="w"> </span><span class="nx">port02</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">Interface</span><span class="w"> </span><span class="nx">port02</span><span class="w"> </span><span class="nx">external_ids</span><span class="p">:</span><span class="nx">iface</span><span class="o">-</span><span class="nx">id</span><span class="p">=</span><span class="nx">port02</span>
</code></pre></div></td></tr></table></div>
<p>On ovn1, create the virtual switch and router required to establish connectivity between both interfaces:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">ls</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s0</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s0</span><span class="w"> </span><span class="nx">port01</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">port01</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>

<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">ls</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s1</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s1</span><span class="w"> </span><span class="nx">port02</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">port02</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mi">02</span>

<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lr</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r1</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r1</span><span class="w"> </span><span class="nx">r1s0</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="nx">ff</span><span class="w"> </span><span class="m m-Double">10.0.0.254</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s0</span><span class="w"> </span><span class="nx">s0r1</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">s0r1</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="nx">ff</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">options</span><span class="w"> </span><span class="nx">s0r1</span><span class="w"> </span><span class="nx">router</span><span class="o">-</span><span class="nx">port</span><span class="p">=</span><span class="nx">r1s0</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="nx">s0r1</span><span class="w"> </span><span class="nx">router</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r1</span><span class="w"> </span><span class="nx">r1s1</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="nx">ff</span><span class="w"> </span><span class="m m-Double">10.0.1.254</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s1</span><span class="w"> </span><span class="nx">s1r1</span><span class="w"> </span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">s1r1</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="nx">ff</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">options</span><span class="w"> </span><span class="nx">s1r1</span><span class="w"> </span><span class="nx">router</span><span class="o">-</span><span class="nx">port</span><span class="p">=</span><span class="nx">r1s1</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="nx">s1r1</span><span class="w"> </span><span class="nx">router</span>
</code></pre></div></td></tr></table></div>
<p>Verify that 10.0.0.1 inside ns0 on ovn1 can reach 10.0.1.1 inside ns0 on ovn2, via router r1 (10.0.0.254):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@ovn1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">netns</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="n">ns0</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="o">-</span><span class="n">c1</span><span class="w"> </span><span class="o">-</span><span class="n">W1</span><span class="w"> </span><span class="mf">10.0.0.254</span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.0.254</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.0.254</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.0.254</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">254</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">0.370</span><span class="w"> </span><span class="n">ms</span>

<span class="o">---</span><span class="w"> </span><span class="mf">10.0.0.254</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.370</span><span class="o">/</span><span class="mf">0.370</span><span class="o">/</span><span class="mf">0.370</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span>
<span class="o">[</span><span class="n">root@ovn1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">netns</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="n">ns0</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="o">-</span><span class="n">c1</span><span class="w"> </span><span class="o">-</span><span class="n">W1</span><span class="w"> </span><span class="mf">10.0.1.1</span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.1.1</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.1.1</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.1.1</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">63</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">2.30</span><span class="w"> </span><span class="n">ms</span>

<span class="o">---</span><span class="w"> </span><span class="mf">10.0.1.1</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.299</span><span class="o">/</span><span class="mf">2.299</span><span class="o">/</span><span class="mf">2.299</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span>
<span class="o">[</span><span class="n">root@ovn1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">netns</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="n">ns0</span><span class="w"> </span><span class="n">traceroute</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="mf">10.0.1.1</span>
<span class="n">traceroute</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mf">10.0.1.1</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.1.1</span><span class="p">),</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">hops</span><span class="w"> </span><span class="nf">max</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">packets</span>
<span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="mf">10.0.0.254</span><span class="w">  </span><span class="mf">1.743</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">1.784</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">1.827</span><span class="w"> </span><span class="n">ms</span>
<span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="mf">10.0.1.1</span><span class="w">  </span><span class="mf">4.080</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">4.091</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">4.091</span><span class="w"> </span><span class="n">ms</span>
</code></pre></div></td></tr></table></div>
<h3 id="configuring-the-dataplane-inside-availability-zone-1">Configuring the dataplane inside availability zone 1</h3>
<p>We will now simulate 2 hosts, each of which resides inside its own subnet and namespace on ovn3. The simulated hosts will be able to communicate via OVN router <code class="highlight">r2</code>:</p>
<p><img alt="ovn-interconnection05" src="https://github.com/andreaskaris/blog/assets/3291433/65c91806-c881-4588-af0b-0eb32d5921af" /></p>
<p>On ovn3, configure veth03 inside ns0:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">veth03</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">veth</span><span class="w"> </span><span class="nx">peer</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">port03</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">ns0</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth03</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">ns0</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">lo</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth03</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">veth03</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">03</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="m m-Double">10.0.2.1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth03</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns0</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">via</span><span class="w"> </span><span class="m m-Double">10.0.2.254</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">port03</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">add</span><span class="o">-</span><span class="nx">port</span><span class="w"> </span><span class="nx">br</span><span class="o">-</span><span class="nx">int</span><span class="w"> </span><span class="nx">port03</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">Interface</span><span class="w"> </span><span class="nx">port03</span><span class="w"> </span><span class="nx">external_ids</span><span class="p">:</span><span class="nx">iface</span><span class="o">-</span><span class="nx">id</span><span class="p">=</span><span class="nx">port03</span>
</code></pre></div></td></tr></table></div>
<p>On ovn3, configure veth04 inside ns1:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">veth04</span><span class="w"> </span><span class="k">type</span><span class="w"> </span><span class="nx">veth</span><span class="w"> </span><span class="nx">peer</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">port04</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">ns1</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth04</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">ns1</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns1</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">lo</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns1</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth04</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns1</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">veth04</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">04</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns1</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="m m-Double">10.0.3.1</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">veth04</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">netns</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">ns1</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">via</span><span class="w"> </span><span class="m m-Double">10.0.3.254</span>
<span class="nx">ip</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">port04</span><span class="w"> </span><span class="nx">up</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">add</span><span class="o">-</span><span class="nx">port</span><span class="w"> </span><span class="nx">br</span><span class="o">-</span><span class="nx">int</span><span class="w"> </span><span class="nx">port04</span>
<span class="nx">ovs</span><span class="o">-</span><span class="nx">vsctl</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">Interface</span><span class="w"> </span><span class="nx">port04</span><span class="w"> </span><span class="nx">external_ids</span><span class="p">:</span><span class="nx">iface</span><span class="o">-</span><span class="nx">id</span><span class="p">=</span><span class="nx">port04</span>
</code></pre></div></td></tr></table></div>
<p>On ovn3, create the virtual switches and router required to establish connectivity between both interfaces:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">ls</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s3</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s3</span><span class="w"> </span><span class="nx">port03</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">port03</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">03</span>

<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">ls</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s4</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s4</span><span class="w"> </span><span class="nx">port04</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">port04</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">04</span>

<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lr</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r2</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="nx">r2s3</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="nx">ff</span><span class="w"> </span><span class="m m-Double">10.0.2.254</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s3</span><span class="w"> </span><span class="nx">s3r2</span><span class="w"> </span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">s3r2</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="nx">ff</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">options</span><span class="w"> </span><span class="nx">s3r2</span><span class="w"> </span><span class="nx">router</span><span class="o">-</span><span class="nx">port</span><span class="p">=</span><span class="nx">r2s3</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="nx">s3r2</span><span class="w"> </span><span class="nx">router</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="nx">r2s4</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="nx">ff</span><span class="w"> </span><span class="m m-Double">10.0.3.254</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">s4</span><span class="w"> </span><span class="nx">s4r2</span><span class="w"> </span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">s4r2</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="nx">ff</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">options</span><span class="w"> </span><span class="nx">s4r2</span><span class="w"> </span><span class="nx">router</span><span class="o">-</span><span class="nx">port</span><span class="p">=</span><span class="nx">r2s4</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="nx">s4r2</span><span class="w"> </span><span class="nx">router</span>
</code></pre></div></td></tr></table></div>
<p>Verify that 10.0.2.1 inside ns0 on ovn3 can reach 10.0.3.1 inside ns1 on ovn3, via router r2 (10.0.2.254):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@ovn3 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">netns</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="n">ns0</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="o">-</span><span class="n">c1</span><span class="w"> </span><span class="o">-</span><span class="n">W1</span><span class="w"> </span><span class="mf">10.0.2.254</span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.2.254</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.2.254</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.2.254</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">254</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">36.4</span><span class="w"> </span><span class="n">ms</span>

<span class="o">---</span><span class="w"> </span><span class="mf">10.0.2.254</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">36.396</span><span class="o">/</span><span class="mf">36.396</span><span class="o">/</span><span class="mf">36.396</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span>
<span class="o">[</span><span class="n">root@ovn3 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">netns</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="n">ns0</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="o">-</span><span class="n">c1</span><span class="w"> </span><span class="o">-</span><span class="n">W1</span><span class="w"> </span><span class="mf">10.0.3.1</span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.3.1</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.3.1</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.3.1</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">63</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">10.7</span><span class="w"> </span><span class="n">ms</span>

<span class="o">---</span><span class="w"> </span><span class="mf">10.0.3.1</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.715</span><span class="o">/</span><span class="mf">10.715</span><span class="o">/</span><span class="mf">10.715</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span>
<span class="o">[</span><span class="n">root@ovn3 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">netns</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="n">ns0</span><span class="w"> </span><span class="n">traceroute</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="mf">10.0.3.1</span>
<span class="n">traceroute</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mf">10.0.3.1</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.3.1</span><span class="p">),</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">hops</span><span class="w"> </span><span class="nf">max</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">packets</span>
<span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="mf">10.0.2.254</span><span class="w">  </span><span class="mf">2.416</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">2.687</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">2.924</span><span class="w"> </span><span class="n">ms</span>
<span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="mf">10.0.3.1</span><span class="w">  </span><span class="mf">2.132</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">2.156</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">2.164</span><span class="w"> </span><span class="n">ms</span>
</code></pre></div></td></tr></table></div>
<h3 id="configuring-the-dataplane-with-ovn-interconnection">Configuring the dataplane with OVN Interconnection</h3>
<p>We will now interconnect the 2 availability zones’ dataplanes with OVN Interconnection.</p>
<p><img alt="ovn-interconnection06" src="https://github.com/andreaskaris/blog/assets/3291433/dbbd32ce-9f65-4dc4-b343-fe7f647e1d1d" /></p>
<p>On ovn1, create a transit switch inside the Interconnection database:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>ovn-ic-nbctl ts-add ts1
</code></pre></div></td></tr></table></div>
<p>OVN IC will automatically create the transit switch inside all OVN NBDBs, e.g. inside the NBDB of ovn3:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">ovn3</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="c1"># ovn-nbctl find logical_switch other_config:interconn-ts=ts1</span>
<span class="n">_uuid</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="n">e6c545b4</span><span class="o">-</span><span class="mi">28</span><span class="n">f3</span><span class="o">-</span><span class="mi">4</span><span class="n">f10</span><span class="o">-</span><span class="n">b1ac</span><span class="o">-</span><span class="n">cb4cab39db04</span>
<span class="n">acls</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">copp</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">dns_records</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">external_ids</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="n">forwarding_groups</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">load_balancer</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">load_balancer_group</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">name</span><span class="w">                </span><span class="p">:</span><span class="w"> </span><span class="n">ts1</span>
<span class="n">other_config</span><span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">interconn</span><span class="o">-</span><span class="n">ts</span><span class="o">=</span><span class="n">ts1</span><span class="p">,</span><span class="w"> </span><span class="n">requested</span><span class="o">-</span><span class="n">tnl</span><span class="o">-</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;16711682&quot;</span><span class="p">}</span>
<span class="n">ports</span><span class="w">               </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">qos_rules</span><span class="w">           </span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
</code></pre></div></td></tr></table></div>
<p>Connect <code class="highlight">r1</code> inside availability zone 0 to transit switch <code class="highlight">ts1</code>. Run the following commands on ovn1:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r1</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">r1</span><span class="o">-</span><span class="nx">ts1</span><span class="w"> </span><span class="nx">aa</span><span class="p">:</span><span class="nx">aa</span><span class="p">:</span><span class="nx">aa</span><span class="p">:</span><span class="nx">aa</span><span class="p">:</span><span class="nx">aa</span><span class="p">:</span><span class="mi">01</span><span class="w"> </span><span class="m m-Double">169.254.100.1</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">ts1</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">ts1</span><span class="o">-</span><span class="nx">r1</span><span class="w"> </span><span class="o">--</span><span class="w"> </span>\
<span class="w">        </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">ts1</span><span class="o">-</span><span class="nx">r1</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">--</span><span class="w"> </span>\
<span class="w">        </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">ts1</span><span class="o">-</span><span class="nx">r1</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">--</span><span class="w"> </span>\
<span class="w">        </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">options</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">ts1</span><span class="o">-</span><span class="nx">r1</span><span class="w"> </span><span class="nx">router</span><span class="o">-</span><span class="nx">port</span><span class="p">=</span><span class="nx">lrp</span><span class="o">-</span><span class="nx">r1</span><span class="o">-</span><span class="nx">ts1</span>
<span class="nx">chassis</span><span class="p">=</span><span class="err">$</span><span class="p">(</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">sbctl</span><span class="w"> </span><span class="nx">find</span><span class="w"> </span><span class="nx">chassis</span><span class="w"> </span><span class="nx">hostname</span><span class="p">=</span><span class="nx">ovn1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">awk</span><span class="w"> </span><span class="err">&#39;</span><span class="o">/^</span><span class="nx">name</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="nx">print</span><span class="w"> </span><span class="err">$</span><span class="nx">NF</span><span class="p">}</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">sed</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">s</span><span class="o">/</span><span class="err">&quot;</span><span class="c1">//g&#39;)</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">gateway</span><span class="o">-</span><span class="nx">chassis</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">r1</span><span class="o">-</span><span class="nx">ts1</span><span class="w"> </span><span class="err">$</span><span class="p">{</span><span class="nx">chassis</span><span class="p">}</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lr</span><span class="o">-</span><span class="nx">route</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r1</span><span class="w"> </span><span class="m m-Double">10.0.2.0</span><span class="o">/</span><span class="mi">23</span><span class="w"> </span><span class="m m-Double">169.254.100.2</span>
</code></pre></div></td></tr></table></div>
<p>Connect <code class="highlight">r2</code> inside availability zone 1 to transit switch <code class="highlight">ts1</code>. Run the following commands on ovn3:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">r2</span><span class="o">-</span><span class="nx">ts1</span><span class="w"> </span><span class="nx">aa</span><span class="p">:</span><span class="nx">aa</span><span class="p">:</span><span class="nx">aa</span><span class="p">:</span><span class="nx">aa</span><span class="p">:</span><span class="nx">aa</span><span class="p">:</span><span class="mi">02</span><span class="w"> </span><span class="m m-Double">169.254.100.2</span><span class="o">/</span><span class="mi">24</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">ts1</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">ts1</span><span class="o">-</span><span class="nx">r2</span><span class="w"> </span><span class="o">--</span><span class="w"> </span>\
<span class="w">        </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">addresses</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">ts1</span><span class="o">-</span><span class="nx">r2</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">--</span><span class="w"> </span>\
<span class="w">        </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="k">type</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">ts1</span><span class="o">-</span><span class="nx">r2</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">--</span><span class="w"> </span>\
<span class="w">        </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">options</span><span class="w"> </span><span class="nx">lsp</span><span class="o">-</span><span class="nx">ts1</span><span class="o">-</span><span class="nx">r2</span><span class="w"> </span><span class="nx">router</span><span class="o">-</span><span class="nx">port</span><span class="p">=</span><span class="nx">lrp</span><span class="o">-</span><span class="nx">r2</span><span class="o">-</span><span class="nx">ts1</span>
<span class="nx">chassis</span><span class="p">=</span><span class="err">$</span><span class="p">(</span><span class="nx">ovn</span><span class="o">-</span><span class="nx">sbctl</span><span class="w"> </span><span class="nx">find</span><span class="w"> </span><span class="nx">chassis</span><span class="w"> </span><span class="nx">hostname</span><span class="p">=</span><span class="nx">ovn3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">awk</span><span class="w"> </span><span class="err">&#39;</span><span class="o">/^</span><span class="nx">name</span><span class="o">/</span><span class="w"> </span><span class="p">{</span><span class="nx">print</span><span class="w"> </span><span class="err">$</span><span class="nx">NF</span><span class="p">}</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">sed</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">s</span><span class="o">/</span><span class="err">&quot;</span><span class="c1">//g&#39;)</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">set</span><span class="o">-</span><span class="nx">gateway</span><span class="o">-</span><span class="nx">chassis</span><span class="w"> </span><span class="nx">lrp</span><span class="o">-</span><span class="nx">r2</span><span class="o">-</span><span class="nx">ts1</span><span class="w"> </span><span class="err">$</span><span class="p">{</span><span class="nx">chassis</span><span class="p">}</span>
<span class="nx">ovn</span><span class="o">-</span><span class="nx">nbctl</span><span class="w"> </span><span class="nx">lr</span><span class="o">-</span><span class="nx">route</span><span class="o">-</span><span class="nx">add</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="m m-Double">10.0.0.0</span><span class="o">/</span><span class="mi">23</span><span class="w"> </span><span class="m m-Double">169.254.100.1</span>
</code></pre></div></td></tr></table></div>
<p>Check that host 10.0.0.1 in ns0 on ovn1 can ping host 10.0.3.1 in ns1 on ovn3, via the interconnection dataplane:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@ovn1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">netns</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="n">ns0</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="o">-</span><span class="n">c1</span><span class="w"> </span><span class="o">-</span><span class="n">W1</span><span class="w"> </span><span class="mf">10.0.3.1</span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.3.1</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.3.1</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.3.1</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">0.608</span><span class="w"> </span><span class="n">ms</span>

<span class="o">---</span><span class="w"> </span><span class="mf">10.0.3.1</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.608</span><span class="o">/</span><span class="mf">0.608</span><span class="o">/</span><span class="mf">0.608</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span>
<span class="o">[</span><span class="n">root@ovn1 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">netns</span><span class="w"> </span><span class="k">exec</span><span class="w"> </span><span class="n">ns0</span><span class="w"> </span><span class="n">traceroute</span><span class="w"> </span><span class="o">-</span><span class="n">I</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="mf">10.0.3.1</span>
<span class="n">traceroute</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mf">10.0.3.1</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.3.1</span><span class="p">),</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="n">hops</span><span class="w"> </span><span class="nf">max</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">packets</span>
<span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="mf">10.0.0.254</span><span class="w">  </span><span class="mf">1.991</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">2.036</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">2.084</span><span class="w"> </span><span class="n">ms</span>
<span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="mf">10.0.3.1</span><span class="w">  </span><span class="mf">4.390</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">4.425</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">4.429</span><span class="w"> </span><span class="n">ms</span>
<span class="w"> </span><span class="mi">3</span><span class="w">  </span><span class="mf">10.0.3.1</span><span class="w">  </span><span class="mf">3.227</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">3.222</span><span class="w"> </span><span class="n">ms</span><span class="w">  </span><span class="mf">3.219</span><span class="w"> </span><span class="n">ms</span>
</code></pre></div></td></tr></table></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 11, 2023</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.prune", "navigation.top", "navigation.path", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>