
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Andreas Karis' blog about anything Kubernetes, OpenShift, Linux and Networking">
      
      
      
        <link rel="canonical" href="https://andreaskaris.github.io/blog/networking/packet-tracing-with-ovn/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>Packet tracing with OVN - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#packet-tracing-with-ovn" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Packet tracing with OVN
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../ceph/ceph-manual-test/" class="md-tabs__link">
        Ceph
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../openshift/analyzing-cni/" class="md-tabs__link">
        Containers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../linux/cgroups/" class="md-tabs__link">
        Linux
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../accept-source-routing/" class="md-tabs__link md-tabs__link--active">
        Networking
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../openshift/alertmanager/" class="md-tabs__link">
        OpenShift
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../openstack/reattach_to_running_deployment/" class="md-tabs__link">
        OpenStack
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../coding/operator-sdk-reconciliation/" class="md-tabs__link">
        Coding
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Ceph
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ceph" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Ceph
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ceph/ceph-manual-test/" class="md-nav__link">
        Ceph manual test with qemu
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Containers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Containers" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Containers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/analyzing-cni/" class="md-nav__link">
        Analyzing CNI calls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        cgroups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        Containers in Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/list_docker_registry_containers/" class="md-nav__link">
        List container images in registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        namespaces
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        cgroups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        Containers in Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/hugepages/" class="md-nav__link">
        Hugepages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/ipxe-boot-environment/" class="md-nav__link">
        iPXE boot environment on Fedora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/java-idrac-issues/" class="md-nav__link">
        Java Idrac Issues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/meson/" class="md-nav__link">
        meson
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        namespaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/old_java_version_with_xorgs_in_container/" class="md-nav__link">
        Old Java inside a container with xorgs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/get-process-cgroup-info-and-limits/" class="md-nav__link">
        Retrieving process cgroup resource usage and limit info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/libvirt-uefi-without-secureboot/" class="md-nav__link">
        RHEL Booting a virtual machine with UEFI but without secure boot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/setting-journalctl-limits/" class="md-nav__link">
        Setting journalctl limits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Networking" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../accept-source-routing/" class="md-nav__link">
        Accept Source Routing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../arp_and_the_neighbor_table/" class="md-nav__link">
        ARP and the Neighbor table
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bpf-and-tcpdump/" class="md-nav__link">
        BPF and tcpdump
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bonding_in_linux/" class="md-nav__link">
        Bonding in Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../juniper_x520/" class="md-nav__link">
        Configure Juniper switch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../haproxy-and-h2c/" class="md-nav__link">
        haproxy and HTTP/2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install-openvswitch-on-rocky/" class="md-nav__link">
        Install Open vSwitch on Rocky Linux 8
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../geneve_tunneling/" class="md-nav__link">
        Geneve tunneling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../netlink/" class="md-nav__link">
        Netlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ovn_standalone_on_fedora/" class="md-nav__link">
        OVN standalone on Fedora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ovs_recirculation/" class="md-nav__link">
        OVS packet recirculation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ovs-vxlan-tunnels-and-dscp/" class="md-nav__link">
        OVS VXLAN tunnels and DSCP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ovs_with_gdb/" class="md-nav__link">
        OVS with GDB
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Packet tracing with OVN
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Packet tracing with OVN
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#running-various-ovn-traces-in-an-ovn-kubernetes-environment" class="md-nav__link">
    Running various OVN traces in an ovn-kubernetes environment
  </a>
  
    <nav class="md-nav" aria-label="Running various OVN traces in an ovn-kubernetes environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment" class="md-nav__link">
    Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collection-of-examples" class="md-nav__link">
    Collection of examples
  </a>
  
    <nav class="md-nav" aria-label="Collection of examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulating-new-flows-through-conntrack" class="md-nav__link">
    Simulating new flows through conntrack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specifying-multiple-ct-actions" class="md-nav__link">
    Specifying multiple --ct actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specifying-tcp-flags-in-ovn-trace" class="md-nav__link">
    Specifying TCP flags in ovn-trace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulating-reverse-flows-through-conntrack" class="md-nav__link">
    Simulating reverse flows through conntrack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sources-and-references" class="md-nav__link">
    Sources and references
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sctp/" class="md-nav__link">
        SCTP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../useful-commands/" class="md-nav__link">
        Useful commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wireguard/" class="md-nav__link">
        Wireguard
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          OpenShift
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="OpenShift" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          OpenShift
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/alertmanager/" class="md-nav__link">
        AlertManager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ocp-custom-release-image/" class="md-nav__link">
        Building custom release images for OpenShift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/cpu-manager-with-custom-machine-config-pool/" class="md-nav__link">
        CPU manager with custom MachineConfigPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/crio-conmon-runc/" class="md-nav__link">
        Crio vs conmon vs runc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/etcd_perf/" class="md-nav__link">
        Etcd Performance tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/get-vs-list-api-calls/" class="md-nav__link">
        Get vs List API Calls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_httpbin_tshark_sidecar/" class="md-nav__link">
        Httpbin tshark sidecar container
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kubernetes_cluster/" class="md-nav__link">
        Hints for installing kubernetes on Fedora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/HPA/" class="md-nav__link">
        Horizontal Pod Autoscaler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/how_rhcos_updates_work/" class="md-nav__link">
        How RHCOS updates work
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ocp4-infra-nodes-with-machineset-without-worker-label/" class="md-nav__link">
        Infra nodes with MachineSets without worker label
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ingresscontroller_router_sharding_ocp_on_osp/" class="md-nav__link">
        Ingress Controller Sharding OCP on OSP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ingress-controller-sharding-on-separate-vip/" class="md-nav__link">
        Ingress Controller Sharding on separate VIP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_mirror_registry/" class="md-nav__link">
        Installing a cluster with a mirror registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/istio-1.6-on-ocp.4.x/" class="md-nav__link">
        Istio 1.6 on OpenShift 4.x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kata/" class="md-nav__link">
        kata containers and the kata operatora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ovn-kind-hybrid-overlay/" class="md-nav__link">
        Kind with OVN Kubernetes Hybrid Overlay
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kind-with-private-registry/" class="md-nav__link">
        Kind with private registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/mounting-container-image/" class="md-nav__link">
        Mount a container image
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/install_openshift_on_openstack/" class="md-nav__link">
        OpenShift on OpenStack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/patch-service-loadbalancer-ingress-ip/" class="md-nav__link">
        Patch status.loadBalancer.ingress IP manually
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/private-registry/" class="md-nav__link">
        Private container registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/proxy-ocp-4.5/" class="md-nav__link">
        Proxy OCP 4.5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/scc/" class="md-nav__link">
        Security Context Constraints (SCC)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift-scc-with-mutating-webhooks/" class="md-nav__link">
        SCCs and mutating webhooks - a lesson learned
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/fix-selinux-labels-coreos/" class="md-nav__link">
        SElinux labels fix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sctp/" class="md-nav__link">
        SCTP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_troubleshooting_etcd_state/" class="md-nav__link">
        Troubleshooting etcd state
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/useful-ocp-commands/" class="md-nav__link">
        Useful commands for OpenShift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/useful-ocp-sdn-commands/" class="md-nav__link">
        Useful commands for OpenShift SDN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/troubleshooting_openshift_on_openstack_worker_creation/" class="md-nav__link">
        Troubleshooting OpenShift on OpenStack worker creation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          OpenStack
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="OpenStack" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          OpenStack
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/reattach_to_running_deployment/" class="md-nav__link">
        Reattach to running deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/using_clouds_yaml/" class="md-nav__link">
        Using clouds.yaml
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Coding
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Coding" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Coding
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/operator-sdk-reconciliation/" class="md-nav__link">
        Controller Reconciliation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/vimrc/" class="md-nav__link">
        My vimrc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/golang-ip-conversion/" class="md-nav__link">
        Golang IP address conversion
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#running-various-ovn-traces-in-an-ovn-kubernetes-environment" class="md-nav__link">
    Running various OVN traces in an ovn-kubernetes environment
  </a>
  
    <nav class="md-nav" aria-label="Running various OVN traces in an ovn-kubernetes environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment" class="md-nav__link">
    Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collection-of-examples" class="md-nav__link">
    Collection of examples
  </a>
  
    <nav class="md-nav" aria-label="Collection of examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulating-new-flows-through-conntrack" class="md-nav__link">
    Simulating new flows through conntrack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specifying-multiple-ct-actions" class="md-nav__link">
    Specifying multiple --ct actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#specifying-tcp-flags-in-ovn-trace" class="md-nav__link">
    Specifying TCP flags in ovn-trace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulating-reverse-flows-through-conntrack" class="md-nav__link">
    Simulating reverse flows through conntrack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sources-and-references" class="md-nav__link">
    Sources and references
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="packet-tracing-with-ovn">Packet tracing with OVN</h1>
<h2 id="running-various-ovn-traces-in-an-ovn-kubernetes-environment">Running various OVN traces in an ovn-kubernetes environment</h2>
<h3 id="environment">Environment</h3>
<p>I use an <a href="https://github.com/ovn-org/ovn-kubernetes">ovn-kubernetes</a> kind deployment as a base environment for the following traces.</p>
<p>I spawn an environment with:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>contrib/kind.sh
</code></pre></div>
</td></tr></table></p>
<p>Then, I deploy the following deployment and service:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># cat nginx.yaml </span><span class="w"></span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"></span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"></span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"></span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.14.2</span><span class="w"></span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="c1"># cat nginx-svc.yaml </span><span class="w"></span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-np</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"></span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w"></span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30007</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<p>My pod is on ovn-worker, and the node's IP address is 172.18.0.3. The service can be reached on port 30007 and will then be NATed and forwarded to pod nginx-deployment-9456bbbf9-x6pc6 with IP 10.244.1.3:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span>root@ovnkubernetes egressfw<span class="o">]</span><span class="c1"># oc get svc -o wide</span>
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE   SELECTOR
kubernetes   ClusterIP   <span class="m">10</span>.96.0.1      &lt;none&gt;        <span class="m">443</span>/TCP        84m   &lt;none&gt;
nginx-np     NodePort    <span class="m">10</span>.96.91.159   &lt;none&gt;        <span class="m">80</span>:30007/TCP   63m   <span class="nv">app</span><span class="o">=</span>nginx
<span class="o">[</span>root@ovnkubernetes egressfw<span class="o">]</span><span class="c1"># oc get pods -o wide</span>
NAME                               READY   STATUS    RESTARTS   AGE   IP           NODE         NOMINATED NODE   READINESS GATES
nginx-deployment-9456bbbf9-x6pc6   <span class="m">1</span>/1     Running   <span class="m">0</span>          63m   <span class="m">10</span>.244.1.3   ovn-worker   &lt;none&gt;           &lt;none&gt;
<span class="o">[</span>root@ovnkubernetes egressfw<span class="o">]</span><span class="c1"># oc get nodes -o wide</span>
NAME                STATUS   ROLES                  AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE       KERNEL-VERSION          CONTAINER-RUNTIME
ovn-control-plane   Ready    control-plane,master   84m   v1.23.3   <span class="m">172</span>.18.0.3    &lt;none&gt;        Ubuntu <span class="m">21</span>.10   <span class="m">4</span>.18.0-358.el8.x86_64   containerd://1.5.9
ovn-worker          Ready    &lt;none&gt;                 84m   v1.23.3   <span class="m">172</span>.18.0.4    &lt;none&gt;        Ubuntu <span class="m">21</span>.10   <span class="m">4</span>.18.0-358.el8.x86_64   containerd://1.5.9
ovn-worker2         Ready    &lt;none&gt;                 84m   v1.23.3   <span class="m">172</span>.18.0.2    &lt;none&gt;        Ubuntu <span class="m">21</span>.10   <span class="m">4</span>.18.0-358.el8.x86_64   containerd://1.5.9
</code></pre></div>
</td></tr></table></p>
<p>We can run curl against this service from the next-hop gateway with IP address 172.18.0.1 and MAC address 02:42:7a:79:82:ca:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ip a ls dev br-519277dba8fe</span>
<span class="m">4</span>: br-519277dba8fe: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1500</span> qdisc noqueue state UP group default 
    link/ether <span class="m">02</span>:42:7a:79:82:ca brd ff:ff:ff:ff:ff:ff
    inet <span class="m">172</span>.18.0.1/16 brd <span class="m">172</span>.18.255.255 scope global br-519277dba8fe
       valid_lft forever preferred_lft forever
    inet6 fc00:f853:ccd:e793::1/64 scope global 
       valid_lft forever preferred_lft forever
    inet6 fe80::42:7aff:fe79:82ca/64 scope link 
       valid_lft forever preferred_lft forever
    inet6 fe80::1/64 scope link 
       valid_lft forever preferred_lft forever
<span class="c1"># curl -I 172.18.0.4:30007 </span>
HTTP/1.1 <span class="m">200</span> OK
Server: nginx/1.14.2
Date: Wed, <span class="m">16</span> Feb <span class="m">2022</span> <span class="m">11</span>:32:44 GMT
Content-Type: text/html
Content-Length: <span class="m">612</span>
Last-Modified: Tue, <span class="m">04</span> Dec <span class="m">2018</span> <span class="m">14</span>:44:49 GMT
Connection: keep-alive
ETag: <span class="s2">&quot;5c0692e1-264&quot;</span>
Accept-Ranges: bytes
</code></pre></div>
</td></tr></table></p>
<p>The pod has the following IP address and gateway:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ip a</span>
<span class="m">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="m">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="m">1000</span>
    link/loopback <span class="m">00</span>:00:00:00:00:00 brd <span class="m">00</span>:00:00:00:00:00
    inet <span class="m">127</span>.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
<span class="m">3</span>: eth0@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="m">1400</span> qdisc noqueue state UP group default 
    link/ether 0a:58:0a:f4:01:03 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="m">0</span>
    inet <span class="m">10</span>.244.1.3/24 brd <span class="m">10</span>.244.1.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::858:aff:fef4:103/64 scope link 
       valid_lft forever preferred_lft forever
<span class="c1"># ip r show default</span>
default via <span class="m">10</span>.244.1.1 dev eth0
<span class="c1"># ip neigh</span>
<span class="m">10</span>.244.1.1 dev eth0 lladdr 0a:58:0a:f4:01:01 STALE
</code></pre></div>
</td></tr></table></p>
<p>And on the pod, we see the following flow which has gone through DNAT and SNAT:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># tcpdump -nne -i eth0</span>
dropped privs to tcpdump
tcpdump: verbose output suppressed, use -v or -vv <span class="k">for</span> full protocol decode
listening on eth0, link-type EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>, capture size <span class="m">262144</span> bytes
<span class="m">11</span>:32:44.407949 0a:58:0a:f4:01:01 &gt; 0a:58:0a:f4:01:03, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">74</span>: <span class="m">100</span>.64.0.3.53642 &gt; <span class="m">10</span>.244.1.3.80: Flags <span class="o">[</span>S<span class="o">]</span>, seq <span class="m">2722623038</span>, win <span class="m">29200</span>, options <span class="o">[</span>mss <span class="m">1460</span>,sackOK,TS val <span class="m">757469725</span> ecr <span class="m">0</span>,nop,wscale <span class="m">7</span><span class="o">]</span>, length <span class="m">0</span>
<span class="m">11</span>:32:44.408002 0a:58:0a:f4:01:03 &gt; 0a:58:0a:f4:01:01, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">74</span>: <span class="m">10</span>.244.1.3.80 &gt; <span class="m">100</span>.64.0.3.53642: Flags <span class="o">[</span>S.<span class="o">]</span>, seq <span class="m">519304349</span>, ack <span class="m">2722623039</span>, win <span class="m">26960</span>, options <span class="o">[</span>mss <span class="m">1360</span>,sackOK,TS val <span class="m">1904257279</span> ecr <span class="m">757469725</span>,nop,wscale <span class="m">7</span><span class="o">]</span>, length <span class="m">0</span>
<span class="m">11</span>:32:44.409948 0a:58:0a:f4:01:01 &gt; 0a:58:0a:f4:01:03, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">147</span>: <span class="m">100</span>.64.0.3.53642 &gt; <span class="m">10</span>.244.1.3.80: Flags <span class="o">[</span>P.<span class="o">]</span>, seq <span class="m">1</span>:82, ack <span class="m">1</span>, win <span class="m">229</span>, options <span class="o">[</span>nop,nop,TS val <span class="m">757469728</span> ecr <span class="m">1904257279</span><span class="o">]</span>, length <span class="m">81</span>: HTTP: HEAD / HTTP/1.1
<span class="m">11</span>:32:44.409953 0a:58:0a:f4:01:01 &gt; 0a:58:0a:f4:01:03, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">66</span>: <span class="m">100</span>.64.0.3.53642 &gt; <span class="m">10</span>.244.1.3.80: Flags <span class="o">[</span>.<span class="o">]</span>, ack <span class="m">1</span>, win <span class="m">229</span>, options <span class="o">[</span>nop,nop,TS val <span class="m">757469728</span> ecr <span class="m">1904257279</span><span class="o">]</span>, length <span class="m">0</span>
<span class="m">11</span>:32:44.410001 0a:58:0a:f4:01:03 &gt; 0a:58:0a:f4:01:01, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">66</span>: <span class="m">10</span>.244.1.3.80 &gt; <span class="m">100</span>.64.0.3.53642: Flags <span class="o">[</span>.<span class="o">]</span>, ack <span class="m">82</span>, win <span class="m">211</span>, options <span class="o">[</span>nop,nop,TS val <span class="m">1904257281</span> ecr <span class="m">757469728</span><span class="o">]</span>, length <span class="m">0</span>
<span class="m">11</span>:32:44.410031 0a:58:0a:f4:01:03 &gt; 0a:58:0a:f4:01:01, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">66</span>: <span class="m">10</span>.244.1.3.80 &gt; <span class="m">100</span>.64.0.3.53642: Flags <span class="o">[</span>.<span class="o">]</span>, ack <span class="m">82</span>, win <span class="m">211</span>, options <span class="o">[</span>nop,nop,TS val <span class="m">1904257281</span> ecr <span class="m">757469728</span><span class="o">]</span>, length <span class="m">0</span>
<span class="m">11</span>:32:44.410399 0a:58:0a:f4:01:03 &gt; 0a:58:0a:f4:01:01, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">304</span>: <span class="m">10</span>.244.1.3.80 &gt; <span class="m">100</span>.64.0.3.53642: Flags <span class="o">[</span>P.<span class="o">]</span>, seq <span class="m">1</span>:239, ack <span class="m">82</span>, win <span class="m">211</span>, options <span class="o">[</span>nop,nop,TS val <span class="m">1904257281</span> ecr <span class="m">757469728</span><span class="o">]</span>, length <span class="m">238</span>: HTTP: HTTP/1.1 <span class="m">200</span> OK
<span class="m">11</span>:32:44.410491 0a:58:0a:f4:01:01 &gt; 0a:58:0a:f4:01:03, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">66</span>: <span class="m">100</span>.64.0.3.53642 &gt; <span class="m">10</span>.244.1.3.80: Flags <span class="o">[</span>.<span class="o">]</span>, ack <span class="m">239</span>, win <span class="m">237</span>, options <span class="o">[</span>nop,nop,TS val <span class="m">757469729</span> ecr <span class="m">1904257281</span><span class="o">]</span>, length <span class="m">0</span>
<span class="m">11</span>:32:44.410772 0a:58:0a:f4:01:01 &gt; 0a:58:0a:f4:01:03, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">66</span>: <span class="m">100</span>.64.0.3.53642 &gt; <span class="m">10</span>.244.1.3.80: Flags <span class="o">[</span>F.<span class="o">]</span>, seq <span class="m">82</span>, ack <span class="m">239</span>, win <span class="m">237</span>, options <span class="o">[</span>nop,nop,TS val <span class="m">757469730</span> ecr <span class="m">1904257281</span><span class="o">]</span>, length <span class="m">0</span>
<span class="m">11</span>:32:44.411039 0a:58:0a:f4:01:03 &gt; 0a:58:0a:f4:01:01, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">66</span>: <span class="m">10</span>.244.1.3.80 &gt; <span class="m">100</span>.64.0.3.53642: Flags <span class="o">[</span>F.<span class="o">]</span>, seq <span class="m">239</span>, ack <span class="m">83</span>, win <span class="m">211</span>, options <span class="o">[</span>nop,nop,TS val <span class="m">1904257282</span> ecr <span class="m">757469730</span><span class="o">]</span>, length <span class="m">0</span>
<span class="m">11</span>:32:44.411154 0a:58:0a:f4:01:01 &gt; 0a:58:0a:f4:01:03, ethertype IPv4 <span class="o">(</span>0x0800<span class="o">)</span>, length <span class="m">66</span>: <span class="m">100</span>.64.0.3.53642 &gt; <span class="m">10</span>.244.1.3.80: Flags <span class="o">[</span>.<span class="o">]</span>, ack <span class="m">240</span>, win <span class="m">237</span>, options <span class="o">[</span>nop,nop,TS val <span class="m">757469730</span> ecr <span class="m">1904257282</span><span class="o">]</span>, length <span class="m">0</span>
^C
<span class="m">11</span> packets captured
<span class="m">11</span> packets received by filter
<span class="m">0</span> packets dropped by kernel
</code></pre></div>
</td></tr></table></p>
<p>Here is an overview of the NBDB state:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sh-5.1# ovn-nbctl show
switch cd928d81-4f0f-4c04-860a-f75022f7e0b9 <span class="o">(</span>ext_ovn-control-plane<span class="o">)</span>
    port breth0_ovn-control-plane
        type: localnet
        addresses: <span class="o">[</span><span class="s2">&quot;unknown&quot;</span><span class="o">]</span>
    port etor-GR_ovn-control-plane
        type: router
        addresses: <span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:03&quot;</span><span class="o">]</span>
        router-port: rtoe-GR_ovn-control-plane
switch 25b2a2f5-437f-4513-90cd-e3e1aaf7f14f <span class="o">(</span>ovn-control-plane<span class="o">)</span>
    port local-path-storage_local-path-provisioner-5ddd94ff66-krkk7
        addresses: <span class="o">[</span><span class="s2">&quot;0a:58:0a:f4:02:04 10.244.2.4&quot;</span><span class="o">]</span>
    port stor-ovn-control-plane
        type: router
        router-port: rtos-ovn-control-plane
    port k8s-ovn-control-plane
        addresses: <span class="o">[</span><span class="s2">&quot;82:24:48:8a:77:cc 10.244.2.2&quot;</span><span class="o">]</span>
    port kube-system_coredns-64897985d-wdvs9
        addresses: <span class="o">[</span><span class="s2">&quot;0a:58:0a:f4:02:05 10.244.2.5&quot;</span><span class="o">]</span>
    port kube-system_coredns-64897985d-rzjfr
        addresses: <span class="o">[</span><span class="s2">&quot;0a:58:0a:f4:02:03 10.244.2.3&quot;</span><span class="o">]</span>
switch b4dede7d-7660-42bf-a954-c5b3f0f28a7c <span class="o">(</span>ovn-worker<span class="o">)</span>
    port stor-ovn-worker
        type: router
        router-port: rtos-ovn-worker
    port default_nginx-deployment-9456bbbf9-x6pc6
        addresses: <span class="o">[</span><span class="s2">&quot;0a:58:0a:f4:01:03 10.244.1.3&quot;</span><span class="o">]</span>
    port k8s-ovn-worker
        addresses: <span class="o">[</span><span class="s2">&quot;4a:d4:28:63:24:1c 10.244.1.2&quot;</span><span class="o">]</span>
switch 214f4d51-750d-414a-aad1-94e84e623f9b <span class="o">(</span>ext_ovn-worker<span class="o">)</span>
    port breth0_ovn-worker
        type: localnet
        addresses: <span class="o">[</span><span class="s2">&quot;unknown&quot;</span><span class="o">]</span>
    port etor-GR_ovn-worker
        type: router
        addresses: <span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:04&quot;</span><span class="o">]</span>
        router-port: rtoe-GR_ovn-worker
switch bcec069e-f578-4927-93d2-6e129595a716 <span class="o">(</span>join<span class="o">)</span>
    port jtor-GR_ovn-worker
        type: router
        router-port: rtoj-GR_ovn-worker
    port jtor-GR_ovn-control-plane
        type: router
        router-port: rtoj-GR_ovn-control-plane
    port jtor-GR_ovn-worker2
        type: router
        router-port: rtoj-GR_ovn-worker2
    port jtor-ovn_cluster_router
        type: router
        router-port: rtoj-ovn_cluster_router
switch ff675836-2b46-4d83-b53f-41cba7297d8b <span class="o">(</span>ext_ovn-worker2<span class="o">)</span>
    port breth0_ovn-worker2
        type: localnet
        addresses: <span class="o">[</span><span class="s2">&quot;unknown&quot;</span><span class="o">]</span>
    port etor-GR_ovn-worker2
        type: router
        addresses: <span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:02&quot;</span><span class="o">]</span>
        router-port: rtoe-GR_ovn-worker2
switch e1f67383-f731-4bf7-a018-6361ec60f477 <span class="o">(</span>ovn-worker2<span class="o">)</span>
    port k8s-ovn-worker2
        addresses: <span class="o">[</span><span class="s2">&quot;4e:19:7f:89:93:bc 10.244.0.2&quot;</span><span class="o">]</span>
    port stor-ovn-worker2
        type: router
        router-port: rtos-ovn-worker2
router 7072022c-7226-4928-a397-fc770b75f98f <span class="o">(</span>GR_ovn-worker2<span class="o">)</span>
    port rtoj-GR_ovn-worker2
        mac: <span class="s2">&quot;0a:58:64:40:00:02&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;100.64.0.2/16&quot;</span><span class="o">]</span>
    port rtoe-GR_ovn-worker2
        mac: <span class="s2">&quot;02:42:ac:12:00:02&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;172.18.0.2/16&quot;</span><span class="o">]</span>
    nat d87cc0f7-5053-4739-9617-a952cb37d74c
        external ip: <span class="s2">&quot;172.18.0.2&quot;</span>
        logical ip: <span class="s2">&quot;10.244.0.0/16&quot;</span>
        type: <span class="s2">&quot;snat&quot;</span>
router 5ea87f54-ceeb-442a-92c8-4b522278b5dd <span class="o">(</span>GR_ovn-worker<span class="o">)</span>
    port rtoj-GR_ovn-worker
        mac: <span class="s2">&quot;0a:58:64:40:00:03&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;100.64.0.3/16&quot;</span><span class="o">]</span>
    port rtoe-GR_ovn-worker
        mac: <span class="s2">&quot;02:42:ac:12:00:04&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;172.18.0.4/16&quot;</span><span class="o">]</span>
    nat ca3ef3e0-22c1-427d-a977-b10256a96177
        external ip: <span class="s2">&quot;172.18.0.4&quot;</span>
        logical ip: <span class="s2">&quot;10.244.0.0/16&quot;</span>
        type: <span class="s2">&quot;snat&quot;</span>
router 1dead945-8773-4d33-b56b-67e5ab8fcca3 <span class="o">(</span>GR_ovn-control-plane<span class="o">)</span>
    port rtoe-GR_ovn-control-plane
        mac: <span class="s2">&quot;02:42:ac:12:00:03&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;172.18.0.3/16&quot;</span><span class="o">]</span>
    port rtoj-GR_ovn-control-plane
        mac: <span class="s2">&quot;0a:58:64:40:00:04&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;100.64.0.4/16&quot;</span><span class="o">]</span>
    nat 70a6067c-ffa4-407a-9d0f-cc581b8b1c3a
        external ip: <span class="s2">&quot;172.18.0.3&quot;</span>
        logical ip: <span class="s2">&quot;10.244.0.0/16&quot;</span>
        type: <span class="s2">&quot;snat&quot;</span>
router 9ac72c76-9f8f-4f3a-9a82-0e18846c4cd9 <span class="o">(</span>ovn_cluster_router<span class="o">)</span>
    port rtos-ovn-control-plane
        mac: <span class="s2">&quot;0a:58:0a:f4:02:01&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;10.244.2.1/24&quot;</span><span class="o">]</span>
        gateway chassis: <span class="o">[</span>9268048a-65bf-467e-b166-d0faffafa686<span class="o">]</span>
    port rtos-ovn-worker2
        mac: <span class="s2">&quot;0a:58:0a:f4:00:01&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;10.244.0.1/24&quot;</span><span class="o">]</span>
        gateway chassis: <span class="o">[</span>fbb949c1-6d62-44cc-b67e-9f93b40d1691<span class="o">]</span>
    port rtos-ovn-worker
        mac: <span class="s2">&quot;0a:58:0a:f4:01:01&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;10.244.1.1/24&quot;</span><span class="o">]</span>
        gateway chassis: <span class="o">[</span>4da007a6-ed1d-45ff-bcf4-62ae8914bbbc<span class="o">]</span>
    port rtoj-ovn_cluster_router
        mac: <span class="s2">&quot;0a:58:64:40:00:01&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;100.64.0.1/16&quot;</span><span class="o">]</span>
</code></pre></div>
</td></tr></table></p>
<p>The service is implemented as an OVN loadbalancer - we are going to look into this load-balancer further in the examples section below:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code># ovn-nbctl lr-lb-list GR_ovn-worker
UUID                                    LB                  PROTO      VIP                 IPs
bc20db47-e79c-4906-b0d8-dd2dcfaf54b4    Service_default/    tcp        172.18.0.4:30007    10.244.1.3:80
e7486241-66e1-453a-b44d-3b3e7b2ebc4f    Service_default/    tcp        10.96.0.1:443       172.18.0.3:6443
</code></pre></div>
</td></tr></table></p>
<h3 id="collection-of-examples">Collection of examples</h3>
<h4 id="simulating-new-flows-through-conntrack">Simulating new flows through conntrack</h4>
<p>Tracing a new TCP flow from the outside of the cluster to the service IP and port, knowing that NAT and conntrack are involved. A <code class="highlight">--minimal</code> trace is always a good starting point. The most important bit here is the <code class="highlight">--ct new</code> command line parameter to simulate a new conntrack flow:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ovn-trace --minimal  --ovs ext_ovn-worker &#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39; --ct new</span>
</code></pre></div>
</td></tr></table></p>
<p>Result of the <code class="highlight">--minimal</code> trace:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sh-5.1# ovn-trace --minimal  --ovs ext_ovn-worker <span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span> --ct new
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
    *** no OpenFlow flows<span class="p">;</span>
    ct_lb /* default <span class="o">(</span>use --ct to customize<span class="o">)</span> */ <span class="o">{</span>
        *** no OpenFlow flows<span class="p">;</span>
        ip.ttl--<span class="p">;</span>
        eth.src <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span>
        eth.dst <span class="o">=</span> 0a:58:64:40:00:01<span class="p">;</span>
        ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ip.ttl--<span class="p">;</span>
            eth.src <span class="o">=</span> 0a:58:0a:f4:01:01<span class="p">;</span>
            eth.dst <span class="o">=</span> 0a:58:0a:f4:01:03<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** chk_lb_hairpin_reply action not implemented<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ct_lb /* default <span class="o">(</span>use --ct to customize<span class="o">)</span> */ <span class="o">{</span>
                *** no OpenFlow flows<span class="p">;</span>
                *** no OpenFlow flows<span class="p">;</span>
                output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
            <span class="o">}</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</code></pre></div>
</td></tr></table></p>
<p>In the detailed trace, we can also see the destination IP after the DNAT:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sh-5.1# ovn-trace --friendly-names  --ovs ext_ovn-worker <span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span> --ct new <span class="p">|</span> tail -n <span class="m">15</span>

ct_lb /* default <span class="o">(</span>use --ct to customize<span class="o">)</span> */
-------------------------------------------
 <span class="m">3</span>. ls_out_acl_hint <span class="o">(</span>northd.c:6041<span class="o">)</span>: ct.est <span class="o">&amp;&amp;</span> ct_label.blocked <span class="o">==</span> <span class="m">0</span>, priority <span class="m">1</span>, uuid 5f2e1810
    <span class="nv">cookie</span><span class="o">=</span>0x5f2e1810, <span class="nv">duration</span><span class="o">=</span><span class="m">5184</span>.167s, <span class="nv">table</span><span class="o">=</span><span class="m">43</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">5184</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,44<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x5f2e1810, <span class="nv">duration</span><span class="o">=</span><span class="m">5184</span>.149s, <span class="nv">table</span><span class="o">=</span><span class="m">43</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">28886</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">7169503</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">1</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,44<span class="o">)</span>
    reg0<span class="o">[</span><span class="m">10</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">8</span>. ls_out_port_sec_ip <span class="o">(</span>northd.c:5130<span class="o">)</span>: <span class="nv">outport</span> <span class="o">==</span> <span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span> <span class="o">&amp;&amp;</span> eth.dst <span class="o">==</span> 0a:58:0a:f4:01:03 <span class="o">&amp;&amp;</span> ip4.dst <span class="o">==</span> <span class="o">{</span><span class="m">255</span>.255.255.255, <span class="m">224</span>.0.0.0/4, <span class="m">10</span>.244.1.3<span class="o">}</span>, priority <span class="m">90</span>, uuid 701b3cf6
    *** no OpenFlow flows
    next<span class="p">;</span>
 <span class="m">9</span>. ls_out_port_sec_l2 <span class="o">(</span>northd.c:5594<span class="o">)</span>: <span class="nv">outport</span> <span class="o">==</span> <span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span> <span class="o">&amp;&amp;</span> eth.dst <span class="o">==</span> <span class="o">{</span>0a:58:0a:f4:01:03<span class="o">}</span>, priority <span class="m">50</span>, uuid b6daec2d
    *** no OpenFlow flows
    output<span class="p">;</span>
    /* output to <span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span>, <span class="nb">type</span> <span class="s2">&quot;&quot;</span> */
</code></pre></div>
</td></tr></table></p>
<p>Unfortunately, it is very difficult to see what the final packet would look like. We know that an SNAT is involved, too, but that is "hidden" somewhere in the output:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sh-5.1# ovn-trace --friendly-names  --ovs ext_ovn-worker <span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span> --ct new <span class="p">|</span> grep <span class="m">100</span>.64     
    <span class="nv">reg0</span> <span class="o">=</span> <span class="m">100</span>.64.0.1<span class="p">;</span>
    <span class="nv">reg1</span> <span class="o">=</span> <span class="m">100</span>.64.0.3<span class="p">;</span>
</code></pre></div>
</td></tr></table></p>
<p>It would indeed be desirable for ovn-trace to show the full packet state of the processed and ready-to-send packet.</p>
<p>If we look at the flow in a bit more detail, we can see that in the <code class="highlight">ingress</code> pipeline of <code class="highlight">GR_ovn-worker</code>, the packet hits the load-balancer flow. SNAT is forced for this load-balancer, and the packet shall be sent to backend <code class="highlight"><span class="mf">10.244.1.3</span><span class="p">:</span><span class="mf">80</span><span class="w"></span></code>:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ovn-trace --ct new --ct new --ct new  --ovs ext_ovn-worker &#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39; </span>
<span class="o">(</span>...<span class="o">)</span>
ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;GR_ovn-worker&quot;</span>, <span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;rtoe-GR_ovn-worker&quot;</span><span class="o">)</span>
--------------------------------------------------------
 <span class="m">0</span>. lr_in_admission <span class="o">(</span>northd.c:10523<span class="o">)</span>: eth.dst <span class="o">==</span> <span class="m">02</span>:42:ac:12:00:04 <span class="o">&amp;&amp;</span> <span class="nv">inport</span> <span class="o">==</span> <span class="s2">&quot;rtoe-GR_ovn-worker&quot;</span>, priority <span class="m">50</span>, uuid 71cc3085
    *** no OpenFlow flows
    xreg0<span class="o">[</span><span class="m">0</span>..47<span class="o">]</span> <span class="o">=</span> <span class="m">02</span>:42:ac:12:00:04<span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">1</span>. lr_in_lookup_neighbor <span class="o">(</span>northd.c:10667<span class="o">)</span>: <span class="m">1</span>, priority <span class="m">0</span>, uuid <span class="m">39881020</span>
    <span class="nv">cookie</span><span class="o">=</span>0x39881020, <span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.530s, <span class="nv">table</span><span class="o">=</span><span class="m">9</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">71802</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">13904424</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x39881020, <span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.497s, <span class="nv">table</span><span class="o">=</span><span class="m">9</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">29937</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">2833154</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
    reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">2</span>. lr_in_learn_neighbor <span class="o">(</span>northd.c:10676<span class="o">)</span>: reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">==</span> <span class="m">1</span> <span class="o">||</span> reg9<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">==</span> <span class="m">0</span>, priority <span class="m">100</span>, uuid 6be9d860
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.530s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">71802</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">13904424</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.496s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">29949</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">2833922</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.497s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">689</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">30478</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">150</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.530s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">19439</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    next<span class="p">;</span>
 <span class="m">4</span>. lr_in_unsnat <span class="o">(</span>northd.c:9670<span class="o">)</span>: ip4 <span class="o">&amp;&amp;</span> ip4.dst <span class="o">==</span> <span class="m">172</span>.18.0.4 <span class="o">&amp;&amp;</span> tcp <span class="o">&amp;&amp;</span> tcp.dst <span class="o">==</span> <span class="m">30007</span>, priority <span class="m">120</span>, uuid 60d3c124
    *** no OpenFlow flows
    next<span class="p">;</span>
 <span class="m">5</span>. lr_in_defrag <span class="o">(</span>northd.c:9865<span class="o">)</span>: ip <span class="o">&amp;&amp;</span> ip4.dst <span class="o">==</span> <span class="m">172</span>.18.0.4 <span class="o">&amp;&amp;</span> tcp, priority <span class="m">110</span>, uuid 4bb8c7f6
    *** no OpenFlow flows
    <span class="nv">reg0</span> <span class="o">=</span> <span class="m">172</span>.18.0.4<span class="p">;</span>
    reg9<span class="o">[</span><span class="m">16</span>..31<span class="o">]</span> <span class="o">=</span> tcp.dst<span class="p">;</span>
    ct_dnat<span class="p">;</span>

ct_dnat /* assuming no un-dnat entry, so no change */
-----------------------------------------------------
 <span class="m">6</span>. lr_in_dnat <span class="o">(</span>northd.c:9701<span class="o">)</span>: ct.new <span class="o">&amp;&amp;</span> ip4 <span class="o">&amp;&amp;</span> <span class="nv">reg0</span> <span class="o">==</span> <span class="m">172</span>.18.0.4 <span class="o">&amp;&amp;</span> tcp <span class="o">&amp;&amp;</span> reg9<span class="o">[</span><span class="m">16</span>..31<span class="o">]</span> <span class="o">==</span> <span class="m">30007</span>, priority <span class="m">120</span>, uuid 25f1ad55
    *** no OpenFlow flows
    flags.force_snat_for_lb <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    ct_lb<span class="o">(</span><span class="nv">backends</span><span class="o">=</span><span class="m">10</span>.244.1.3:80<span class="o">)</span><span class="p">;</span>

ct_lb
-----
<span class="m">10</span>. lr_in_ip_routing_pre <span class="o">(</span>northd.c:10910<span class="o">)</span>: <span class="m">1</span>, priority <span class="m">0</span>, uuid 219bc578
    <span class="nv">cookie</span><span class="o">=</span>0x219bc578, <span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.530s, <span class="nv">table</span><span class="o">=</span><span class="m">18</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">71797</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">13903874</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>set_field:0/0xffffffff-&gt;xxreg1,resubmit<span class="o">(</span>,19<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x219bc578, <span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.496s, <span class="nv">table</span><span class="o">=</span><span class="m">18</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">29925</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">2831554</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>set_field:0/0xffffffff-&gt;xxreg1,resubmit<span class="o">(</span>,19<span class="o">)</span>
    <span class="nv">reg7</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
    next<span class="p">;</span>
<span class="m">11</span>. lr_in_ip_routing <span class="o">(</span>northd.c:9439<span class="o">)</span>: <span class="nv">reg7</span> <span class="o">==</span> <span class="m">0</span> <span class="o">&amp;&amp;</span> ip4.dst <span class="o">==</span> <span class="m">10</span>.244.0.0/16, priority <span class="m">49</span>, uuid fbba9ce1
    *** no OpenFlow flows
    ip.ttl--<span class="p">;</span>
    reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="nv">reg0</span> <span class="o">=</span> <span class="m">100</span>.64.0.1<span class="p">;</span>
    <span class="nv">reg1</span> <span class="o">=</span> <span class="m">100</span>.64.0.3<span class="p">;</span>
    eth.src <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span>
    <span class="nv">outport</span> <span class="o">=</span> <span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span><span class="p">;</span>
    flags.loopback <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
</code></pre></div>
</td></tr></table></p>
<p>We can find the same flow here inside the OVN Southbound database flows:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ovn-sbctl dump-flows </span>
<span class="o">(</span>...<span class="o">)</span>
Datapath: <span class="s2">&quot;GR_ovn-worker&quot;</span> <span class="o">(</span>15e72dff-677d-4794-8f70-a5fea49ad788<span class="o">)</span>  Pipeline: ingress
<span class="o">(</span>...<span class="o">)</span>
  <span class="nv">table</span><span class="o">=</span><span class="m">6</span> <span class="o">(</span>lr_in_dnat         <span class="o">)</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">120</span>  , <span class="nv">match</span><span class="o">=(</span>ct.new <span class="o">&amp;&amp;</span> ip4 <span class="o">&amp;&amp;</span> <span class="nv">reg0</span> <span class="o">==</span> <span class="m">172</span>.18.0.4 <span class="o">&amp;&amp;</span> tcp <span class="o">&amp;&amp;</span> reg9<span class="o">[</span><span class="m">16</span>..31<span class="o">]</span> <span class="o">==</span> <span class="m">30007</span><span class="o">)</span>, <span class="nv">action</span><span class="o">=(</span>flags.force_snat_for_lb <span class="o">=</span> <span class="m">1</span><span class="p">;</span> ct_lb<span class="o">(</span><span class="nv">backends</span><span class="o">=</span><span class="m">10</span>.244.1.3:80<span class="o">)</span><span class="p">;</span><span class="o">)</span>
<span class="o">(</span>...<span class="o">)</span>
  <span class="nv">table</span><span class="o">=</span><span class="m">11</span><span class="o">(</span>lr_in_ip_routing   <span class="o">)</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">49</span>   , <span class="nv">match</span><span class="o">=(</span><span class="nv">reg7</span> <span class="o">==</span> <span class="m">0</span> <span class="o">&amp;&amp;</span> ip4.dst <span class="o">==</span> <span class="m">10</span>.244.0.0/16<span class="o">)</span>, <span class="nv">action</span><span class="o">=(</span>ip.ttl--<span class="p">;</span> reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span> <span class="nv">reg0</span> <span class="o">=</span> <span class="m">100</span>.64.0.1<span class="p">;</span> <span class="nv">reg1</span> <span class="o">=</span> <span class="m">100</span>.64.0.3<span class="p">;</span> eth.src <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span> <span class="nv">outport</span> <span class="o">=</span> <span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span><span class="p">;</span> flags.loopback <span class="o">=</span> <span class="m">1</span><span class="p">;</span> next<span class="p">;</span><span class="o">)</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div>
</td></tr></table></p>
<h4 id="specifying-multiple-ct-actions">Specifying multiple <code class="highlight">--ct</code> actions</h4>
<p>From the ovn-trace man page:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>            <span class="nv">A</span> <span class="nv">packet</span> <span class="nv">might</span> <span class="nv">pass</span> <span class="nv">through</span> <span class="nv">the</span> <span class="nv">connection</span> <span class="nv">tracker</span> <span class="nv">twice</span> <span class="nv">in</span>
            <span class="nv">one</span> <span class="nv">trip</span> <span class="nv">through</span> <span class="nv">OVN</span>: <span class="nv">once</span> <span class="nv">following</span> <span class="nv">egress</span> <span class="nv">from</span> <span class="nv">a</span> <span class="nv">VM</span> <span class="nv">as</span> <span class="nv">it</span>
            <span class="nv">passes</span> <span class="nv">outward</span> <span class="nv">through</span> <span class="nv">a</span> <span class="nv">firewall</span>, <span class="nv">and</span> <span class="nv">once</span> <span class="nv">preceding</span>
            <span class="nv">ingress</span> <span class="nv">to</span> <span class="nv">a</span> <span class="nv">second</span> <span class="nv">VM</span> <span class="nv">as</span> <span class="nv">it</span> <span class="nv">passes</span> <span class="nv">inward</span> <span class="nv">through</span> <span class="nv">a</span>
            <span class="nv">firewall</span>. <span class="nv">Use</span> <span class="nv">multiple</span> <span class="o">--</span><span class="nv">ct</span> <span class="nv">options</span> <span class="nv">to</span> <span class="nv">specify</span> <span class="nv">the</span> <span class="nv">flags</span> <span class="k">for</span>
            <span class="nv">multiple</span> <span class="nv">ct_next</span> <span class="nv">actions</span>.
</code></pre></div>
</td></tr></table></p>
<p>Compare the following outputs - note that there is a difference with every <code class="highlight">--ct new</code> set:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sh-5.1# ovn-trace --minimal  --ovs ext_ovn-worker <span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span>              
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
ct_dnat /* assuming no un-dnat entry, so no change */ /* default <span class="o">(</span>use --ct to customize<span class="o">)</span> */ <span class="o">{</span>
    *** no OpenFlow flows<span class="p">;</span>
    ip.ttl--<span class="p">;</span>
    eth.src <span class="o">=</span> <span class="m">02</span>:42:ac:12:00:04<span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
sh-5.1# ovn-trace --ct new --minimal  --ovs ext_ovn-worker <span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span> 
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
    *** no OpenFlow flows<span class="p">;</span>
    ct_lb /* default <span class="o">(</span>use --ct to customize<span class="o">)</span> */ <span class="o">{</span>
        *** no OpenFlow flows<span class="p">;</span>
        ip.ttl--<span class="p">;</span>
        eth.src <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span>
        eth.dst <span class="o">=</span> 0a:58:64:40:00:01<span class="p">;</span>
        ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ip.ttl--<span class="p">;</span>
            eth.src <span class="o">=</span> 0a:58:0a:f4:01:01<span class="p">;</span>
            eth.dst <span class="o">=</span> 0a:58:0a:f4:01:03<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** chk_lb_hairpin_reply action not implemented<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ct_lb /* default <span class="o">(</span>use --ct to customize<span class="o">)</span> */ <span class="o">{</span>
                *** no OpenFlow flows<span class="p">;</span>
                *** no OpenFlow flows<span class="p">;</span>
                output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
            <span class="o">}</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
sh-5.1# ovn-trace --ct new --ct new --minimal  --ovs ext_ovn-worker <span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span> 
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
    *** no OpenFlow flows<span class="p">;</span>
    ct_lb <span class="o">{</span>
        *** no OpenFlow flows<span class="p">;</span>
        ip.ttl--<span class="p">;</span>
        eth.src <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span>
        eth.dst <span class="o">=</span> 0a:58:64:40:00:01<span class="p">;</span>
        ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ip.ttl--<span class="p">;</span>
            eth.src <span class="o">=</span> 0a:58:0a:f4:01:01<span class="p">;</span>
            eth.dst <span class="o">=</span> 0a:58:0a:f4:01:03<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** chk_lb_hairpin_reply action not implemented<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ct_lb /* default <span class="o">(</span>use --ct to customize<span class="o">)</span> */ <span class="o">{</span>
                *** no OpenFlow flows<span class="p">;</span>
                *** no OpenFlow flows<span class="p">;</span>
                output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
            <span class="o">}</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
sh-5.1# ovn-trace --ct new --ct new --ct new --minimal  --ovs ext_ovn-worker <span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span> 
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
    *** no OpenFlow flows<span class="p">;</span>
    ct_lb <span class="o">{</span>
        *** no OpenFlow flows<span class="p">;</span>
        ip.ttl--<span class="p">;</span>
        eth.src <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span>
        eth.dst <span class="o">=</span> 0a:58:64:40:00:01<span class="p">;</span>
        ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ip.ttl--<span class="p">;</span>
            eth.src <span class="o">=</span> 0a:58:0a:f4:01:01<span class="p">;</span>
            eth.dst <span class="o">=</span> 0a:58:0a:f4:01:03<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** chk_lb_hairpin_reply action not implemented<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ct_lb <span class="o">{</span>
                *** no OpenFlow flows<span class="p">;</span>
                *** no OpenFlow flows<span class="p">;</span>
                output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
            <span class="o">}</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
sh-5.1# 
</code></pre></div>
</td></tr></table></p>
<h4 id="specifying-tcp-flags-in-ovn-trace">Specifying TCP flags in ovn-trace</h4>
<p>It is also possible to provide the exact TCP flags. See RFC 793 for further details:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>  Control Bits:  6 bits (from left to right):

    URG:  Urgent Pointer field significant
    ACK:  Acknowledgment field significant
    PSH:  Push Function
    RST:  Reset the connection
    SYN:  Synchronize sequence numbers
    FIN:  No more data from sender
</code></pre></div>
</td></tr></table></p>
<p>A FIN is hence <code class="highlight"><span class="mf">0</span><span class="n">x1</span><span class="w"></span></code>, a SYN 0x2, a RST is 0x4, a PSH is 0x8, an ACK is 0x10, a SYN/ACK is 0x12 and so on.</p>
<p>The resulting ovn-trace command:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ovn-trace --minimal  --ovs ext_ovn-worker &#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007 &amp;&amp; tcp.flags == 0x2&#39; --ct new </span>
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=syn</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
    *** no OpenFlow flows<span class="p">;</span>
    ct_lb /* default <span class="o">(</span>use --ct to customize<span class="o">)</span> */ <span class="o">{</span>
        *** no OpenFlow flows<span class="p">;</span>
        ip.ttl--<span class="p">;</span>
        eth.src <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span>
        eth.dst <span class="o">=</span> 0a:58:64:40:00:01<span class="p">;</span>
        ct_dnat /* assuming no un-dnat entry, so no change */ <span class="o">{</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ip.ttl--<span class="p">;</span>
            eth.src <span class="o">=</span> 0a:58:0a:f4:01:01<span class="p">;</span>
            eth.dst <span class="o">=</span> 0a:58:0a:f4:01:03<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** chk_lb_hairpin_reply action not implemented<span class="p">;</span>
            reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
            *** no OpenFlow flows<span class="p">;</span>
            ct_lb /* default <span class="o">(</span>use --ct to customize<span class="o">)</span> */ <span class="o">{</span>
                *** no OpenFlow flows<span class="p">;</span>
                *** no OpenFlow flows<span class="p">;</span>
                output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
            <span class="o">}</span><span class="p">;</span>
        <span class="o">}</span><span class="p">;</span>
    <span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</code></pre></div>
</td></tr></table></p>
<h4 id="simulating-reverse-flows-through-conntrack">Simulating reverse flows through conntrack</h4>
<p>Let's continue with the earlier example. This time, let's simulate the the answer to the earlier flow. Unfortunately, something seems to go wrong:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ovn-trace --ct rpl,est --minimal  --ovs ovn-worker &#39;inport == &quot;default_nginx-deployment-9456bbbf9-x6pc6&quot; &amp;&amp; eth.src == 0a:58:0a:f4:01:03 &amp;&amp;  eth.dst == 0a:58:0a:f4:01:01 &amp;&amp; ip4.src == 10.244.1.3 &amp;&amp; ip4.dst == 100.64.0.3 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==80 &amp;&amp; tcp.dst == 47306&#39; </span>
<span class="c1"># tcp,reg14=0x3,vlan_tci=0x0000,dl_src=0a:58:0a:f4:01:03,dl_dst=0a:58:0a:f4:01:01,nw_src=10.244.1.3,nw_dst=100.64.0.3,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=80,tp_dst=47306,tcp_flags=0</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
ct_lb <span class="o">{</span>
    reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
    *** chk_lb_hairpin_reply action not implemented<span class="p">;</span>
    reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
    ip.ttl--<span class="p">;</span>
    eth.src <span class="o">=</span> 0a:58:64:40:00:01<span class="p">;</span>
    eth.dst <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
    *** no OpenFlow flows<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</code></pre></div>
</td></tr></table></p>
<p>What happens if we run a detailed trace:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ovn-trace --ct rpl,est --ovs ovn-worker &#39;inport == &quot;default_nginx-deployment-9456bbbf9-x6pc6&quot; &amp;&amp; eth.src == 0a:58:0a:f4:01:03 &amp;&amp;  eth.dst == 0a:58:0a:f4:01:01 &amp;&amp; ip4.src == 10.244.1.3 &amp;&amp; ip4.dst == 100.64.0.3 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==80 &amp;&amp; tcp.dst == 47306&#39; </span>
<span class="c1"># tcp,reg14=0x3,vlan_tci=0x0000,dl_src=0a:58:0a:f4:01:03,dl_dst=0a:58:0a:f4:01:01,nw_src=10.244.1.3,nw_dst=100.64.0.3,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=80,tp_dst=47306,tcp_flags=0</span>

ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;ovn-worker&quot;</span>, <span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span>
---------------------------------------------------------------------------
 <span class="m">0</span>. ls_in_port_sec_l2 <span class="o">(</span>northd.c:5497<span class="o">)</span>: <span class="nv">inport</span> <span class="o">==</span> <span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span> <span class="o">&amp;&amp;</span> eth.src <span class="o">==</span> <span class="o">{</span>0a:58:0a:f4:01:03<span class="o">}</span>, priority <span class="m">50</span>, uuid 7fade81c
    *** no OpenFlow flows
    next<span class="p">;</span>
 <span class="m">1</span>. ls_in_port_sec_ip <span class="o">(</span>northd.c:5130<span class="o">)</span>: <span class="nv">inport</span> <span class="o">==</span> <span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span> <span class="o">&amp;&amp;</span> eth.src <span class="o">==</span> 0a:58:0a:f4:01:03 <span class="o">&amp;&amp;</span> ip4.src <span class="o">==</span> <span class="o">{</span><span class="m">10</span>.244.1.3<span class="o">}</span>, priority <span class="m">90</span>, uuid 4d81359d
    *** no OpenFlow flows
    next<span class="p">;</span>
 <span class="m">5</span>. ls_in_pre_acl <span class="o">(</span>northd.c:5758<span class="o">)</span>: ip, priority <span class="m">100</span>, uuid 7d029aba
    <span class="nv">cookie</span><span class="o">=</span>0x7d029aba, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.183s, <span class="nv">table</span><span class="o">=</span><span class="m">13</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ipv6,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>set_field:0x1000000000000000000000000/0x1000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,14<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x7d029aba, <span class="nv">duration</span><span class="o">=</span><span class="m">22958</span>.578s, <span class="nv">table</span><span class="o">=</span><span class="m">13</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22958</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ip,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>set_field:0x1000000000000000000000000/0x1000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,14<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x7d029aba, <span class="nv">duration</span><span class="o">=</span><span class="m">22958</span>.578s, <span class="nv">table</span><span class="o">=</span><span class="m">13</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22958</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ipv6,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>set_field:0x1000000000000000000000000/0x1000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,14<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x7d029aba, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.182s, <span class="nv">table</span><span class="o">=</span><span class="m">13</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">260424</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">52306797</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ip,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>set_field:0x1000000000000000000000000/0x1000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,14<span class="o">)</span>
    reg0<span class="o">[</span><span class="m">0</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">6</span>. ls_in_pre_lb <span class="o">(</span>northd.c:5890<span class="o">)</span>: ip, priority <span class="m">100</span>, uuid 8a8d61ca
    <span class="nv">cookie</span><span class="o">=</span>0x8a8d61ca, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s, <span class="nv">table</span><span class="o">=</span><span class="m">14</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ipv6,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>set_field:0x4000000000000000000000000/0x4000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,15<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x8a8d61ca, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.204s, <span class="nv">table</span><span class="o">=</span><span class="m">14</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">260424</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">52306797</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ip,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>set_field:0x4000000000000000000000000/0x4000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,15<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x8a8d61ca, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.204s, <span class="nv">table</span><span class="o">=</span><span class="m">14</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ipv6,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>set_field:0x4000000000000000000000000/0x4000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,15<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x8a8d61ca, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s, <span class="nv">table</span><span class="o">=</span><span class="m">14</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ip,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>set_field:0x4000000000000000000000000/0x4000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,15<span class="o">)</span>
    reg0<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">7</span>. ls_in_pre_stateful <span class="o">(</span>northd.c:5917<span class="o">)</span>: reg0<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">==</span> <span class="m">1</span> <span class="o">&amp;&amp;</span> ip4 <span class="o">&amp;&amp;</span> tcp, priority <span class="m">120</span>, uuid 01fdf58b
    <span class="nv">cookie</span><span class="o">=</span>0x1fdf58b, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s, <span class="nv">table</span><span class="o">=</span><span class="m">15</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">120</span>,tcp,reg0<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>move:NXM_OF_IP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">64</span>..95<span class="o">]</span>,move:NXM_OF_TCP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">32</span>..47<span class="o">]</span>,ct<span class="o">(</span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,zone<span class="o">=</span>NXM_NX_REG13<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span>,nat<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x1fdf58b, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s, <span class="nv">table</span><span class="o">=</span><span class="m">15</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">120</span>,tcp,reg0<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x8 <span class="nv">actions</span><span class="o">=</span>move:NXM_OF_IP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">64</span>..95<span class="o">]</span>,move:NXM_OF_TCP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">32</span>..47<span class="o">]</span>,ct<span class="o">(</span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,zone<span class="o">=</span>NXM_NX_REG13<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span>,nat<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x1fdf58b, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.204s, <span class="nv">table</span><span class="o">=</span><span class="m">15</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">260424</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">52306797</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">120</span>,tcp,reg0<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>move:NXM_OF_IP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">64</span>..95<span class="o">]</span>,move:NXM_OF_TCP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">32</span>..47<span class="o">]</span>,ct<span class="o">(</span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,zone<span class="o">=</span>NXM_NX_REG13<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span>,nat<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x1fdf58b, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.232s, <span class="nv">table</span><span class="o">=</span><span class="m">15</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">120</span>,tcp,reg0<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x2 <span class="nv">actions</span><span class="o">=</span>move:NXM_OF_IP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">64</span>..95<span class="o">]</span>,move:NXM_OF_TCP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">32</span>..47<span class="o">]</span>,ct<span class="o">(</span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,zone<span class="o">=</span>NXM_NX_REG13<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span>,nat<span class="o">)</span>
    <span class="nv">reg1</span> <span class="o">=</span> ip4.dst<span class="p">;</span>
    reg2<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span> <span class="o">=</span> tcp.dst<span class="p">;</span>
    ct_lb<span class="p">;</span>

ct_lb
-----
 <span class="m">8</span>. ls_in_acl_hint <span class="o">(</span>northd.c:6041<span class="o">)</span>: ct.est <span class="o">&amp;&amp;</span> ct_label.blocked <span class="o">==</span> <span class="m">0</span>, priority <span class="m">1</span>, uuid a17a896f
    <span class="nv">cookie</span><span class="o">=</span>0xa17a896f, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s, <span class="nv">table</span><span class="o">=</span><span class="m">16</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,17<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0xa17a896f, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.204s, <span class="nv">table</span><span class="o">=</span><span class="m">16</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">128010</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">31684495</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,17<span class="o">)</span>
    reg0<span class="o">[</span><span class="m">10</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">9</span>. ls_in_acl <span class="o">(</span>northd.c:6471<span class="o">)</span>: ct.est <span class="o">&amp;&amp;</span> !ct.rel <span class="o">&amp;&amp;</span> !ct.new <span class="o">&amp;&amp;</span> !ct.inv <span class="o">&amp;&amp;</span> ct.rpl <span class="o">&amp;&amp;</span> ct_label.blocked <span class="o">==</span> <span class="m">0</span>, priority <span class="m">65532</span>, uuid 5ae98b31
    <span class="nv">cookie</span><span class="o">=</span>0x5ae98b31, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s, <span class="nv">table</span><span class="o">=</span><span class="m">17</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">65532</span>,ct_state<span class="o">=</span>-new+est-rel+rpl-inv+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,18<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x5ae98b31, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.215s, <span class="nv">table</span><span class="o">=</span><span class="m">17</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">128010</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">31684495</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">65532</span>,ct_state<span class="o">=</span>-new+est-rel+rpl-inv+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,18<span class="o">)</span>
    next<span class="p">;</span>
<span class="m">13</span>. ls_in_pre_hairpin <span class="o">(</span>northd.c:6801<span class="o">)</span>: ip <span class="o">&amp;&amp;</span> ct.trk, priority <span class="m">100</span>, uuid 2520b1a4
    <span class="nv">cookie</span><span class="o">=</span>0x2520b1a4, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s, <span class="nv">table</span><span class="o">=</span><span class="m">21</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ct_state<span class="o">=</span>+trk,ip,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,68<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">102</span><span class="o">]</span>,set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,69<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">108</span><span class="o">]</span>,resubmit<span class="o">(</span>,22<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x2520b1a4, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.215s, <span class="nv">table</span><span class="o">=</span><span class="m">21</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ct_state<span class="o">=</span>+trk,ipv6,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,68<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">102</span><span class="o">]</span>,set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,69<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">108</span><span class="o">]</span>,resubmit<span class="o">(</span>,22<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x2520b1a4, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.215s, <span class="nv">table</span><span class="o">=</span><span class="m">21</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">251254</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">51628217</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ct_state<span class="o">=</span>+trk,ip,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,68<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">102</span><span class="o">]</span>,set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,69<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">108</span><span class="o">]</span>,resubmit<span class="o">(</span>,22<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x2520b1a4, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s, <span class="nv">table</span><span class="o">=</span><span class="m">21</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ct_state<span class="o">=</span>+trk,ipv6,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,68<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">102</span><span class="o">]</span>,set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,69<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">108</span><span class="o">]</span>,resubmit<span class="o">(</span>,22<span class="o">)</span>
    reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span> <span class="o">=</span> chk_lb_hairpin<span class="o">()</span><span class="p">;</span>
    reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span> <span class="o">=</span> chk_lb_hairpin_reply<span class="o">()</span><span class="p">;</span>
    *** chk_lb_hairpin_reply action not implemented
    next<span class="p">;</span>
<span class="m">22</span>. ls_in_l2_lkup <span class="o">(</span>northd.c:8292<span class="o">)</span>: eth.dst <span class="o">==</span> 0a:58:0a:f4:01:01, priority <span class="m">50</span>, uuid e7b71eee
    *** no OpenFlow flows
    <span class="nv">outport</span> <span class="o">=</span> <span class="s2">&quot;stor-ovn-worker&quot;</span><span class="p">;</span>
    output<span class="p">;</span>

egress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;ovn-worker&quot;</span>, <span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span>, <span class="nv">outport</span><span class="o">=</span><span class="s2">&quot;stor-ovn-worker&quot;</span><span class="o">)</span>
-----------------------------------------------------------------------------------------------------
 <span class="m">0</span>. ls_out_pre_lb <span class="o">(</span>northd.c:5647<span class="o">)</span>: ip <span class="o">&amp;&amp;</span> <span class="nv">outport</span> <span class="o">==</span> <span class="s2">&quot;stor-ovn-worker&quot;</span>, priority <span class="m">110</span>, uuid a85134e9
    *** no OpenFlow flows
    next<span class="p">;</span>
 <span class="m">1</span>. ls_out_pre_acl <span class="o">(</span>northd.c:5647<span class="o">)</span>: ip <span class="o">&amp;&amp;</span> <span class="nv">outport</span> <span class="o">==</span> <span class="s2">&quot;stor-ovn-worker&quot;</span>, priority <span class="m">110</span>, uuid 473dc0a5
    *** no OpenFlow flows
    next<span class="p">;</span>
 <span class="m">3</span>. ls_out_acl_hint <span class="o">(</span>northd.c:6041<span class="o">)</span>: ct.est <span class="o">&amp;&amp;</span> ct_label.blocked <span class="o">==</span> <span class="m">0</span>, priority <span class="m">1</span>, uuid 5f2e1810
    <span class="nv">cookie</span><span class="o">=</span>0x5f2e1810, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s, <span class="nv">table</span><span class="o">=</span><span class="m">43</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,44<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x5f2e1810, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.216s, <span class="nv">table</span><span class="o">=</span><span class="m">43</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">128010</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">31684495</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,44<span class="o">)</span>
    reg0<span class="o">[</span><span class="m">10</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">4</span>. ls_out_acl <span class="o">(</span>northd.c:6473<span class="o">)</span>: ct.est <span class="o">&amp;&amp;</span> !ct.rel <span class="o">&amp;&amp;</span> !ct.new <span class="o">&amp;&amp;</span> !ct.inv <span class="o">&amp;&amp;</span> ct.rpl <span class="o">&amp;&amp;</span> ct_label.blocked <span class="o">==</span> <span class="m">0</span>, priority <span class="m">65532</span>, uuid 72e85294
    <span class="nv">cookie</span><span class="o">=</span>0x72e85294, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s, <span class="nv">table</span><span class="o">=</span><span class="m">44</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">65532</span>,ct_state<span class="o">=</span>-new+est-rel+rpl-inv+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,45<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x72e85294, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.216s, <span class="nv">table</span><span class="o">=</span><span class="m">44</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">128010</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">31684495</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">65532</span>,ct_state<span class="o">=</span>-new+est-rel+rpl-inv+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,45<span class="o">)</span>
    next<span class="p">;</span>
 <span class="m">9</span>. ls_out_port_sec_l2 <span class="o">(</span>northd.c:5594<span class="o">)</span>: <span class="nv">outport</span> <span class="o">==</span> <span class="s2">&quot;stor-ovn-worker&quot;</span>, priority <span class="m">50</span>, uuid ae50e49e
    *** no OpenFlow flows
    output<span class="p">;</span>
    /* output to <span class="s2">&quot;stor-ovn-worker&quot;</span>, <span class="nb">type</span> <span class="s2">&quot;patch&quot;</span> */

ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;ovn_cluster_router&quot;</span>, <span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;rtos-ovn-worker&quot;</span><span class="o">)</span>
----------------------------------------------------------
 <span class="m">0</span>. lr_in_admission <span class="o">(</span>northd.c:10523<span class="o">)</span>: eth.dst <span class="o">==</span> 0a:58:0a:f4:01:01 <span class="o">&amp;&amp;</span> <span class="nv">inport</span> <span class="o">==</span> <span class="s2">&quot;rtos-ovn-worker&quot;</span> <span class="o">&amp;&amp;</span> is_chassis_resident<span class="o">(</span><span class="s2">&quot;cr-rtos-ovn-worker&quot;</span><span class="o">)</span>, priority <span class="m">50</span>, uuid 16833f18
    *** no OpenFlow flows
    xreg0<span class="o">[</span><span class="m">0</span>..47<span class="o">]</span> <span class="o">=</span> 0a:58:0a:f4:01:01<span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">1</span>. lr_in_lookup_neighbor <span class="o">(</span>northd.c:10667<span class="o">)</span>: <span class="m">1</span>, priority <span class="m">0</span>, uuid <span class="m">39881020</span>
    <span class="nv">cookie</span><span class="o">=</span>0x39881020, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s, <span class="nv">table</span><span class="o">=</span><span class="m">9</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">84769</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">16419002</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x39881020, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s, <span class="nv">table</span><span class="o">=</span><span class="m">9</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">34573</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">3262795</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
    reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">2</span>. lr_in_learn_neighbor <span class="o">(</span>northd.c:10676<span class="o">)</span>: reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">==</span> <span class="m">1</span> <span class="o">||</span> reg9<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">==</span> <span class="m">0</span>, priority <span class="m">100</span>, uuid 6be9d860
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">84769</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">16419002</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.183s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">34585</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">3263563</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">869</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">39094</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">29</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    next<span class="p">;</span>
<span class="m">10</span>. lr_in_ip_routing_pre <span class="o">(</span>northd.c:10910<span class="o">)</span>: <span class="m">1</span>, priority <span class="m">0</span>, uuid 219bc578
    <span class="nv">cookie</span><span class="o">=</span>0x219bc578, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s, <span class="nv">table</span><span class="o">=</span><span class="m">18</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">84764</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">16418452</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>set_field:0/0xffffffff-&gt;xxreg1,resubmit<span class="o">(</span>,19<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x219bc578, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.183s, <span class="nv">table</span><span class="o">=</span><span class="m">18</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">34561</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">3261195</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>set_field:0/0xffffffff-&gt;xxreg1,resubmit<span class="o">(</span>,19<span class="o">)</span>
    <span class="nv">reg7</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
    next<span class="p">;</span>
<span class="m">11</span>. lr_in_ip_routing <span class="o">(</span>northd.c:9439<span class="o">)</span>: <span class="nv">reg7</span> <span class="o">==</span> <span class="m">0</span> <span class="o">&amp;&amp;</span> ip4.dst <span class="o">==</span> <span class="m">100</span>.64.0.3/32, priority <span class="m">97</span>, uuid 4b1e23e5
    <span class="nv">cookie</span><span class="o">=</span>0x4b1e23e5, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s, <span class="nv">table</span><span class="o">=</span><span class="m">19</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">97</span>,ip,reg7<span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1,nw_dst<span class="o">=</span><span class="m">100</span>.64.0.3 <span class="nv">actions</span><span class="o">=</span>dec_ttl<span class="o">()</span>,set_field:0/0xffff00000000-&gt;xreg4,set_field:0x64400003000000000000000000000000/0xffffffff000000000000000000000000-&gt;xxreg0,set_field:0x644000010000000000000000/0xffffffff0000000000000000-&gt;xxreg0,set_field:0a:58:64:40:00:01-&gt;eth_src,set_field:0x1-&gt;reg15,set_field:0x1/0x1-&gt;reg10,resubmit<span class="o">(</span>,20<span class="o">)</span>
    ip.ttl--<span class="p">;</span>
    reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="nv">reg0</span> <span class="o">=</span> <span class="m">100</span>.64.0.3<span class="p">;</span>
    <span class="nv">reg1</span> <span class="o">=</span> <span class="m">100</span>.64.0.1<span class="p">;</span>
    eth.src <span class="o">=</span> 0a:58:64:40:00:01<span class="p">;</span>
    <span class="nv">outport</span> <span class="o">=</span> <span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span><span class="p">;</span>
    flags.loopback <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
<span class="m">12</span>. lr_in_ip_routing_ecmp <span class="o">(</span>northd.c:10985<span class="o">)</span>: reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span> <span class="o">==</span> <span class="m">0</span>, priority <span class="m">150</span>, uuid f65895a6
    <span class="nv">cookie</span><span class="o">=</span>0xf65895a6, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s, <span class="nv">table</span><span class="o">=</span><span class="m">20</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">84764</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">16418452</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">150</span>,reg8<span class="o">=</span><span class="m">0</span>/0xffff,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,21<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0xf65895a6, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.186s, <span class="nv">table</span><span class="o">=</span><span class="m">20</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">21</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">2064</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">14155</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">150</span>,reg8<span class="o">=</span><span class="m">0</span>/0xffff,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,21<span class="o">)</span>
    next<span class="p">;</span>
<span class="m">13</span>. lr_in_policy <span class="o">(</span>northd.c:8672<span class="o">)</span>: ip4.src <span class="o">==</span> <span class="m">10</span>.244.0.0/16 <span class="o">&amp;&amp;</span> ip4.dst <span class="o">==</span> <span class="m">100</span>.64.0.0/16, priority <span class="m">101</span>, uuid f385bfe8
    <span class="nv">cookie</span><span class="o">=</span>0xf385bfe8, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s, <span class="nv">table</span><span class="o">=</span><span class="m">21</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">101</span>,ip,metadata<span class="o">=</span>0x1,nw_src<span class="o">=</span><span class="m">10</span>.244.0.0/16,nw_dst<span class="o">=</span><span class="m">100</span>.64.0.0/16 <span class="nv">actions</span><span class="o">=</span>set_field:0/0xffff00000000-&gt;xreg4,resubmit<span class="o">(</span>,22<span class="o">)</span>
    reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
    next<span class="p">;</span>
<span class="m">14</span>. lr_in_policy_ecmp <span class="o">(</span>northd.c:11120<span class="o">)</span>: reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span> <span class="o">==</span> <span class="m">0</span>, priority <span class="m">150</span>, uuid e3a1301b
    <span class="nv">cookie</span><span class="o">=</span>0xe3a1301b, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s, <span class="nv">table</span><span class="o">=</span><span class="m">22</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">84764</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">16418452</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">150</span>,reg8<span class="o">=</span><span class="m">0</span>/0xffff,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,23<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0xe3a1301b, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.186s, <span class="nv">table</span><span class="o">=</span><span class="m">22</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">21</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">2064</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">14155</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">150</span>,reg8<span class="o">=</span><span class="m">0</span>/0xffff,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,23<span class="o">)</span>
    next<span class="p">;</span>
<span class="m">15</span>. lr_in_arp_resolve <span class="o">(</span>northd.c:11506<span class="o">)</span>: <span class="nv">outport</span> <span class="o">==</span> <span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">reg0</span> <span class="o">==</span> <span class="m">100</span>.64.0.3, priority <span class="m">100</span>, uuid 33f04862
    <span class="nv">cookie</span><span class="o">=</span>0x33f04862, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s, <span class="nv">table</span><span class="o">=</span><span class="m">23</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg0<span class="o">=</span>0x64400003,reg15<span class="o">=</span>0x1,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>set_field:0a:58:64:40:00:03-&gt;eth_dst,resubmit<span class="o">(</span>,24<span class="o">)</span>
    eth.dst <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span>
    next<span class="p">;</span>
<span class="m">19</span>. lr_in_arp_request <span class="o">(</span>northd.c:11801<span class="o">)</span>: <span class="m">1</span>, priority <span class="m">0</span>, uuid 0abbeff8
    <span class="nv">cookie</span><span class="o">=</span>0xabbeff8, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s, <span class="nv">table</span><span class="o">=</span><span class="m">27</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">84764</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">16418452</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,37<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0xabbeff8, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s, <span class="nv">table</span><span class="o">=</span><span class="m">27</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">20</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">1990</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">14155</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,37<span class="o">)</span>
    output<span class="p">;</span>

egress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;ovn_cluster_router&quot;</span>, <span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;rtos-ovn-worker&quot;</span>, <span class="nv">outport</span><span class="o">=</span><span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span><span class="o">)</span>
--------------------------------------------------------------------------------------------
 <span class="m">0</span>. lr_out_chk_dnat_local <span class="o">(</span>northd.c:13026<span class="o">)</span>: <span class="m">1</span>, priority <span class="m">0</span>, uuid a02f42a1
    <span class="nv">cookie</span><span class="o">=</span>0xa02f42a1, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s, <span class="nv">table</span><span class="o">=</span><span class="m">40</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">84752</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">16417482</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>set_field:0/0x10-&gt;xreg4,resubmit<span class="o">(</span>,41<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0xa02f42a1, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s, <span class="nv">table</span><span class="o">=</span><span class="m">40</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">465</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">21988</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">29</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>set_field:0/0x10-&gt;xreg4,resubmit<span class="o">(</span>,41<span class="o">)</span>
    reg9<span class="o">[</span><span class="m">4</span><span class="o">]</span> <span class="o">=</span> <span class="m">0</span><span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">6</span>. lr_out_delivery <span class="o">(</span>northd.c:11848<span class="o">)</span>: <span class="nv">outport</span> <span class="o">==</span> <span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span>, priority <span class="m">100</span>, uuid 5428c7e9
    <span class="nv">cookie</span><span class="o">=</span>0x5428c7e9, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s, <span class="nv">table</span><span class="o">=</span><span class="m">46</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg15<span class="o">=</span>0x1,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,64<span class="o">)</span>
    output<span class="p">;</span>
    /* output to <span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span>, <span class="nb">type</span> <span class="s2">&quot;patch&quot;</span> */

ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;join&quot;</span>, <span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;jtor-ovn_cluster_router&quot;</span><span class="o">)</span>
----------------------------------------------------
 <span class="m">0</span>. ls_in_port_sec_l2 <span class="o">(</span>northd.c:5497<span class="o">)</span>: <span class="nv">inport</span> <span class="o">==</span> <span class="s2">&quot;jtor-ovn_cluster_router&quot;</span>, priority <span class="m">50</span>, uuid 485af0cc
    <span class="nv">cookie</span><span class="o">=</span>0x485af0cc, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s, <span class="nv">table</span><span class="o">=</span><span class="m">8</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">50</span>,reg14<span class="o">=</span>0x1,metadata<span class="o">=</span>0x2 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,9<span class="o">)</span>
    next<span class="p">;</span>
 <span class="m">6</span>. ls_in_pre_lb <span class="o">(</span>northd.c:5644<span class="o">)</span>: ip <span class="o">&amp;&amp;</span> <span class="nv">inport</span> <span class="o">==</span> <span class="s2">&quot;jtor-ovn_cluster_router&quot;</span>, priority <span class="m">110</span>, uuid 61c2f8b4
    <span class="nv">cookie</span><span class="o">=</span>0x61c2f8b4, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s, <span class="nv">table</span><span class="o">=</span><span class="m">14</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">110</span>,ipv6,reg14<span class="o">=</span>0x1,metadata<span class="o">=</span>0x2 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,15<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x61c2f8b4, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s, <span class="nv">table</span><span class="o">=</span><span class="m">14</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">110</span>,ip,reg14<span class="o">=</span>0x1,metadata<span class="o">=</span>0x2 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,15<span class="o">)</span>
    next<span class="p">;</span>
<span class="m">22</span>. ls_in_l2_lkup <span class="o">(</span>northd.c:8292<span class="o">)</span>: eth.dst <span class="o">==</span> 0a:58:64:40:00:03, priority <span class="m">50</span>, uuid 4ec697e3
    <span class="nv">cookie</span><span class="o">=</span>0x4ec697e3, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s, <span class="nv">table</span><span class="o">=</span><span class="m">30</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">50</span>,metadata<span class="o">=</span>0x2,dl_dst<span class="o">=</span>0a:58:64:40:00:03 <span class="nv">actions</span><span class="o">=</span>set_field:0x2-&gt;reg15,resubmit<span class="o">(</span>,37<span class="o">)</span>
    <span class="nv">outport</span> <span class="o">=</span> <span class="s2">&quot;jtor-GR_ovn-worker&quot;</span><span class="p">;</span>
    output<span class="p">;</span>

egress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;join&quot;</span>, <span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;jtor-ovn_cluster_router&quot;</span>, <span class="nv">outport</span><span class="o">=</span><span class="s2">&quot;jtor-GR_ovn-worker&quot;</span><span class="o">)</span>
---------------------------------------------------------------------------------
 <span class="m">0</span>. ls_out_pre_lb <span class="o">(</span>northd.c:5647<span class="o">)</span>: ip <span class="o">&amp;&amp;</span> <span class="nv">outport</span> <span class="o">==</span> <span class="s2">&quot;jtor-GR_ovn-worker&quot;</span>, priority <span class="m">110</span>, uuid ff3a234e
    *** no OpenFlow flows
    next<span class="p">;</span>
 <span class="m">9</span>. ls_out_port_sec_l2 <span class="o">(</span>northd.c:5594<span class="o">)</span>: <span class="nv">outport</span> <span class="o">==</span> <span class="s2">&quot;jtor-GR_ovn-worker&quot;</span>, priority <span class="m">50</span>, uuid <span class="m">65252832</span>
    *** no OpenFlow flows
    output<span class="p">;</span>
    /* output to <span class="s2">&quot;jtor-GR_ovn-worker&quot;</span>, <span class="nb">type</span> <span class="s2">&quot;l3gateway&quot;</span> */

ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;GR_ovn-worker&quot;</span>, <span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span><span class="o">)</span>
--------------------------------------------------------
 <span class="m">0</span>. lr_in_admission <span class="o">(</span>northd.c:10523<span class="o">)</span>: eth.dst <span class="o">==</span> 0a:58:64:40:00:03 <span class="o">&amp;&amp;</span> <span class="nv">inport</span> <span class="o">==</span> <span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span>, priority <span class="m">50</span>, uuid edfaf0af
    *** no OpenFlow flows
    xreg0<span class="o">[</span><span class="m">0</span>..47<span class="o">]</span> <span class="o">=</span> 0a:58:64:40:00:03<span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">1</span>. lr_in_lookup_neighbor <span class="o">(</span>northd.c:10667<span class="o">)</span>: <span class="m">1</span>, priority <span class="m">0</span>, uuid <span class="m">39881020</span>
    <span class="nv">cookie</span><span class="o">=</span>0x39881020, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s, <span class="nv">table</span><span class="o">=</span><span class="m">9</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">84769</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">16419002</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x39881020, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.185s, <span class="nv">table</span><span class="o">=</span><span class="m">9</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">34573</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">3262795</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
    reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">=</span> <span class="m">1</span><span class="p">;</span>
    next<span class="p">;</span>
 <span class="m">2</span>. lr_in_learn_neighbor <span class="o">(</span>northd.c:10676<span class="o">)</span>: reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span> <span class="o">==</span> <span class="m">1</span> <span class="o">||</span> reg9<span class="o">[</span><span class="m">3</span><span class="o">]</span> <span class="o">==</span> <span class="m">0</span>, priority <span class="m">100</span>, uuid 6be9d860
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.219s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">84769</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">16419002</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.185s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">34585</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">3263563</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.186s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">869</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">39094</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">29</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x9 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    <span class="nv">cookie</span><span class="o">=</span>0x6be9d860, <span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.219s, <span class="nv">table</span><span class="o">=</span><span class="m">10</span>, <span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>, <span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>, <span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x1 <span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
    next<span class="p">;</span>
 <span class="m">4</span>. lr_in_unsnat <span class="o">(</span>northd.c:10378<span class="o">)</span>: <span class="nv">inport</span> <span class="o">==</span> <span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span> <span class="o">&amp;&amp;</span> ip4.dst <span class="o">==</span> <span class="m">100</span>.64.0.3, priority <span class="m">110</span>, uuid e548aaeb
    *** no OpenFlow flows
    ct_snat<span class="p">;</span>
</code></pre></div>
</td></tr></table></p>
<p>We can see that we hit <code class="highlight">ct_snat</code> in the <code class="highlight">ingress</code> pipeline of <code class="highlight">GR_ovn-worker</code>:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ovn-sbctl dump-flows</span>
<span class="o">(</span>...<span class="o">)</span>
Datapath: <span class="s2">&quot;GR_ovn-worker&quot;</span> <span class="o">(</span>15e72dff-677d-4794-8f70-a5fea49ad788<span class="o">)</span>  Pipeline: ingress
<span class="o">(</span>...<span class="o">)</span>
  <span class="nv">table</span><span class="o">=</span><span class="m">4</span> <span class="o">(</span>lr_in_unsnat       <span class="o">)</span>, <span class="nv">priority</span><span class="o">=</span><span class="m">110</span>  , <span class="nv">match</span><span class="o">=(</span><span class="nv">inport</span> <span class="o">==</span> <span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span> <span class="o">&amp;&amp;</span> ip4.dst <span class="o">==</span> <span class="m">100</span>.64.0.3<span class="o">)</span>, <span class="nv">action</span><span class="o">=(</span>ct_snat<span class="p">;</span><span class="o">)</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div>
</td></tr></table></p>
<p>Now, here, we hit an unfortunate shortcoming of ovn-trace - it does not what to do due to missing conntrack entries, and thus on a gatway router it will treat <code class="highlight">ct_snat</code> as if this was a noop:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>      This action distinguishes between gateway routers and distributed
      routers.  A gateway router is defined as a logical datapath that contains
      an <span class="nt">&lt;code&gt;</span>l3gateway<span class="nt">&lt;/code&gt;</span> port; any other logical datapath is a
      distributed router.  On a gateway router, <span class="nt">&lt;code&gt;</span>ct_snat;<span class="nt">&lt;/code&gt;</span> is
      treated as a no-op.  On a distributed router, it is treated the same way
      as <span class="nt">&lt;code&gt;</span>ct_dnat;<span class="nt">&lt;/code&gt;</span>.
</code></pre></div>
</td></tr></table>
From: <a href="https://github.com/ovn-org/ovn/blob/ed81be75e8b3b33745eeb9b6ce2686b87ef72cd0/utilities/ovn-trace.8.xml#L242">https://github.com/ovn-org/ovn/blob/ed81be75e8b3b33745eeb9b6ce2686b87ef72cd0/utilities/ovn-trace.8.xml#L242</a></p>
<p>For our example, this means that the processing stops here, and that we have to figure out ourselves what would happen here. We know that the loadbalancer should rewrite the DNAT and SNAT that was done initially, and we can simply run a new trace. First, though, we have to find out from where.</p>
<p>We know that the packet will go out of <code class="highlight">GR_ovn-worker</code> and from port <code class="highlight">rtoe-GR_ovn-worker</code>:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># ovn-nbctl show</span>
<span class="o">(</span>...<span class="o">)</span>
switch 214f4d51-750d-414a-aad1-94e84e623f9b <span class="o">(</span>ext_ovn-worker<span class="o">)</span>
    port breth0_ovn-worker
        type: localnet
        addresses: <span class="o">[</span><span class="s2">&quot;unknown&quot;</span><span class="o">]</span>
    port etor-GR_ovn-worker
        type: router
        addresses: <span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:04&quot;</span><span class="o">]</span>
        router-port: rtoe-GR_ovn-worker
<span class="o">(</span>...<span class="o">)</span>
router 5ea87f54-ceeb-442a-92c8-4b522278b5dd <span class="o">(</span>GR_ovn-worker<span class="o">)</span>
    port rtoj-GR_ovn-worker
        mac: <span class="s2">&quot;0a:58:64:40:00:03&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;100.64.0.3/16&quot;</span><span class="o">]</span>
    port rtoe-GR_ovn-worker
        mac: <span class="s2">&quot;02:42:ac:12:00:04&quot;</span>
        networks: <span class="o">[</span><span class="s2">&quot;172.18.0.4/16&quot;</span><span class="o">]</span>
    nat ca3ef3e0-22c1-427d-a977-b10256a96177
        external ip: <span class="s2">&quot;172.18.0.4&quot;</span>
        logical ip: <span class="s2">&quot;10.244.0.0/16&quot;</span>
        type: <span class="s2">&quot;snat&quot;</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div>
</td></tr></table></p>
<p>Let's find the switch port that matches this router port:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sh-5.1# ovn-nbctl find logical_switch_port <span class="s2">&quot;options={router-port=rtoe-GR_ovn-worker}&quot;</span>
_uuid               : 2b6e5ae2-a67f-4526-8b53-316a265a1acc
addresses           : <span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:04&quot;</span><span class="o">]</span>
dhcpv4_options      : <span class="o">[]</span>
dhcpv6_options      : <span class="o">[]</span>
dynamic_addresses   : <span class="o">[]</span>
enabled             : <span class="o">[]</span>
external_ids        : <span class="o">{}</span>
ha_chassis_group    : <span class="o">[]</span>
name                : etor-GR_ovn-worker
options             : <span class="o">{</span>router-port<span class="o">=</span>rtoe-GR_ovn-worker<span class="o">}</span>
parent_name         : <span class="o">[]</span>
port_security       : <span class="o">[]</span>
tag                 : <span class="o">[]</span>
tag_request         : <span class="o">[]</span>
<span class="nb">type</span>                : router
up                  : <span class="nb">true</span>
</code></pre></div>
</td></tr></table></p>
<p>And now, we can craft the ovn-trace command that shows our packet is indeed leaving on <code class="highlight">breth0_ovn-worker</code>:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sh-5.1# ovn-trace --ct est,rpl --ovs ext_ovn-worker <span class="s1">&#39;inport == &quot;etor-GR_ovn-worker&quot; &amp;&amp; eth.src == 02:42:ac:12:00:04 &amp;&amp;  eth.dst == 02:42:7a:79:82:ca &amp;&amp; ip4.src == 171.18.0.4 &amp;&amp; ip4.dst == 171.18.0.1 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==30007 &amp;&amp; tcp.dst == 47306&#39;</span>  --minimal
<span class="c1"># tcp,reg14=0x2,vlan_tci=0x0000,dl_src=02:42:ac:12:00:04,dl_dst=02:42:7a:79:82:ca,nw_src=171.18.0.4,nw_dst=171.18.0.1,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=30007,tp_dst=47306,tcp_flags=0</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
*** no OpenFlow flows<span class="p">;</span>
output<span class="o">(</span><span class="s2">&quot;breth0_ovn-worker&quot;</span><span class="o">)</span><span class="p">;</span>
sh-5.1# 
</code></pre></div>
</td></tr></table></p>
<h2 id="sources-and-references">Sources and references</h2>
<p>Man pages:</p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man8/ovn-trace.8.html">https://man7.org/linux/man-pages/man8/ovn-trace.8.html</a></li>
<li><a href="https://man7.org/linux/man-pages/man5/ovn-sb.5.html">https://man7.org/linux/man-pages/man5/ovn-sb.5.html</a></li>
</ul>
<p>Some discussion around ovn-trace:</p>
<ul>
<li><a href="https://www.mail-archive.com/ovs-discuss@openvswitch.org/msg07214.html">https://www.mail-archive.com/ovs-discuss@openvswitch.org/msg07214.html</a></li>
</ul>
<p>Examples for ovn-trace commands can be found inside the OVN test cases:</p>
<ul>
<li><a href="https://www.mail-archive.com/ovs-dev@openvswitch.org/msg55608.html">https://www.mail-archive.com/ovs-dev@openvswitch.org/msg55608.html</a></li>
<li>Simple test cases with <code class="highlight">--ct new</code>: <a href="https://github.com/ovn-org/ovn/blob/main/tests/ovn-northd.at">https://github.com/ovn-org/ovn/blob/main/tests/ovn-northd.at</a></li>
<li>More complex test cases: <a href="https://github.com/ovn-org/ovn/blob/main/tests/ovn.at">https://github.com/ovn-org/ovn/blob/main/tests/ovn.at</a></li>
</ul>
<p>RFCs:</p>
<ul>
<li><a href="https://datatracker.ietf.org/doc/html/rfc793#section-3.1">https://datatracker.ietf.org/doc/html/rfc793#section-3.1</a></li>
</ul>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">February 16, 2022</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../ovs_with_gdb/" class="md-footer__link md-footer__link--prev" aria-label="Previous: OVS with GDB" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              OVS with GDB
            </div>
          </div>
        </a>
      
      
        
        <a href="../sctp/" class="md-footer__link md-footer__link--next" aria-label="Next: SCTP" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              SCTP
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.prune", "navigation.top", "navigation.path"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>