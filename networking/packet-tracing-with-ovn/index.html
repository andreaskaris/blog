
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Andreas Karis' blog about anything Kubernetes, OpenShift, Linux and Networking">
      
      
      
        <link rel="canonical" href="https://andreaskaris.github.io/blog/networking/packet-tracing-with-ovn/">
      
      
        <link rel="prev" href="../ovs_with_gdb/">
      
      
        <link rel="next" href="../sctp/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Packet tracing with OVN - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="RSS feed of created content" href="https://andreaskaris.github.io/blog/feed_rss_created.xml">
  <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="https://andreaskaris.github.io/blog/feed_rss_updated.xml">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Packet tracing with OVN
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ceph/" class="md-tabs__link">
          
  
    
  
  Ceph

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux/" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Networking

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openshift/" class="md-tabs__link">
          
  
    
  
  OpenShift and Kubernetes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openstack/" class="md-tabs__link">
          
  
    
  
  OpenStack

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../coding/" class="md-tabs__link">
          
  
    
  
  Coding

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  
    
    <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ceph/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ceph
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ceph
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ceph/ceph-manual-test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ceph manual test with qemu
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../linux/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cgroups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containers in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/hugepages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugepages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/ipxe-boot-environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iPXE boot environment on Fedora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/java-idrac-issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java Idrac Issues
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/meson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    meson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    namespaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/old_java_version_with_xorgs_in_container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Old Java inside a container with xorgs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/org-gnome-shell-overrides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workaround for org.gnome.shell.overrides not installed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/get-process-cgroup-info-and-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retrieving process cgroup resource usage and limit info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/libvirt-uefi-without-secureboot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RHEL Booting a virtual machine with UEFI but without secure boot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/setting-journalctl-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting journalctl limits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups_cpu_quota/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using cgroups for CFS bandwidth control
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Networking
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Networking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../accept-source-routing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accept Source Routing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arp_and_the_neighbor_table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ARP and the Neighbor table
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bpf-and-tcpdump/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BPF and tcpdump
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bonding_in_linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bonding in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../juniper_x520/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure Juniper switch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ovn-interconnection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hands-on with OVN Interconnection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../haproxy-and-h2c/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    haproxy and HTTP/2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install-openvswitch-on-rocky/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Open vSwitch on Rocky Linux 8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../geneve_tunneling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Geneve tunneling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../netlink/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Netlink
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ovn_standalone_on_fedora/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVN standalone on Fedora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ovs_recirculation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS packet recirculation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ovs-vxlan-tunnels-and-dscp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS VXLAN tunnels and DSCP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ovs_with_gdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS with GDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Packet tracing with OVN
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sctp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../useful-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wireguard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wireguard
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../openshift/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenShift and Kubernetes
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            OpenShift and Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/alertmanager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AlertManager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/analyzing-cni/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analyzing CNI calls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ocp-custom-release-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building custom release images for OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/cpu-manager-with-custom-machine-config-pool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPU manager with custom MachineConfigPool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/crio-conmon-runc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crio vs conmon vs runc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/dedicated-service-monitors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DedicatedServiceMonitors in OpenShift Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/etcd_perf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Etcd Performance tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/get-vs-list-api-calls/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get vs List API Calls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_httpbin_tshark_sidecar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Httpbin tshark sidecar container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kubernetes_cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hints for installing kubernetes on Fedora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/HPA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Horizontal Pod Autoscaler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/how_rhcos_updates_work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How RHCOS updates work
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kubelet-filesystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How kubelet monitors filesystems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ocp4-infra-nodes-with-machineset-without-worker-label/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infra nodes with MachineSets without worker label
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ingresscontroller_router_sharding_ocp_on_osp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress Controller Sharding OCP on OSP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ingress-controller-sharding-on-separate-vip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress Controller Sharding on separate VIP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_mirror_registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing a cluster with a mirror registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/istio-1.6-on-ocp.4.x/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Istio 1.6 on OpenShift 4.x
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kata containers and the kata operatora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kernel-ml-on-openshift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kernel-ml on OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/ovn-kind-hybrid-overlay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kind with OVN Kubernetes Hybrid Overlay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/kind-with-private-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kind with private registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/list_docker_registry_containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    List container images in registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/mounting-container-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mount a container image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/install_openshift_on_openstack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenShift on OpenStack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift-with-multipath/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenShift with iSCSI multipath
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/patch-service-loadbalancer-ingress-ip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Patch status.loadBalancer.ingress IP manually
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/private-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private container registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/proxy-ocp-4.5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proxy OCP 4.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/rpm-ostree-failed-to-find-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rpm-ostreed failed to find image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/seccomp-defaults-ocp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Seccomp defaults in Red Hat OpenShift Container Platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/scc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Context Constraints (SCC)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift-scc-with-mutating-webhooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCCs and mutating webhooks - a lesson learned
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/fix-selinux-labels-coreos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SElinux labels fix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sctp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/openshift_troubleshooting_etcd_state/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting etcd state
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/useful-ocp-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful commands for OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/useful-ocp-sdn-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful commands for OpenShift SDN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openshift/troubleshooting_openshift_on_openstack_worker_creation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting OpenShift on OpenStack worker creation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../openstack/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenStack
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            OpenStack
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/reattach_to_running_deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reattach to running deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/using_clouds_yaml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using clouds.yaml
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../coding/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coding
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Coding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/operator-sdk-reconciliation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller Reconciliation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/vimrc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    My vimrc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/golang-ip-conversion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Golang IP address conversion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
        </div>
      </div>
    </div>
  
  
    
    <!--
    <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
</nav>
        </div>
      </div>
    </div>
    -->
  

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="packet-tracing-with-ovn">Packet tracing with OVN</h1>
<h2 id="running-various-ovn-traces-in-an-ovn-kubernetes-environment">Running various OVN traces in an ovn-kubernetes environment</h2>
<h3 id="environment">Environment</h3>
<p>I use an <a href="https://github.com/ovn-org/ovn-kubernetes">ovn-kubernetes</a> kind deployment as a base environment for the following traces.</p>
<p>I spawn an environment with:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>contrib/kind.sh
</code></pre></div></td></tr></table></div></p>
<p>Then, I deploy the following deployment and service:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># cat nginx.yaml </span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.14.2</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="c1"># cat nginx-svc.yaml </span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-np</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30007</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</code></pre></div></td></tr></table></div></p>
<p>My pod is on ovn-worker, and the node's IP address is 172.18.0.3. The service can be reached on port 30007 and will then be NATed and forwarded to pod nginx-deployment-9456bbbf9-x6pc6 with IP 10.244.1.3:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span>root@ovnkubernetes<span class="w"> </span>egressfw<span class="o">]</span><span class="c1"># oc get svc -o wide</span>
NAME<span class="w">         </span>TYPE<span class="w">        </span>CLUSTER-IP<span class="w">     </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">        </span>AGE<span class="w">   </span>SELECTOR
kubernetes<span class="w">   </span>ClusterIP<span class="w">   </span><span class="m">10</span>.96.0.1<span class="w">      </span>&lt;none&gt;<span class="w">        </span><span class="m">443</span>/TCP<span class="w">        </span>84m<span class="w">   </span>&lt;none&gt;
nginx-np<span class="w">     </span>NodePort<span class="w">    </span><span class="m">10</span>.96.91.159<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">80</span>:30007/TCP<span class="w">   </span>63m<span class="w">   </span><span class="nv">app</span><span class="o">=</span>nginx
<span class="o">[</span>root@ovnkubernetes<span class="w"> </span>egressfw<span class="o">]</span><span class="c1"># oc get pods -o wide</span>
NAME<span class="w">                               </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE<span class="w">   </span>IP<span class="w">           </span>NODE<span class="w">         </span>NOMINATED<span class="w"> </span>NODE<span class="w">   </span>READINESS<span class="w"> </span>GATES
nginx-deployment-9456bbbf9-x6pc6<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>63m<span class="w">   </span><span class="m">10</span>.244.1.3<span class="w">   </span>ovn-worker<span class="w">   </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
<span class="o">[</span>root@ovnkubernetes<span class="w"> </span>egressfw<span class="o">]</span><span class="c1"># oc get nodes -o wide</span>
NAME<span class="w">                </span>STATUS<span class="w">   </span>ROLES<span class="w">                  </span>AGE<span class="w">   </span>VERSION<span class="w">   </span>INTERNAL-IP<span class="w">   </span>EXTERNAL-IP<span class="w">   </span>OS-IMAGE<span class="w">       </span>KERNEL-VERSION<span class="w">          </span>CONTAINER-RUNTIME
ovn-control-plane<span class="w">   </span>Ready<span class="w">    </span>control-plane,master<span class="w">   </span>84m<span class="w">   </span>v1.23.3<span class="w">   </span><span class="m">172</span>.18.0.3<span class="w">    </span>&lt;none&gt;<span class="w">        </span>Ubuntu<span class="w"> </span><span class="m">21</span>.10<span class="w">   </span><span class="m">4</span>.18.0-358.el8.x86_64<span class="w">   </span>containerd://1.5.9
ovn-worker<span class="w">          </span>Ready<span class="w">    </span>&lt;none&gt;<span class="w">                 </span>84m<span class="w">   </span>v1.23.3<span class="w">   </span><span class="m">172</span>.18.0.4<span class="w">    </span>&lt;none&gt;<span class="w">        </span>Ubuntu<span class="w"> </span><span class="m">21</span>.10<span class="w">   </span><span class="m">4</span>.18.0-358.el8.x86_64<span class="w">   </span>containerd://1.5.9
ovn-worker2<span class="w">         </span>Ready<span class="w">    </span>&lt;none&gt;<span class="w">                 </span>84m<span class="w">   </span>v1.23.3<span class="w">   </span><span class="m">172</span>.18.0.2<span class="w">    </span>&lt;none&gt;<span class="w">        </span>Ubuntu<span class="w"> </span><span class="m">21</span>.10<span class="w">   </span><span class="m">4</span>.18.0-358.el8.x86_64<span class="w">   </span>containerd://1.5.9
</code></pre></div></td></tr></table></div></p>
<p>We can run curl against this service from the next-hop gateway with IP address 172.18.0.1 and MAC address 02:42:7a:79:82:ca:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ip a ls dev br-519277dba8fe</span>
<span class="m">4</span>:<span class="w"> </span>br-519277dba8fe:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">1500</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>
<span class="w">    </span>link/ether<span class="w"> </span><span class="m">02</span>:42:7a:79:82:ca<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff
<span class="w">    </span>inet<span class="w"> </span><span class="m">172</span>.18.0.1/16<span class="w"> </span>brd<span class="w"> </span><span class="m">172</span>.18.255.255<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>br-519277dba8fe
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="w">    </span>inet6<span class="w"> </span>fc00:f853:ccd:e793::1/64<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="w">    </span>inet6<span class="w"> </span>fe80::42:7aff:fe79:82ca/64<span class="w"> </span>scope<span class="w"> </span>link<span class="w"> </span>
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="w">    </span>inet6<span class="w"> </span>fe80::1/64<span class="w"> </span>scope<span class="w"> </span>link<span class="w"> </span>
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="c1"># curl -I 172.18.0.4:30007 </span>
HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Server:<span class="w"> </span>nginx/1.14.2
Date:<span class="w"> </span>Wed,<span class="w"> </span><span class="m">16</span><span class="w"> </span>Feb<span class="w"> </span><span class="m">2022</span><span class="w"> </span><span class="m">11</span>:32:44<span class="w"> </span>GMT
Content-Type:<span class="w"> </span>text/html
Content-Length:<span class="w"> </span><span class="m">612</span>
Last-Modified:<span class="w"> </span>Tue,<span class="w"> </span><span class="m">04</span><span class="w"> </span>Dec<span class="w"> </span><span class="m">2018</span><span class="w"> </span><span class="m">14</span>:44:49<span class="w"> </span>GMT
Connection:<span class="w"> </span>keep-alive
ETag:<span class="w"> </span><span class="s2">&quot;5c0692e1-264&quot;</span>
Accept-Ranges:<span class="w"> </span>bytes
</code></pre></div></td></tr></table></div></p>
<p>The pod has the following IP address and gateway:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ip a</span>
<span class="m">1</span>:<span class="w"> </span>lo:<span class="w"> </span>&lt;LOOPBACK,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">65536</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>UNKNOWN<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>qlen<span class="w"> </span><span class="m">1000</span>
<span class="w">    </span>link/loopback<span class="w"> </span><span class="m">00</span>:00:00:00:00:00<span class="w"> </span>brd<span class="w"> </span><span class="m">00</span>:00:00:00:00:00
<span class="w">    </span>inet<span class="w"> </span><span class="m">127</span>.0.0.1/8<span class="w"> </span>scope<span class="w"> </span>host<span class="w"> </span>lo
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="w">    </span>inet6<span class="w"> </span>::1/128<span class="w"> </span>scope<span class="w"> </span>host<span class="w"> </span>
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="m">3</span>:<span class="w"> </span>eth0@if7:<span class="w"> </span>&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;<span class="w"> </span>mtu<span class="w"> </span><span class="m">1400</span><span class="w"> </span>qdisc<span class="w"> </span>noqueue<span class="w"> </span>state<span class="w"> </span>UP<span class="w"> </span>group<span class="w"> </span>default<span class="w"> </span>
<span class="w">    </span>link/ether<span class="w"> </span>0a:58:0a:f4:01:03<span class="w"> </span>brd<span class="w"> </span>ff:ff:ff:ff:ff:ff<span class="w"> </span>link-netnsid<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>inet<span class="w"> </span><span class="m">10</span>.244.1.3/24<span class="w"> </span>brd<span class="w"> </span><span class="m">10</span>.244.1.255<span class="w"> </span>scope<span class="w"> </span>global<span class="w"> </span>eth0
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="w">    </span>inet6<span class="w"> </span>fe80::858:aff:fef4:103/64<span class="w"> </span>scope<span class="w"> </span>link<span class="w"> </span>
<span class="w">       </span>valid_lft<span class="w"> </span>forever<span class="w"> </span>preferred_lft<span class="w"> </span>forever
<span class="c1"># ip r show default</span>
default<span class="w"> </span>via<span class="w"> </span><span class="m">10</span>.244.1.1<span class="w"> </span>dev<span class="w"> </span>eth0
<span class="c1"># ip neigh</span>
<span class="m">10</span>.244.1.1<span class="w"> </span>dev<span class="w"> </span>eth0<span class="w"> </span>lladdr<span class="w"> </span>0a:58:0a:f4:01:01<span class="w"> </span>STALE
</code></pre></div></td></tr></table></div></p>
<p>And on the pod, we see the following flow which has gone through DNAT and SNAT:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># tcpdump -nne -i eth0</span>
dropped<span class="w"> </span>privs<span class="w"> </span>to<span class="w"> </span>tcpdump
tcpdump:<span class="w"> </span>verbose<span class="w"> </span>output<span class="w"> </span>suppressed,<span class="w"> </span>use<span class="w"> </span>-v<span class="w"> </span>or<span class="w"> </span>-vv<span class="w"> </span><span class="k">for</span><span class="w"> </span>full<span class="w"> </span>protocol<span class="w"> </span>decode
listening<span class="w"> </span>on<span class="w"> </span>eth0,<span class="w"> </span>link-type<span class="w"> </span>EN10MB<span class="w"> </span><span class="o">(</span>Ethernet<span class="o">)</span>,<span class="w"> </span>capture<span class="w"> </span>size<span class="w"> </span><span class="m">262144</span><span class="w"> </span>bytes
<span class="m">11</span>:32:44.407949<span class="w"> </span>0a:58:0a:f4:01:01<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:03,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">74</span>:<span class="w"> </span><span class="m">100</span>.64.0.3.53642<span class="w"> </span>&gt;<span class="w"> </span><span class="m">10</span>.244.1.3.80:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>S<span class="o">]</span>,<span class="w"> </span>seq<span class="w"> </span><span class="m">2722623038</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">29200</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>mss<span class="w"> </span><span class="m">1460</span>,sackOK,TS<span class="w"> </span>val<span class="w"> </span><span class="m">757469725</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">0</span>,nop,wscale<span class="w"> </span><span class="m">7</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">0</span>
<span class="m">11</span>:32:44.408002<span class="w"> </span>0a:58:0a:f4:01:03<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:01,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">74</span>:<span class="w"> </span><span class="m">10</span>.244.1.3.80<span class="w"> </span>&gt;<span class="w"> </span><span class="m">100</span>.64.0.3.53642:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>S.<span class="o">]</span>,<span class="w"> </span>seq<span class="w"> </span><span class="m">519304349</span>,<span class="w"> </span>ack<span class="w"> </span><span class="m">2722623039</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">26960</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>mss<span class="w"> </span><span class="m">1360</span>,sackOK,TS<span class="w"> </span>val<span class="w"> </span><span class="m">1904257279</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">757469725</span>,nop,wscale<span class="w"> </span><span class="m">7</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">0</span>
<span class="m">11</span>:32:44.409948<span class="w"> </span>0a:58:0a:f4:01:01<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:03,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">147</span>:<span class="w"> </span><span class="m">100</span>.64.0.3.53642<span class="w"> </span>&gt;<span class="w"> </span><span class="m">10</span>.244.1.3.80:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>P.<span class="o">]</span>,<span class="w"> </span>seq<span class="w"> </span><span class="m">1</span>:82,<span class="w"> </span>ack<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">229</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>nop,nop,TS<span class="w"> </span>val<span class="w"> </span><span class="m">757469728</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">1904257279</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">81</span>:<span class="w"> </span>HTTP:<span class="w"> </span>HEAD<span class="w"> </span>/<span class="w"> </span>HTTP/1.1
<span class="m">11</span>:32:44.409953<span class="w"> </span>0a:58:0a:f4:01:01<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:03,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">66</span>:<span class="w"> </span><span class="m">100</span>.64.0.3.53642<span class="w"> </span>&gt;<span class="w"> </span><span class="m">10</span>.244.1.3.80:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>.<span class="o">]</span>,<span class="w"> </span>ack<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">229</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>nop,nop,TS<span class="w"> </span>val<span class="w"> </span><span class="m">757469728</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">1904257279</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">0</span>
<span class="m">11</span>:32:44.410001<span class="w"> </span>0a:58:0a:f4:01:03<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:01,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">66</span>:<span class="w"> </span><span class="m">10</span>.244.1.3.80<span class="w"> </span>&gt;<span class="w"> </span><span class="m">100</span>.64.0.3.53642:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>.<span class="o">]</span>,<span class="w"> </span>ack<span class="w"> </span><span class="m">82</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">211</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>nop,nop,TS<span class="w"> </span>val<span class="w"> </span><span class="m">1904257281</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">757469728</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">0</span>
<span class="m">11</span>:32:44.410031<span class="w"> </span>0a:58:0a:f4:01:03<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:01,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">66</span>:<span class="w"> </span><span class="m">10</span>.244.1.3.80<span class="w"> </span>&gt;<span class="w"> </span><span class="m">100</span>.64.0.3.53642:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>.<span class="o">]</span>,<span class="w"> </span>ack<span class="w"> </span><span class="m">82</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">211</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>nop,nop,TS<span class="w"> </span>val<span class="w"> </span><span class="m">1904257281</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">757469728</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">0</span>
<span class="m">11</span>:32:44.410399<span class="w"> </span>0a:58:0a:f4:01:03<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:01,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">304</span>:<span class="w"> </span><span class="m">10</span>.244.1.3.80<span class="w"> </span>&gt;<span class="w"> </span><span class="m">100</span>.64.0.3.53642:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>P.<span class="o">]</span>,<span class="w"> </span>seq<span class="w"> </span><span class="m">1</span>:239,<span class="w"> </span>ack<span class="w"> </span><span class="m">82</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">211</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>nop,nop,TS<span class="w"> </span>val<span class="w"> </span><span class="m">1904257281</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">757469728</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">238</span>:<span class="w"> </span>HTTP:<span class="w"> </span>HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
<span class="m">11</span>:32:44.410491<span class="w"> </span>0a:58:0a:f4:01:01<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:03,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">66</span>:<span class="w"> </span><span class="m">100</span>.64.0.3.53642<span class="w"> </span>&gt;<span class="w"> </span><span class="m">10</span>.244.1.3.80:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>.<span class="o">]</span>,<span class="w"> </span>ack<span class="w"> </span><span class="m">239</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">237</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>nop,nop,TS<span class="w"> </span>val<span class="w"> </span><span class="m">757469729</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">1904257281</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">0</span>
<span class="m">11</span>:32:44.410772<span class="w"> </span>0a:58:0a:f4:01:01<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:03,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">66</span>:<span class="w"> </span><span class="m">100</span>.64.0.3.53642<span class="w"> </span>&gt;<span class="w"> </span><span class="m">10</span>.244.1.3.80:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>F.<span class="o">]</span>,<span class="w"> </span>seq<span class="w"> </span><span class="m">82</span>,<span class="w"> </span>ack<span class="w"> </span><span class="m">239</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">237</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>nop,nop,TS<span class="w"> </span>val<span class="w"> </span><span class="m">757469730</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">1904257281</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">0</span>
<span class="m">11</span>:32:44.411039<span class="w"> </span>0a:58:0a:f4:01:03<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:01,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">66</span>:<span class="w"> </span><span class="m">10</span>.244.1.3.80<span class="w"> </span>&gt;<span class="w"> </span><span class="m">100</span>.64.0.3.53642:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>F.<span class="o">]</span>,<span class="w"> </span>seq<span class="w"> </span><span class="m">239</span>,<span class="w"> </span>ack<span class="w"> </span><span class="m">83</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">211</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>nop,nop,TS<span class="w"> </span>val<span class="w"> </span><span class="m">1904257282</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">757469730</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">0</span>
<span class="m">11</span>:32:44.411154<span class="w"> </span>0a:58:0a:f4:01:01<span class="w"> </span>&gt;<span class="w"> </span>0a:58:0a:f4:01:03,<span class="w"> </span>ethertype<span class="w"> </span>IPv4<span class="w"> </span><span class="o">(</span>0x0800<span class="o">)</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">66</span>:<span class="w"> </span><span class="m">100</span>.64.0.3.53642<span class="w"> </span>&gt;<span class="w"> </span><span class="m">10</span>.244.1.3.80:<span class="w"> </span>Flags<span class="w"> </span><span class="o">[</span>.<span class="o">]</span>,<span class="w"> </span>ack<span class="w"> </span><span class="m">240</span>,<span class="w"> </span>win<span class="w"> </span><span class="m">237</span>,<span class="w"> </span>options<span class="w"> </span><span class="o">[</span>nop,nop,TS<span class="w"> </span>val<span class="w"> </span><span class="m">757469730</span><span class="w"> </span>ecr<span class="w"> </span><span class="m">1904257282</span><span class="o">]</span>,<span class="w"> </span>length<span class="w"> </span><span class="m">0</span>
^C
<span class="m">11</span><span class="w"> </span>packets<span class="w"> </span>captured
<span class="m">11</span><span class="w"> </span>packets<span class="w"> </span>received<span class="w"> </span>by<span class="w"> </span>filter
<span class="m">0</span><span class="w"> </span>packets<span class="w"> </span>dropped<span class="w"> </span>by<span class="w"> </span>kernel
</code></pre></div></td></tr></table></div></p>
<p>Here is an overview of the NBDB state:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code>sh-5.1#<span class="w"> </span>ovn-nbctl<span class="w"> </span>show
switch<span class="w"> </span>cd928d81-4f0f-4c04-860a-f75022f7e0b9<span class="w"> </span><span class="o">(</span>ext_ovn-control-plane<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>breth0_ovn-control-plane
<span class="w">        </span>type:<span class="w"> </span>localnet
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;unknown&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>etor-GR_ovn-control-plane
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:03&quot;</span><span class="o">]</span>
<span class="w">        </span>router-port:<span class="w"> </span>rtoe-GR_ovn-control-plane
switch<span class="w"> </span>25b2a2f5-437f-4513-90cd-e3e1aaf7f14f<span class="w"> </span><span class="o">(</span>ovn-control-plane<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>local-path-storage_local-path-provisioner-5ddd94ff66-krkk7
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;0a:58:0a:f4:02:04 10.244.2.4&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>stor-ovn-control-plane
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>router-port:<span class="w"> </span>rtos-ovn-control-plane
<span class="w">    </span>port<span class="w"> </span>k8s-ovn-control-plane
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;82:24:48:8a:77:cc 10.244.2.2&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>kube-system_coredns-64897985d-wdvs9
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;0a:58:0a:f4:02:05 10.244.2.5&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>kube-system_coredns-64897985d-rzjfr
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;0a:58:0a:f4:02:03 10.244.2.3&quot;</span><span class="o">]</span>
switch<span class="w"> </span>b4dede7d-7660-42bf-a954-c5b3f0f28a7c<span class="w"> </span><span class="o">(</span>ovn-worker<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>stor-ovn-worker
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>router-port:<span class="w"> </span>rtos-ovn-worker
<span class="w">    </span>port<span class="w"> </span>default_nginx-deployment-9456bbbf9-x6pc6
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;0a:58:0a:f4:01:03 10.244.1.3&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>k8s-ovn-worker
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;4a:d4:28:63:24:1c 10.244.1.2&quot;</span><span class="o">]</span>
switch<span class="w"> </span>214f4d51-750d-414a-aad1-94e84e623f9b<span class="w"> </span><span class="o">(</span>ext_ovn-worker<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>breth0_ovn-worker
<span class="w">        </span>type:<span class="w"> </span>localnet
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;unknown&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>etor-GR_ovn-worker
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:04&quot;</span><span class="o">]</span>
<span class="w">        </span>router-port:<span class="w"> </span>rtoe-GR_ovn-worker
switch<span class="w"> </span>bcec069e-f578-4927-93d2-6e129595a716<span class="w"> </span><span class="o">(</span>join<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>jtor-GR_ovn-worker
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>router-port:<span class="w"> </span>rtoj-GR_ovn-worker
<span class="w">    </span>port<span class="w"> </span>jtor-GR_ovn-control-plane
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>router-port:<span class="w"> </span>rtoj-GR_ovn-control-plane
<span class="w">    </span>port<span class="w"> </span>jtor-GR_ovn-worker2
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>router-port:<span class="w"> </span>rtoj-GR_ovn-worker2
<span class="w">    </span>port<span class="w"> </span>jtor-ovn_cluster_router
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>router-port:<span class="w"> </span>rtoj-ovn_cluster_router
switch<span class="w"> </span>ff675836-2b46-4d83-b53f-41cba7297d8b<span class="w"> </span><span class="o">(</span>ext_ovn-worker2<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>breth0_ovn-worker2
<span class="w">        </span>type:<span class="w"> </span>localnet
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;unknown&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>etor-GR_ovn-worker2
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:02&quot;</span><span class="o">]</span>
<span class="w">        </span>router-port:<span class="w"> </span>rtoe-GR_ovn-worker2
switch<span class="w"> </span>e1f67383-f731-4bf7-a018-6361ec60f477<span class="w"> </span><span class="o">(</span>ovn-worker2<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>k8s-ovn-worker2
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;4e:19:7f:89:93:bc 10.244.0.2&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>stor-ovn-worker2
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>router-port:<span class="w"> </span>rtos-ovn-worker2
router<span class="w"> </span>7072022c-7226-4928-a397-fc770b75f98f<span class="w"> </span><span class="o">(</span>GR_ovn-worker2<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>rtoj-GR_ovn-worker2
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;0a:58:64:40:00:02&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;100.64.0.2/16&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>rtoe-GR_ovn-worker2
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;02:42:ac:12:00:02&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;172.18.0.2/16&quot;</span><span class="o">]</span>
<span class="w">    </span>nat<span class="w"> </span>d87cc0f7-5053-4739-9617-a952cb37d74c
<span class="w">        </span>external<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;172.18.0.2&quot;</span>
<span class="w">        </span>logical<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;10.244.0.0/16&quot;</span>
<span class="w">        </span>type:<span class="w"> </span><span class="s2">&quot;snat&quot;</span>
router<span class="w"> </span>5ea87f54-ceeb-442a-92c8-4b522278b5dd<span class="w"> </span><span class="o">(</span>GR_ovn-worker<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>rtoj-GR_ovn-worker
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;0a:58:64:40:00:03&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;100.64.0.3/16&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>rtoe-GR_ovn-worker
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;02:42:ac:12:00:04&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;172.18.0.4/16&quot;</span><span class="o">]</span>
<span class="w">    </span>nat<span class="w"> </span>ca3ef3e0-22c1-427d-a977-b10256a96177
<span class="w">        </span>external<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;172.18.0.4&quot;</span>
<span class="w">        </span>logical<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;10.244.0.0/16&quot;</span>
<span class="w">        </span>type:<span class="w"> </span><span class="s2">&quot;snat&quot;</span>
router<span class="w"> </span>1dead945-8773-4d33-b56b-67e5ab8fcca3<span class="w"> </span><span class="o">(</span>GR_ovn-control-plane<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>rtoe-GR_ovn-control-plane
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;02:42:ac:12:00:03&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;172.18.0.3/16&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>rtoj-GR_ovn-control-plane
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;0a:58:64:40:00:04&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;100.64.0.4/16&quot;</span><span class="o">]</span>
<span class="w">    </span>nat<span class="w"> </span>70a6067c-ffa4-407a-9d0f-cc581b8b1c3a
<span class="w">        </span>external<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;172.18.0.3&quot;</span>
<span class="w">        </span>logical<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;10.244.0.0/16&quot;</span>
<span class="w">        </span>type:<span class="w"> </span><span class="s2">&quot;snat&quot;</span>
router<span class="w"> </span>9ac72c76-9f8f-4f3a-9a82-0e18846c4cd9<span class="w"> </span><span class="o">(</span>ovn_cluster_router<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>rtos-ovn-control-plane
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;0a:58:0a:f4:02:01&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.2.1/24&quot;</span><span class="o">]</span>
<span class="w">        </span>gateway<span class="w"> </span>chassis:<span class="w"> </span><span class="o">[</span>9268048a-65bf-467e-b166-d0faffafa686<span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>rtos-ovn-worker2
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;0a:58:0a:f4:00:01&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.0.1/24&quot;</span><span class="o">]</span>
<span class="w">        </span>gateway<span class="w"> </span>chassis:<span class="w"> </span><span class="o">[</span>fbb949c1-6d62-44cc-b67e-9f93b40d1691<span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>rtos-ovn-worker
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;0a:58:0a:f4:01:01&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;10.244.1.1/24&quot;</span><span class="o">]</span>
<span class="w">        </span>gateway<span class="w"> </span>chassis:<span class="w"> </span><span class="o">[</span>4da007a6-ed1d-45ff-bcf4-62ae8914bbbc<span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>rtoj-ovn_cluster_router
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;0a:58:64:40:00:01&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;100.64.0.1/16&quot;</span><span class="o">]</span>
</code></pre></div></td></tr></table></div></p>
<p>The service is implemented as an OVN loadbalancer - we are going to look into this load-balancer further in the examples section below:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh">#</span> ovn-nbctl lr-lb-list GR_ovn-worker
UUID                                    LB                  PROTO      VIP                 IPs
bc20db47-e79c-4906-b0d8-dd2dcfaf54b4    Service_default/    tcp        172.18.0.4:30007    10.244.1.3:80
e7486241-66e1-453a-b44d-3b3e7b2ebc4f    Service_default/    tcp        10.96.0.1:443       172.18.0.3:6443
</code></pre></div></td></tr></table></div></p>
<h3 id="collection-of-examples">Collection of examples</h3>
<h4 id="simulating-new-flows-through-conntrack">Simulating new flows through conntrack</h4>
<p>Tracing a new TCP flow from the outside of the cluster to the service IP and port, knowing that NAT and conntrack are involved. A <code class="highlight">--minimal</code> trace is always a good starting point. The most important bit here is the <code class="highlight">--ct new</code> command line parameter to simulate a new conntrack flow:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ovn-trace --minimal  --ovs ext_ovn-worker &#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39; --ct new</span>
</code></pre></div></td></tr></table></div></p>
<p>Result of the <code class="highlight">--minimal</code> trace:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code>sh-5.1#<span class="w"> </span>ovn-trace<span class="w"> </span>--minimal<span class="w">  </span>--ovs<span class="w"> </span>ext_ovn-worker<span class="w"> </span><span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span><span class="w"> </span>--ct<span class="w"> </span>new
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>ct_lb<span class="w"> </span>/*<span class="w"> </span>default<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>--ct<span class="w"> </span>to<span class="w"> </span>customize<span class="o">)</span><span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">        </span>ip.ttl--<span class="p">;</span>
<span class="w">        </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span>
<span class="w">        </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:01<span class="p">;</span>
<span class="w">        </span>ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ip.ttl--<span class="p">;</span>
<span class="w">            </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:01<span class="p">;</span>
<span class="w">            </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:03<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>chk_lb_hairpin_reply<span class="w"> </span>action<span class="w"> </span>not<span class="w"> </span>implemented<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ct_lb<span class="w"> </span>/*<span class="w"> </span>default<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>--ct<span class="w"> </span>to<span class="w"> </span>customize<span class="o">)</span><span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">            </span><span class="o">}</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
<p>In the detailed trace, we can also see the destination IP after the DNAT:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code>sh-5.1#<span class="w"> </span>ovn-trace<span class="w"> </span>--friendly-names<span class="w">  </span>--ovs<span class="w"> </span>ext_ovn-worker<span class="w"> </span><span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span><span class="w"> </span>--ct<span class="w"> </span>new<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">15</span>

ct_lb<span class="w"> </span>/*<span class="w"> </span>default<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>--ct<span class="w"> </span>to<span class="w"> </span>customize<span class="o">)</span><span class="w"> </span>*/
-------------------------------------------
<span class="w"> </span><span class="m">3</span>.<span class="w"> </span>ls_out_acl_hint<span class="w"> </span><span class="o">(</span>northd.c:6041<span class="o">)</span>:<span class="w"> </span>ct.est<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ct_label.blocked<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>uuid<span class="w"> </span>5f2e1810
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x5f2e1810,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">5184</span>.167s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">43</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">5184</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,44<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x5f2e1810,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">5184</span>.149s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">43</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">28886</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">7169503</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">1</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,44<span class="o">)</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">10</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">8</span>.<span class="w"> </span>ls_out_port_sec_ip<span class="w"> </span><span class="o">(</span>northd.c:5130<span class="o">)</span>:<span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>eth.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span>0a:58:0a:f4:01:03<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">{</span><span class="m">255</span>.255.255.255,<span class="w"> </span><span class="m">224</span>.0.0.0/4,<span class="w"> </span><span class="m">10</span>.244.1.3<span class="o">}</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">90</span>,<span class="w"> </span>uuid<span class="w"> </span>701b3cf6
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">9</span>.<span class="w"> </span>ls_out_port_sec_l2<span class="w"> </span><span class="o">(</span>northd.c:5594<span class="o">)</span>:<span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>eth.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">{</span>0a:58:0a:f4:01:03<span class="o">}</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>b6daec2d
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>output<span class="p">;</span>
<span class="w">    </span>/*<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span>,<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>*/
</code></pre></div></td></tr></table></div></p>
<p>Unfortunately, it is very difficult to see what the final packet would look like. We know that an SNAT is involved, too, but that is "hidden" somewhere in the output:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>sh-5.1#<span class="w"> </span>ovn-trace<span class="w"> </span>--friendly-names<span class="w">  </span>--ovs<span class="w"> </span>ext_ovn-worker<span class="w"> </span><span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span><span class="w"> </span>--ct<span class="w"> </span>new<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">100</span>.64<span class="w">     </span>
<span class="w">    </span><span class="nv">reg0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>.64.0.1<span class="p">;</span>
<span class="w">    </span><span class="nv">reg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>.64.0.3<span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
<p>It would indeed be desirable for ovn-trace to show the full packet state of the processed and ready-to-send packet.</p>
<p>If we look at the flow in a bit more detail, we can see that in the <code class="highlight">ingress</code> pipeline of <code class="highlight">GR_ovn-worker</code>, the packet hits the load-balancer flow. SNAT is forced for this load-balancer, and the packet shall be sent to backend <code class="highlight"><span class="mf">10.244.1.3</span><span class="p">:</span><span class="mf">80</span></code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ovn-trace --ct new --ct new --ct new  --ovs ext_ovn-worker &#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39; </span>
<span class="o">(</span>...<span class="o">)</span>
ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;GR_ovn-worker&quot;</span>,<span class="w"> </span><span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;rtoe-GR_ovn-worker&quot;</span><span class="o">)</span>
--------------------------------------------------------
<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>lr_in_admission<span class="w"> </span><span class="o">(</span>northd.c:10523<span class="o">)</span>:<span class="w"> </span>eth.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">02</span>:42:ac:12:00:04<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtoe-GR_ovn-worker&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>71cc3085
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>xreg0<span class="o">[</span><span class="m">0</span>..47<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">02</span>:42:ac:12:00:04<span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">1</span>.<span class="w"> </span>lr_in_lookup_neighbor<span class="w"> </span><span class="o">(</span>northd.c:10667<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>uuid<span class="w"> </span><span class="m">39881020</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x39881020,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.530s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">9</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">71802</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">13904424</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x39881020,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.497s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">9</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">29937</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">2833154</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
<span class="w">    </span>reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">2</span>.<span class="w"> </span>lr_in_learn_neighbor<span class="w"> </span><span class="o">(</span>northd.c:10676<span class="o">)</span>:<span class="w"> </span>reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>reg9<span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>6be9d860
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.530s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">71802</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">13904424</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.496s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">29949</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">2833922</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.497s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">689</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">30478</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">150</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.530s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">19439</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">4</span>.<span class="w"> </span>lr_in_unsnat<span class="w"> </span><span class="o">(</span>northd.c:9670<span class="o">)</span>:<span class="w"> </span>ip4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">30007</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">120</span>,<span class="w"> </span>uuid<span class="w"> </span>60d3c124
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">5</span>.<span class="w"> </span>lr_in_defrag<span class="w"> </span><span class="o">(</span>northd.c:9865<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp,<span class="w"> </span>priority<span class="w"> </span><span class="m">110</span>,<span class="w"> </span>uuid<span class="w"> </span>4bb8c7f6
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span><span class="nv">reg0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">172</span>.18.0.4<span class="p">;</span>
<span class="w">    </span>reg9<span class="o">[</span><span class="m">16</span>..31<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tcp.dst<span class="p">;</span>
<span class="w">    </span>ct_dnat<span class="p">;</span>

ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/
-----------------------------------------------------
<span class="w"> </span><span class="m">6</span>.<span class="w"> </span>lr_in_dnat<span class="w"> </span><span class="o">(</span>northd.c:9701<span class="o">)</span>:<span class="w"> </span>ct.new<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">reg0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg9<span class="o">[</span><span class="m">16</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">30007</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">120</span>,<span class="w"> </span>uuid<span class="w"> </span>25f1ad55
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>flags.force_snat_for_lb<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>ct_lb<span class="o">(</span><span class="nv">backends</span><span class="o">=</span><span class="m">10</span>.244.1.3:80<span class="o">)</span><span class="p">;</span>

ct_lb
-----
<span class="m">10</span>.<span class="w"> </span>lr_in_ip_routing_pre<span class="w"> </span><span class="o">(</span>northd.c:10910<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>uuid<span class="w"> </span>219bc578
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x219bc578,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.530s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">18</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">71797</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">13903874</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0xffffffff-&gt;xxreg1,resubmit<span class="o">(</span>,19<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x219bc578,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">19439</span>.496s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">18</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">29925</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">2831554</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0xffffffff-&gt;xxreg1,resubmit<span class="o">(</span>,19<span class="o">)</span>
<span class="w">    </span><span class="nv">reg7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">11</span>.<span class="w"> </span>lr_in_ip_routing<span class="w"> </span><span class="o">(</span>northd.c:9439<span class="o">)</span>:<span class="w"> </span><span class="nv">reg7</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.0.0/16,<span class="w"> </span>priority<span class="w"> </span><span class="m">49</span>,<span class="w"> </span>uuid<span class="w"> </span>fbba9ce1
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>ip.ttl--<span class="p">;</span>
<span class="w">    </span>reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span><span class="nv">reg0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>.64.0.1<span class="p">;</span>
<span class="w">    </span><span class="nv">reg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>.64.0.3<span class="p">;</span>
<span class="w">    </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span>
<span class="w">    </span><span class="nv">outport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span><span class="p">;</span>
<span class="w">    </span>flags.loopback<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
<p>We can find the same flow here inside the OVN Southbound database flows:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ovn-sbctl dump-flows </span>
<span class="o">(</span>...<span class="o">)</span>
Datapath:<span class="w"> </span><span class="s2">&quot;GR_ovn-worker&quot;</span><span class="w"> </span><span class="o">(</span>15e72dff-677d-4794-8f70-a5fea49ad788<span class="o">)</span><span class="w">  </span>Pipeline:<span class="w"> </span>ingress
<span class="o">(</span>...<span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">6</span><span class="w"> </span><span class="o">(</span>lr_in_dnat<span class="w">         </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">120</span><span class="w">  </span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span>ct.new<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">reg0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">172</span>.18.0.4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>reg9<span class="o">[</span><span class="m">16</span>..31<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">30007</span><span class="o">)</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>flags.force_snat_for_lb<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>ct_lb<span class="o">(</span><span class="nv">backends</span><span class="o">=</span><span class="m">10</span>.244.1.3:80<span class="o">)</span><span class="p">;</span><span class="o">)</span>
<span class="o">(</span>...<span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">11</span><span class="o">(</span>lr_in_ip_routing<span class="w">   </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">49</span><span class="w">   </span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span><span class="nv">reg7</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.0.0/16<span class="o">)</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>ip.ttl--<span class="p">;</span><span class="w"> </span>reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="nv">reg0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>.64.0.1<span class="p">;</span><span class="w"> </span><span class="nv">reg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>.64.0.3<span class="p">;</span><span class="w"> </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span><span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span><span class="p">;</span><span class="w"> </span>flags.loopback<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span>next<span class="p">;</span><span class="o">)</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="specifying-multiple-ct-actions">Specifying multiple <code class="highlight">--ct</code> actions</h4>
<p>From the ovn-trace man page:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>            A packet might pass through the connection tracker twice in
            one trip through OVN: once following egress from a VM as it
            passes outward through a firewall, and once preceding
            ingress to a second VM as it passes inward through a
            firewall. Use multiple --ct options to specify the flags for
            multiple ct_next actions.
</code></pre></div></td></tr></table></div></p>
<p>Compare the following outputs - note that there is a difference with every <code class="highlight">--ct new</code> set:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code>sh-5.1#<span class="w"> </span>ovn-trace<span class="w"> </span>--minimal<span class="w">  </span>--ovs<span class="w"> </span>ext_ovn-worker<span class="w"> </span><span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span><span class="w">              </span>
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span>/*<span class="w"> </span>default<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>--ct<span class="w"> </span>to<span class="w"> </span>customize<span class="o">)</span><span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>ip.ttl--<span class="p">;</span>
<span class="w">    </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">02</span>:42:ac:12:00:04<span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
sh-5.1#<span class="w"> </span>ovn-trace<span class="w"> </span>--ct<span class="w"> </span>new<span class="w"> </span>--minimal<span class="w">  </span>--ovs<span class="w"> </span>ext_ovn-worker<span class="w"> </span><span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span><span class="w"> </span>
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>ct_lb<span class="w"> </span>/*<span class="w"> </span>default<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>--ct<span class="w"> </span>to<span class="w"> </span>customize<span class="o">)</span><span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">        </span>ip.ttl--<span class="p">;</span>
<span class="w">        </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span>
<span class="w">        </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:01<span class="p">;</span>
<span class="w">        </span>ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ip.ttl--<span class="p">;</span>
<span class="w">            </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:01<span class="p">;</span>
<span class="w">            </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:03<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>chk_lb_hairpin_reply<span class="w"> </span>action<span class="w"> </span>not<span class="w"> </span>implemented<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ct_lb<span class="w"> </span>/*<span class="w"> </span>default<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>--ct<span class="w"> </span>to<span class="w"> </span>customize<span class="o">)</span><span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">            </span><span class="o">}</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
sh-5.1#<span class="w"> </span>ovn-trace<span class="w"> </span>--ct<span class="w"> </span>new<span class="w"> </span>--ct<span class="w"> </span>new<span class="w"> </span>--minimal<span class="w">  </span>--ovs<span class="w"> </span>ext_ovn-worker<span class="w"> </span><span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span><span class="w"> </span>
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>ct_lb<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">        </span>ip.ttl--<span class="p">;</span>
<span class="w">        </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span>
<span class="w">        </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:01<span class="p">;</span>
<span class="w">        </span>ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ip.ttl--<span class="p">;</span>
<span class="w">            </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:01<span class="p">;</span>
<span class="w">            </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:03<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>chk_lb_hairpin_reply<span class="w"> </span>action<span class="w"> </span>not<span class="w"> </span>implemented<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ct_lb<span class="w"> </span>/*<span class="w"> </span>default<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>--ct<span class="w"> </span>to<span class="w"> </span>customize<span class="o">)</span><span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">            </span><span class="o">}</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
sh-5.1#<span class="w"> </span>ovn-trace<span class="w"> </span>--ct<span class="w"> </span>new<span class="w"> </span>--ct<span class="w"> </span>new<span class="w"> </span>--ct<span class="w"> </span>new<span class="w"> </span>--minimal<span class="w">  </span>--ovs<span class="w"> </span>ext_ovn-worker<span class="w"> </span><span class="s1">&#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007&#39;</span><span class="w"> </span>
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=0</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>ct_lb<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">        </span>ip.ttl--<span class="p">;</span>
<span class="w">        </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span>
<span class="w">        </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:01<span class="p">;</span>
<span class="w">        </span>ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ip.ttl--<span class="p">;</span>
<span class="w">            </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:01<span class="p">;</span>
<span class="w">            </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:03<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>chk_lb_hairpin_reply<span class="w"> </span>action<span class="w"> </span>not<span class="w"> </span>implemented<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ct_lb<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">            </span><span class="o">}</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
sh-5.1#<span class="w"> </span>
</code></pre></div></td></tr></table></div></p>
<h4 id="specifying-tcp-flags-in-ovn-trace">Specifying TCP flags in ovn-trace</h4>
<p>It is also possible to provide the exact TCP flags. See RFC 793 for further details:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code>  Control Bits:  6 bits (from left to right):

    URG:  Urgent Pointer field significant
    ACK:  Acknowledgment field significant
    PSH:  Push Function
    RST:  Reset the connection
    SYN:  Synchronize sequence numbers
    FIN:  No more data from sender
</code></pre></div></td></tr></table></div></p>
<p>A FIN is hence <code class="highlight"><span class="mf">0</span><span class="n">x1</span></code>, a SYN 0x2, a RST is 0x4, a PSH is 0x8, an ACK is 0x10, a SYN/ACK is 0x12 and so on.</p>
<p>The resulting ovn-trace command:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ovn-trace --minimal  --ovs ext_ovn-worker &#39;inport == &quot;breth0_ovn-worker&quot; &amp;&amp; eth.src == 02:42:7a:79:82:ca &amp;&amp;  eth.dst == 02:42:ac:12:00:04 &amp;&amp; ip4.src == 172.18.0.1 &amp;&amp; ip4.dst == 172.18.0.4 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==12345 &amp;&amp; tcp.dst == 30007 &amp;&amp; tcp.flags == 0x2&#39; --ct new </span>
<span class="c1"># tcp,reg14=0x1,vlan_tci=0x0000,dl_src=02:42:7a:79:82:ca,dl_dst=02:42:ac:12:00:04,nw_src=172.18.0.1,nw_dst=172.18.0.4,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=12345,tp_dst=30007,tcp_flags=syn</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>ct_lb<span class="w"> </span>/*<span class="w"> </span>default<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>--ct<span class="w"> </span>to<span class="w"> </span>customize<span class="o">)</span><span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">        </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">        </span>ip.ttl--<span class="p">;</span>
<span class="w">        </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span>
<span class="w">        </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:01<span class="p">;</span>
<span class="w">        </span>ct_dnat<span class="w"> </span>/*<span class="w"> </span>assuming<span class="w"> </span>no<span class="w"> </span>un-dnat<span class="w"> </span>entry,<span class="w"> </span>so<span class="w"> </span>no<span class="w"> </span>change<span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ip.ttl--<span class="p">;</span>
<span class="w">            </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:01<span class="p">;</span>
<span class="w">            </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:03<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>chk_lb_hairpin_reply<span class="w"> </span>action<span class="w"> </span>not<span class="w"> </span>implemented<span class="p">;</span>
<span class="w">            </span>reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">            </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">            </span>ct_lb<span class="w"> </span>/*<span class="w"> </span>default<span class="w"> </span><span class="o">(</span>use<span class="w"> </span>--ct<span class="w"> </span>to<span class="w"> </span>customize<span class="o">)</span><span class="w"> </span>*/<span class="w"> </span><span class="o">{</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">                </span>output<span class="o">(</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">            </span><span class="o">}</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span><span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="simulating-reverse-flows-through-conntrack">Simulating reverse flows through conntrack</h4>
<p>Let's continue with the earlier example. This time, let's simulate the the answer to the earlier flow. Unfortunately, something seems to go wrong:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ovn-trace --ct rpl,est --minimal  --ovs ovn-worker &#39;inport == &quot;default_nginx-deployment-9456bbbf9-x6pc6&quot; &amp;&amp; eth.src == 0a:58:0a:f4:01:03 &amp;&amp;  eth.dst == 0a:58:0a:f4:01:01 &amp;&amp; ip4.src == 10.244.1.3 &amp;&amp; ip4.dst == 100.64.0.3 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==80 &amp;&amp; tcp.dst == 47306&#39; </span>
<span class="c1"># tcp,reg14=0x3,vlan_tci=0x0000,dl_src=0a:58:0a:f4:01:03,dl_dst=0a:58:0a:f4:01:01,nw_src=10.244.1.3,nw_dst=100.64.0.3,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=80,tp_dst=47306,tcp_flags=0</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
ct_lb<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>chk_lb_hairpin_reply<span class="w"> </span>action<span class="w"> </span>not<span class="w"> </span>implemented<span class="p">;</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>ip.ttl--<span class="p">;</span>
<span class="w">    </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:01<span class="p">;</span>
<span class="w">    </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
<span class="o">}</span><span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
<p>What happens if we run a detailed trace:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ovn-trace --ct rpl,est --ovs ovn-worker &#39;inport == &quot;default_nginx-deployment-9456bbbf9-x6pc6&quot; &amp;&amp; eth.src == 0a:58:0a:f4:01:03 &amp;&amp;  eth.dst == 0a:58:0a:f4:01:01 &amp;&amp; ip4.src == 10.244.1.3 &amp;&amp; ip4.dst == 100.64.0.3 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==80 &amp;&amp; tcp.dst == 47306&#39; </span>
<span class="c1"># tcp,reg14=0x3,vlan_tci=0x0000,dl_src=0a:58:0a:f4:01:03,dl_dst=0a:58:0a:f4:01:01,nw_src=10.244.1.3,nw_dst=100.64.0.3,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=80,tp_dst=47306,tcp_flags=0</span>

ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;ovn-worker&quot;</span>,<span class="w"> </span><span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="o">)</span>
---------------------------------------------------------------------------
<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>ls_in_port_sec_l2<span class="w"> </span><span class="o">(</span>northd.c:5497<span class="o">)</span>:<span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>eth.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">{</span>0a:58:0a:f4:01:03<span class="o">}</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>7fade81c
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">1</span>.<span class="w"> </span>ls_in_port_sec_ip<span class="w"> </span><span class="o">(</span>northd.c:5130<span class="o">)</span>:<span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>eth.src<span class="w"> </span><span class="o">==</span><span class="w"> </span>0a:58:0a:f4:01:03<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">{</span><span class="m">10</span>.244.1.3<span class="o">}</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">90</span>,<span class="w"> </span>uuid<span class="w"> </span>4d81359d
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">5</span>.<span class="w"> </span>ls_in_pre_acl<span class="w"> </span><span class="o">(</span>northd.c:5758<span class="o">)</span>:<span class="w"> </span>ip,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>7d029aba
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x7d029aba,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.183s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">13</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ipv6,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x1000000000000000000000000/0x1000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,14<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x7d029aba,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22958</span>.578s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">13</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22958</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ip,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x1000000000000000000000000/0x1000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,14<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x7d029aba,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22958</span>.578s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">13</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22958</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ipv6,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x1000000000000000000000000/0x1000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,14<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x7d029aba,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.182s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">13</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">260424</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">52306797</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ip,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x1000000000000000000000000/0x1000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,14<span class="o">)</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">0</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">6</span>.<span class="w"> </span>ls_in_pre_lb<span class="w"> </span><span class="o">(</span>northd.c:5890<span class="o">)</span>:<span class="w"> </span>ip,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>8a8d61ca
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x8a8d61ca,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">14</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ipv6,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4000000000000000000000000/0x4000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,15<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x8a8d61ca,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.204s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">14</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">260424</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">52306797</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ip,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4000000000000000000000000/0x4000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,15<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x8a8d61ca,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.204s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">14</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ipv6,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4000000000000000000000000/0x4000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,15<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x8a8d61ca,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">14</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ip,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4000000000000000000000000/0x4000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,15<span class="o">)</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">7</span>.<span class="w"> </span>ls_in_pre_stateful<span class="w"> </span><span class="o">(</span>northd.c:5917<span class="o">)</span>:<span class="w"> </span>reg0<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tcp,<span class="w"> </span>priority<span class="w"> </span><span class="m">120</span>,<span class="w"> </span>uuid<span class="w"> </span>01fdf58b
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x1fdf58b,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">15</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">120</span>,tcp,reg0<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>move:NXM_OF_IP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">64</span>..95<span class="o">]</span>,move:NXM_OF_TCP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">32</span>..47<span class="o">]</span>,ct<span class="o">(</span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,zone<span class="o">=</span>NXM_NX_REG13<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span>,nat<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x1fdf58b,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">15</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">120</span>,tcp,reg0<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x8<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>move:NXM_OF_IP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">64</span>..95<span class="o">]</span>,move:NXM_OF_TCP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">32</span>..47<span class="o">]</span>,ct<span class="o">(</span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,zone<span class="o">=</span>NXM_NX_REG13<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span>,nat<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x1fdf58b,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.204s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">15</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">260424</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">52306797</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">120</span>,tcp,reg0<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>move:NXM_OF_IP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">64</span>..95<span class="o">]</span>,move:NXM_OF_TCP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">32</span>..47<span class="o">]</span>,ct<span class="o">(</span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,zone<span class="o">=</span>NXM_NX_REG13<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span>,nat<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x1fdf58b,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.232s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">15</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">120</span>,tcp,reg0<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x2<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>move:NXM_OF_IP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">64</span>..95<span class="o">]</span>,move:NXM_OF_TCP_DST<span class="o">[]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">32</span>..47<span class="o">]</span>,ct<span class="o">(</span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,zone<span class="o">=</span>NXM_NX_REG13<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span>,nat<span class="o">)</span>
<span class="w">    </span><span class="nv">reg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ip4.dst<span class="p">;</span>
<span class="w">    </span>reg2<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tcp.dst<span class="p">;</span>
<span class="w">    </span>ct_lb<span class="p">;</span>

ct_lb
-----
<span class="w"> </span><span class="m">8</span>.<span class="w"> </span>ls_in_acl_hint<span class="w"> </span><span class="o">(</span>northd.c:6041<span class="o">)</span>:<span class="w"> </span>ct.est<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ct_label.blocked<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>uuid<span class="w"> </span>a17a896f
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xa17a896f,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,17<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xa17a896f,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.204s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">16</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">128010</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">31684495</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,17<span class="o">)</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">10</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">9</span>.<span class="w"> </span>ls_in_acl<span class="w"> </span><span class="o">(</span>northd.c:6471<span class="o">)</span>:<span class="w"> </span>ct.est<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.rel<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.new<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.inv<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ct.rpl<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ct_label.blocked<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">65532</span>,<span class="w"> </span>uuid<span class="w"> </span>5ae98b31
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x5ae98b31,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">17</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">65532</span>,ct_state<span class="o">=</span>-new+est-rel+rpl-inv+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,18<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x5ae98b31,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.215s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">17</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">128010</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">31684495</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">65532</span>,ct_state<span class="o">=</span>-new+est-rel+rpl-inv+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,18<span class="o">)</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">13</span>.<span class="w"> </span>ls_in_pre_hairpin<span class="w"> </span><span class="o">(</span>northd.c:6801<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ct.trk,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>2520b1a4
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x2520b1a4,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">21</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ct_state<span class="o">=</span>+trk,ip,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,68<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">102</span><span class="o">]</span>,set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,69<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">108</span><span class="o">]</span>,resubmit<span class="o">(</span>,22<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x2520b1a4,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.215s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">21</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ct_state<span class="o">=</span>+trk,ipv6,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,68<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">102</span><span class="o">]</span>,set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,69<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">108</span><span class="o">]</span>,resubmit<span class="o">(</span>,22<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x2520b1a4,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.215s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">21</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">251254</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">51628217</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ct_state<span class="o">=</span>+trk,ip,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,68<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">102</span><span class="o">]</span>,set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,69<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">108</span><span class="o">]</span>,resubmit<span class="o">(</span>,22<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x2520b1a4,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.233s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">21</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,ct_state<span class="o">=</span>+trk,ipv6,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,68<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">102</span><span class="o">]</span>,set_field:0/0x80-&gt;reg10,resubmit<span class="o">(</span>,69<span class="o">)</span>,move:NXM_NX_REG10<span class="o">[</span><span class="m">7</span><span class="o">]</span>-&gt;NXM_NX_XXREG0<span class="o">[</span><span class="m">108</span><span class="o">]</span>,resubmit<span class="o">(</span>,22<span class="o">)</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">6</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>chk_lb_hairpin<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">12</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>chk_lb_hairpin_reply<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>***<span class="w"> </span>chk_lb_hairpin_reply<span class="w"> </span>action<span class="w"> </span>not<span class="w"> </span>implemented
<span class="w">    </span>next<span class="p">;</span>
<span class="m">22</span>.<span class="w"> </span>ls_in_l2_lkup<span class="w"> </span><span class="o">(</span>northd.c:8292<span class="o">)</span>:<span class="w"> </span>eth.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span>0a:58:0a:f4:01:01,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>e7b71eee
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span><span class="nv">outport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;stor-ovn-worker&quot;</span><span class="p">;</span>
<span class="w">    </span>output<span class="p">;</span>

egress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;ovn-worker&quot;</span>,<span class="w"> </span><span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;default_nginx-deployment-9456bbbf9-x6pc6&quot;</span>,<span class="w"> </span><span class="nv">outport</span><span class="o">=</span><span class="s2">&quot;stor-ovn-worker&quot;</span><span class="o">)</span>
-----------------------------------------------------------------------------------------------------
<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>ls_out_pre_lb<span class="w"> </span><span class="o">(</span>northd.c:5647<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stor-ovn-worker&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">110</span>,<span class="w"> </span>uuid<span class="w"> </span>a85134e9
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">1</span>.<span class="w"> </span>ls_out_pre_acl<span class="w"> </span><span class="o">(</span>northd.c:5647<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stor-ovn-worker&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">110</span>,<span class="w"> </span>uuid<span class="w"> </span>473dc0a5
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">3</span>.<span class="w"> </span>ls_out_acl_hint<span class="w"> </span><span class="o">(</span>northd.c:6041<span class="o">)</span>:<span class="w"> </span>ct.est<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ct_label.blocked<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>uuid<span class="w"> </span>5f2e1810
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x5f2e1810,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">43</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,44<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x5f2e1810,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.216s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">43</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">128010</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">31684495</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">1</span>,ct_state<span class="o">=</span>+est+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x400000000000000000000000000/0x400000000000000000000000000-&gt;xxreg0,resubmit<span class="o">(</span>,44<span class="o">)</span>
<span class="w">    </span>reg0<span class="o">[</span><span class="m">10</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">4</span>.<span class="w"> </span>ls_out_acl<span class="w"> </span><span class="o">(</span>northd.c:6473<span class="o">)</span>:<span class="w"> </span>ct.est<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.rel<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.new<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>!ct.inv<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ct.rpl<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ct_label.blocked<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">65532</span>,<span class="w"> </span>uuid<span class="w"> </span>72e85294
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x72e85294,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">44</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">65532</span>,ct_state<span class="o">=</span>-new+est-rel+rpl-inv+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x5<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,45<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x72e85294,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.216s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">44</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">128010</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">31684495</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">65532</span>,ct_state<span class="o">=</span>-new+est-rel+rpl-inv+trk,ct_label<span class="o">=</span><span class="m">0</span>/0x1,metadata<span class="o">=</span>0x3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,45<span class="o">)</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">9</span>.<span class="w"> </span>ls_out_port_sec_l2<span class="w"> </span><span class="o">(</span>northd.c:5594<span class="o">)</span>:<span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;stor-ovn-worker&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>ae50e49e
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>output<span class="p">;</span>
<span class="w">    </span>/*<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span><span class="s2">&quot;stor-ovn-worker&quot;</span>,<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">&quot;patch&quot;</span><span class="w"> </span>*/

ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;ovn_cluster_router&quot;</span>,<span class="w"> </span><span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;rtos-ovn-worker&quot;</span><span class="o">)</span>
----------------------------------------------------------
<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>lr_in_admission<span class="w"> </span><span class="o">(</span>northd.c:10523<span class="o">)</span>:<span class="w"> </span>eth.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span>0a:58:0a:f4:01:01<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtos-ovn-worker&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>is_chassis_resident<span class="o">(</span><span class="s2">&quot;cr-rtos-ovn-worker&quot;</span><span class="o">)</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>16833f18
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>xreg0<span class="o">[</span><span class="m">0</span>..47<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:0a:f4:01:01<span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">1</span>.<span class="w"> </span>lr_in_lookup_neighbor<span class="w"> </span><span class="o">(</span>northd.c:10667<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>uuid<span class="w"> </span><span class="m">39881020</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x39881020,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">9</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">84769</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">16419002</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x39881020,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">9</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">34573</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">3262795</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
<span class="w">    </span>reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">2</span>.<span class="w"> </span>lr_in_learn_neighbor<span class="w"> </span><span class="o">(</span>northd.c:10676<span class="o">)</span>:<span class="w"> </span>reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>reg9<span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>6be9d860
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">84769</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">16419002</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.183s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">34585</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">3263563</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">869</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">39094</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">29</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">10</span>.<span class="w"> </span>lr_in_ip_routing_pre<span class="w"> </span><span class="o">(</span>northd.c:10910<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>uuid<span class="w"> </span>219bc578
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x219bc578,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">18</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">84764</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">16418452</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0xffffffff-&gt;xxreg1,resubmit<span class="o">(</span>,19<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x219bc578,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.183s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">18</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">34561</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">3261195</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0xffffffff-&gt;xxreg1,resubmit<span class="o">(</span>,19<span class="o">)</span>
<span class="w">    </span><span class="nv">reg7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">11</span>.<span class="w"> </span>lr_in_ip_routing<span class="w"> </span><span class="o">(</span>northd.c:9439<span class="o">)</span>:<span class="w"> </span><span class="nv">reg7</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">100</span>.64.0.3/32,<span class="w"> </span>priority<span class="w"> </span><span class="m">97</span>,<span class="w"> </span>uuid<span class="w"> </span>4b1e23e5
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x4b1e23e5,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">19</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">97</span>,ip,reg7<span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1,nw_dst<span class="o">=</span><span class="m">100</span>.64.0.3<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>dec_ttl<span class="o">()</span>,set_field:0/0xffff00000000-&gt;xreg4,set_field:0x64400003000000000000000000000000/0xffffffff000000000000000000000000-&gt;xxreg0,set_field:0x644000010000000000000000/0xffffffff0000000000000000-&gt;xxreg0,set_field:0a:58:64:40:00:01-&gt;eth_src,set_field:0x1-&gt;reg15,set_field:0x1/0x1-&gt;reg10,resubmit<span class="o">(</span>,20<span class="o">)</span>
<span class="w">    </span>ip.ttl--<span class="p">;</span>
<span class="w">    </span>reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span><span class="nv">reg0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>.64.0.3<span class="p">;</span>
<span class="w">    </span><span class="nv">reg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>.64.0.1<span class="p">;</span>
<span class="w">    </span>eth.src<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:01<span class="p">;</span>
<span class="w">    </span><span class="nv">outport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span><span class="p">;</span>
<span class="w">    </span>flags.loopback<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">12</span>.<span class="w"> </span>lr_in_ip_routing_ecmp<span class="w"> </span><span class="o">(</span>northd.c:10985<span class="o">)</span>:<span class="w"> </span>reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">150</span>,<span class="w"> </span>uuid<span class="w"> </span>f65895a6
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xf65895a6,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">20</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">84764</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">16418452</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">150</span>,reg8<span class="o">=</span><span class="m">0</span>/0xffff,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,21<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xf65895a6,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.186s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">20</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">21</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">2064</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">14155</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">150</span>,reg8<span class="o">=</span><span class="m">0</span>/0xffff,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,21<span class="o">)</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">13</span>.<span class="w"> </span>lr_in_policy<span class="w"> </span><span class="o">(</span>northd.c:8672<span class="o">)</span>:<span class="w"> </span>ip4.src<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">10</span>.244.0.0/16<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">100</span>.64.0.0/16,<span class="w"> </span>priority<span class="w"> </span><span class="m">101</span>,<span class="w"> </span>uuid<span class="w"> </span>f385bfe8
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xf385bfe8,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">21</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">101</span>,ip,metadata<span class="o">=</span>0x1,nw_src<span class="o">=</span><span class="m">10</span>.244.0.0/16,nw_dst<span class="o">=</span><span class="m">100</span>.64.0.0/16<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0xffff00000000-&gt;xreg4,resubmit<span class="o">(</span>,22<span class="o">)</span>
<span class="w">    </span>reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">14</span>.<span class="w"> </span>lr_in_policy_ecmp<span class="w"> </span><span class="o">(</span>northd.c:11120<span class="o">)</span>:<span class="w"> </span>reg8<span class="o">[</span><span class="m">0</span>..15<span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">150</span>,<span class="w"> </span>uuid<span class="w"> </span>e3a1301b
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xe3a1301b,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.217s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">22</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">84764</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">16418452</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">150</span>,reg8<span class="o">=</span><span class="m">0</span>/0xffff,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,23<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xe3a1301b,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.186s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">22</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">21</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">2064</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">14155</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">150</span>,reg8<span class="o">=</span><span class="m">0</span>/0xffff,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,23<span class="o">)</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">15</span>.<span class="w"> </span>lr_in_arp_resolve<span class="w"> </span><span class="o">(</span>northd.c:11506<span class="o">)</span>:<span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">reg0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">100</span>.64.0.3,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>33f04862
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x33f04862,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">23</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg0<span class="o">=</span>0x64400003,reg15<span class="o">=</span>0x1,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0a:58:64:40:00:03-&gt;eth_dst,resubmit<span class="o">(</span>,24<span class="o">)</span>
<span class="w">    </span>eth.dst<span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">19</span>.<span class="w"> </span>lr_in_arp_request<span class="w"> </span><span class="o">(</span>northd.c:11801<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>uuid<span class="w"> </span>0abbeff8
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xabbeff8,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">27</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">84764</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">16418452</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,37<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xabbeff8,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">27</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">20</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">1990</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">14155</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,37<span class="o">)</span>
<span class="w">    </span>output<span class="p">;</span>

egress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;ovn_cluster_router&quot;</span>,<span class="w"> </span><span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;rtos-ovn-worker&quot;</span>,<span class="w"> </span><span class="nv">outport</span><span class="o">=</span><span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span><span class="o">)</span>
--------------------------------------------------------------------------------------------
<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>lr_out_chk_dnat_local<span class="w"> </span><span class="o">(</span>northd.c:13026<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>uuid<span class="w"> </span>a02f42a1
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xa02f42a1,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">40</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">84752</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">16417482</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0x10-&gt;xreg4,resubmit<span class="o">(</span>,41<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0xa02f42a1,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.184s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">40</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">465</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">21988</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">29</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0/0x10-&gt;xreg4,resubmit<span class="o">(</span>,41<span class="o">)</span>
<span class="w">    </span>reg9<span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">6</span>.<span class="w"> </span>lr_out_delivery<span class="w"> </span><span class="o">(</span>northd.c:11848<span class="o">)</span>:<span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>5428c7e9
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x5428c7e9,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">46</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg15<span class="o">=</span>0x1,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,64<span class="o">)</span>
<span class="w">    </span>output<span class="p">;</span>
<span class="w">    </span>/*<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span><span class="s2">&quot;rtoj-ovn_cluster_router&quot;</span>,<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">&quot;patch&quot;</span><span class="w"> </span>*/

ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;join&quot;</span>,<span class="w"> </span><span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;jtor-ovn_cluster_router&quot;</span><span class="o">)</span>
----------------------------------------------------
<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>ls_in_port_sec_l2<span class="w"> </span><span class="o">(</span>northd.c:5497<span class="o">)</span>:<span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;jtor-ovn_cluster_router&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>485af0cc
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x485af0cc,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">8</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">50</span>,reg14<span class="o">=</span>0x1,metadata<span class="o">=</span>0x2<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,9<span class="o">)</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">6</span>.<span class="w"> </span>ls_in_pre_lb<span class="w"> </span><span class="o">(</span>northd.c:5644<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;jtor-ovn_cluster_router&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">110</span>,<span class="w"> </span>uuid<span class="w"> </span>61c2f8b4
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x61c2f8b4,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">14</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">110</span>,ipv6,reg14<span class="o">=</span>0x1,metadata<span class="o">=</span>0x2<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,15<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x61c2f8b4,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">14</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">110</span>,ip,reg14<span class="o">=</span>0x1,metadata<span class="o">=</span>0x2<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,15<span class="o">)</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="m">22</span>.<span class="w"> </span>ls_in_l2_lkup<span class="w"> </span><span class="o">(</span>northd.c:8292<span class="o">)</span>:<span class="w"> </span>eth.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span>0a:58:64:40:00:03,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>4ec697e3
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x4ec697e3,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.234s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">30</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">50</span>,metadata<span class="o">=</span>0x2,dl_dst<span class="o">=</span>0a:58:64:40:00:03<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x2-&gt;reg15,resubmit<span class="o">(</span>,37<span class="o">)</span>
<span class="w">    </span><span class="nv">outport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;jtor-GR_ovn-worker&quot;</span><span class="p">;</span>
<span class="w">    </span>output<span class="p">;</span>

egress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;join&quot;</span>,<span class="w"> </span><span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;jtor-ovn_cluster_router&quot;</span>,<span class="w"> </span><span class="nv">outport</span><span class="o">=</span><span class="s2">&quot;jtor-GR_ovn-worker&quot;</span><span class="o">)</span>
---------------------------------------------------------------------------------
<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>ls_out_pre_lb<span class="w"> </span><span class="o">(</span>northd.c:5647<span class="o">)</span>:<span class="w"> </span>ip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;jtor-GR_ovn-worker&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">110</span>,<span class="w"> </span>uuid<span class="w"> </span>ff3a234e
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">9</span>.<span class="w"> </span>ls_out_port_sec_l2<span class="w"> </span><span class="o">(</span>northd.c:5594<span class="o">)</span>:<span class="w"> </span><span class="nv">outport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;jtor-GR_ovn-worker&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span><span class="m">65252832</span>
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>output<span class="p">;</span>
<span class="w">    </span>/*<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span><span class="s2">&quot;jtor-GR_ovn-worker&quot;</span>,<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">&quot;l3gateway&quot;</span><span class="w"> </span>*/

ingress<span class="o">(</span><span class="nv">dp</span><span class="o">=</span><span class="s2">&quot;GR_ovn-worker&quot;</span>,<span class="w"> </span><span class="nv">inport</span><span class="o">=</span><span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span><span class="o">)</span>
--------------------------------------------------------
<span class="w"> </span><span class="m">0</span>.<span class="w"> </span>lr_in_admission<span class="w"> </span><span class="o">(</span>northd.c:10523<span class="o">)</span>:<span class="w"> </span>eth.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span>0a:58:64:40:00:03<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">50</span>,<span class="w"> </span>uuid<span class="w"> </span>edfaf0af
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>xreg0<span class="o">[</span><span class="m">0</span>..47<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0a:58:64:40:00:03<span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">1</span>.<span class="w"> </span>lr_in_lookup_neighbor<span class="w"> </span><span class="o">(</span>northd.c:10667<span class="o">)</span>:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>uuid<span class="w"> </span><span class="m">39881020</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x39881020,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.218s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">9</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">84769</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">16419002</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x39881020,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.185s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">9</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">34573</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">3262795</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">0</span>,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>set_field:0x4/0x4-&gt;xreg4,resubmit<span class="o">(</span>,10<span class="o">)</span>
<span class="w">    </span>reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">;</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">2</span>.<span class="w"> </span>lr_in_learn_neighbor<span class="w"> </span><span class="o">(</span>northd.c:10676<span class="o">)</span>:<span class="w"> </span>reg9<span class="o">[</span><span class="m">2</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>reg9<span class="o">[</span><span class="m">3</span><span class="o">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span>,<span class="w"> </span>priority<span class="w"> </span><span class="m">100</span>,<span class="w"> </span>uuid<span class="w"> </span>6be9d860
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.219s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">84769</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">16419002</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.185s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">34585</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">3263563</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span><span class="m">0</span>/0x8,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.186s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">869</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">39094</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">29</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x9<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span><span class="nv">cookie</span><span class="o">=</span>0x6be9d860,<span class="w"> </span><span class="nv">duration</span><span class="o">=</span><span class="m">22959</span>.219s,<span class="w"> </span><span class="nv">table</span><span class="o">=</span><span class="m">10</span>,<span class="w"> </span><span class="nv">n_packets</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">n_bytes</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">idle_age</span><span class="o">=</span><span class="m">22959</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">100</span>,reg9<span class="o">=</span>0x4/0x4,metadata<span class="o">=</span>0x1<span class="w"> </span><span class="nv">actions</span><span class="o">=</span>resubmit<span class="o">(</span>,11<span class="o">)</span>
<span class="w">    </span>next<span class="p">;</span>
<span class="w"> </span><span class="m">4</span>.<span class="w"> </span>lr_in_unsnat<span class="w"> </span><span class="o">(</span>northd.c:10378<span class="o">)</span>:<span class="w"> </span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">100</span>.64.0.3,<span class="w"> </span>priority<span class="w"> </span><span class="m">110</span>,<span class="w"> </span>uuid<span class="w"> </span>e548aaeb
<span class="w">    </span>***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows
<span class="w">    </span>ct_snat<span class="p">;</span>
</code></pre></div></td></tr></table></div></p>
<p>We can see that we hit <code class="highlight">ct_snat</code> in the <code class="highlight">ingress</code> pipeline of <code class="highlight">GR_ovn-worker</code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ovn-sbctl dump-flows</span>
<span class="o">(</span>...<span class="o">)</span>
Datapath:<span class="w"> </span><span class="s2">&quot;GR_ovn-worker&quot;</span><span class="w"> </span><span class="o">(</span>15e72dff-677d-4794-8f70-a5fea49ad788<span class="o">)</span><span class="w">  </span>Pipeline:<span class="w"> </span>ingress
<span class="o">(</span>...<span class="o">)</span>
<span class="w">  </span><span class="nv">table</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="o">(</span>lr_in_unsnat<span class="w">       </span><span class="o">)</span>,<span class="w"> </span><span class="nv">priority</span><span class="o">=</span><span class="m">110</span><span class="w">  </span>,<span class="w"> </span><span class="nv">match</span><span class="o">=(</span><span class="nv">inport</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;rtoj-GR_ovn-worker&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ip4.dst<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">100</span>.64.0.3<span class="o">)</span>,<span class="w"> </span><span class="nv">action</span><span class="o">=(</span>ct_snat<span class="p">;</span><span class="o">)</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div></p>
<p>Now, here, we hit an unfortunate shortcoming of ovn-trace - it does not what to do due to missing conntrack entries, and thus on a gatway router it will treat <code class="highlight">ct_snat</code> as if this was a noop:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">      </span>This<span class="w"> </span>action<span class="w"> </span>distinguishes<span class="w"> </span>between<span class="w"> </span>gateway<span class="w"> </span>routers<span class="w"> </span>and<span class="w"> </span>distributed
<span class="w">      </span>routers.<span class="w">  </span>A<span class="w"> </span>gateway<span class="w"> </span>router<span class="w"> </span>is<span class="w"> </span>defined<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>logical<span class="w"> </span>datapath<span class="w"> </span>that<span class="w"> </span>contains
<span class="w">      </span>an<span class="w"> </span><span class="nt">&lt;code&gt;</span>l3gateway<span class="nt">&lt;/code&gt;</span><span class="w"> </span>port;<span class="w"> </span>any<span class="w"> </span>other<span class="w"> </span>logical<span class="w"> </span>datapath<span class="w"> </span>is<span class="w"> </span>a
<span class="w">      </span>distributed<span class="w"> </span>router.<span class="w">  </span>On<span class="w"> </span>a<span class="w"> </span>gateway<span class="w"> </span>router,<span class="w"> </span><span class="nt">&lt;code&gt;</span>ct_snat;<span class="nt">&lt;/code&gt;</span><span class="w"> </span>is
<span class="w">      </span>treated<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>no-op.<span class="w">  </span>On<span class="w"> </span>a<span class="w"> </span>distributed<span class="w"> </span>router,<span class="w"> </span>it<span class="w"> </span>is<span class="w"> </span>treated<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>way
<span class="w">      </span>as<span class="w"> </span><span class="nt">&lt;code&gt;</span>ct_dnat;<span class="nt">&lt;/code&gt;</span>.
</code></pre></div></td></tr></table></div>
From: <a href="https://github.com/ovn-org/ovn/blob/ed81be75e8b3b33745eeb9b6ce2686b87ef72cd0/utilities/ovn-trace.8.xml#L242">https://github.com/ovn-org/ovn/blob/ed81be75e8b3b33745eeb9b6ce2686b87ef72cd0/utilities/ovn-trace.8.xml#L242</a></p>
<p>For our example, this means that the processing stops here, and that we have to figure out ourselves what would happen here. We know that the loadbalancer should rewrite the DNAT and SNAT that was done initially, and we can simply run a new trace. First, though, we have to find out from where.</p>
<p>We know that the packet will go out of <code class="highlight">GR_ovn-worker</code> and from port <code class="highlight">rtoe-GR_ovn-worker</code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># ovn-nbctl show</span>
<span class="o">(</span>...<span class="o">)</span>
switch<span class="w"> </span>214f4d51-750d-414a-aad1-94e84e623f9b<span class="w"> </span><span class="o">(</span>ext_ovn-worker<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>breth0_ovn-worker
<span class="w">        </span>type:<span class="w"> </span>localnet
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;unknown&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>etor-GR_ovn-worker
<span class="w">        </span>type:<span class="w"> </span>router
<span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:04&quot;</span><span class="o">]</span>
<span class="w">        </span>router-port:<span class="w"> </span>rtoe-GR_ovn-worker
<span class="o">(</span>...<span class="o">)</span>
router<span class="w"> </span>5ea87f54-ceeb-442a-92c8-4b522278b5dd<span class="w"> </span><span class="o">(</span>GR_ovn-worker<span class="o">)</span>
<span class="w">    </span>port<span class="w"> </span>rtoj-GR_ovn-worker
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;0a:58:64:40:00:03&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;100.64.0.3/16&quot;</span><span class="o">]</span>
<span class="w">    </span>port<span class="w"> </span>rtoe-GR_ovn-worker
<span class="w">        </span>mac:<span class="w"> </span><span class="s2">&quot;02:42:ac:12:00:04&quot;</span>
<span class="w">        </span>networks:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;172.18.0.4/16&quot;</span><span class="o">]</span>
<span class="w">    </span>nat<span class="w"> </span>ca3ef3e0-22c1-427d-a977-b10256a96177
<span class="w">        </span>external<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;172.18.0.4&quot;</span>
<span class="w">        </span>logical<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;10.244.0.0/16&quot;</span>
<span class="w">        </span>type:<span class="w"> </span><span class="s2">&quot;snat&quot;</span>
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div></p>
<p>Let's find the switch port that matches this router port:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code>sh-5.1#<span class="w"> </span>ovn-nbctl<span class="w"> </span>find<span class="w"> </span>logical_switch_port<span class="w"> </span><span class="s2">&quot;options={router-port=rtoe-GR_ovn-worker}&quot;</span>
_uuid<span class="w">               </span>:<span class="w"> </span>2b6e5ae2-a67f-4526-8b53-316a265a1acc
addresses<span class="w">           </span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;02:42:ac:12:00:04&quot;</span><span class="o">]</span>
dhcpv4_options<span class="w">      </span>:<span class="w"> </span><span class="o">[]</span>
dhcpv6_options<span class="w">      </span>:<span class="w"> </span><span class="o">[]</span>
dynamic_addresses<span class="w">   </span>:<span class="w"> </span><span class="o">[]</span>
enabled<span class="w">             </span>:<span class="w"> </span><span class="o">[]</span>
external_ids<span class="w">        </span>:<span class="w"> </span><span class="o">{}</span>
ha_chassis_group<span class="w">    </span>:<span class="w"> </span><span class="o">[]</span>
name<span class="w">                </span>:<span class="w"> </span>etor-GR_ovn-worker
options<span class="w">             </span>:<span class="w"> </span><span class="o">{</span>router-port<span class="o">=</span>rtoe-GR_ovn-worker<span class="o">}</span>
parent_name<span class="w">         </span>:<span class="w"> </span><span class="o">[]</span>
port_security<span class="w">       </span>:<span class="w"> </span><span class="o">[]</span>
tag<span class="w">                 </span>:<span class="w"> </span><span class="o">[]</span>
tag_request<span class="w">         </span>:<span class="w"> </span><span class="o">[]</span>
<span class="nb">type</span><span class="w">                </span>:<span class="w"> </span>router
up<span class="w">                  </span>:<span class="w"> </span><span class="nb">true</span>
</code></pre></div></td></tr></table></div></p>
<p>And now, we can craft the ovn-trace command that shows our packet is indeed leaving on <code class="highlight">breth0_ovn-worker</code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code>sh-5.1#<span class="w"> </span>ovn-trace<span class="w"> </span>--ct<span class="w"> </span>est,rpl<span class="w"> </span>--ovs<span class="w"> </span>ext_ovn-worker<span class="w"> </span><span class="s1">&#39;inport == &quot;etor-GR_ovn-worker&quot; &amp;&amp; eth.src == 02:42:ac:12:00:04 &amp;&amp;  eth.dst == 02:42:7a:79:82:ca &amp;&amp; ip4.src == 171.18.0.4 &amp;&amp; ip4.dst == 171.18.0.1 &amp;&amp; ip.ttl == 64 &amp;&amp; tcp.src==30007 &amp;&amp; tcp.dst == 47306&#39;</span><span class="w">  </span>--minimal
<span class="c1"># tcp,reg14=0x2,vlan_tci=0x0000,dl_src=02:42:ac:12:00:04,dl_dst=02:42:7a:79:82:ca,nw_src=171.18.0.4,nw_dst=171.18.0.1,nw_tos=0,nw_ecn=0,nw_ttl=64,tp_src=30007,tp_dst=47306,tcp_flags=0</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
***<span class="w"> </span>no<span class="w"> </span>OpenFlow<span class="w"> </span>flows<span class="p">;</span>
output<span class="o">(</span><span class="s2">&quot;breth0_ovn-worker&quot;</span><span class="o">)</span><span class="p">;</span>
sh-5.1#<span class="w"> </span>
</code></pre></div></td></tr></table></div></p>
<h2 id="sources-and-references">Sources and references</h2>
<p>Man pages:</p>
<ul>
<li><a href="https://man7.org/linux/man-pages/man8/ovn-trace.8.html">https://man7.org/linux/man-pages/man8/ovn-trace.8.html</a></li>
<li><a href="https://man7.org/linux/man-pages/man5/ovn-sb.5.html">https://man7.org/linux/man-pages/man5/ovn-sb.5.html</a></li>
</ul>
<p>Some discussion around ovn-trace:</p>
<ul>
<li><a href="https://www.mail-archive.com/ovs-discuss@openvswitch.org/msg07214.html">https://www.mail-archive.com/ovs-discuss@openvswitch.org/msg07214.html</a></li>
</ul>
<p>Examples for ovn-trace commands can be found inside the OVN test cases:</p>
<ul>
<li><a href="https://www.mail-archive.com/ovs-dev@openvswitch.org/msg55608.html">https://www.mail-archive.com/ovs-dev@openvswitch.org/msg55608.html</a></li>
<li>Simple test cases with <code class="highlight">--ct new</code>: <a href="https://github.com/ovn-org/ovn/blob/main/tests/ovn-northd.at">https://github.com/ovn-org/ovn/blob/main/tests/ovn-northd.at</a></li>
<li>More complex test cases: <a href="https://github.com/ovn-org/ovn/blob/main/tests/ovn.at">https://github.com/ovn-org/ovn/blob/main/tests/ovn.at</a></li>
</ul>
<p>RFCs:</p>
<ul>
<li><a href="https://datatracker.ietf.org/doc/html/rfc793#section-3.1">https://datatracker.ietf.org/doc/html/rfc793#section-3.1</a></li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">February 16, 2022</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.prune", "navigation.top", "navigation.path", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>