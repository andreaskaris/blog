
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Andreas Karis' blog about anything Kubernetes, OpenShift, Linux and Networking">
      
      
      
        <link rel="canonical" href="https://andreaskaris.github.io/blog/openshift/ingress-controller-sharding-on-separate-vip/">
      
      
        <link rel="prev" href="../ingresscontroller_router_sharding_ocp_on_osp/">
      
      
        <link rel="next" href="../openshift_mirror_registry/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Ingress Controller Sharding on separate VIP - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="RSS feed of created content" href="https://andreaskaris.github.io/blog/feed_rss_created.xml">
  <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="https://andreaskaris.github.io/blog/feed_rss_updated.xml">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ingress Controller Sharding on separate VIP
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ceph/" class="md-tabs__link">
          
  
    
  
  Ceph

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux/" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../networking/" class="md-tabs__link">
          
  
    
  
  Networking

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  OpenShift and Kubernetes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openstack/" class="md-tabs__link">
          
  
    
  
  OpenStack

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../coding/" class="md-tabs__link">
          
  
    
  
  Coding

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  
    
    <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ceph/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ceph
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ceph
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ceph/ceph-manual-test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ceph manual test with qemu
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../linux/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cgroups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containers in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/hugepages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugepages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/ipxe-boot-environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iPXE boot environment on Fedora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/java-idrac-issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java Idrac Issues
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/meson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    meson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    namespaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/old_java_version_with_xorgs_in_container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Old Java inside a container with xorgs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/protect-lenovo-battery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Protect Lenovo laptop battery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/org-gnome-shell-overrides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workaround for org.gnome.shell.overrides not installed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/get-process-cgroup-info-and-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retrieving process cgroup resource usage and limit info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/libvirt-uefi-without-secureboot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RHEL Booting a virtual machine with UEFI but without secure boot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/setting-journalctl-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting journalctl limits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups_cpu_quota/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using cgroups for CFS bandwidth control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/udev-ethtool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    udev rules to apply ethtool settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/selinux-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SELinux Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../networking/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Networking
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Networking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/accept-source-routing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accept Source Routing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/arp_and_the_neighbor_table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ARP and the Neighbor table
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/bpf-and-tcpdump/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BPF and tcpdump
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/bonding_in_linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bonding in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/juniper_x520/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure Juniper switch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovn-interconnection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hands-on with OVN Interconnection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/haproxy-and-h2c/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    haproxy and HTTP/2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/install-openvswitch-on-rocky/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Open vSwitch on Rocky Linux 8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/geneve_tunneling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Geneve tunneling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/netlink/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Netlink
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/netlink-address-fields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Netlink and MAC addresses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovn_standalone_on_fedora/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVN standalone on Fedora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovs_recirculation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS packet recirculation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovs-vxlan-tunnels-and-dscp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS VXLAN tunnels and DSCP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovs_with_gdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS with GDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/packet-tracing-with-ovn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Packet tracing with OVN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/sctp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/useful-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/wireguard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wireguard
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenShift and Kubernetes
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            OpenShift and Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alertmanager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AlertManager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analyzing-cni/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analyzing CNI calls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ocp-custom-release-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building custom release images for OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpu-manager-with-custom-machine-config-pool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPU manager with custom MachineConfigPool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpu-isolation-in-openshift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPU isolation in Red Hat OpenShift Container Platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crio-conmon-runc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crio vs conmon vs runc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dedicated-service-monitors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DedicatedServiceMonitors in OpenShift Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../etcd_perf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Etcd Performance tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../get-vs-list-api-calls/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get vs List API Calls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift_httpbin_tshark_sidecar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Httpbin tshark sidecar container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hints for installing kubernetes on Fedora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../HPA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Horizontal Pod Autoscaler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how_rhcos_updates_work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How RHCOS updates work
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubelet-filesystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How kubelet monitors filesystems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ocp4-infra-nodes-with-machineset-without-worker-label/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infra nodes with MachineSets without worker label
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingresscontroller_router_sharding_ocp_on_osp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress Controller Sharding OCP on OSP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Ingress Controller Sharding on separate VIP
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift_mirror_registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing a cluster with a mirror registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../istio-1.6-on-ocp.4.x/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Istio 1.6 on OpenShift 4.x
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kata containers and the kata operatora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kernel-ml-on-openshift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kernel-ml on OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ovn-kind-hybrid-overlay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kind with OVN Kubernetes Hybrid Overlay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kind-with-private-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kind with private registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../list_docker_registry_containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    List container images in registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mounting-container-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mount a container image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/install_openshift_on_openstack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenShift on OpenStack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift-with-multipath/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenShift with iSCSI multipath
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patch-service-loadbalancer-ingress-ip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Patch status.loadBalancer.ingress IP manually
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../private-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private container registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proxy-ocp-4.5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proxy OCP 4.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rpm-ostree-failed-to-find-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rpm-ostreed failed to find image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../seccomp-defaults-ocp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Seccomp defaults in Red Hat OpenShift Container Platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security Context Constraints (SCC)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift-scc-with-mutating-webhooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCCs and mutating webhooks - a lesson learned
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fix-selinux-labels-coreos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SElinux labels fix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/sctp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift_troubleshooting_etcd_state/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting etcd state
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../useful-ocp-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful commands for OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../useful-ocp-sdn-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful commands for OpenShift SDN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting_openshift_on_openstack_worker_creation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting OpenShift on OpenStack worker creation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../openstack/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenStack
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            OpenStack
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/reattach_to_running_deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reattach to running deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/using_clouds_yaml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using clouds.yaml
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../coding/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coding
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Coding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/operator-sdk-reconciliation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller Reconciliation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/vimrc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    My vimrc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/golang-ip-conversion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Golang IP address conversion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
        </div>
      </div>
    </div>
  
  
    
    <!--
    <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
</nav>
        </div>
      </div>
    </div>
    -->
  

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="ingress-controller-sharding-on-separate-vip">Ingress Controller Sharding on separate VIP</h1>
<p>It is important to know that each node can only host one ingress router with <code class="highlight">HostNetwork</code> networking. You will need a specific role for each INGRESS type and different INGRESS types cannot be hosted on the same worker node. This is due to the particularities of the <code class="highlight">HostNetwork</code> network type.</p>
<p>The following example uses the OpenStack IPI.</p>
<h2 id="step-1-scale-out-by-2-more-worker-nodes">Step 1: Scale out by 2 more worker nodes</h2>
<p>Scale out the worker role. This step might have to be improved.
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server cluster-logging</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="n">openshift</span><span class="o">-</span><span class="n">machine</span><span class="o">-</span><span class="n">api</span><span class="w"> </span><span class="o">--</span><span class="n">replicas</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">machineset</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span>
<span class="n">machineset</span><span class="p">.</span><span class="n">machine</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="w"> </span><span class="n">scaled</span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server cluster-logging</span><span class="o">]</span><span class="err">$</span><span class="w"> </span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">nodes</span>
<span class="n">NAME</span><span class="w">                            </span><span class="n">STATUS</span><span class="w">   </span><span class="n">ROLES</span><span class="w">    </span><span class="n">AGE</span><span class="w">     </span><span class="n">VERSION</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">0</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">   </span><span class="mi">5</span><span class="n">h18m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">   </span><span class="mi">5</span><span class="n">h18m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">   </span><span class="mi">5</span><span class="n">h19m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">g4q6z</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">5</span><span class="n">h4m</span><span class="w">    </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">2</span><span class="n">m12s</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">5</span><span class="n">h1m</span><span class="w">    </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">5</span><span class="n">h6m</span><span class="w">    </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">2</span><span class="n">m57s</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
</code></pre></div></td></tr></table></div>
<h2 id="step-2-add-additional-interface-to-additional-nodes">Step 2: Add additional interface to additional nodes</h2>
<p>This step will be executed within the underlying infrastructure provider. In this example case, OpenShift is hosted on top of OpenStack.</p>
<p>Make sure that the subnet runs a DHCP server:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">subnet</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="o">--</span><span class="nx">dhcp</span><span class="w"> </span><span class="mi">41</span><span class="nx">c073c0</span><span class="o">-</span><span class="mi">5</span><span class="nx">b6a</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">9023</span><span class="o">-</span><span class="mi">115</span><span class="nx">ce3d0e378</span>
<span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">subnet</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="mi">41</span><span class="nx">c073c0</span><span class="o">-</span><span class="mi">5</span><span class="nx">b6a</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">9023</span><span class="o">-</span><span class="mi">115</span><span class="nx">ce3d0e378</span>
<span class="o">+-------------------+--------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nx">Field</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="nx">Value</span><span class="w">                                </span><span class="o">|</span>
<span class="o">+-------------------+--------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nx">allocation_pools</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="m m-Double">172.31.254.2</span><span class="o">-</span><span class="m m-Double">172.31.254.254</span><span class="w">          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">cidr</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="m m-Double">172.31.254.0</span><span class="o">/</span><span class="mi">24</span><span class="w">                      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">created_at</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span><span class="nx">T17</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">39</span><span class="nx">Z</span><span class="w">                 </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">description</span><span class="w">       </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">dns_nameservers</span><span class="w">   </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">enable_dhcp</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nx">True</span><span class="w">                                 </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">gateway_ip</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="m m-Double">172.31.254.1</span><span class="w">                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">host_routes</span><span class="w">       </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">id</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="mi">41</span><span class="nx">c073c0</span><span class="o">-</span><span class="mi">5</span><span class="nx">b6a</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">9023</span><span class="o">-</span><span class="mi">115</span><span class="nx">ce3d0e378</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">ip_version</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w">                                    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">ipv6_address_mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                 </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">ipv6_ra_mode</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                 </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">name</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span><span class="o">-</span><span class="nx">subnet</span><span class="w">                </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">network_id</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nx">aa68c208</span><span class="o">-</span><span class="nx">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="nx">e</span><span class="o">-</span><span class="nx">b508</span><span class="o">-</span><span class="mi">1</span><span class="nx">b9d82f3baa4</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">prefix_length</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                 </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">project_id</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nx">ea78dddee3e240c7af1779b417c64618</span><span class="w">     </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">revision_number</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                                    </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">segment_id</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                 </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">service_types</span><span class="w">     </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">subnetpool_id</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                 </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">tags</span><span class="w">              </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">updated_at</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nx">T15</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">17</span><span class="nx">Z</span><span class="w">                 </span><span class="o">|</span>
<span class="o">+-------------------+--------------------------------------+</span>
</code></pre></div></td></tr></table></div></p>
<p>And create a router that can host floating IPs:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>openstack router create akaris-backend
openstack router set --external-gateway 5cd089f9-8ed2-46bc-8ea7-4e1cdb5262ba akaris-backend
openstack router add subnet akaris-backend akaris-backend-subnet
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="o">--</span><span class="nx">network</span><span class="w"> </span><span class="nx">aa68c208</span><span class="o">-</span><span class="nx">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="nx">e</span><span class="o">-</span><span class="nx">b508</span><span class="o">-</span><span class="mi">1</span><span class="nx">b9d82f3baa4</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">hp2hz</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span>
<span class="o">+-----------------------+------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nx">Field</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="nx">Value</span><span class="w">                                                                        </span><span class="o">|</span>
<span class="o">+-----------------------+------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nx">admin_state_up</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nx">UP</span><span class="w">                                                                           </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">allowed_address_pairs</span><span class="w"> </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_host_id</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_profile</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_vif_details</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_vif_type</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_vnic_type</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">normal</span><span class="w">                                                                       </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">created_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nx">T14</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">17</span><span class="nx">Z</span><span class="w">                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">data_plane_status</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">description</span><span class="w">           </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">device_id</span><span class="w">             </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">device_owner</span><span class="w">          </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">dns_assignment</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">dns_name</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">extra_dhcp_opts</span><span class="w">       </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">fixed_ips</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="nx">ip_address</span><span class="p">=</span><span class="err">&#39;</span><span class="m m-Double">172.31.254.48</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">subnet_id</span><span class="p">=</span><span class="err">&#39;</span><span class="mi">41</span><span class="nx">c073c0</span><span class="o">-</span><span class="mi">5</span><span class="nx">b6a</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">9023</span><span class="o">-</span><span class="mi">115</span><span class="nx">ce3d0e378</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">id</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="nx">e737c31</span><span class="o">-</span><span class="mi">0450</span><span class="o">-</span><span class="mi">40</span><span class="nx">d0</span><span class="o">-</span><span class="nx">a5e0</span><span class="o">-</span><span class="mi">54871</span><span class="nx">a735428</span><span class="w">                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">ip_address</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">mac_address</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="nx">fa</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">3</span><span class="nx">e</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="mi">12</span><span class="w">                                                            </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">name</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">hp2hz</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span><span class="w">                                 </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">network_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nx">aa68c208</span><span class="o">-</span><span class="nx">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="nx">e</span><span class="o">-</span><span class="nx">b508</span><span class="o">-</span><span class="mi">1</span><span class="nx">b9d82f3baa4</span><span class="w">                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">option_name</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">option_value</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">port_security_enabled</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">True</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">project_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nx">ea78dddee3e240c7af1779b417c64618</span><span class="w">                                             </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">qos_policy_id</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">revision_number</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">6</span><span class="w">                                                                            </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">security_group_ids</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nx">ae5a722f</span><span class="o">-</span><span class="nx">aeea</span><span class="o">-</span><span class="mi">4</span><span class="nx">acd</span><span class="o">-</span><span class="mi">8260</span><span class="o">-</span><span class="nx">a04f5dceb624</span><span class="w">                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">status</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nx">DOWN</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">subnet_id</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">tags</span><span class="w">                  </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">trunk_details</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">updated_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nx">T14</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">17</span><span class="nx">Z</span><span class="w">                                                         </span><span class="o">|</span>
<span class="o">+-----------------------+------------------------------------------------------------------------------+</span>
<span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="o">--</span><span class="nx">network</span><span class="w"> </span><span class="nx">aa68c208</span><span class="o">-</span><span class="nx">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="nx">e</span><span class="o">-</span><span class="nx">b508</span><span class="o">-</span><span class="mi">1</span><span class="nx">b9d82f3baa4</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">zhs67</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nx">Field</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="nx">Value</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nx">admin_state_up</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nx">UP</span><span class="w">                                                                            </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">allowed_address_pairs</span><span class="w"> </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_host_id</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_profile</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_vif_details</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_vif_type</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_vnic_type</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">normal</span><span class="w">                                                                        </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">created_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nx">T14</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">40</span><span class="nx">Z</span><span class="w">                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">data_plane_status</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">description</span><span class="w">           </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">device_id</span><span class="w">             </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">device_owner</span><span class="w">          </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">dns_assignment</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">dns_name</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">extra_dhcp_opts</span><span class="w">       </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">fixed_ips</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="nx">ip_address</span><span class="p">=</span><span class="err">&#39;</span><span class="m m-Double">172.31.254.207</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">subnet_id</span><span class="p">=</span><span class="err">&#39;</span><span class="mi">41</span><span class="nx">c073c0</span><span class="o">-</span><span class="mi">5</span><span class="nx">b6a</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">9023</span><span class="o">-</span><span class="mi">115</span><span class="nx">ce3d0e378</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">id</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="nx">c82401f3</span><span class="o">-</span><span class="nx">fa76</span><span class="o">-</span><span class="mi">449</span><span class="nx">e</span><span class="o">-</span><span class="nx">ba16</span><span class="o">-</span><span class="mi">75</span><span class="nx">fe4b0f5583</span><span class="w">                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">ip_address</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">mac_address</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="nx">fa</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">3</span><span class="nx">e</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="nx">d2</span><span class="p">:</span><span class="mi">28</span><span class="w">                                                             </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">name</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">zhs67</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span><span class="w">                                  </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">network_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nx">aa68c208</span><span class="o">-</span><span class="nx">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="nx">e</span><span class="o">-</span><span class="nx">b508</span><span class="o">-</span><span class="mi">1</span><span class="nx">b9d82f3baa4</span><span class="w">                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">option_name</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">option_value</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">port_security_enabled</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">True</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">project_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nx">ea78dddee3e240c7af1779b417c64618</span><span class="w">                                              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">qos_policy_id</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">revision_number</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">6</span><span class="w">                                                                             </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">security_group_ids</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nx">ae5a722f</span><span class="o">-</span><span class="nx">aeea</span><span class="o">-</span><span class="mi">4</span><span class="nx">acd</span><span class="o">-</span><span class="mi">8260</span><span class="o">-</span><span class="nx">a04f5dceb624</span><span class="w">                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">status</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nx">DOWN</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">subnet_id</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">tags</span><span class="w">                  </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">trunk_details</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">updated_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nx">T14</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mi">40</span><span class="nx">Z</span><span class="w">                                                          </span><span class="o">|</span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span>
<span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="o">--</span><span class="nx">network</span><span class="w"> </span><span class="nx">aa68c208</span><span class="o">-</span><span class="nx">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="nx">e</span><span class="o">-</span><span class="nx">b508</span><span class="o">-</span><span class="mi">1</span><span class="nx">b9d82f3baa4</span><span class="w"> </span><span class="nx">vip</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nx">Field</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="nx">Value</span><span class="w">                                                                         </span><span class="o">|</span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="w"> </span><span class="nx">admin_state_up</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nx">UP</span><span class="w">                                                                            </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">allowed_address_pairs</span><span class="w"> </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_host_id</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_profile</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_vif_details</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_vif_type</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">binding_vnic_type</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">normal</span><span class="w">                                                                        </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">created_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nx">T18</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">53</span><span class="nx">Z</span><span class="w">                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">data_plane_status</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">description</span><span class="w">           </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">device_id</span><span class="w">             </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">device_owner</span><span class="w">          </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">dns_assignment</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">dns_name</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">extra_dhcp_opts</span><span class="w">       </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">fixed_ips</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="nx">ip_address</span><span class="p">=</span><span class="err">&#39;</span><span class="m m-Double">172.31.254.118</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">subnet_id</span><span class="p">=</span><span class="err">&#39;</span><span class="mi">41</span><span class="nx">c073c0</span><span class="o">-</span><span class="mi">5</span><span class="nx">b6a</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">9023</span><span class="o">-</span><span class="mi">115</span><span class="nx">ce3d0e378</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">id</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="nx">d0b32f5</span><span class="o">-</span><span class="mi">203</span><span class="nx">b</span><span class="o">-</span><span class="mi">4</span><span class="nx">e2b</span><span class="o">-</span><span class="nx">b92b</span><span class="o">-</span><span class="nx">b25f349b1d83</span><span class="w">                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">ip_address</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">mac_address</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="nx">fa</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">3</span><span class="nx">e</span><span class="p">:</span><span class="mi">0</span><span class="nx">d</span><span class="p">:</span><span class="mi">3</span><span class="nx">e</span><span class="p">:</span><span class="nx">cd</span><span class="w">                                                             </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">name</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="nx">vip</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span><span class="w">                                                            </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">network_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nx">aa68c208</span><span class="o">-</span><span class="nx">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="nx">e</span><span class="o">-</span><span class="nx">b508</span><span class="o">-</span><span class="mi">1</span><span class="nx">b9d82f3baa4</span><span class="w">                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">option_name</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">option_value</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">port_security_enabled</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">True</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">project_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="nx">ea78dddee3e240c7af1779b417c64618</span><span class="w">                                              </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">qos_policy_id</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">revision_number</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">6</span><span class="w">                                                                             </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">security_group_ids</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="nx">ae5a722f</span><span class="o">-</span><span class="nx">aeea</span><span class="o">-</span><span class="mi">4</span><span class="nx">acd</span><span class="o">-</span><span class="mi">8260</span><span class="o">-</span><span class="nx">a04f5dceb624</span><span class="w">                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">status</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="nx">DOWN</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">subnet_id</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">tags</span><span class="w">                  </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">trunk_details</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="nx">None</span><span class="w">                                                                          </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="nx">updated_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nx">T18</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">53</span><span class="nx">Z</span><span class="w">                                                          </span><span class="o">|</span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span>
<span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">hp2hz</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">hp2hz</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span>
<span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">zhs67</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">zhs67</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span>
<span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">floating</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="o">--</span><span class="nx">port</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">hp2hz</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span><span class="w"> </span><span class="m m-Double">10.0.92.194</span>
<span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">floating</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="o">--</span><span class="nx">port</span><span class="w"> </span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">zhs67</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span><span class="w"> </span><span class="m m-Double">10.0.92.205</span>
<span class="p">[</span><span class="nx">cloud</span><span class="o">-</span><span class="nx">user</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">jump</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="nx">openshift</span><span class="p">]</span><span class="err">$</span><span class="w"> </span><span class="nx">openstack</span><span class="w"> </span><span class="nx">floating</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="o">--</span><span class="nx">port</span><span class="w"> </span><span class="nx">vip</span><span class="o">-</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">backend</span><span class="w"> </span><span class="m m-Double">10.0.89.89</span>
</code></pre></div></td></tr></table></div>
<p>After this, the floating IPs look like this in OpenStack:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">floating</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="mf">172.31.254</span>
<span class="o">|</span><span class="w"> </span><span class="n">dd055cc4</span><span class="o">-</span><span class="n">af00</span><span class="o">-</span><span class="mi">4</span><span class="n">dbd</span><span class="o">-</span><span class="mf">8e4</span><span class="n">a</span><span class="o">-</span><span class="mi">94</span><span class="n">fac680299d</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">10.0.89.89</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mf">172.31.254.118</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="n">d0b32f5</span><span class="o">-</span><span class="mi">203</span><span class="n">b</span><span class="o">-</span><span class="mf">4e2</span><span class="n">b</span><span class="o">-</span><span class="n">b92b</span><span class="o">-</span><span class="n">b25f349b1d83</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="n">cd089f9</span><span class="o">-</span><span class="mi">8</span><span class="n">ed2</span><span class="o">-</span><span class="mi">46</span><span class="n">bc</span><span class="o">-</span><span class="mi">8</span><span class="n">ea7</span><span class="o">-</span><span class="mf">4e1</span><span class="n">cdb5262ba</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">e586c5c8</span><span class="o">-</span><span class="mi">1</span><span class="n">cd4</span><span class="o">-</span><span class="mi">4</span><span class="n">bd5</span><span class="o">-</span><span class="n">adb7</span><span class="o">-</span><span class="mf">790e895</span><span class="n">b5af8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mf">172.31.254.48</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mf">8e737</span><span class="n">c31</span><span class="o">-</span><span class="mi">0450</span><span class="o">-</span><span class="mi">40</span><span class="n">d0</span><span class="o">-</span><span class="n">a5e0</span><span class="o">-</span><span class="mi">54871</span><span class="n">a735428</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="n">cd089f9</span><span class="o">-</span><span class="mi">8</span><span class="n">ed2</span><span class="o">-</span><span class="mi">46</span><span class="n">bc</span><span class="o">-</span><span class="mi">8</span><span class="n">ea7</span><span class="o">-</span><span class="mf">4e1</span><span class="n">cdb5262ba</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w"> </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">f7e082f1</span><span class="o">-</span><span class="mi">7880</span><span class="o">-</span><span class="mi">4</span><span class="n">f07</span><span class="o">-</span><span class="mi">8</span><span class="n">a05</span><span class="o">-</span><span class="mi">3</span><span class="n">fdb0585eb32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mf">172.31.254.207</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">c82401f3</span><span class="o">-</span><span class="n">fa76</span><span class="o">-</span><span class="mi">449</span><span class="n">e</span><span class="o">-</span><span class="n">ba16</span><span class="o">-</span><span class="mi">75</span><span class="n">fe4b0f5583</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="n">cd089f9</span><span class="o">-</span><span class="mi">8</span><span class="n">ed2</span><span class="o">-</span><span class="mi">46</span><span class="n">bc</span><span class="o">-</span><span class="mi">8</span><span class="n">ea7</span><span class="o">-</span><span class="mf">4e1</span><span class="n">cdb5262ba</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w"> </span><span class="o">|</span>
</code></pre></div></td></tr></table></div></p>
<p>Last but not least, disable port security for these ports so that VRRP can work with these OpenStack ports:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="nv">port</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">akaris</span><span class="o">-</span><span class="nv">osc</span><span class="o">-</span><span class="mi">6</span><span class="nv">klvk</span><span class="o">-</span><span class="nv">worker</span><span class="o">-</span><span class="nv">hp2hz</span><span class="o">-</span><span class="nv">akaris</span><span class="o">-</span><span class="nv">backend</span><span class="w"> </span><span class="nv">akaris</span><span class="o">-</span><span class="nv">osc</span><span class="o">-</span><span class="mi">6</span><span class="nv">klvk</span><span class="o">-</span><span class="nv">worker</span><span class="o">-</span><span class="nv">zhs67</span><span class="o">-</span><span class="nv">akaris</span><span class="o">-</span><span class="nv">backend</span><span class="w"> </span><span class="nv">vip</span><span class="o">-</span><span class="nv">akaris</span><span class="o">-</span><span class="nv">backend</span><span class="w"> </span><span class="c1">; do </span>
<span class="w">    </span><span class="nv">echo</span><span class="w"> </span><span class="o">===</span><span class="w"> </span>$<span class="nv">port</span><span class="w"> </span><span class="o">===</span>
<span class="w">    </span><span class="nv">openstack</span><span class="w"> </span><span class="nv">port</span><span class="w"> </span><span class="nv">set</span><span class="w"> </span><span class="o">--</span><span class="nv">no</span><span class="o">-</span><span class="nv">security</span><span class="o">-</span><span class="nv">group</span><span class="w"> </span>$<span class="nv">port</span>
<span class="w">    </span><span class="nv">openstack</span><span class="w"> </span><span class="nv">port</span><span class="w"> </span><span class="nv">set</span><span class="w"> </span><span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">port</span><span class="o">-</span><span class="nv">security</span><span class="w"> </span>$<span class="nv">port</span>
<span class="nv">done</span>
</code></pre></div></td></tr></table></div></p>
<p>The VRRP floating IP is: 
   IP 172.31.254.118
   MAC address: fa:16:3e:0d:3e:cd
   VIP: 10.0.89.89</p>
<p>Verify that the port was added to the workers:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">node</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span>
<span class="n">Starting</span><span class="w"> </span><span class="n">pod</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="o">-</span><span class="n">debug</span><span class="w"> </span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="n">binaries</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="err">`</span><span class="n">chroot</span><span class="w"> </span><span class="o">/</span><span class="k">host</span><span class="err">`</span>
<span class="n">Pod</span><span class="w"> </span><span class="nl">IP</span><span class="p">:</span><span class="w"> </span><span class="mf">192.168.1.160</span>
<span class="k">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t see a command prompt, try pressing enter.</span>
<span class="s1">sh-4.2# chroot /host</span>
<span class="s1">sh-4.4# toolbox</span>
<span class="s1">Trying to pull registry.redhat.io/rhel8/support-tools...</span>
<span class="s1">Getting image source signatures</span>
<span class="s1">Copying blob 77c58f19bd6e done  </span>
<span class="s1">Copying blob 47db82df7f3f done  </span>
<span class="s1">Copying blob cdc5441bd52d done  </span>
<span class="s1">Copying config 5ef2aab094 done  </span>
<span class="s1">Writing manifest to image destination</span>
<span class="s1">Storing signatures</span>
<span class="s1">5ef2aab094514cc5561fa94b0bb52d75379ecf8a36355e891017f3982bac278c</span>
<span class="s1">Spawning a container &#39;</span><span class="n">toolbox</span><span class="o">-</span><span class="s1">&#39; with image &#39;</span><span class="n">registry</span><span class="p">.</span><span class="n">redhat</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">rhel8</span><span class="o">/</span><span class="n">support</span><span class="o">-</span><span class="n">tools</span><span class="err">&#39;</span>
<span class="n">Detected</span><span class="w"> </span><span class="n">RUN</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="nc">image</span><span class="p">.</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="p">...</span>
<span class="nl">command</span><span class="p">:</span><span class="w"> </span><span class="n">podman</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">it</span><span class="w"> </span><span class="o">--</span><span class="n">name</span><span class="w"> </span><span class="n">toolbox</span><span class="o">-</span><span class="w"> </span><span class="o">--</span><span class="n">privileged</span><span class="w"> </span><span class="o">--</span><span class="n">ipc</span><span class="o">=</span><span class="k">host</span><span class="w"> </span><span class="o">--</span><span class="n">net</span><span class="o">=</span><span class="k">host</span><span class="w"> </span><span class="o">--</span><span class="n">pid</span><span class="o">=</span><span class="k">host</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="k">HOST</span><span class="o">=/</span><span class="k">host</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">NAME</span><span class="o">=</span><span class="n">toolbox</span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="nc">IMAGE</span><span class="o">=</span><span class="n">registry</span><span class="p">.</span><span class="n">redhat</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">rhel8</span><span class="o">/</span><span class="n">support</span><span class="o">-</span><span class="nl">tools</span><span class="p">:</span><span class="n">latest</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="nl">run</span><span class="p">:</span><span class="o">/</span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="nf">var</span><span class="o">/</span><span class="nf">log</span><span class="err">:</span><span class="o">/</span><span class="nf">var</span><span class="o">/</span><span class="nf">log</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="nl">id</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="k">localtime</span><span class="err">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="k">localtime</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="err">:</span><span class="o">/</span><span class="k">host</span><span class="w"> </span><span class="n">registry</span><span class="p">.</span><span class="n">redhat</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">rhel8</span><span class="o">/</span><span class="n">support</span><span class="o">-</span><span class="nl">tools</span><span class="p">:</span><span class="n">latest</span>
<span class="o">[</span><span class="n">root@akaris-osc-6klvk-worker-hp2hz /</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">yum</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">iproute</span><span class="w"> </span><span class="o">-</span><span class="n">y</span>
<span class="p">(...)</span>
<span class="nl">Installed</span><span class="p">:</span>
<span class="w">  </span><span class="n">iproute</span><span class="o">-</span><span class="mf">5.3.0</span><span class="o">-</span><span class="mf">1.</span><span class="n">el8</span><span class="p">.</span><span class="n">x86_64</span><span class="w">                                 </span><span class="n">libmnl</span><span class="o">-</span><span class="mf">1.0.4</span><span class="o">-</span><span class="mf">6.</span><span class="n">el8</span><span class="p">.</span><span class="n">x86_64</span><span class="w">                                </span>

<span class="n">Complete</span><span class="err">!</span>
<span class="o">[</span><span class="n">root@akaris-osc-6klvk-worker-hp2hz /</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">dmesg</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tail</span>
<span class="o">[</span><span class="n">  745.078322</span><span class="o">]</span><span class="w"> </span><span class="n">pci</span><span class="w"> </span><span class="mi">0000</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mf">06.0</span><span class="err">:</span><span class="w"> </span><span class="n">BAR</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="n">assigned</span><span class="w"> </span><span class="o">[</span><span class="n">io  0x1000-0x103f</span><span class="o">]</span>
<span class="o">[</span><span class="n">  745.080319</span><span class="o">]</span><span class="w"> </span><span class="n">virtio</span><span class="o">-</span><span class="n">pci</span><span class="w"> </span><span class="mi">0000</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mf">06.0</span><span class="err">:</span><span class="w"> </span><span class="n">enabling</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="p">(</span><span class="mi">0000</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">0003</span><span class="p">)</span>
<span class="o">[</span><span class="n">  745.100662</span><span class="o">]</span><span class="w"> </span><span class="n">PCI</span><span class="w"> </span><span class="n">Interrupt</span><span class="w"> </span><span class="n">Link</span><span class="w"> </span><span class="o">[</span><span class="n">LNKB</span><span class="o">]</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">IRQ</span><span class="w"> </span><span class="mi">11</span>
<span class="o">[</span><span class="n">  745.109702</span><span class="o">]</span><span class="w"> </span><span class="n">virtio_net</span><span class="w"> </span><span class="n">virtio3</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">renamed</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">eth0</span>
<span class="o">[</span><span class="n">  745.156833</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_UP</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ready</span>
<span class="o">[</span><span class="n">  745.159290</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_UP</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ready</span>
<span class="o">[</span><span class="n">  745.165677</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_UP</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ready</span>
<span class="o">[</span><span class="n">  745.172694</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_UP</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ready</span>
<span class="o">[</span><span class="n">  746.143079</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_CHANGE</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">becomes</span><span class="w"> </span><span class="n">ready</span>
<span class="o">[</span><span class="n">  861.279527</span><span class="o">]</span><span class="w"> </span><span class="nl">SELinux</span><span class="p">:</span><span class="w"> </span><span class="n">mount</span><span class="w"> </span><span class="n">invalid</span><span class="p">.</span><span class="w">  </span><span class="n">Same</span><span class="w"> </span><span class="n">superblock</span><span class="p">,</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">dev</span><span class="w"> </span><span class="n">mqueue</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">mqueue</span><span class="p">)</span>
<span class="o">[</span><span class="n">root@akaris-osc-6klvk-worker-hp2hz /</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="n">ens6</span>
<span class="mi">10</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1450</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">fq_codel</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="nl">fa</span><span class="p">:</span><span class="mi">16</span><span class="err">:</span><span class="mi">3</span><span class="nl">e</span><span class="p">:</span><span class="mi">07</span><span class="err">:</span><span class="mi">66</span><span class="err">:</span><span class="mi">12</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="n">ff</span>
</code></pre></div></td></tr></table></div></p>
<p>Repeat the same on the other node:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">node</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span>
<span class="p">(...)</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="step-3-create-new-role-and-assign-new-nodes-to-the-role">Step 3: create new role and assign new nodes to the role</h2>
<p>Follow <a href="https://www.redhat.com/en/blog/openshift-container-platform-4-how-does-machine-config-pool-work">https://www.redhat.com/en/blog/openshift-container-platform-4-how-does-machine-config-pool-work with modifications</a>.</p>
<p>Run this via a script that's triggered by a systemd unit file:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="o">-</span>
<span class="nl">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="n">machineconfiguration</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
<span class="nl">kind</span><span class="p">:</span><span class="w"> </span><span class="n">MachineConfigPool</span>
<span class="nl">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">staging</span>
<span class="nl">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nl">machineConfigSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nl">matchExpressions</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="err">{</span><span class="k">key</span><span class="err">:</span><span class="w"> </span><span class="n">machineconfiguration</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="k">role</span><span class="p">,</span><span class="w"> </span><span class="nl">operator</span><span class="p">:</span><span class="w"> </span><span class="ow">In</span><span class="p">,</span><span class="w"> </span><span class="k">values</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">worker,staging</span><span class="o">]</span><span class="err">}</span>
<span class="w">  </span><span class="nl">nodeSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nl">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="n">node</span><span class="o">-</span><span class="k">role</span><span class="p">.</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="nl">staging</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;&quot;</span>
<span class="w">  </span><span class="nl">paused</span><span class="p">:</span><span class="w"> </span><span class="k">false</span>
<span class="n">EOF</span>

<span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s1">&#39;FOE&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">sh</span>
<span class="err">#!</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>

<span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">ens6</span>
<span class="n">NAME</span><span class="o">=</span><span class="ss">&quot;System ens6&quot;</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">dhcp</span>
<span class="n">DEFROUTE</span><span class="o">=</span><span class="k">no</span>
<span class="n">IPV6INIT</span><span class="o">=</span><span class="k">no</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">ens6</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">EOF</span>

<span class="err">#</span><span class="w"> </span><span class="k">none</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">we</span><span class="s1">&#39;re using DHCP</span>
<span class="s1"># cat &lt;&lt;&#39;</span><span class="n">EOF</span><span class="s1">&#39; &gt; /etc/sysconfig/network-scripts/rule-ens6</span>
<span class="s1"># from 172.31.254.0/24 lookup 5000</span>
<span class="s1"># EOF</span>

<span class="s1"># cat &lt;&lt;&#39;</span><span class="n">EOF</span><span class="s1">&#39; &gt; /etc/sysconfig/network-scripts/route-ens6</span>
<span class="s1"># default via 172.31.254.1 table 5000</span>
<span class="s1"># EOF</span>

<span class="s1"># the following will not work either</span>
<span class="s1"># ip rule add from 172.31.254.0/24 lookup 5000</span>
<span class="s1"># ip route add default via 172.31.254.1 table 5000</span>

<span class="s1">cat &lt;&lt;&#39;</span><span class="n">EOF</span><span class="err">&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">NetworkManager</span><span class="o">/</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">ifup</span><span class="o">-</span><span class="k">local</span>
<span class="err">#!</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span>

<span class="n">interface</span><span class="o">=</span><span class="ss">&quot;$1&quot;</span>
<span class="n">status</span><span class="o">=</span><span class="ss">&quot;$2&quot;</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="n"> &quot;$interface&quot; == &quot;ens6&quot; </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="n"> &quot;$status&quot; == &quot;up&quot; </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="n">logger</span><span class="w"> </span><span class="ss">&quot;Interface $interface $status - setting ip rule and ip route&quot;</span>
<span class="w">  </span><span class="n">ip</span><span class="w"> </span><span class="k">rule</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">172.31.254.0</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">lookup</span><span class="w"> </span><span class="mi">5000</span>
<span class="w">  </span><span class="n">ip</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="mf">172.31.254.1</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="mi">5000</span>
<span class="n">fi</span>
<span class="n">EOF</span>
<span class="n">chmod</span><span class="w"> </span><span class="o">+</span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">NetworkManager</span><span class="o">/</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">ifup</span><span class="o">-</span><span class="k">local</span>
<span class="n">FOE</span>

<span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="o">-</span>
<span class="nl">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="n">machineconfiguration</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span>
<span class="nl">kind</span><span class="p">:</span><span class="w"> </span><span class="n">MachineConfig</span>
<span class="nl">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nl">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="k">null</span>
<span class="w">  </span><span class="nl">labels</span><span class="p">:</span>
<span class="w">    </span><span class="n">machineconfiguration</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="k">role</span><span class="err">:</span><span class="w"> </span><span class="n">staging</span>
<span class="w">  </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="mi">01</span><span class="o">-</span><span class="n">staging</span><span class="o">-</span><span class="n">additional</span><span class="o">-</span><span class="n">interface</span>
<span class="nl">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nl">config</span><span class="p">:</span>
<span class="w">    </span><span class="nl">ignition</span><span class="p">:</span>
<span class="w">      </span><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="mf">2.2.0</span>
<span class="w">    </span><span class="nl">storage</span><span class="p">:</span>
<span class="w">      </span><span class="nl">files</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">contents</span><span class="p">:</span>
<span class="w">          </span><span class="nl">source</span><span class="p">:</span><span class="w"> </span><span class="k">data</span><span class="err">:</span><span class="p">;</span><span class="n">base64</span><span class="p">,</span><span class="err">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">sh</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">base64</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">sh</span>
<span class="w">        </span><span class="nl">filesystem</span><span class="p">:</span><span class="w"> </span><span class="n">root</span>
<span class="w">        </span><span class="nl">mode</span><span class="p">:</span><span class="w"> </span><span class="mi">0755</span>
<span class="w">    </span><span class="nl">systemd</span><span class="p">:</span>
<span class="w">      </span><span class="nl">units</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">contents</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;[Unit]\\nDescription=Configure network\\nAfter=ignition-firstboot-complete.service\\nBefore=nodeip-configuration.service kubelet.service crio.service\\n\\n[Service]\\nType=oneshot\\nExecStart=/usr/local/bin/network-script.sh\\n\\n[Install]\\nWantedBy=multi-user.target&quot;</span>
<span class="w">        </span><span class="nl">enabled</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>
<span class="w">        </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">service</span>
<span class="n">EOF</span>

<span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">sh</span>
</code></pre></div></td></tr></table></div></p>
<p>Label the nodes as staging:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>oc label node akaris-osc-6klvk-worker-hp2hz node-role.kubernetes.io/worker- node-role.kubernetes.io/staging=
oc label node akaris-osc-6klvk-worker-zhs67 node-role.kubernetes.io/worker- node-role.kubernetes.io/staging=
</code></pre></div></td></tr></table></div></p>
<p>The nodes will now reboot with the new setting, so wait:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">nodes</span>
<span class="n">NAME</span><span class="w">                            </span><span class="n">STATUS</span><span class="w">                        </span><span class="n">ROLES</span><span class="w">     </span><span class="n">AGE</span><span class="w">     </span><span class="n">VERSION</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">0</span><span class="w">       </span><span class="n">Ready</span><span class="w">                         </span><span class="n">master</span><span class="w">    </span><span class="mi">5</span><span class="n">h48m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="n">Ready</span><span class="w">                         </span><span class="n">master</span><span class="w">    </span><span class="mi">5</span><span class="n">h48m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="w">       </span><span class="n">Ready</span><span class="w">                         </span><span class="n">master</span><span class="w">    </span><span class="mi">5</span><span class="n">h49m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">g4q6z</span><span class="w">   </span><span class="n">Ready</span><span class="w">                         </span><span class="n">worker</span><span class="w">    </span><span class="mi">5</span><span class="n">h34m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="n">Ready</span><span class="w">                         </span><span class="n">staging</span><span class="w">   </span><span class="mi">32</span><span class="n">m</span><span class="w">     </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="n">Ready</span><span class="w">                         </span><span class="n">worker</span><span class="w">    </span><span class="mi">5</span><span class="n">h31m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="n">Ready</span><span class="w">                         </span><span class="n">worker</span><span class="w">    </span><span class="mi">5</span><span class="n">h36m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="n">NotReady</span><span class="p">,</span><span class="n">SchedulingDisabled</span><span class="w">   </span><span class="n">staging</span><span class="w">   </span><span class="mi">32</span><span class="n">m</span><span class="w">     </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span>
</code></pre></div></td></tr></table></div></p>
<p>Make sure that the interface was created:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">node</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span>
<span class="n">Starting</span><span class="w"> </span><span class="n">pod</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="o">-</span><span class="n">debug</span><span class="w"> </span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="n">binaries</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="err">`</span><span class="n">chroot</span><span class="w"> </span><span class="o">/</span><span class="k">host</span><span class="err">`</span>
<span class="n">Pod</span><span class="w"> </span><span class="nl">IP</span><span class="p">:</span><span class="w"> </span><span class="mf">192.168.2.48</span>
<span class="k">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">prompt</span><span class="p">,</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">pressing</span><span class="w"> </span><span class="n">enter</span><span class="p">.</span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.4</span><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">ens6</span><span class="w"> </span>
<span class="n">NAME</span><span class="o">=</span><span class="ss">&quot;System ens6&quot;</span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">dhcp</span>
<span class="n">DEFROUTE</span><span class="o">=</span><span class="k">no</span>
<span class="n">IPV6INIT</span><span class="o">=</span><span class="k">no</span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">ens6</span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">Ethernet</span>
<span class="n">PROXY_METHOD</span><span class="o">=</span><span class="k">none</span>
<span class="n">BROWSER_ONLY</span><span class="o">=</span><span class="k">no</span>
<span class="n">ETHTOOL_OPTS</span><span class="o">=</span><span class="ss">&quot;-K ens6 tx-checksum-ip-generic off&quot;</span>
<span class="n">IPV4_FAILURE_FATAL</span><span class="o">=</span><span class="k">no</span>
<span class="n">UUID</span><span class="o">=</span><span class="mi">9325</span><span class="n">ba04</span><span class="o">-</span><span class="mi">7907</span><span class="o">-</span><span class="n">b4a4</span><span class="o">-</span><span class="mi">1414</span><span class="o">-</span><span class="mi">177267</span><span class="n">ba3519</span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.2</span><span class="err">#</span><span class="w"> </span><span class="n">chroot</span><span class="w"> </span><span class="o">/</span><span class="k">host</span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.4</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="n">ens6</span>
<span class="mi">3</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1450</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">fq_codel</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="nl">fa</span><span class="p">:</span><span class="mi">16</span><span class="err">:</span><span class="mi">3</span><span class="nl">e</span><span class="p">:</span><span class="mi">66</span><span class="err">:</span><span class="nl">d2</span><span class="p">:</span><span class="mi">28</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="n">ff</span>
<span class="w">    </span><span class="n">inet</span><span class="w"> </span><span class="mf">172.31.254.207</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mf">172.31.254.255</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="k">dynamic</span><span class="w"> </span><span class="n">noprefixroute</span><span class="w"> </span><span class="n">ens6</span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="mi">86276</span><span class="n">sec</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="mi">86276</span><span class="n">sec</span>
<span class="w">    </span><span class="n">inet6</span><span class="w"> </span><span class="nl">fe80</span><span class="p">:</span><span class="err">:</span><span class="nl">f816</span><span class="p">:</span><span class="mi">3</span><span class="nl">eff</span><span class="p">:</span><span class="nl">fe66</span><span class="p">:</span><span class="n">d228</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="n">link</span><span class="w"> </span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.4</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="mi">5000</span>
<span class="k">default</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="mf">172.31.254.1</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="n">ens6</span><span class="w"> </span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.4</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="k">rule</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="mi">5000</span>
<span class="mi">32765</span><span class="err">:</span><span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="mf">172.31.254.0</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">lookup</span><span class="w"> </span><span class="mi">5000</span>
</code></pre></div></td></tr></table></div></p>
<p>Run the same verification on the other worker.</p>
<p>Ping both floating IPs and make sure that policy routing works:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="mf">10.0.92.194</span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.92.194</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">13.8</span><span class="w"> </span><span class="n">ms</span>
<span class="o">^</span><span class="n">C</span>
<span class="o">---</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">13.897</span><span class="o">/</span><span class="mf">13.897</span><span class="o">/</span><span class="mf">13.897</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="mf">10.0.92.205</span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.92.205</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">1.24</span><span class="w"> </span><span class="n">ms</span>
<span class="o">^</span><span class="n">C</span>
<span class="o">---</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.242</span><span class="o">/</span><span class="mf">1.242</span><span class="o">/</span><span class="mf">1.242</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="step-4-configure-keepalived-template-for-the-staging-node">Step 4: Configure keepalived template for the staging node</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="err">&#39;</span><span class="nx">EOF</span><span class="err">&#39;</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">keepalived</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">tmpl</span>
<span class="err">#</span><span class="w"> </span><span class="nx">TODO</span><span class="p">:</span><span class="w"> </span><span class="nx">Improve</span><span class="w"> </span><span class="nx">this</span><span class="w"> </span><span class="nx">check</span><span class="p">.</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">assumed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">alive</span><span class="p">.</span>
<span class="err">#</span><span class="w"> </span><span class="nx">Need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">assess</span><span class="w"> </span><span class="nx">what</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">ramification</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">there</span><span class="p">.</span>
<span class="nx">vrrp_script</span><span class="w"> </span><span class="nx">chk_ingress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">script</span><span class="w"> </span><span class="s">&quot;/usr/bin/curl -o /dev/null -kLfs http://0:1936/healthz&quot;</span>
<span class="w">    </span><span class="nx">interval</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nx">weight</span><span class="w"> </span><span class="mi">50</span>
<span class="p">}</span>
<span class="nx">vrrp_instance</span><span class="w"> </span><span class="nx">staging_INGRESS</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">state</span><span class="w"> </span><span class="nx">BACKUP</span>
<span class="w">    </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ens6</span>
<span class="w">    </span><span class="nx">virtual_router_id</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="nx">priority</span><span class="w"> </span><span class="mi">40</span>
<span class="w">    </span><span class="nx">advert_int</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nx">authentication</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">auth_type</span><span class="w"> </span><span class="nx">PASS</span>
<span class="w">        </span><span class="nx">auth_pass</span><span class="w"> </span><span class="nx">staging_vip</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">virtual_ipaddress</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="m m-Double">172.31.254.118</span><span class="o">/</span><span class="mi">24</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">track_script</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">chk_ingress</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="nx">EOF</span>

<span class="nx">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="nx">EOF</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">oc</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="o">-</span><span class="nx">f</span><span class="w"> </span><span class="o">-</span>
<span class="nx">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="nx">machineconfiguration</span><span class="p">.</span><span class="nx">openshift</span><span class="p">.</span><span class="nx">io</span><span class="o">/</span><span class="nx">v1</span>
<span class="nx">kind</span><span class="p">:</span><span class="w"> </span><span class="nx">MachineConfig</span>
<span class="nx">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nx">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nx">machineconfiguration</span><span class="p">.</span><span class="nx">openshift</span><span class="p">.</span><span class="nx">io</span><span class="o">/</span><span class="nx">role</span><span class="p">:</span><span class="w"> </span><span class="nx">staging</span>
<span class="w">  </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="o">-</span><span class="nx">staging</span><span class="o">-</span><span class="nx">keepalived</span><span class="o">-</span><span class="nx">vip</span>
<span class="nx">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nx">config</span><span class="p">:</span>
<span class="w">    </span><span class="nx">ignition</span><span class="p">:</span>
<span class="w">      </span><span class="nx">config</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">security</span><span class="p">:</span>
<span class="w">        </span><span class="nx">tls</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">timeouts</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="nx">version</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">2.2.0</span>
<span class="w">    </span><span class="nx">networkd</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nx">passwd</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="nx">storage</span><span class="p">:</span>
<span class="w">      </span><span class="nx">files</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nx">contents</span><span class="p">:</span>
<span class="w">          </span><span class="nx">source</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">:</span><span class="nx">text</span><span class="o">/</span><span class="nx">plain</span><span class="p">;</span><span class="nx">charset</span><span class="p">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="p">;</span><span class="nx">base64</span><span class="p">,</span><span class="err">$</span><span class="p">(</span><span class="nx">cat</span><span class="w"> </span><span class="nx">keepalived</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">tmpl</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">base64</span><span class="w"> </span><span class="o">-</span><span class="nx">w0</span><span class="p">)</span>
<span class="w">          </span><span class="nx">verification</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="nx">filesystem</span><span class="p">:</span><span class="w"> </span><span class="nx">root</span>
<span class="w">        </span><span class="nx">mode</span><span class="p">:</span><span class="w"> </span><span class="mi">420</span>
<span class="w">        </span><span class="nx">path</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">kubernetes</span><span class="o">/</span><span class="nx">static</span><span class="o">-</span><span class="nx">pod</span><span class="o">-</span><span class="nx">resources</span><span class="o">/</span><span class="nx">keepalived</span><span class="o">/</span><span class="nx">keepalived</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">tmpl</span>
<span class="w">    </span><span class="nx">systemd</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="nx">EOF</span>

<span class="nx">rm</span><span class="w"> </span><span class="o">-</span><span class="nx">f</span><span class="w">  </span><span class="nx">keepalived</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">tmpl</span>
</code></pre></div></td></tr></table></div>
<p>Verify:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">zhs67</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="err">#</span><span class="w"> </span><span class="nx">cat</span><span class="w"> </span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">keepalived</span><span class="o">/</span><span class="nx">keepalived</span><span class="p">.</span><span class="nx">conf</span><span class="w"> </span>
<span class="err">#</span><span class="w"> </span><span class="nx">TODO</span><span class="p">:</span><span class="w"> </span><span class="nx">Improve</span><span class="w"> </span><span class="nx">this</span><span class="w"> </span><span class="nx">check</span><span class="p">.</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">assumed</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">alive</span><span class="p">.</span>
<span class="err">#</span><span class="w"> </span><span class="nx">Need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">assess</span><span class="w"> </span><span class="nx">what</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">ramification</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">there</span><span class="p">.</span>
<span class="nx">vrrp_script</span><span class="w"> </span><span class="nx">chk_ingress</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">script</span><span class="w"> </span><span class="s">&quot;/usr/bin/curl -o /dev/null -kLfs http://0:1936/healthz&quot;</span>
<span class="w">    </span><span class="nx">interval</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nx">weight</span><span class="w"> </span><span class="mi">50</span>
<span class="p">}</span>
<span class="nx">vrrp_instance</span><span class="w"> </span><span class="nx">staging_INGRESS</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">state</span><span class="w"> </span><span class="nx">BACKUP</span>
<span class="w">    </span><span class="kd">interface</span><span class="w"> </span><span class="nx">ens6</span>
<span class="w">    </span><span class="nx">virtual_router_id</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="nx">priority</span><span class="w"> </span><span class="mi">40</span>
<span class="w">    </span><span class="nx">advert_int</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="nx">authentication</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">auth_type</span><span class="w"> </span><span class="nx">PASS</span>
<span class="w">        </span><span class="nx">auth_pass</span><span class="w"> </span><span class="nx">staging_vip</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">virtual_ipaddress</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="m m-Double">172.31.254.118</span><span class="o">/</span><span class="mi">24</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">track_script</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">chk_ingress</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">zhs67</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="err">#</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">gre</span><span class="o">^</span><span class="nx">C</span>
<span class="p">[</span><span class="nx">root</span><span class="err">@</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">-</span><span class="mi">6</span><span class="nx">klvk</span><span class="o">-</span><span class="nx">worker</span><span class="o">-</span><span class="nx">zhs67</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="err">#</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">ls</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">ens6</span>
<span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="nx">ens6</span><span class="p">:</span><span class="w"> </span><span class="p">&lt;</span><span class="nx">BROADCAST</span><span class="p">,</span><span class="nx">MULTICAST</span><span class="p">,</span><span class="nx">UP</span><span class="p">,</span><span class="nx">LOWER_UP</span><span class="p">&gt;</span><span class="w"> </span><span class="nx">mtu</span><span class="w"> </span><span class="mi">1450</span><span class="w"> </span><span class="nx">qdisc</span><span class="w"> </span><span class="nx">fq_codel</span><span class="w"> </span><span class="nx">state</span><span class="w"> </span><span class="nx">UP</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">qlen</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="nx">link</span><span class="o">/</span><span class="nx">ether</span><span class="w"> </span><span class="nx">fa</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span><span class="mi">3</span><span class="nx">e</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="nx">d2</span><span class="p">:</span><span class="mi">28</span><span class="w"> </span><span class="nx">brd</span><span class="w"> </span><span class="nx">ff</span><span class="p">:</span><span class="nx">ff</span><span class="p">:</span><span class="nx">ff</span><span class="p">:</span><span class="nx">ff</span><span class="p">:</span><span class="nx">ff</span><span class="p">:</span><span class="nx">ff</span>
<span class="w">    </span><span class="nx">inet</span><span class="w"> </span><span class="m m-Double">172.31.254.207</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="nx">brd</span><span class="w"> </span><span class="m m-Double">172.31.254.255</span><span class="w"> </span><span class="nx">scope</span><span class="w"> </span><span class="nx">global</span><span class="w"> </span><span class="nx">dynamic</span><span class="w"> </span><span class="nx">noprefixroute</span><span class="w"> </span><span class="nx">ens6</span>
<span class="w">       </span><span class="nx">valid_lft</span><span class="w"> </span><span class="mi">86337</span><span class="nx">sec</span><span class="w"> </span><span class="nx">preferred_lft</span><span class="w"> </span><span class="mi">86337</span><span class="nx">sec</span>
<span class="w">    </span><span class="nx">inet</span><span class="w"> </span><span class="m m-Double">172.31.254.118</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="nx">scope</span><span class="w"> </span><span class="nx">global</span><span class="w"> </span><span class="nx">secondary</span><span class="w"> </span><span class="nx">ens6</span>
<span class="w">       </span><span class="nx">valid_lft</span><span class="w"> </span><span class="nx">forever</span><span class="w"> </span><span class="nx">preferred_lft</span><span class="w"> </span><span class="nx">forever</span>
<span class="w">    </span><span class="nx">inet6</span><span class="w"> </span><span class="nx">fe80</span><span class="o">::</span><span class="nx">f816</span><span class="p">:</span><span class="mi">3</span><span class="nx">eff</span><span class="p">:</span><span class="nx">fe66</span><span class="p">:</span><span class="nx">d228</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="nx">scope</span><span class="w"> </span><span class="nx">link</span><span class="w"> </span>
<span class="w">       </span><span class="nx">valid_lft</span><span class="w"> </span><span class="nx">forever</span><span class="w"> </span><span class="nx">preferred_lft</span><span class="w"> </span><span class="nx">forever</span>
</code></pre></div></td></tr></table></div></p>
<p>And ping the VIP:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="mf">10.0.89.89</span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.89.89</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.89.89</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.89.89</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">15.7</span><span class="w"> </span><span class="n">ms</span>
<span class="o">^</span><span class="n">C</span>
<span class="o">---</span><span class="w"> </span><span class="mf">10.0.89.89</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">15.791</span><span class="o">/</span><span class="mf">15.791</span><span class="o">/</span><span class="mf">15.791</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span>
</code></pre></div></td></tr></table></div></p>
<p>And SSH into the VIP:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">[</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="p">@</span><span class="n">akaris</span><span class="o">-</span><span class="n">jump</span><span class="o">-</span><span class="n">server</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="n">$</span><span class="w"> </span><span class="n">ssh</span><span class="w"> </span><span class="n">core</span><span class="mf">@10.0.89.89</span>
<span class="n">The</span><span class="w"> </span><span class="n">authenticity</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="err">&#39;</span><span class="mf">10.0.89.89</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.89.89</span><span class="p">)</span><span class="err">&#39;</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">established</span><span class="p">.</span>
<span class="n">ECDSA</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">fingerprint</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">SHA256</span><span class="o">:</span><span class="n">XB</span><span class="o">+</span><span class="n">FYE3vAxFZNI4HakM5WJkHmf74iMdFgI8x</span><span class="o">+</span><span class="n">dLx03A</span><span class="p">.</span>
<span class="n">ECDSA</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">fingerprint</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">MD5</span><span class="o">:</span><span class="n">a2</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="n">c1</span><span class="o">:</span><span class="mi">52</span><span class="o">:</span><span class="n">ee</span><span class="o">:</span><span class="mo">05</span><span class="o">:</span><span class="mi">67</span><span class="o">:</span><span class="mi">52</span><span class="o">:</span><span class="mi">7</span><span class="n">c</span><span class="o">:</span><span class="mi">2</span><span class="n">a</span><span class="o">:</span><span class="n">a9</span><span class="o">:</span><span class="n">b8</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="n">a9</span><span class="o">:</span><span class="n">a5</span><span class="o">:</span><span class="n">ee</span><span class="p">.</span>
<span class="n">Are</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="n">connecting</span><span class="w"> </span><span class="p">(</span><span class="n">yes</span><span class="o">/</span><span class="n">no</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="n">yes</span>
<span class="nl">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">Permanently</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="err">&#39;</span><span class="mf">10.0.89.89</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">ECDSA</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="n">hosts</span><span class="p">.</span>
<span class="n">Red</span><span class="w"> </span><span class="n">Hat</span><span class="w"> </span><span class="n">Enterprise</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">CoreOS</span><span class="w"> </span><span class="mf">45.82.202007240629</span><span class="mi">-0</span>
<span class="w">  </span><span class="n">Part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">OpenShift</span><span class="w"> </span><span class="mf">4.5</span><span class="p">,</span><span class="w"> </span><span class="n">RHCOS</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Kubernetes</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">operating</span><span class="w"> </span><span class="n">system</span>
<span class="w">  </span><span class="n">managed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Machine</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="n">Operator</span><span class="w"> </span><span class="p">(</span><span class="err">`</span><span class="n">clusteroperator</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="n">config</span><span class="err">`</span><span class="p">).</span>

<span class="nl">WARNING</span><span class="p">:</span><span class="w"> </span><span class="n">Direct</span><span class="w"> </span><span class="n">SSH</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">machines</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">recommended</span><span class="p">;</span><span class="w"> </span><span class="n">instead</span><span class="p">,</span>
<span class="n">make</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="err">`</span><span class="n">machineconfig</span><span class="err">`</span><span class="w"> </span><span class="n">objects</span><span class="o">:</span>
<span class="w">  </span><span class="nl">https</span><span class="p">:</span><span class="c1">//docs.openshift.com/container-platform/4.5/architecture/architecture-rhcos.html</span>

<span class="o">---</span>
<span class="n">Last</span><span class="w"> </span><span class="n">login</span><span class="o">:</span><span class="w"> </span><span class="n">Tue</span><span class="w"> </span><span class="n">Aug</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">19</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span><span class="mi">19</span><span class="w"> </span><span class="mi">2020</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="mf">10.0.88.55</span>
<span class="p">[</span><span class="n">core</span><span class="p">@</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="mi">-6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="n">$</span><span class="w"> </span>
</code></pre></div></td></tr></table></div></p>
<h2 id="step-5-configure-an-ingress-use-ingress-controller-sharding">Step 5: Configure an Ingress, use Ingress controller sharding</h2>
<p>Use:
<a href="https://docs.openshift.com/container-platform/4.5/networking/ingress-operator.html#nw-ingress-sharding_configuring-ingress">https://docs.openshift.com/container-platform/4.5/networking/ingress-operator.html#nw-ingress-sharding_configuring-ingress</a></p>
<p>For example, the following Ingress route should work and be served by the 2 <code class="highlight">staging</code> workers:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="mf">10.0.89.99</span><span class="w"> </span><span class="n">test</span><span class="mf">.</span><span class="n">staging</span><span class="mf">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="mf">....</span>
</code></pre></div></td></tr></table></div></p>
<p>Configure the default IngressController and have it run only on <code class="highlight">worker</code> nodes - you can also exclude namespaces which shall not be served by the default IngressController:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="err">&#39;</span><span class="nx">EOF</span><span class="err">&#39;</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="nx">patch</span><span class="p">.</span><span class="nx">yaml</span>
<span class="nx">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nx">replicas</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="err">#</span><span class="w">  </span><span class="nx">namespaceSelector</span><span class="p">:</span>
<span class="err">#</span><span class="w">    </span><span class="nx">matchExpressions</span><span class="p">:</span>
<span class="err">#</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="nx">key</span><span class="p">:</span><span class="w"> </span><span class="k">type</span>
<span class="err">#</span><span class="w">      </span><span class="nx">operator</span><span class="p">:</span><span class="w"> </span><span class="nx">NotIn</span>
<span class="err">#</span><span class="w">      </span><span class="nx">values</span><span class="p">:</span>
<span class="err">#</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nx">test1</span>
<span class="err">#</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nx">test2</span>
<span class="w">  </span><span class="nx">nodePlacement</span><span class="p">:</span>
<span class="w">    </span><span class="nx">nodeSelector</span><span class="p">:</span>
<span class="w">      </span><span class="nx">matchLabels</span><span class="p">:</span>
<span class="w">        </span><span class="nx">node</span><span class="o">-</span><span class="nx">role</span><span class="p">.</span><span class="nx">kubernetes</span><span class="p">.</span><span class="nx">io</span><span class="o">/</span><span class="nx">worker</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nx">EOF</span>
<span class="nx">oc</span><span class="w"> </span><span class="nx">patch</span><span class="w"> </span><span class="o">-</span><span class="nx">n</span><span class="w"> </span><span class="nx">openshift</span><span class="o">-</span><span class="nx">ingress</span><span class="o">-</span><span class="nx">operator</span><span class="w"> </span><span class="nx">ingresscontroller</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="o">--</span><span class="k">type</span><span class="p">=</span><span class="s">&quot;merge&quot;</span><span class="w"> </span><span class="o">-</span><span class="nx">p</span><span class="w"> </span><span class="s">&quot;$(cat patch.yaml)&quot;</span>
<span class="nx">rm</span><span class="w"> </span><span class="o">-</span><span class="nx">f</span><span class="w"> </span><span class="nx">patch</span><span class="p">.</span><span class="nx">yaml</span>
</code></pre></div></td></tr></table></div></p>
<p>Configure the staging IngressController and have it run only on <code class="highlight">sharded</code> nodes:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="err">&#39;</span><span class="nx">EOF</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">oc</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="o">-</span><span class="nx">f</span><span class="w"> </span><span class="o">-</span>
<span class="nx">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="nx">v1</span>
<span class="nx">items</span><span class="p">:</span>
<span class="o">-</span><span class="w"> </span><span class="nx">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="nx">operator</span><span class="p">.</span><span class="nx">openshift</span><span class="p">.</span><span class="nx">io</span><span class="o">/</span><span class="nx">v1</span>
<span class="w">  </span><span class="nx">kind</span><span class="p">:</span><span class="w"> </span><span class="nx">IngressController</span>
<span class="w">  </span><span class="nx">metadata</span><span class="p">:</span>
<span class="w">    </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">staging</span>
<span class="w">    </span><span class="kn">namespace</span><span class="p">:</span><span class="w"> </span><span class="nx">openshift</span><span class="o">-</span><span class="nx">ingress</span><span class="o">-</span><span class="nx">operator</span>
<span class="w">  </span><span class="nx">spec</span><span class="p">:</span>
<span class="w">    </span><span class="nx">replicas</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nx">domain</span><span class="p">:</span><span class="w"> </span><span class="nx">staging</span><span class="p">.</span><span class="nx">akaris</span><span class="o">-</span><span class="nx">osc</span><span class="o">...</span><span class="p">.</span>
<span class="w">    </span><span class="nx">nodePlacement</span><span class="p">:</span>
<span class="w">      </span><span class="nx">nodeSelector</span><span class="p">:</span>
<span class="w">        </span><span class="nx">matchLabels</span><span class="p">:</span>
<span class="w">          </span><span class="nx">node</span><span class="o">-</span><span class="nx">role</span><span class="p">.</span><span class="nx">kubernetes</span><span class="p">.</span><span class="nx">io</span><span class="o">/</span><span class="nx">staging</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="err">#</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="nx">either</span><span class="w"> </span><span class="o">---</span>
<span class="err">#</span><span class="w">    </span><span class="nx">routeSelector</span><span class="p">:</span>
<span class="err">#</span><span class="w">      </span><span class="nx">matchLabels</span><span class="p">:</span>
<span class="err">#</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">staging</span>
<span class="err">#</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="o">---</span>
<span class="err">#</span><span class="w">    </span><span class="nx">namespaceSelector</span><span class="p">:</span>
<span class="err">#</span><span class="w">      </span><span class="nx">matchLabels</span><span class="p">:</span>
<span class="err">#</span><span class="w">        </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">test1</span>
<span class="w">    </span><span class="nx">endpointPublishingStrategy</span><span class="p">:</span>
<span class="w">      </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">HostNetwork</span>
<span class="w">  </span><span class="nx">status</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="nx">kind</span><span class="p">:</span><span class="w"> </span><span class="nx">List</span>
<span class="nx">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nx">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">  </span><span class="nx">selfLink</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="nx">EOF</span>
</code></pre></div></td></tr></table></div></p>
<p>Verify generation and modification of the IngressController and OpenShift router pods:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">nodes</span>
<span class="n">NAME</span><span class="w">                            </span><span class="n">STATUS</span><span class="w">   </span><span class="n">ROLES</span><span class="w">     </span><span class="n">AGE</span><span class="w">   </span><span class="n">VERSION</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">0</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">g4q6z</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">staging</span><span class="w">   </span><span class="mi">19</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">staging</span><span class="w">   </span><span class="mi">19</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">ingresscontroller</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="n">openshift</span><span class="o">-</span><span class="n">ingress</span><span class="o">-</span><span class="n">operator</span>
<span class="n">NAME</span><span class="w">      </span><span class="n">AGE</span>
<span class="k">default</span><span class="w">   </span><span class="mi">24</span><span class="n">h</span>
<span class="n">staging</span><span class="w">   </span><span class="mi">13</span><span class="n">m</span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">pods</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="n">openshift</span><span class="o">-</span><span class="n">ingress</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">wide</span>
<span class="n">NAME</span><span class="w">                              </span><span class="n">READY</span><span class="w">   </span><span class="n">STATUS</span><span class="w">    </span><span class="n">RESTARTS</span><span class="w">   </span><span class="n">AGE</span><span class="w">    </span><span class="n">IP</span><span class="w">              </span><span class="n">NODE</span><span class="w">                            </span><span class="n">NOMINATED</span><span class="w"> </span><span class="n">NODE</span><span class="w">   </span><span class="n">READINESS</span><span class="w"> </span><span class="n">GATES</span>
<span class="n">router</span><span class="o">-</span><span class="k">default</span><span class="o">-</span><span class="mi">7</span><span class="n">fd7bdd4fc</span><span class="o">-</span><span class="n">jf55h</span><span class="w">   </span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="w">     </span><span class="n">Running</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="mi">2</span><span class="n">m5s</span><span class="w">   </span><span class="mf">192.168.0.114</span><span class="w">   </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w">           </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
<span class="n">router</span><span class="o">-</span><span class="k">default</span><span class="o">-</span><span class="mi">7</span><span class="n">fd7bdd4fc</span><span class="o">-</span><span class="n">mc572</span><span class="w">   </span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="w">     </span><span class="n">Running</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="mi">106</span><span class="n">s</span><span class="w">   </span><span class="mf">192.168.0.251</span><span class="w">   </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w">           </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
<span class="n">router</span><span class="o">-</span><span class="n">staging</span><span class="o">-</span><span class="mi">86</span><span class="n">c864549c</span><span class="o">-</span><span class="mi">7</span><span class="n">stx8</span><span class="w">   </span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="w">     </span><span class="n">Running</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="mi">14</span><span class="n">m</span><span class="w">    </span><span class="mf">192.168.1.160</span><span class="w">   </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w">           </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
<span class="n">router</span><span class="o">-</span><span class="n">staging</span><span class="o">-</span><span class="mi">86</span><span class="n">c864549c</span><span class="o">-</span><span class="n">nkz28</span><span class="w">   </span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="w">     </span><span class="n">Running</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="mi">14</span><span class="n">m</span><span class="w">    </span><span class="mf">192.168.2.48</span><span class="w">    </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w">           </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="step-6-expose-route">Step 6: Expose route</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>oc new-project test
oc adm policy add-scc-to-user anyuid -z default
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code>cat &lt;&lt;&#39;EOF&#39; &gt; httpbin-ingress.yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: httpbin-ingress
  annotations:
    kubernetes.io/ingress.allow-http: &quot;true&quot;
spec:
  rules:
  - host: httpbin-ingress.staging.akaris-osc....
    http:
      paths:
      - path: /
        backend:
          serviceName: httpbin-service
          servicePort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: httpbin-service
  labels:
    app: httpbin-deployment
spec:
  selector:
    app: httpbin-pod
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: httpbin-deployment
  labels:
    app: httpbin-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: httpbin-pod
  template:
    metadata:
      labels:
        app: httpbin-pod
    spec:
      containers:
      - name: tshark
        image: danielguerra/alpine-tshark 
        command:
          - &quot;tshark&quot; 
          - &quot;-i&quot; 
          - &quot;eth0&quot; 
          - &quot;-Y&quot; 
          - &quot;http&quot; 
          - &quot;-V&quot;  
          - &quot;dst&quot; 
          - &quot;port&quot;
          - &quot;80&quot;
      - name: httpbin
        image: kennethreitz/httpbin
        imagePullPolicy: Always
        command:
        - &quot;gunicorn&quot;
        - &quot;-b&quot;
        - &quot;0.0.0.0:80&quot;
        - &quot;httpbin:app&quot;
        - &quot;-k&quot;
        - &quot;gevent&quot;
        - &quot;--capture-output&quot;
        - &quot;--error-logfile&quot;
        - &quot;-&quot;
        - &quot;--access-logfile&quot;
        - &quot;-&quot;
        - &quot;--access-logformat&quot;
        - &quot;&#39;%(h)s %(t)s %(r)s %(s)s Host: %({Host}i)s} Header-i: %({Header}i)s Header-o: %({Header}o)s&#39;&quot;
EOF
oc apply -f httpbin-ingress.yaml
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">routes</span><span class="w"> </span>
<span class="n">NAME</span><span class="w">                    </span><span class="k">HOST</span><span class="o">/</span><span class="n">PORT</span><span class="w">                                                                                 </span><span class="k">PATH</span><span class="w">   </span><span class="n">SERVICES</span><span class="w">          </span><span class="n">PORT</span><span class="w">    </span><span class="n">TERMINATION</span><span class="w">   </span><span class="n">WILDCARD</span>
<span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="o">-</span><span class="n">z9tgf</span><span class="w">   </span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">more</span><span class="w">   </span><span class="o">/</span><span class="w">      </span><span class="n">httpbin</span><span class="o">-</span><span class="n">service</span><span class="w">   </span><span class="o">&lt;</span><span class="ow">all</span><span class="o">&gt;</span><span class="w">                 </span><span class="k">None</span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span>
<span class="err">{</span>
<span class="w">  </span><span class="ss">&quot;args&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">{}</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="ss">&quot;headers&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="ss">&quot;Accept&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;*/*&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;Forwarded&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;for=10.0.88.55;host=httpbin-ingress.staging.akaris-osc....;proto=http&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;Host&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;httpbin-ingress.staging.akaris-osc....&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;User-Agent&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;curl/7.29.0&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;X-Forwarded-Host&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;httpbin-ingress.staging.akaris-osc....&quot;</span>
<span class="w">  </span><span class="err">}</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="ss">&quot;origin&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;10.0.88.55&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="ss">&quot;url&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;http://httpbin-ingress.staging.akaris-osc..../get&quot;</span>
<span class="err">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="step-7-security-hardening">Step 7: Security hardening</h2>
<p>This is out of scope of this PoC, but note that at the moment, the default Ingress can still handle all domains and thus if the client configures its resolver appropriately, can reach the application via the default VIP.</p>
<p>For example, take this mapping:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="mf">10.0.88.28</span><span class="w"> </span><span class="o">*</span><span class="mf">.</span><span class="n">apps</span><span class="mf">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="mf">....</span>
<span class="mf">10.0.89.89</span><span class="w"> </span><span class="o">*</span><span class="mf">.</span><span class="n">staging</span><span class="mf">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="mf">....</span>
</code></pre></div></td></tr></table></div></p>
<p>Then one can still use the other ingress router by modifying the client resolver:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="o">--</span><span class="n">resolve</span><span class="w"> </span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="o">/</span><span class="k">get</span><span class="err">:</span><span class="mi">80</span><span class="err">:</span><span class="mf">10.0.88.28</span><span class="w"> </span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="o">/</span><span class="k">get</span>
<span class="err">{</span>
<span class="w">  </span><span class="ss">&quot;args&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">{}</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="ss">&quot;headers&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="ss">&quot;Accept&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;*/*&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;Forwarded&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;for=10.0.88.55;host=httpbin-ingress.staging.akaris-osc....;proto=http&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;Host&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;httpbin-ingress.staging.akaris-osc...., </span>
<span class="ss">    &quot;</span><span class="k">User</span><span class="o">-</span><span class="n">Agent</span><span class="ss">&quot;: &quot;</span><span class="n">curl</span><span class="o">/</span><span class="mf">7.29.0</span><span class="ss">&quot;, </span>
<span class="ss">    &quot;</span><span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="k">Host</span><span class="ss">&quot;: &quot;</span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">...</span><span class="ss">&quot;</span>
<span class="ss">  }, </span>
<span class="ss">  &quot;</span><span class="n">origin</span><span class="ss">&quot;: &quot;</span><span class="mf">10.0.88.55</span><span class="ss">&quot;, </span>
<span class="ss">  &quot;</span><span class="n">url</span><span class="ss">&quot;: &quot;</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="o">/</span><span class="k">get</span><span class="ss">&quot;</span>
<span class="ss">}</span>
<span class="ss">[cloud-user@akaris-jump-server ~]$ curl --resolve httpbin-ingress.staging.akaris-osc..../get:80:10.0.89.89 httpbin-ingress.staging.akaris-osc.../get</span>
<span class="ss">{</span>
<span class="ss">  &quot;</span><span class="n">args</span><span class="ss">&quot;: {}, </span>
<span class="ss">  &quot;</span><span class="n">headers</span><span class="ss">&quot;: {</span>
<span class="ss">    &quot;</span><span class="n">Accept</span><span class="ss">&quot;: &quot;</span><span class="o">*</span><span class="cm">/*&quot;, </span>
<span class="cm">    &quot;Forwarded&quot;: &quot;for=10.0.88.55;host=httpbin-ingress.staging.akaris-osc....;proto=http&quot;, </span>
<span class="cm">    &quot;Host&quot;: &quot;httpbin-ingress.staging.akaris-osc...&quot;, </span>
<span class="cm">    &quot;User-Agent&quot;: &quot;curl/7.29.0&quot;, </span>
<span class="cm">    &quot;X-Forwarded-Host&quot;: &quot;httpbin-ingress.staging.akaris-osc...&quot;</span>
<span class="cm">  }, </span>
<span class="cm">  &quot;origin&quot;: &quot;10.0.88.55&quot;, </span>
<span class="cm">  &quot;url&quot;: &quot;http://httpbin-ingress.staging.akaris-osc.../get&quot;</span>
<span class="cm">}</span>
</code></pre></div></td></tr></table></div></p>
<p>And the same goes for the other way around:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="o">--</span><span class="n">resolve</span><span class="w"> </span><span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="n">application</span><span class="p">.</span><span class="n">apps</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="err">:</span><span class="mi">80</span><span class="err">:</span><span class="mf">10.0.88.28</span><span class="w"> </span><span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="n">application</span><span class="p">.</span><span class="n">apps</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span>
<span class="n">Nginx</span><span class="w"> </span><span class="n">A</span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="o">--</span><span class="n">resolve</span><span class="w"> </span><span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="n">application</span><span class="p">.</span><span class="n">apps</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="err">:</span><span class="mi">80</span><span class="err">:</span><span class="mf">10.0.89.89</span><span class="w"> </span><span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="n">application</span><span class="p">.</span><span class="n">apps</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span>
<span class="n">Nginx</span><span class="w"> </span><span class="n">A</span>
</code></pre></div></td></tr></table></div></p>
<p>Read the documentation about IngressController sharding for further details.</p>
<h2 id="step-8-troubleshooting">Step 8: Troubleshooting</h2>
<p>Again, a bit outside of the scope of this PoC - the debug pods for my <code class="highlight">staging</code> nodes stopped working overnight. This would need some further troubleshooting:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">nodes</span>
<span class="n">NAME</span><span class="w">                            </span><span class="n">STATUS</span><span class="w">   </span><span class="n">ROLES</span><span class="w">     </span><span class="n">AGE</span><span class="w">   </span><span class="n">VERSION</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">0</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">25</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">25</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">25</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">g4q6z</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">staging</span><span class="w">   </span><span class="mi">19</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">staging</span><span class="w">   </span><span class="mi">19</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">node</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span>
<span class="n">Starting</span><span class="w"> </span><span class="n">pod</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="o">-</span><span class="n">debug</span><span class="w"> </span><span class="p">...</span>
<span class="k">To</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="n">binaries</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="err">`</span><span class="n">chroot</span><span class="w"> </span><span class="o">/</span><span class="k">host</span><span class="err">`</span>
<span class="n">Pod</span><span class="w"> </span><span class="nl">IP</span><span class="p">:</span><span class="w"> </span><span class="mf">192.168.2.48</span>
<span class="k">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">prompt</span><span class="p">,</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">pressing</span><span class="w"> </span><span class="n">enter</span><span class="p">.</span>

<span class="n">Removing</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">pod</span><span class="w"> </span><span class="p">...</span>
<span class="n">Error</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="nl">server</span><span class="p">:</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">dialing</span><span class="w"> </span><span class="nl">backend</span><span class="p">:</span><span class="w"> </span><span class="n">remote</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="nl">tls</span><span class="p">:</span><span class="w"> </span><span class="n">internal</span><span class="w"> </span><span class="n">error</span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span>
</code></pre></div></td></tr></table></div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 15, 2020</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.prune", "navigation.top", "navigation.path", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>