
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>Ingress Controller Sharding on separate VIP - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ingress-controller-sharding-on-separate-vip" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Ingress Controller Sharding on separate VIP
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Ceph
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ceph" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Ceph
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ceph/ceph-manual-test/" class="md-nav__link">
        Ceph manual test with qemu
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Containers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Containers" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Containers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../analyzing-cni/" class="md-nav__link">
        Analyzing CNI calls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        cgroups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        Containers in Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../list_docker_registry_containers/" class="md-nav__link">
        List container images in registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        namespaces
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Linux
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linux" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Linux
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        cgroups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        Containers in Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/hugepages/" class="md-nav__link">
        Hugepages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/ipxe-boot-environment/" class="md-nav__link">
        iPXE boot environment on Fedora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/java-idrac-issues/" class="md-nav__link">
        Java Idrac Issues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/meson/" class="md-nav__link">
        meson
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/vimrc/" class="md-nav__link">
        My vimrc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        namespaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/old_java_version_with_xorgs_in_container/" class="md-nav__link">
        Old Java inside a container with xorgs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/get-process-cgroup-info-and-limits/" class="md-nav__link">
        Retrieving process cgroup resource usage and limit info
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/libvirt-uefi-without-secureboot/" class="md-nav__link">
        RHEL Booting a virtual machine with UEFI but without secure boot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/setting-journalctl-limits/" class="md-nav__link">
        Setting journalctl limits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Networking" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/accept-source-routing/" class="md-nav__link">
        Accept Source Routing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/arp_and_the_neighbor_table/" class="md-nav__link">
        ARP and the Neighbor table
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/bpf-and-tcpdump/" class="md-nav__link">
        BPF and tcpdump
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/bonding_in_linux/" class="md-nav__link">
        Bonding in Linux
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/juniper_x520/" class="md-nav__link">
        Configure Juniper switch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/haproxy-and-h2c/" class="md-nav__link">
        haproxy and HTTP/2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/install-openvswitch-on-rocky/" class="md-nav__link">
        Install Open vSwitch on Rocky Linux 8
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/geneve_tunneling/" class="md-nav__link">
        Geneve tunneling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/golang-ip-conversion/" class="md-nav__link">
        Golang IP address conversion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/netlink/" class="md-nav__link">
        Netlink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovn_standalone_on_fedora/" class="md-nav__link">
        OVN standalone on Fedora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovs_recirculation/" class="md-nav__link">
        OVS packet recirculation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovs-vxlan-tunnels-and-dscp/" class="md-nav__link">
        OVS VXLAN tunnels and DSCP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovs_with_gdb/" class="md-nav__link">
        OVS with GDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/packet-tracing-with-ovn/" class="md-nav__link">
        Packet tracing with OVN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/sctp/" class="md-nav__link">
        SCTP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/useful-commands/" class="md-nav__link">
        Useful commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/wireguard/" class="md-nav__link">
        Wireguard
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          OpenShift
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="OpenShift" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          OpenShift
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../alertmanager/" class="md-nav__link">
        AlertManager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ocp-custom-release-image/" class="md-nav__link">
        Building custom release images for OpenShift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cpu-manager-with-custom-machine-config-pool/" class="md-nav__link">
        CPU manager with custom MachineConfigPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../crio-conmon-runc/" class="md-nav__link">
        Crio vs conmon vs runc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../etcd_perf/" class="md-nav__link">
        Etcd Performance tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get-vs-list-api-calls/" class="md-nav__link">
        Get vs List API Calls
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openshift_httpbin_tshark_sidecar/" class="md-nav__link">
        Httpbin tshark sidecar container
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster/" class="md-nav__link">
        Hints for installing kubernetes on Fedora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../HPA/" class="md-nav__link">
        Horizontal Pod Autoscaler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../how_rhcos_updates_work/" class="md-nav__link">
        How RHCOS updates work
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ocp4-infra-nodes-with-machineset-without-worker-label/" class="md-nav__link">
        Infra nodes with MachineSets without worker label
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ingresscontroller_router_sharding_ocp_on_osp/" class="md-nav__link">
        Ingress Controller Sharding OCP on OSP
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Ingress Controller Sharding on separate VIP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Ingress Controller Sharding on separate VIP
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-scale-out-by-2-more-worker-nodes" class="md-nav__link">
    Step 1: Scale out by 2 more worker nodes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-add-additional-interface-to-additional-nodes" class="md-nav__link">
    Step 2: Add additional interface to additional nodes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-create-new-role-and-assign-new-nodes-to-the-role" class="md-nav__link">
    Step 3: create new role and assign new nodes to the role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-configure-keepalived-template-for-the-staging-node" class="md-nav__link">
    Step 4: Configure keepalived template for the staging node
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-configure-an-ingress-use-ingress-controller-sharding" class="md-nav__link">
    Step 5: Configure an Ingress, use Ingress controller sharding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-expose-route" class="md-nav__link">
    Step 6: Expose route
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-7-security-hardening" class="md-nav__link">
    Step 7: Security hardening
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-8-troubleshooting" class="md-nav__link">
    Step 8: Troubleshooting
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openshift_mirror_registry/" class="md-nav__link">
        Installing a cluster with a mirror registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../istio-1.6-on-ocp.4.x/" class="md-nav__link">
        Istio 1.6 on OpenShift 4.x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kata/" class="md-nav__link">
        kata containers and the kata operatora
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ovn-kind-hybrid-overlay/" class="md-nav__link">
        Kind with OVN Kubernetes Hybrid Overlay
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kind-with-private-registry/" class="md-nav__link">
        Kind with private registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mounting-container-image/" class="md-nav__link">
        Mount a container image
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/install_openshift_on_openstack/" class="md-nav__link">
        OpenShift on OpenStack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../patch-service-loadbalancer-ingress-ip/" class="md-nav__link">
        Patch status.loadBalancer.ingress IP manually
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../private-registry/" class="md-nav__link">
        Private container registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../proxy-ocp-4.5/" class="md-nav__link">
        Proxy OCP 4.5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../scc/" class="md-nav__link">
        Security Context Constraints (SCC)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openshift-scc-with-mutating-webhooks/" class="md-nav__link">
        SCCs and mutating webhooks - a lesson learned
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fix-selinux-labels-coreos/" class="md-nav__link">
        SElinux labels fix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/sctp/" class="md-nav__link">
        SCTP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../openshift_troubleshooting_etcd_state/" class="md-nav__link">
        Troubleshooting etcd state
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../useful-ocp-commands/" class="md-nav__link">
        Useful commands for OpenShift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../useful-ocp-sdn-commands/" class="md-nav__link">
        Useful commands for OpenShift SDN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting_openshift_on_openstack_worker_creation/" class="md-nav__link">
        Troubleshooting OpenShift on OpenStack worker creation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          OpenStack
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="OpenStack" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          OpenStack
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/reattach_to_running_deployment/" class="md-nav__link">
        Reattach to running deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/using_clouds_yaml/" class="md-nav__link">
        Using clouds.yaml
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          OperatorSDK
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="OperatorSDK" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          OperatorSDK
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../operator-sdk/operator-sdk-reconciliation/" class="md-nav__link">
        Controller Reconciliation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="ingress-controller-sharding-on-separate-vip">Ingress Controller Sharding on separate VIP</h1>
<p>It is important to know that each node can only host one ingress router with <code class="highlight">HostNetwork</code> networking. You will need a specific role for each INGRESS type and different INGRESS types cannot be hosted on the same worker node. This is due to the particularities of the <code class="highlight">HostNetwork</code> network type.</p>
<p>The following example uses the OpenStack IPI.</p>
<h2 id="step-1-scale-out-by-2-more-worker-nodes">Step 1: Scale out by 2 more worker nodes</h2>
<p>Scale out the worker role. This step might have to be improved.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server cluster-logging</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="n">openshift</span><span class="o">-</span><span class="n">machine</span><span class="o">-</span><span class="n">api</span><span class="w"> </span><span class="o">--</span><span class="n">replicas</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="n">machineset</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="w"></span>
<span class="n">machineset</span><span class="p">.</span><span class="n">machine</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="w"> </span><span class="n">scaled</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server cluster-logging</span><span class="o">]</span><span class="err">$</span><span class="w"> </span>
</code></pre></div>
</td></tr></table></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">nodes</span><span class="w"></span>
<span class="n">NAME</span><span class="w">                            </span><span class="n">STATUS</span><span class="w">   </span><span class="n">ROLES</span><span class="w">    </span><span class="n">AGE</span><span class="w">     </span><span class="n">VERSION</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">0</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">   </span><span class="mi">5</span><span class="n">h18m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">   </span><span class="mi">5</span><span class="n">h18m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">   </span><span class="mi">5</span><span class="n">h19m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">g4q6z</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">5</span><span class="n">h4m</span><span class="w">    </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">2</span><span class="n">m12s</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">5</span><span class="n">h1m</span><span class="w">    </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">5</span><span class="n">h6m</span><span class="w">    </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">   </span><span class="mi">2</span><span class="n">m57s</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<h2 id="step-2-add-additional-interface-to-additional-nodes">Step 2: Add additional interface to additional nodes</h2>
<p>This step will be executed within the underlying infrastructure provider. In this example case, OpenShift is hosted on top of OpenStack.</p>
<p>Make sure that the subnet runs a DHCP server:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">subnet</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="o">--</span><span class="n">dhcp</span><span class="w"> </span><span class="mi">41</span><span class="n">c073c0</span><span class="o">-</span><span class="mi">5</span><span class="n">b6a</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">9023</span><span class="o">-</span><span class="mi">115</span><span class="n">ce3d0e378</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">subnet</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="mi">41</span><span class="n">c073c0</span><span class="o">-</span><span class="mi">5</span><span class="n">b6a</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">9023</span><span class="o">-</span><span class="mi">115</span><span class="n">ce3d0e378</span><span class="w"></span>
<span class="o">+-------------------+--------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Field</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">Value</span><span class="w">                                </span><span class="o">|</span><span class="w"></span>
<span class="o">+-------------------+--------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">allocation_pools</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="mf">172.31.254.2</span><span class="o">-</span><span class="mf">172.31.254.254</span><span class="w">          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">cidr</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="mf">172.31.254.0</span><span class="o">/</span><span class="mi">24</span><span class="w">                      </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">created_at</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span><span class="nl">T17</span><span class="p">:</span><span class="mi">13</span><span class="err">:</span><span class="mi">39</span><span class="n">Z</span><span class="w">                 </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w">       </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">dns_nameservers</span><span class="w">   </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">enable_dhcp</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">True</span><span class="w">                                 </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">gateway_ip</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mf">172.31.254.1</span><span class="w">                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">host_routes</span><span class="w">       </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="mi">41</span><span class="n">c073c0</span><span class="o">-</span><span class="mi">5</span><span class="n">b6a</span><span class="o">-</span><span class="mi">4639</span><span class="o">-</span><span class="mi">9023</span><span class="o">-</span><span class="mi">115</span><span class="n">ce3d0e378</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">ip_version</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="w">                                    </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">ipv6_address_mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                 </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">ipv6_ra_mode</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                 </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">subnet</span><span class="w">                </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">network_id</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">aa68c208</span><span class="o">-</span><span class="n">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="n">e</span><span class="o">-</span><span class="n">b508</span><span class="o">-</span><span class="mi">1</span><span class="n">b9d82f3baa4</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">prefix_length</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                 </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">project_id</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w">     </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">revision_number</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="w">                                    </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">segment_id</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                 </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">service_types</span><span class="w">     </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">subnetpool_id</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                 </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w">              </span><span class="o">|</span><span class="w">                                      </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">updated_at</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nl">T15</span><span class="p">:</span><span class="mi">19</span><span class="err">:</span><span class="mi">17</span><span class="n">Z</span><span class="w">                 </span><span class="o">|</span><span class="w"></span>
<span class="o">+</span><span class="c1">-------------------+--------------------------------------+</span>
</code></pre></div>
</td></tr></table></p>
<p>And create a router that can host floating IPs:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>openstack router create akaris-backend
openstack router set --external-gateway 5cd089f9-8ed2-46bc-8ea7-4e1cdb5262ba akaris-backend
openstack router add subnet akaris-backend akaris-backend-subnet
</code></pre></div>
</td></tr></table></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="o">--</span><span class="n">network</span><span class="w"> </span><span class="n">aa68c208</span><span class="o">-</span><span class="n">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="n">e</span><span class="o">-</span><span class="n">b508</span><span class="o">-</span><span class="mi">1</span><span class="n">b9d82f3baa4</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w"></span>
<span class="o">+-----------------------+------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Field</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="k">Value</span><span class="w">                                                                        </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">admin_state_up</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">UP</span><span class="w">                                                                           </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">allowed_address_pairs</span><span class="w"> </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_host_id</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_profile</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_vif_details</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_vif_type</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_vnic_type</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">normal</span><span class="w">                                                                       </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">created_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nl">T14</span><span class="p">:</span><span class="mi">47</span><span class="err">:</span><span class="mi">17</span><span class="n">Z</span><span class="w">                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">data_plane_status</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w">           </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">device_id</span><span class="w">             </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">device_owner</span><span class="w">          </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">dns_assignment</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">dns_name</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">extra_dhcp_opts</span><span class="w">       </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">fixed_ips</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">ip_address</span><span class="o">=</span><span class="s1">&#39;172.31.254.48&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subnet_id</span><span class="o">=</span><span class="s1">&#39;41c073c0-5b6a-4639-9023-115ce3d0e378&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="mf">8e737</span><span class="n">c31</span><span class="o">-</span><span class="mi">0450</span><span class="o">-</span><span class="mi">40</span><span class="n">d0</span><span class="o">-</span><span class="n">a5e0</span><span class="o">-</span><span class="mi">54871</span><span class="n">a735428</span><span class="w">                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">ip_address</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">mac_address</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="nl">fa</span><span class="p">:</span><span class="mi">16</span><span class="err">:</span><span class="mi">3</span><span class="nl">e</span><span class="p">:</span><span class="mi">07</span><span class="err">:</span><span class="mi">66</span><span class="err">:</span><span class="mi">12</span><span class="w">                                                            </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w">                                 </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">network_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">aa68c208</span><span class="o">-</span><span class="n">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="n">e</span><span class="o">-</span><span class="n">b508</span><span class="o">-</span><span class="mi">1</span><span class="n">b9d82f3baa4</span><span class="w">                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">option_name</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">option_value</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">port_security_enabled</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">True</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">project_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w">                                             </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">qos_policy_id</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">revision_number</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">6</span><span class="w">                                                                            </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">security_group_ids</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ae5a722f</span><span class="o">-</span><span class="n">aeea</span><span class="o">-</span><span class="mi">4</span><span class="n">acd</span><span class="o">-</span><span class="mi">8260</span><span class="o">-</span><span class="n">a04f5dceb624</span><span class="w">                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">status</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="n">DOWN</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">subnet_id</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w">                  </span><span class="o">|</span><span class="w">                                                                              </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">trunk_details</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">updated_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nl">T14</span><span class="p">:</span><span class="mi">47</span><span class="err">:</span><span class="mi">17</span><span class="n">Z</span><span class="w">                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="o">--</span><span class="n">network</span><span class="w"> </span><span class="n">aa68c208</span><span class="o">-</span><span class="n">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="n">e</span><span class="o">-</span><span class="n">b508</span><span class="o">-</span><span class="mi">1</span><span class="n">b9d82f3baa4</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w"></span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Field</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="k">Value</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">admin_state_up</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">UP</span><span class="w">                                                                            </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">allowed_address_pairs</span><span class="w"> </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_host_id</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_profile</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_vif_details</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_vif_type</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_vnic_type</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">normal</span><span class="w">                                                                        </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">created_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nl">T14</span><span class="p">:</span><span class="mi">47</span><span class="err">:</span><span class="mi">40</span><span class="n">Z</span><span class="w">                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">data_plane_status</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w">           </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">device_id</span><span class="w">             </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">device_owner</span><span class="w">          </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">dns_assignment</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">dns_name</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">extra_dhcp_opts</span><span class="w">       </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">fixed_ips</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">ip_address</span><span class="o">=</span><span class="s1">&#39;172.31.254.207&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subnet_id</span><span class="o">=</span><span class="s1">&#39;41c073c0-5b6a-4639-9023-115ce3d0e378&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="n">c82401f3</span><span class="o">-</span><span class="n">fa76</span><span class="o">-</span><span class="mi">449</span><span class="n">e</span><span class="o">-</span><span class="n">ba16</span><span class="o">-</span><span class="mi">75</span><span class="n">fe4b0f5583</span><span class="w">                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">ip_address</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">mac_address</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="nl">fa</span><span class="p">:</span><span class="mi">16</span><span class="err">:</span><span class="mi">3</span><span class="nl">e</span><span class="p">:</span><span class="mi">66</span><span class="err">:</span><span class="nl">d2</span><span class="p">:</span><span class="mi">28</span><span class="w">                                                             </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w">                                  </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">network_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">aa68c208</span><span class="o">-</span><span class="n">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="n">e</span><span class="o">-</span><span class="n">b508</span><span class="o">-</span><span class="mi">1</span><span class="n">b9d82f3baa4</span><span class="w">                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">option_name</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">option_value</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">port_security_enabled</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">True</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">project_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w">                                              </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">qos_policy_id</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">revision_number</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">6</span><span class="w">                                                                             </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">security_group_ids</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ae5a722f</span><span class="o">-</span><span class="n">aeea</span><span class="o">-</span><span class="mi">4</span><span class="n">acd</span><span class="o">-</span><span class="mi">8260</span><span class="o">-</span><span class="n">a04f5dceb624</span><span class="w">                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">status</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="n">DOWN</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">subnet_id</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w">                  </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">trunk_details</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">updated_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nl">T14</span><span class="p">:</span><span class="mi">47</span><span class="err">:</span><span class="mi">40</span><span class="n">Z</span><span class="w">                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="o">--</span><span class="n">network</span><span class="w"> </span><span class="n">aa68c208</span><span class="o">-</span><span class="n">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="n">e</span><span class="o">-</span><span class="n">b508</span><span class="o">-</span><span class="mi">1</span><span class="n">b9d82f3baa4</span><span class="w"> </span><span class="n">vip</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w"></span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Field</span><span class="w">                 </span><span class="o">|</span><span class="w"> </span><span class="k">Value</span><span class="w">                                                                         </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">admin_state_up</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="n">UP</span><span class="w">                                                                            </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">allowed_address_pairs</span><span class="w"> </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_host_id</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_profile</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_vif_details</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_vif_type</span><span class="w">      </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">binding_vnic_type</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="n">normal</span><span class="w">                                                                        </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">created_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nl">T18</span><span class="p">:</span><span class="mi">32</span><span class="err">:</span><span class="mi">53</span><span class="n">Z</span><span class="w">                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">data_plane_status</span><span class="w">     </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">description</span><span class="w">           </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">device_id</span><span class="w">             </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">device_owner</span><span class="w">          </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">dns_assignment</span><span class="w">        </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">dns_name</span><span class="w">              </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">extra_dhcp_opts</span><span class="w">       </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">fixed_ips</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="n">ip_address</span><span class="o">=</span><span class="s1">&#39;172.31.254.118&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">subnet_id</span><span class="o">=</span><span class="s1">&#39;41c073c0-5b6a-4639-9023-115ce3d0e378&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w">                    </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="n">d0b32f5</span><span class="o">-</span><span class="mi">203</span><span class="n">b</span><span class="o">-</span><span class="mf">4e2</span><span class="n">b</span><span class="o">-</span><span class="n">b92b</span><span class="o">-</span><span class="n">b25f349b1d83</span><span class="w">                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">ip_address</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">mac_address</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="nl">fa</span><span class="p">:</span><span class="mi">16</span><span class="err">:</span><span class="mi">3</span><span class="nl">e</span><span class="p">:</span><span class="mi">0</span><span class="nl">d</span><span class="p">:</span><span class="mi">3</span><span class="nl">e</span><span class="p">:</span><span class="n">cd</span><span class="w">                                                             </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">name</span><span class="w">                  </span><span class="o">|</span><span class="w"> </span><span class="n">vip</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w">                                                            </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">network_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">aa68c208</span><span class="o">-</span><span class="n">b6c9</span><span class="o">-</span><span class="mi">402</span><span class="n">e</span><span class="o">-</span><span class="n">b508</span><span class="o">-</span><span class="mi">1</span><span class="n">b9d82f3baa4</span><span class="w">                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">option_name</span><span class="w">           </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">option_value</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">port_security_enabled</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="k">True</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">project_id</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w">                                              </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">qos_policy_id</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">revision_number</span><span class="w">       </span><span class="o">|</span><span class="w"> </span><span class="mi">6</span><span class="w">                                                                             </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">security_group_ids</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="n">ae5a722f</span><span class="o">-</span><span class="n">aeea</span><span class="o">-</span><span class="mi">4</span><span class="n">acd</span><span class="o">-</span><span class="mi">8260</span><span class="o">-</span><span class="n">a04f5dceb624</span><span class="w">                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">status</span><span class="w">                </span><span class="o">|</span><span class="w"> </span><span class="n">DOWN</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">subnet_id</span><span class="w">             </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">tags</span><span class="w">                  </span><span class="o">|</span><span class="w">                                                                               </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">trunk_details</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="k">None</span><span class="w">                                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">updated_at</span><span class="w">            </span><span class="o">|</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">11</span><span class="nl">T18</span><span class="p">:</span><span class="mi">32</span><span class="err">:</span><span class="mi">53</span><span class="n">Z</span><span class="w">                                                          </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+-------------------------------------------------------------------------------+</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">floating</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="o">--</span><span class="n">port</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">floating</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="o">--</span><span class="n">port</span><span class="w"> </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="o">-</span><span class="n">akaris</span><span class="o">-</span><span class="n">backend</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">floating</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="c1">--port vip-akaris-backend 10.0.89.89</span>
</code></pre></div>
</td></tr></table>
<p>After this, the floating IPs look like this in OpenStack:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="n">floating</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="mf">172.31.254</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">dd055cc4</span><span class="o">-</span><span class="n">af00</span><span class="o">-</span><span class="mi">4</span><span class="n">dbd</span><span class="o">-</span><span class="mf">8e4</span><span class="n">a</span><span class="o">-</span><span class="mi">94</span><span class="n">fac680299d</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">10.0.89.89</span><span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="mf">172.31.254.118</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mi">4</span><span class="n">d0b32f5</span><span class="o">-</span><span class="mi">203</span><span class="n">b</span><span class="o">-</span><span class="mf">4e2</span><span class="n">b</span><span class="o">-</span><span class="n">b92b</span><span class="o">-</span><span class="n">b25f349b1d83</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="n">cd089f9</span><span class="o">-</span><span class="mi">8</span><span class="n">ed2</span><span class="o">-</span><span class="mi">46</span><span class="n">bc</span><span class="o">-</span><span class="mi">8</span><span class="n">ea7</span><span class="o">-</span><span class="mf">4e1</span><span class="n">cdb5262ba</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">e586c5c8</span><span class="o">-</span><span class="mi">1</span><span class="n">cd4</span><span class="o">-</span><span class="mi">4</span><span class="n">bd5</span><span class="o">-</span><span class="n">adb7</span><span class="o">-</span><span class="mf">790e895</span><span class="n">b5af8</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mf">172.31.254.48</span><span class="w">    </span><span class="o">|</span><span class="w"> </span><span class="mf">8e737</span><span class="n">c31</span><span class="o">-</span><span class="mi">0450</span><span class="o">-</span><span class="mi">40</span><span class="n">d0</span><span class="o">-</span><span class="n">a5e0</span><span class="o">-</span><span class="mi">54871</span><span class="n">a735428</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="n">cd089f9</span><span class="o">-</span><span class="mi">8</span><span class="n">ed2</span><span class="o">-</span><span class="mi">46</span><span class="n">bc</span><span class="o">-</span><span class="mi">8</span><span class="n">ea7</span><span class="o">-</span><span class="mf">4e1</span><span class="n">cdb5262ba</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">f7e082f1</span><span class="o">-</span><span class="mi">7880</span><span class="o">-</span><span class="mi">4</span><span class="n">f07</span><span class="o">-</span><span class="mi">8</span><span class="n">a05</span><span class="o">-</span><span class="mi">3</span><span class="n">fdb0585eb32</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="w">         </span><span class="o">|</span><span class="w"> </span><span class="mf">172.31.254.207</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="n">c82401f3</span><span class="o">-</span><span class="n">fa76</span><span class="o">-</span><span class="mi">449</span><span class="n">e</span><span class="o">-</span><span class="n">ba16</span><span class="o">-</span><span class="mi">75</span><span class="n">fe4b0f5583</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">5</span><span class="n">cd089f9</span><span class="o">-</span><span class="mi">8</span><span class="n">ed2</span><span class="o">-</span><span class="mi">46</span><span class="n">bc</span><span class="o">-</span><span class="mi">8</span><span class="n">ea7</span><span class="o">-</span><span class="mf">4e1</span><span class="n">cdb5262ba</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ea78dddee3e240c7af1779b417c64618</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<p>Last but not least, disable port security for these ports so that VRRP can work with these OpenStack ports:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="nv">port</span> <span class="nv">in</span> <span class="nv">akaris</span><span class="o">-</span><span class="nv">osc</span><span class="o">-</span><span class="mi">6</span><span class="nv">klvk</span><span class="o">-</span><span class="nv">worker</span><span class="o">-</span><span class="nv">hp2hz</span><span class="o">-</span><span class="nv">akaris</span><span class="o">-</span><span class="nv">backend</span> <span class="nv">akaris</span><span class="o">-</span><span class="nv">osc</span><span class="o">-</span><span class="mi">6</span><span class="nv">klvk</span><span class="o">-</span><span class="nv">worker</span><span class="o">-</span><span class="nv">zhs67</span><span class="o">-</span><span class="nv">akaris</span><span class="o">-</span><span class="nv">backend</span> <span class="nv">vip</span><span class="o">-</span><span class="nv">akaris</span><span class="o">-</span><span class="nv">backend</span> <span class="c1">; do </span>
    <span class="nv">echo</span> <span class="o">===</span> $<span class="nv">port</span> <span class="o">===</span>
    <span class="nv">openstack</span> <span class="nv">port</span> <span class="nv">set</span> <span class="o">--</span><span class="nv">no</span><span class="o">-</span><span class="nv">security</span><span class="o">-</span><span class="nv">group</span> $<span class="nv">port</span>
    <span class="nv">openstack</span> <span class="nv">port</span> <span class="nv">set</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">port</span><span class="o">-</span><span class="nv">security</span> $<span class="nv">port</span>
<span class="nv">done</span>
</code></pre></div>
</td></tr></table></p>
<p>The VRRP floating IP is: 
   IP 172.31.254.118
   MAC address: fa:16:3e:0d:3e:cd
   VIP: 10.0.89.89</p>
<p>Verify that the port was added to the workers:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">node</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w"></span>
<span class="n">Starting</span><span class="w"> </span><span class="n">pod</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="o">-</span><span class="n">debug</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="k">To</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="n">binaries</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="err">`</span><span class="n">chroot</span><span class="w"> </span><span class="o">/</span><span class="k">host</span><span class="err">`</span><span class="w"></span>
<span class="n">Pod</span><span class="w"> </span><span class="nl">IP</span><span class="p">:</span><span class="w"> </span><span class="mf">192.168.1.160</span><span class="w"></span>
<span class="k">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t see a command prompt, try pressing enter.</span>
<span class="s1">sh-4.2# chroot /host</span>
<span class="s1">sh-4.4# toolbox</span>
<span class="s1">Trying to pull registry.redhat.io/rhel8/support-tools...</span>
<span class="s1">Getting image source signatures</span>
<span class="s1">Copying blob 77c58f19bd6e done  </span>
<span class="s1">Copying blob 47db82df7f3f done  </span>
<span class="s1">Copying blob cdc5441bd52d done  </span>
<span class="s1">Copying config 5ef2aab094 done  </span>
<span class="s1">Writing manifest to image destination</span>
<span class="s1">Storing signatures</span>
<span class="s1">5ef2aab094514cc5561fa94b0bb52d75379ecf8a36355e891017f3982bac278c</span>
<span class="s1">Spawning a container &#39;</span><span class="n">toolbox</span><span class="o">-</span><span class="s1">&#39; with image &#39;</span><span class="n">registry</span><span class="p">.</span><span class="n">redhat</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">rhel8</span><span class="o">/</span><span class="n">support</span><span class="o">-</span><span class="n">tools</span><span class="err">&#39;</span><span class="w"></span>
<span class="n">Detected</span><span class="w"> </span><span class="n">RUN</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="nc">image</span><span class="p">.</span><span class="w"> </span><span class="k">Using</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">default</span><span class="p">...</span><span class="w"></span>
<span class="nl">command</span><span class="p">:</span><span class="w"> </span><span class="n">podman</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">it</span><span class="w"> </span><span class="o">--</span><span class="n">name</span><span class="w"> </span><span class="n">toolbox</span><span class="o">-</span><span class="w"> </span><span class="o">--</span><span class="n">privileged</span><span class="w"> </span><span class="o">--</span><span class="n">ipc</span><span class="o">=</span><span class="k">host</span><span class="w"> </span><span class="o">--</span><span class="n">net</span><span class="o">=</span><span class="k">host</span><span class="w"> </span><span class="o">--</span><span class="n">pid</span><span class="o">=</span><span class="k">host</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="k">HOST</span><span class="o">=/</span><span class="k">host</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">NAME</span><span class="o">=</span><span class="n">toolbox</span><span class="o">-</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="nc">IMAGE</span><span class="o">=</span><span class="n">registry</span><span class="p">.</span><span class="n">redhat</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">rhel8</span><span class="o">/</span><span class="n">support</span><span class="o">-</span><span class="nl">tools</span><span class="p">:</span><span class="n">latest</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="nl">run</span><span class="p">:</span><span class="o">/</span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="nf">var</span><span class="o">/</span><span class="nf">log</span><span class="err">:</span><span class="o">/</span><span class="nf">var</span><span class="o">/</span><span class="nf">log</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="nl">id</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="k">localtime</span><span class="err">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="k">localtime</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="err">:</span><span class="o">/</span><span class="k">host</span><span class="w"> </span><span class="n">registry</span><span class="p">.</span><span class="n">redhat</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">rhel8</span><span class="o">/</span><span class="n">support</span><span class="o">-</span><span class="nl">tools</span><span class="p">:</span><span class="n">latest</span><span class="w"></span>
<span class="o">[</span><span class="n">root@akaris-osc-6klvk-worker-hp2hz /</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">yum</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">iproute</span><span class="w"> </span><span class="o">-</span><span class="n">y</span><span class="w"></span>
<span class="p">(...)</span><span class="w"></span>
<span class="nl">Installed</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="n">iproute</span><span class="o">-</span><span class="mf">5.3.0</span><span class="o">-</span><span class="mf">1.</span><span class="n">el8</span><span class="p">.</span><span class="n">x86_64</span><span class="w">                                 </span><span class="n">libmnl</span><span class="o">-</span><span class="mf">1.0.4</span><span class="o">-</span><span class="mf">6.</span><span class="n">el8</span><span class="p">.</span><span class="n">x86_64</span><span class="w">                                </span>

<span class="n">Complete</span><span class="err">!</span><span class="w"></span>
<span class="o">[</span><span class="n">root@akaris-osc-6klvk-worker-hp2hz /</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">dmesg</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tail</span><span class="w"></span>
<span class="o">[</span><span class="n">  745.078322</span><span class="o">]</span><span class="w"> </span><span class="n">pci</span><span class="w"> </span><span class="mi">0000</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mf">06.0</span><span class="err">:</span><span class="w"> </span><span class="n">BAR</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"> </span><span class="n">assigned</span><span class="w"> </span><span class="o">[</span><span class="n">io  0x1000-0x103f</span><span class="o">]</span><span class="w"></span>
<span class="o">[</span><span class="n">  745.080319</span><span class="o">]</span><span class="w"> </span><span class="n">virtio</span><span class="o">-</span><span class="n">pci</span><span class="w"> </span><span class="mi">0000</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mf">06.0</span><span class="err">:</span><span class="w"> </span><span class="n">enabling</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="p">(</span><span class="mi">0000</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">0003</span><span class="p">)</span><span class="w"></span>
<span class="o">[</span><span class="n">  745.100662</span><span class="o">]</span><span class="w"> </span><span class="n">PCI</span><span class="w"> </span><span class="n">Interrupt</span><span class="w"> </span><span class="n">Link</span><span class="w"> </span><span class="o">[</span><span class="n">LNKB</span><span class="o">]</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">IRQ</span><span class="w"> </span><span class="mi">11</span><span class="w"></span>
<span class="o">[</span><span class="n">  745.109702</span><span class="o">]</span><span class="w"> </span><span class="n">virtio_net</span><span class="w"> </span><span class="n">virtio3</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">renamed</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">eth0</span><span class="w"></span>
<span class="o">[</span><span class="n">  745.156833</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_UP</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ready</span><span class="w"></span>
<span class="o">[</span><span class="n">  745.159290</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_UP</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ready</span><span class="w"></span>
<span class="o">[</span><span class="n">  745.165677</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_UP</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ready</span><span class="w"></span>
<span class="o">[</span><span class="n">  745.172694</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_UP</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">ready</span><span class="w"></span>
<span class="o">[</span><span class="n">  746.143079</span><span class="o">]</span><span class="w"> </span><span class="nl">IPv6</span><span class="p">:</span><span class="w"> </span><span class="n">ADDRCONF</span><span class="p">(</span><span class="n">NETDEV_CHANGE</span><span class="p">)</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">becomes</span><span class="w"> </span><span class="n">ready</span><span class="w"></span>
<span class="o">[</span><span class="n">  861.279527</span><span class="o">]</span><span class="w"> </span><span class="nl">SELinux</span><span class="p">:</span><span class="w"> </span><span class="n">mount</span><span class="w"> </span><span class="n">invalid</span><span class="p">.</span><span class="w">  </span><span class="n">Same</span><span class="w"> </span><span class="n">superblock</span><span class="p">,</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">dev</span><span class="w"> </span><span class="n">mqueue</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">mqueue</span><span class="p">)</span><span class="w"></span>
<span class="o">[</span><span class="n">root@akaris-osc-6klvk-worker-hp2hz /</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="n">ens6</span><span class="w"></span>
<span class="mi">10</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1450</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">fq_codel</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span><span class="w"></span>
<span class="w">    </span><span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="nl">fa</span><span class="p">:</span><span class="mi">16</span><span class="err">:</span><span class="mi">3</span><span class="nl">e</span><span class="p">:</span><span class="mi">07</span><span class="err">:</span><span class="mi">66</span><span class="err">:</span><span class="mi">12</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="n">ff</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<p>Repeat the same on the other node:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">node</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w"></span>
<span class="p">(...)</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<h2 id="step-3-create-new-role-and-assign-new-nodes-to-the-role">Step 3: create new role and assign new nodes to the role</h2>
<p>Follow <a href="https://www.redhat.com/en/blog/openshift-container-platform-4-how-does-machine-config-pool-work">https://www.redhat.com/en/blog/openshift-container-platform-4-how-does-machine-config-pool-work with modifications</a>.</p>
<p>Run this via a script that's triggered by a systemd unit file:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="o">-</span><span class="w"></span>
<span class="nl">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="n">machineconfiguration</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span><span class="w"></span>
<span class="nl">kind</span><span class="p">:</span><span class="w"> </span><span class="n">MachineConfigPool</span><span class="w"></span>
<span class="nl">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">staging</span><span class="w"></span>
<span class="nl">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nl">machineConfigSelector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nl">matchExpressions</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="err">{</span><span class="k">key</span><span class="err">:</span><span class="w"> </span><span class="n">machineconfiguration</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="k">role</span><span class="p">,</span><span class="w"> </span><span class="nl">operator</span><span class="p">:</span><span class="w"> </span><span class="ow">In</span><span class="p">,</span><span class="w"> </span><span class="k">values</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">worker,staging</span><span class="o">]</span><span class="err">}</span><span class="w"></span>
<span class="w">  </span><span class="nl">nodeSelector</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nl">matchLabels</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="n">node</span><span class="o">-</span><span class="k">role</span><span class="p">.</span><span class="n">kubernetes</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="nl">staging</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nl">paused</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="w"></span>
<span class="n">EOF</span><span class="w"></span>

<span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s1">&#39;FOE&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">sh</span><span class="w"></span>
<span class="err">#!</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span><span class="w"></span>

<span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">ens6</span><span class="w"></span>
<span class="n">NAME</span><span class="o">=</span><span class="ss">&quot;System ens6&quot;</span><span class="w"></span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">dhcp</span><span class="w"></span>
<span class="n">DEFROUTE</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
<span class="n">IPV6INIT</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">ens6</span><span class="w"></span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span><span class="w"></span>
<span class="n">EOF</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="k">none</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">work</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">we</span><span class="s1">&#39;re using DHCP</span>
<span class="s1"># cat &lt;&lt;&#39;</span><span class="n">EOF</span><span class="s1">&#39; &gt; /etc/sysconfig/network-scripts/rule-ens6</span>
<span class="s1"># from 172.31.254.0/24 lookup 5000</span>
<span class="s1"># EOF</span>

<span class="s1"># cat &lt;&lt;&#39;</span><span class="n">EOF</span><span class="s1">&#39; &gt; /etc/sysconfig/network-scripts/route-ens6</span>
<span class="s1"># default via 172.31.254.1 table 5000</span>
<span class="s1"># EOF</span>

<span class="s1"># the following will not work either</span>
<span class="s1"># ip rule add from 172.31.254.0/24 lookup 5000</span>
<span class="s1"># ip route add default via 172.31.254.1 table 5000</span>

<span class="s1">cat &lt;&lt;&#39;</span><span class="n">EOF</span><span class="err">&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">NetworkManager</span><span class="o">/</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">ifup</span><span class="o">-</span><span class="k">local</span><span class="w"></span>
<span class="err">#!</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="w"></span>

<span class="n">interface</span><span class="o">=</span><span class="ss">&quot;$1&quot;</span><span class="w"></span>
<span class="n">status</span><span class="o">=</span><span class="ss">&quot;$2&quot;</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="n"> &quot;$interface&quot; == &quot;ens6&quot; </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="n"> &quot;$status&quot; == &quot;up&quot; </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<span class="w">  </span><span class="n">logger</span><span class="w"> </span><span class="ss">&quot;Interface $interface $status - setting ip rule and ip route&quot;</span><span class="w"></span>
<span class="w">  </span><span class="n">ip</span><span class="w"> </span><span class="k">rule</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">172.31.254.0</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">lookup</span><span class="w"> </span><span class="mi">5000</span><span class="w"></span>
<span class="w">  </span><span class="n">ip</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="mf">172.31.254.1</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="mi">5000</span><span class="w"></span>
<span class="n">fi</span><span class="w"></span>
<span class="n">EOF</span><span class="w"></span>
<span class="n">chmod</span><span class="w"> </span><span class="o">+</span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">NetworkManager</span><span class="o">/</span><span class="n">dispatcher</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">ifup</span><span class="o">-</span><span class="k">local</span><span class="w"></span>
<span class="n">FOE</span><span class="w"></span>

<span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="o">-</span><span class="w"></span>
<span class="nl">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="n">machineconfiguration</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1</span><span class="w"></span>
<span class="nl">kind</span><span class="p">:</span><span class="w"> </span><span class="n">MachineConfig</span><span class="w"></span>
<span class="nl">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nl">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="k">null</span><span class="w"></span>
<span class="w">  </span><span class="nl">labels</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="n">machineconfiguration</span><span class="p">.</span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="k">role</span><span class="err">:</span><span class="w"> </span><span class="n">staging</span><span class="w"></span>
<span class="w">  </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="mi">01</span><span class="o">-</span><span class="n">staging</span><span class="o">-</span><span class="n">additional</span><span class="o">-</span><span class="n">interface</span><span class="w"></span>
<span class="nl">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nl">config</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nl">ignition</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="mf">2.2.0</span><span class="w"></span>
<span class="w">    </span><span class="nl">storage</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nl">files</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">contents</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nl">source</span><span class="p">:</span><span class="w"> </span><span class="k">data</span><span class="err">:</span><span class="p">;</span><span class="n">base64</span><span class="p">,</span><span class="err">$</span><span class="p">(</span><span class="n">cat</span><span class="w"> </span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">sh</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">base64</span><span class="w"> </span><span class="o">-</span><span class="n">w</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">path</span><span class="err">:</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">sh</span><span class="w"></span>
<span class="w">        </span><span class="nl">filesystem</span><span class="p">:</span><span class="w"> </span><span class="n">root</span><span class="w"></span>
<span class="w">        </span><span class="nl">mode</span><span class="p">:</span><span class="w"> </span><span class="mi">0755</span><span class="w"></span>
<span class="w">    </span><span class="nl">systemd</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nl">units</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">contents</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;[Unit]\\nDescription=Configure network\\nAfter=ignition-firstboot-complete.service\\nBefore=nodeip-configuration.service kubelet.service crio.service\\n\\n[Service]\\nType=oneshot\\nExecStart=/usr/local/bin/network-script.sh\\n\\n[Install]\\nWantedBy=multi-user.target&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nl">enabled</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="w"></span>
<span class="w">        </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">service</span><span class="w"></span>
<span class="n">EOF</span><span class="w"></span>

<span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">network</span><span class="o">-</span><span class="n">script</span><span class="p">.</span><span class="n">sh</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<p>Label the nodes as staging:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>oc label node akaris-osc-6klvk-worker-hp2hz node-role.kubernetes.io/worker- node-role.kubernetes.io/staging=
oc label node akaris-osc-6klvk-worker-zhs67 node-role.kubernetes.io/worker- node-role.kubernetes.io/staging=
</code></pre></div>
</td></tr></table></p>
<p>The nodes will now reboot with the new setting, so wait:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">nodes</span><span class="w"></span>
<span class="n">NAME</span><span class="w">                            </span><span class="n">STATUS</span><span class="w">                        </span><span class="n">ROLES</span><span class="w">     </span><span class="n">AGE</span><span class="w">     </span><span class="n">VERSION</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">0</span><span class="w">       </span><span class="n">Ready</span><span class="w">                         </span><span class="n">master</span><span class="w">    </span><span class="mi">5</span><span class="n">h48m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="n">Ready</span><span class="w">                         </span><span class="n">master</span><span class="w">    </span><span class="mi">5</span><span class="n">h48m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="w">       </span><span class="n">Ready</span><span class="w">                         </span><span class="n">master</span><span class="w">    </span><span class="mi">5</span><span class="n">h49m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">g4q6z</span><span class="w">   </span><span class="n">Ready</span><span class="w">                         </span><span class="n">worker</span><span class="w">    </span><span class="mi">5</span><span class="n">h34m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="n">Ready</span><span class="w">                         </span><span class="n">staging</span><span class="w">   </span><span class="mi">32</span><span class="n">m</span><span class="w">     </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="n">Ready</span><span class="w">                         </span><span class="n">worker</span><span class="w">    </span><span class="mi">5</span><span class="n">h31m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="n">Ready</span><span class="w">                         </span><span class="n">worker</span><span class="w">    </span><span class="mi">5</span><span class="n">h36m</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="n">NotReady</span><span class="p">,</span><span class="n">SchedulingDisabled</span><span class="w">   </span><span class="n">staging</span><span class="w">   </span><span class="mi">32</span><span class="n">m</span><span class="w">     </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span>
</code></pre></div>
</td></tr></table></p>
<p>Make sure that the interface was created:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">node</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w"></span>
<span class="n">Starting</span><span class="w"> </span><span class="n">pod</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="o">-</span><span class="n">debug</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="k">To</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="n">binaries</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="err">`</span><span class="n">chroot</span><span class="w"> </span><span class="o">/</span><span class="k">host</span><span class="err">`</span><span class="w"></span>
<span class="n">Pod</span><span class="w"> </span><span class="nl">IP</span><span class="p">:</span><span class="w"> </span><span class="mf">192.168.2.48</span><span class="w"></span>
<span class="k">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">prompt</span><span class="p">,</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">pressing</span><span class="w"> </span><span class="n">enter</span><span class="p">.</span><span class="w"></span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.4</span><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysconfig</span><span class="o">/</span><span class="n">network</span><span class="o">-</span><span class="n">scripts</span><span class="o">/</span><span class="n">ifcfg</span><span class="o">-</span><span class="n">ens6</span><span class="w"> </span>
<span class="n">NAME</span><span class="o">=</span><span class="ss">&quot;System ens6&quot;</span><span class="w"></span>
<span class="n">BOOTPROTO</span><span class="o">=</span><span class="n">dhcp</span><span class="w"></span>
<span class="n">DEFROUTE</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
<span class="n">IPV6INIT</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
<span class="n">DEVICE</span><span class="o">=</span><span class="n">ens6</span><span class="w"></span>
<span class="n">ONBOOT</span><span class="o">=</span><span class="n">yes</span><span class="w"></span>
<span class="n">TYPE</span><span class="o">=</span><span class="n">Ethernet</span><span class="w"></span>
<span class="n">PROXY_METHOD</span><span class="o">=</span><span class="k">none</span><span class="w"></span>
<span class="n">BROWSER_ONLY</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
<span class="n">ETHTOOL_OPTS</span><span class="o">=</span><span class="ss">&quot;-K ens6 tx-checksum-ip-generic off&quot;</span><span class="w"></span>
<span class="n">IPV4_FAILURE_FATAL</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
<span class="n">UUID</span><span class="o">=</span><span class="mi">9325</span><span class="n">ba04</span><span class="o">-</span><span class="mi">7907</span><span class="o">-</span><span class="n">b4a4</span><span class="o">-</span><span class="mi">1414</span><span class="o">-</span><span class="mi">177267</span><span class="n">ba3519</span><span class="w"></span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.2</span><span class="err">#</span><span class="w"> </span><span class="n">chroot</span><span class="w"> </span><span class="o">/</span><span class="k">host</span><span class="w"></span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.4</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="n">ens6</span><span class="w"></span>
<span class="mi">3</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1450</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">fq_codel</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span><span class="w"></span>
<span class="w">    </span><span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="nl">fa</span><span class="p">:</span><span class="mi">16</span><span class="err">:</span><span class="mi">3</span><span class="nl">e</span><span class="p">:</span><span class="mi">66</span><span class="err">:</span><span class="nl">d2</span><span class="p">:</span><span class="mi">28</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="n">ff</span><span class="w"></span>
<span class="w">    </span><span class="n">inet</span><span class="w"> </span><span class="mf">172.31.254.207</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mf">172.31.254.255</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="k">dynamic</span><span class="w"> </span><span class="n">noprefixroute</span><span class="w"> </span><span class="n">ens6</span><span class="w"></span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="mi">86276</span><span class="n">sec</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="mi">86276</span><span class="n">sec</span><span class="w"></span>
<span class="w">    </span><span class="n">inet6</span><span class="w"> </span><span class="nl">fe80</span><span class="p">:</span><span class="err">:</span><span class="nl">f816</span><span class="p">:</span><span class="mi">3</span><span class="nl">eff</span><span class="p">:</span><span class="nl">fe66</span><span class="p">:</span><span class="n">d228</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="n">link</span><span class="w"> </span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"></span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.4</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="mi">5000</span><span class="w"></span>
<span class="k">default</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="mf">172.31.254.1</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="n">ens6</span><span class="w"> </span>
<span class="n">sh</span><span class="o">-</span><span class="mf">4.4</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="k">rule</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="mi">5000</span><span class="w"></span>
<span class="mi">32765</span><span class="err">:</span><span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="mf">172.31.254.0</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">lookup</span><span class="w"> </span><span class="mi">5000</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<p>Run the same verification on the other worker.</p>
<p>Ping both floating IPs and make sure that policy routing works:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="w"></span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.92.194</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="w"></span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">13.8</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="o">^</span><span class="n">C</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="mf">10.0.92.194</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span><span class="w"></span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span><span class="w"></span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">13.897</span><span class="o">/</span><span class="mf">13.897</span><span class="o">/</span><span class="mf">13.897</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="w"></span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.92.205</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="w"></span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">1.24</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="o">^</span><span class="n">C</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="mf">10.0.92.205</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span><span class="w"></span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span><span class="w"></span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.242</span><span class="o">/</span><span class="mf">1.242</span><span class="o">/</span><span class="mf">1.242</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<h2 id="step-4-configure-keepalived-template-for-the-staging-node">Step 4: Configure keepalived template for the staging node</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s1">&#39;EOF&#39;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nt">keepalived</span><span class="p">.</span><span class="nc">conf</span><span class="p">.</span><span class="nc">tmpl</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="nt">TODO</span><span class="o">:</span><span class="w"> </span><span class="nt">Improve</span><span class="w"> </span><span class="nt">this</span><span class="w"> </span><span class="nt">check</span><span class="o">.</span><span class="w"> </span><span class="nt">The</span><span class="w"> </span><span class="nt">port</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">assumed</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">alive</span><span class="o">.</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="nt">Need</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">assess</span><span class="w"> </span><span class="nt">what</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">ramification</span><span class="w"> </span><span class="nt">if</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">port</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">not</span><span class="w"> </span><span class="nt">there</span><span class="o">.</span><span class="w"></span>
<span class="nt">vrrp_script</span><span class="w"> </span><span class="nt">chk_ingress</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">script</span><span class="w"> </span><span class="err">&quot;/usr/bin/curl</span><span class="w"> </span><span class="err">-o</span><span class="w"> </span><span class="err">/dev/null</span><span class="w"> </span><span class="err">-kLfs</span><span class="w"> </span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mi">0</span><span class="o">:</span><span class="mi">1936</span><span class="o">/</span><span class="n">healthz</span><span class="err">&quot;</span><span class="w"></span>
<span class="w">    </span><span class="n">interval</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="kc">weight</span><span class="w"> </span><span class="mi">50</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="nt">vrrp_instance</span><span class="w"> </span><span class="nt">staging_INGRESS</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="err">state</span><span class="w"> </span><span class="err">BACKUP</span><span class="w"></span>
<span class="w">    </span><span class="err">interface</span><span class="w"> </span><span class="err">ens6</span><span class="w"></span>
<span class="w">    </span><span class="err">virtual_router_id</span><span class="w"> </span><span class="err">100</span><span class="w"></span>
<span class="w">    </span><span class="err">priority</span><span class="w"> </span><span class="err">40</span><span class="w"></span>
<span class="w">    </span><span class="err">advert_int</span><span class="w"> </span><span class="err">1</span><span class="w"></span>
<span class="w">    </span><span class="err">authentication</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="err">auth_type</span><span class="w"> </span><span class="err">PASS</span><span class="w"></span>
<span class="w">        </span><span class="err">auth_pass</span><span class="w"> </span><span class="err">staging_vip</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nt">virtual_ipaddress</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="err">172.31.254.118/24</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="nt">track_script</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="err">chk_ingress</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
<span class="nt">EOF</span><span class="w"></span>

<span class="nt">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="nt">EOF</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nt">oc</span><span class="w"> </span><span class="nt">apply</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="nt">-</span><span class="w"></span>
<span class="nt">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="nt">machineconfiguration</span><span class="p">.</span><span class="nc">openshift</span><span class="p">.</span><span class="nc">io</span><span class="o">/</span><span class="nt">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="o">:</span><span class="w"> </span><span class="nt">MachineConfig</span><span class="w"></span>
<span class="nt">metadata</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">labels</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">machineconfiguration</span><span class="p">.</span><span class="nc">openshift</span><span class="p">.</span><span class="nc">io</span><span class="o">/</span><span class="nt">role</span><span class="o">:</span><span class="w"> </span><span class="nt">staging</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="o">:</span><span class="w"> </span><span class="nt">99-staging-keepalived-vip</span><span class="w"></span>
<span class="nt">spec</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">config</span><span class="o">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">ignition</span><span class="o">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">config</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">      </span><span class="nt">security</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">tls</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">      </span><span class="nt">timeouts</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">      </span><span class="nt">version</span><span class="o">:</span><span class="w"> </span><span class="nt">2</span><span class="p">.</span><span class="nc">2</span><span class="p">.</span><span class="nc">0</span><span class="w"></span>
<span class="w">    </span><span class="nt">networkd</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="nt">passwd</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="nt">storage</span><span class="o">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">files</span><span class="o">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">-</span><span class="w"> </span><span class="nt">contents</span><span class="o">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">source</span><span class="o">:</span><span class="w"> </span><span class="nt">data</span><span class="p">:</span><span class="nd">text</span><span class="o">/</span><span class="nt">plain</span><span class="o">;</span><span class="nt">charset</span><span class="o">=</span><span class="nt">utf-8</span><span class="o">;</span><span class="nt">base64</span><span class="o">,$(</span><span class="nt">cat</span><span class="w"> </span><span class="nt">keepalived</span><span class="p">.</span><span class="nc">conf</span><span class="p">.</span><span class="nc">tmpl</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nt">base64</span><span class="w"> </span><span class="nt">-w0</span><span class="o">)</span><span class="w"></span>
<span class="w">          </span><span class="nt">verification</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">        </span><span class="nt">filesystem</span><span class="o">:</span><span class="w"> </span><span class="nt">root</span><span class="w"></span>
<span class="w">        </span><span class="nt">mode</span><span class="o">:</span><span class="w"> </span><span class="nt">420</span><span class="w"></span>
<span class="w">        </span><span class="nt">path</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="nt">etc</span><span class="o">/</span><span class="nt">kubernetes</span><span class="o">/</span><span class="nt">static-pod-resources</span><span class="o">/</span><span class="nt">keepalived</span><span class="o">/</span><span class="nt">keepalived</span><span class="p">.</span><span class="nc">conf</span><span class="p">.</span><span class="nc">tmpl</span><span class="w"></span>
<span class="w">    </span><span class="nt">systemd</span><span class="o">:</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="nt">EOF</span><span class="w"></span>

<span class="nt">rm</span><span class="w"> </span><span class="nt">-f</span><span class="w">  </span><span class="nt">keepalived</span><span class="p">.</span><span class="nc">conf</span><span class="p">.</span><span class="nc">tmpl</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Verify:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@akaris-osc-6klvk-worker-zhs67 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">keepalived</span><span class="o">/</span><span class="n">keepalived</span><span class="p">.</span><span class="n">conf</span><span class="w"> </span>
<span class="err">#</span><span class="w"> </span><span class="nl">TODO</span><span class="p">:</span><span class="w"> </span><span class="n">Improve</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">check</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">assumed</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">alive</span><span class="p">.</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">Need</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">assess</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ramification</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">there</span><span class="p">.</span><span class="w"></span>
<span class="n">vrrp_script</span><span class="w"> </span><span class="n">chk_ingress</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="n">script</span><span class="w"> </span><span class="ss">&quot;/usr/bin/curl -o /dev/null -kLfs http://0:1936/healthz&quot;</span><span class="w"></span>
<span class="w">    </span><span class="k">interval</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">weight</span><span class="w"> </span><span class="mi">50</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
<span class="n">vrrp_instance</span><span class="w"> </span><span class="n">staging_INGRESS</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="k">state</span><span class="w"> </span><span class="k">BACKUP</span><span class="w"></span>
<span class="w">    </span><span class="n">interface</span><span class="w"> </span><span class="n">ens6</span><span class="w"></span>
<span class="w">    </span><span class="n">virtual_router_id</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="w">    </span><span class="n">priority</span><span class="w"> </span><span class="mi">40</span><span class="w"></span>
<span class="w">    </span><span class="n">advert_int</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">authentication</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">auth_type</span><span class="w"> </span><span class="n">PASS</span><span class="w"></span>
<span class="w">        </span><span class="n">auth_pass</span><span class="w"> </span><span class="n">staging_vip</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="n">virtual_ipaddress</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="mf">172.31.254.118</span><span class="o">/</span><span class="mi">24</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="w">    </span><span class="n">track_script</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">        </span><span class="n">chk_ingress</span><span class="w"></span>
<span class="w">    </span><span class="err">}</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
<span class="o">[</span><span class="n">root@akaris-osc-6klvk-worker-zhs67 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">gre</span><span class="o">^</span><span class="n">C</span><span class="w"></span>
<span class="o">[</span><span class="n">root@akaris-osc-6klvk-worker-zhs67 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="n">ens6</span><span class="w"></span>
<span class="mi">3</span><span class="err">:</span><span class="w"> </span><span class="nl">ens6</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1450</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">fq_codel</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span><span class="w"></span>
<span class="w">    </span><span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="nl">fa</span><span class="p">:</span><span class="mi">16</span><span class="err">:</span><span class="mi">3</span><span class="nl">e</span><span class="p">:</span><span class="mi">66</span><span class="err">:</span><span class="nl">d2</span><span class="p">:</span><span class="mi">28</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="n">ff</span><span class="w"></span>
<span class="w">    </span><span class="n">inet</span><span class="w"> </span><span class="mf">172.31.254.207</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mf">172.31.254.255</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="k">dynamic</span><span class="w"> </span><span class="n">noprefixroute</span><span class="w"> </span><span class="n">ens6</span><span class="w"></span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="mi">86337</span><span class="n">sec</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="mi">86337</span><span class="n">sec</span><span class="w"></span>
<span class="w">    </span><span class="n">inet</span><span class="w"> </span><span class="mf">172.31.254.118</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="k">global</span><span class="w"> </span><span class="n">secondary</span><span class="w"> </span><span class="n">ens6</span><span class="w"></span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"></span>
<span class="w">    </span><span class="n">inet6</span><span class="w"> </span><span class="nl">fe80</span><span class="p">:</span><span class="err">:</span><span class="nl">f816</span><span class="p">:</span><span class="mi">3</span><span class="nl">eff</span><span class="p">:</span><span class="nl">fe66</span><span class="p">:</span><span class="n">d228</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="k">scope</span><span class="w"> </span><span class="n">link</span><span class="w"> </span>
<span class="w">       </span><span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<p>And ping the VIP:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="mf">10.0.89.89</span><span class="w"></span>
<span class="n">PING</span><span class="w"> </span><span class="mf">10.0.89.89</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.89.89</span><span class="p">)</span><span class="w"> </span><span class="mi">56</span><span class="p">(</span><span class="mi">84</span><span class="p">)</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="w"></span>
<span class="mi">64</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">10.0.89.89</span><span class="err">:</span><span class="w"> </span><span class="n">icmp_seq</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">ttl</span><span class="o">=</span><span class="mi">62</span><span class="w"> </span><span class="nc">time</span><span class="o">=</span><span class="mf">15.7</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="o">^</span><span class="n">C</span><span class="w"></span>
<span class="o">---</span><span class="w"> </span><span class="mf">10.0.89.89</span><span class="w"> </span><span class="n">ping</span><span class="w"> </span><span class="k">statistics</span><span class="w"> </span><span class="o">---</span><span class="w"></span>
<span class="mi">1</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">transmitted</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">received</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="o">%</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="n">loss</span><span class="p">,</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="mi">0</span><span class="n">ms</span><span class="w"></span>
<span class="n">rtt</span><span class="w"> </span><span class="nf">min</span><span class="o">/</span><span class="nf">avg</span><span class="o">/</span><span class="nf">max</span><span class="o">/</span><span class="n">mdev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">15.791</span><span class="o">/</span><span class="mf">15.791</span><span class="o">/</span><span class="mf">15.791</span><span class="o">/</span><span class="mf">0.000</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span>
</code></pre></div>
</td></tr></table></p>
<p>And SSH into the VIP:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">cloud</span><span class="o">-</span><span class="n">user</span><span class="p">@</span><span class="n">akaris</span><span class="o">-</span><span class="n">jump</span><span class="o">-</span><span class="n">server</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="n">$</span><span class="w"> </span><span class="n">ssh</span><span class="w"> </span><span class="n">core</span><span class="mf">@10.0.89.89</span><span class="w"></span>
<span class="n">The</span><span class="w"> </span><span class="n">authenticity</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="err">&#39;</span><span class="mf">10.0.89.89</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0.89.89</span><span class="p">)</span><span class="err">&#39;</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">established</span><span class="p">.</span><span class="w"></span>
<span class="n">ECDSA</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">fingerprint</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">SHA256</span><span class="o">:</span><span class="n">XB</span><span class="o">+</span><span class="n">FYE3vAxFZNI4HakM5WJkHmf74iMdFgI8x</span><span class="o">+</span><span class="n">dLx03A</span><span class="p">.</span><span class="w"></span>
<span class="n">ECDSA</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">fingerprint</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">MD5</span><span class="o">:</span><span class="n">a2</span><span class="o">:</span><span class="mi">54</span><span class="o">:</span><span class="n">c1</span><span class="o">:</span><span class="mi">52</span><span class="o">:</span><span class="n">ee</span><span class="o">:</span><span class="mo">05</span><span class="o">:</span><span class="mi">67</span><span class="o">:</span><span class="mi">52</span><span class="o">:</span><span class="mi">7</span><span class="n">c</span><span class="o">:</span><span class="mi">2</span><span class="n">a</span><span class="o">:</span><span class="n">a9</span><span class="o">:</span><span class="n">b8</span><span class="o">:</span><span class="mi">35</span><span class="o">:</span><span class="n">a9</span><span class="o">:</span><span class="n">a5</span><span class="o">:</span><span class="n">ee</span><span class="p">.</span><span class="w"></span>
<span class="n">Are</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="n">connecting</span><span class="w"> </span><span class="p">(</span><span class="n">yes</span><span class="o">/</span><span class="n">no</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="n">yes</span><span class="w"></span>
<span class="nl">Warning</span><span class="p">:</span><span class="w"> </span><span class="n">Permanently</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="err">&#39;</span><span class="mf">10.0.89.89</span><span class="err">&#39;</span><span class="w"> </span><span class="p">(</span><span class="n">ECDSA</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="n">hosts</span><span class="p">.</span><span class="w"></span>
<span class="n">Red</span><span class="w"> </span><span class="n">Hat</span><span class="w"> </span><span class="n">Enterprise</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">CoreOS</span><span class="w"> </span><span class="mf">45.82.202007240629</span><span class="mi">-0</span><span class="w"></span>
<span class="w">  </span><span class="n">Part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">OpenShift</span><span class="w"> </span><span class="mf">4.5</span><span class="p">,</span><span class="w"> </span><span class="n">RHCOS</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Kubernetes</span><span class="w"> </span><span class="n">native</span><span class="w"> </span><span class="n">operating</span><span class="w"> </span><span class="n">system</span><span class="w"></span>
<span class="w">  </span><span class="n">managed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Machine</span><span class="w"> </span><span class="n">Config</span><span class="w"> </span><span class="n">Operator</span><span class="w"> </span><span class="p">(</span><span class="err">`</span><span class="n">clusteroperator</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="n">config</span><span class="err">`</span><span class="p">).</span><span class="w"></span>

<span class="nl">WARNING</span><span class="p">:</span><span class="w"> </span><span class="n">Direct</span><span class="w"> </span><span class="n">SSH</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">machines</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">recommended</span><span class="p">;</span><span class="w"> </span><span class="n">instead</span><span class="p">,</span><span class="w"></span>
<span class="n">make</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">changes</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="err">`</span><span class="n">machineconfig</span><span class="err">`</span><span class="w"> </span><span class="n">objects</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="nl">https</span><span class="p">:</span><span class="c1">//docs.openshift.com/container-platform/4.5/architecture/architecture-rhcos.html</span>

<span class="o">---</span><span class="w"></span>
<span class="n">Last</span><span class="w"> </span><span class="n">login</span><span class="o">:</span><span class="w"> </span><span class="n">Tue</span><span class="w"> </span><span class="n">Aug</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">19</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span><span class="mi">19</span><span class="w"> </span><span class="mi">2020</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="mf">10.0.88.55</span><span class="w"></span>
<span class="p">[</span><span class="n">core</span><span class="p">@</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="mi">-6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w"> </span><span class="o">~</span><span class="p">]</span><span class="n">$</span><span class="w"> </span>
</code></pre></div>
</td></tr></table></p>
<h2 id="step-5-configure-an-ingress-use-ingress-controller-sharding">Step 5: Configure an Ingress, use Ingress controller sharding</h2>
<p>Use:
<a href="https://docs.openshift.com/container-platform/4.5/networking/ingress-operator.html#nw-ingress-sharding_configuring-ingress">https://docs.openshift.com/container-platform/4.5/networking/ingress-operator.html#nw-ingress-sharding_configuring-ingress</a></p>
<p>For example, the following Ingress route should work and be served by the 2 <code class="highlight">staging</code> workers:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="mf">10.0.89.99</span><span class="w"> </span><span class="n">test</span><span class="mf">.</span><span class="n">staging</span><span class="mf">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="mf">....</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<p>Configure the default IngressController and have it run only on <code class="highlight">worker</code> nodes - you can also exclude namespaces which shall not be served by the default IngressController:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cat &lt;&lt;&#39;EOF&#39; &gt; patch.yaml
spec:
  replicas: 2
#  namespaceSelector:
#    matchExpressions:
#    - key: type
#      operator: NotIn
#      values:
#      - test1
#      - test2
  nodePlacement:
    nodeSelector:
      matchLabels:
        node-role.kubernetes.io/worker: &quot;&quot;
EOF
oc patch -n openshift-ingress-operator ingresscontroller default --type=&quot;merge&quot; -p &quot;$(cat patch.yaml)&quot;
rm -f patch.yaml
</code></pre></div>
</td></tr></table></p>
<p>Configure the staging IngressController and have it run only on <code class="highlight">sharded</code> nodes:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cat &lt;&lt;&#39;EOF&#39; | oc apply -f -
apiVersion: v1
items:
- apiVersion: operator.openshift.io/v1
  kind: IngressController
  metadata:
    name: staging
    namespace: openshift-ingress-operator
  spec:
    replicas: 2
    domain: staging.akaris-osc....
    nodePlacement:
      nodeSelector:
        matchLabels:
          node-role.kubernetes.io/staging: &quot;&quot;
# --- either ---
#    routeSelector:
#      matchLabels:
#        type: staging
# --- or ---
#    namespaceSelector:
#      matchLabels:
#        type: test1
    endpointPublishingStrategy:
      type: HostNetwork
  status: {}
kind: List
metadata:
  resourceVersion: &quot;&quot;
  selfLink: &quot;&quot;
EOF
</code></pre></div>
</td></tr></table></p>
<p>Verify generation and modification of the IngressController and OpenShift router pods:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">nodes</span><span class="w"></span>
<span class="n">NAME</span><span class="w">                            </span><span class="n">STATUS</span><span class="w">   </span><span class="n">ROLES</span><span class="w">     </span><span class="n">AGE</span><span class="w">   </span><span class="n">VERSION</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">0</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">g4q6z</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">staging</span><span class="w">   </span><span class="mi">19</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">staging</span><span class="w">   </span><span class="mi">19</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">ingresscontroller</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="n">openshift</span><span class="o">-</span><span class="n">ingress</span><span class="o">-</span><span class="n">operator</span><span class="w"></span>
<span class="n">NAME</span><span class="w">      </span><span class="n">AGE</span><span class="w"></span>
<span class="k">default</span><span class="w">   </span><span class="mi">24</span><span class="n">h</span><span class="w"></span>
<span class="n">staging</span><span class="w">   </span><span class="mi">13</span><span class="n">m</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server openshift</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">pods</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="n">openshift</span><span class="o">-</span><span class="n">ingress</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">wide</span><span class="w"></span>
<span class="n">NAME</span><span class="w">                              </span><span class="n">READY</span><span class="w">   </span><span class="n">STATUS</span><span class="w">    </span><span class="n">RESTARTS</span><span class="w">   </span><span class="n">AGE</span><span class="w">    </span><span class="n">IP</span><span class="w">              </span><span class="n">NODE</span><span class="w">                            </span><span class="n">NOMINATED</span><span class="w"> </span><span class="n">NODE</span><span class="w">   </span><span class="n">READINESS</span><span class="w"> </span><span class="n">GATES</span><span class="w"></span>
<span class="n">router</span><span class="o">-</span><span class="k">default</span><span class="o">-</span><span class="mi">7</span><span class="n">fd7bdd4fc</span><span class="o">-</span><span class="n">jf55h</span><span class="w">   </span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="w">     </span><span class="n">Running</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="mi">2</span><span class="n">m5s</span><span class="w">   </span><span class="mf">192.168.0.114</span><span class="w">   </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w">           </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w"></span>
<span class="n">router</span><span class="o">-</span><span class="k">default</span><span class="o">-</span><span class="mi">7</span><span class="n">fd7bdd4fc</span><span class="o">-</span><span class="n">mc572</span><span class="w">   </span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="w">     </span><span class="n">Running</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="mi">106</span><span class="n">s</span><span class="w">   </span><span class="mf">192.168.0.251</span><span class="w">   </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w">           </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w"></span>
<span class="n">router</span><span class="o">-</span><span class="n">staging</span><span class="o">-</span><span class="mi">86</span><span class="n">c864549c</span><span class="o">-</span><span class="mi">7</span><span class="n">stx8</span><span class="w">   </span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="w">     </span><span class="n">Running</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="mi">14</span><span class="n">m</span><span class="w">    </span><span class="mf">192.168.1.160</span><span class="w">   </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w">           </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w"></span>
<span class="n">router</span><span class="o">-</span><span class="n">staging</span><span class="o">-</span><span class="mi">86</span><span class="n">c864549c</span><span class="o">-</span><span class="n">nkz28</span><span class="w">   </span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="w">     </span><span class="n">Running</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="mi">14</span><span class="n">m</span><span class="w">    </span><span class="mf">192.168.2.48</span><span class="w">    </span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w">           </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<h2 id="step-6-expose-route">Step 6: Expose route</h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>oc new-project test
oc adm policy add-scc-to-user anyuid -z default
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cat &lt;&lt;&#39;EOF&#39; &gt; httpbin-ingress.yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: httpbin-ingress
  annotations:
    kubernetes.io/ingress.allow-http: &quot;true&quot;
spec:
  rules:
  - host: httpbin-ingress.staging.akaris-osc....
    http:
      paths:
      - path: /
        backend:
          serviceName: httpbin-service
          servicePort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: httpbin-service
  labels:
    app: httpbin-deployment
spec:
  selector:
    app: httpbin-pod
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: httpbin-deployment
  labels:
    app: httpbin-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: httpbin-pod
  template:
    metadata:
      labels:
        app: httpbin-pod
    spec:
      containers:
      - name: tshark
        image: danielguerra/alpine-tshark 
        command:
          - &quot;tshark&quot; 
          - &quot;-i&quot; 
          - &quot;eth0&quot; 
          - &quot;-Y&quot; 
          - &quot;http&quot; 
          - &quot;-V&quot;  
          - &quot;dst&quot; 
          - &quot;port&quot;
          - &quot;80&quot;
      - name: httpbin
        image: kennethreitz/httpbin
        imagePullPolicy: Always
        command:
        - &quot;gunicorn&quot;
        - &quot;-b&quot;
        - &quot;0.0.0.0:80&quot;
        - &quot;httpbin:app&quot;
        - &quot;-k&quot;
        - &quot;gevent&quot;
        - &quot;--capture-output&quot;
        - &quot;--error-logfile&quot;
        - &quot;-&quot;
        - &quot;--access-logfile&quot;
        - &quot;-&quot;
        - &quot;--access-logformat&quot;
        - &quot;&#39;%(h)s %(t)s %(r)s %(s)s Host: %({Host}i)s} Header-i: %({Header}i)s Header-o: %({Header}o)s&#39;&quot;
EOF
oc apply -f httpbin-ingress.yaml
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">routes</span><span class="w"> </span>
<span class="n">NAME</span><span class="w">                    </span><span class="k">HOST</span><span class="o">/</span><span class="n">PORT</span><span class="w">                                                                                 </span><span class="k">PATH</span><span class="w">   </span><span class="n">SERVICES</span><span class="w">          </span><span class="n">PORT</span><span class="w">    </span><span class="n">TERMINATION</span><span class="w">   </span><span class="n">WILDCARD</span><span class="w"></span>
<span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="o">-</span><span class="n">z9tgf</span><span class="w">   </span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">more</span><span class="w">   </span><span class="o">/</span><span class="w">      </span><span class="n">httpbin</span><span class="o">-</span><span class="n">service</span><span class="w">   </span><span class="o">&lt;</span><span class="ow">all</span><span class="o">&gt;</span><span class="w">                 </span><span class="k">None</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="w"></span>
<span class="err">{</span><span class="w"></span>
<span class="w">  </span><span class="ss">&quot;args&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">{}</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="ss">&quot;headers&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="ss">&quot;Accept&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;*/*&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;Forwarded&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;for=10.0.88.55;host=httpbin-ingress.staging.akaris-osc....;proto=http&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;Host&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;httpbin-ingress.staging.akaris-osc....&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;User-Agent&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;curl/7.29.0&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;X-Forwarded-Host&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;httpbin-ingress.staging.akaris-osc....&quot;</span><span class="w"></span>
<span class="w">  </span><span class="err">}</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="ss">&quot;origin&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;10.0.88.55&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="ss">&quot;url&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;http://httpbin-ingress.staging.akaris-osc..../get&quot;</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<h2 id="step-7-security-hardening">Step 7: Security hardening</h2>
<p>This is out of scope of this PoC, but note that at the moment, the default Ingress can still handle all domains and thus if the client configures its resolver appropriately, can reach the application via the default VIP.</p>
<p>For example, take this mapping:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="mf">10.0.88.28</span><span class="w"> </span><span class="o">*</span><span class="mf">.</span><span class="n">apps</span><span class="mf">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="mf">....</span><span class="w"></span>
<span class="mf">10.0.89.89</span><span class="w"> </span><span class="o">*</span><span class="mf">.</span><span class="n">staging</span><span class="mf">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="mf">....</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<p>Then one can still use the other ingress router by modifying the client resolver:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="o">--</span><span class="n">resolve</span><span class="w"> </span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="o">/</span><span class="k">get</span><span class="err">:</span><span class="mi">80</span><span class="err">:</span><span class="mf">10.0.88.28</span><span class="w"> </span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="o">/</span><span class="k">get</span><span class="w"></span>
<span class="err">{</span><span class="w"></span>
<span class="w">  </span><span class="ss">&quot;args&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">{}</span><span class="p">,</span><span class="w"> </span>
<span class="w">  </span><span class="ss">&quot;headers&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span><span class="ss">&quot;Accept&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;*/*&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;Forwarded&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;for=10.0.88.55;host=httpbin-ingress.staging.akaris-osc....;proto=http&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">    </span><span class="ss">&quot;Host&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;httpbin-ingress.staging.akaris-osc...., </span>
<span class="ss">    &quot;</span><span class="k">User</span><span class="o">-</span><span class="n">Agent</span><span class="ss">&quot;: &quot;</span><span class="n">curl</span><span class="o">/</span><span class="mf">7.29.0</span><span class="ss">&quot;, </span>
<span class="ss">    &quot;</span><span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="k">Host</span><span class="ss">&quot;: &quot;</span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">...</span><span class="ss">&quot;</span>
<span class="ss">  }, </span>
<span class="ss">  &quot;</span><span class="n">origin</span><span class="ss">&quot;: &quot;</span><span class="mf">10.0.88.55</span><span class="ss">&quot;, </span>
<span class="ss">  &quot;</span><span class="n">url</span><span class="ss">&quot;: &quot;</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">httpbin</span><span class="o">-</span><span class="n">ingress</span><span class="p">.</span><span class="n">staging</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="o">/</span><span class="k">get</span><span class="ss">&quot;</span>
<span class="ss">}</span>
<span class="ss">[cloud-user@akaris-jump-server ~]$ curl --resolve httpbin-ingress.staging.akaris-osc..../get:80:10.0.89.89 httpbin-ingress.staging.akaris-osc.../get</span>
<span class="ss">{</span>
<span class="ss">  &quot;</span><span class="n">args</span><span class="ss">&quot;: {}, </span>
<span class="ss">  &quot;</span><span class="n">headers</span><span class="ss">&quot;: {</span>
<span class="ss">    &quot;</span><span class="n">Accept</span><span class="ss">&quot;: &quot;</span><span class="o">*</span><span class="cm">/*&quot;, </span>
<span class="cm">    &quot;Forwarded&quot;: &quot;for=10.0.88.55;host=httpbin-ingress.staging.akaris-osc....;proto=http&quot;, </span>
<span class="cm">    &quot;Host&quot;: &quot;httpbin-ingress.staging.akaris-osc...&quot;, </span>
<span class="cm">    &quot;User-Agent&quot;: &quot;curl/7.29.0&quot;, </span>
<span class="cm">    &quot;X-Forwarded-Host&quot;: &quot;httpbin-ingress.staging.akaris-osc...&quot;</span>
<span class="cm">  }, </span>
<span class="cm">  &quot;origin&quot;: &quot;10.0.88.55&quot;, </span>
<span class="cm">  &quot;url&quot;: &quot;http://httpbin-ingress.staging.akaris-osc.../get&quot;</span>
<span class="cm">}</span>
</code></pre></div>
</td></tr></table></p>
<p>And the same goes for the other way around:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="o">--</span><span class="n">resolve</span><span class="w"> </span><span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="n">application</span><span class="p">.</span><span class="n">apps</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="err">:</span><span class="mi">80</span><span class="err">:</span><span class="mf">10.0.88.28</span><span class="w"> </span><span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="n">application</span><span class="p">.</span><span class="n">apps</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="w"></span>
<span class="n">Nginx</span><span class="w"> </span><span class="n">A</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="o">--</span><span class="n">resolve</span><span class="w"> </span><span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="n">application</span><span class="p">.</span><span class="n">apps</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="err">:</span><span class="mi">80</span><span class="err">:</span><span class="mf">10.0.89.89</span><span class="w"> </span><span class="n">nginx</span><span class="o">-</span><span class="n">deployment</span><span class="o">-</span><span class="n">application</span><span class="p">.</span><span class="n">apps</span><span class="p">.</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="p">....</span><span class="w"></span>
<span class="n">Nginx</span><span class="w"> </span><span class="n">A</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<p>Read the documentation about IngressController sharding for further details.</p>
<h2 id="step-8-troubleshooting">Step 8: Troubleshooting</h2>
<p>Again, a bit outside of the scope of this PoC - the debug pods for my <code class="highlight">staging</code> nodes stopped working overnight. This would need some further troubleshooting:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">nodes</span><span class="w"></span>
<span class="n">NAME</span><span class="w">                            </span><span class="n">STATUS</span><span class="w">   </span><span class="n">ROLES</span><span class="w">     </span><span class="n">AGE</span><span class="w">   </span><span class="n">VERSION</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">0</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">25</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">1</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">25</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">master</span><span class="o">-</span><span class="mi">2</span><span class="w">       </span><span class="n">Ready</span><span class="w">    </span><span class="n">master</span><span class="w">    </span><span class="mi">25</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">g4q6z</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">hp2hz</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">staging</span><span class="w">   </span><span class="mi">19</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">l726s</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">lp2df</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">worker</span><span class="w">    </span><span class="mi">24</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
<span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="n">staging</span><span class="w">   </span><span class="mi">19</span><span class="n">h</span><span class="w">   </span><span class="n">v1</span><span class="mf">.18.3</span><span class="o">+</span><span class="mi">012</span><span class="n">b3ec</span><span class="w"></span>
</code></pre></div>
</td></tr></table></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">node</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="w"></span>
<span class="n">Starting</span><span class="w"> </span><span class="n">pod</span><span class="o">/</span><span class="n">akaris</span><span class="o">-</span><span class="n">osc</span><span class="o">-</span><span class="mi">6</span><span class="n">klvk</span><span class="o">-</span><span class="n">worker</span><span class="o">-</span><span class="n">zhs67</span><span class="o">-</span><span class="n">debug</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="k">To</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">host</span><span class="w"> </span><span class="n">binaries</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="err">`</span><span class="n">chroot</span><span class="w"> </span><span class="o">/</span><span class="k">host</span><span class="err">`</span><span class="w"></span>
<span class="n">Pod</span><span class="w"> </span><span class="nl">IP</span><span class="p">:</span><span class="w"> </span><span class="mf">192.168.2.48</span><span class="w"></span>
<span class="k">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">prompt</span><span class="p">,</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">pressing</span><span class="w"> </span><span class="n">enter</span><span class="p">.</span><span class="w"></span>

<span class="n">Removing</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">pod</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="n">Error</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="nl">server</span><span class="p">:</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">dialing</span><span class="w"> </span><span class="nl">backend</span><span class="p">:</span><span class="w"> </span><span class="n">remote</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="nl">tls</span><span class="p">:</span><span class="w"> </span><span class="n">internal</span><span class="w"> </span><span class="n">error</span><span class="w"></span>
<span class="o">[</span><span class="n">cloud-user@akaris-jump-server ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span>
</code></pre></div>
</td></tr></table>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 15, 2020</span>
      
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../ingresscontroller_router_sharding_ocp_on_osp/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Ingress Controller Sharding OCP on OSP" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Ingress Controller Sharding OCP on OSP
            </div>
          </div>
        </a>
      
      
        
        <a href="../openshift_mirror_registry/" class="md-footer__link md-footer__link--next" aria-label="Next: Installing a cluster with a mirror registry" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Installing a cluster with a mirror registry
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>