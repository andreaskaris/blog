
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Andreas Karis' blog about anything Kubernetes, OpenShift, Linux and Networking">
      
      
      
        <link rel="canonical" href="https://andreaskaris.github.io/blog/openshift/scc/">
      
      
        <link rel="prev" href="../seccomp-defaults-ocp/">
      
      
        <link rel="next" href="../openshift-scc-with-mutating-webhooks/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Security Context Constraints (SCC) - Andreas Karis Blog</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="RSS feed of created content" href="https://andreaskaris.github.io/blog/feed_rss_created.xml">
  <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="https://andreaskaris.github.io/blog/feed_rss_updated.xml">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andreas Karis Blog" class="md-header__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andreas Karis Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Security Context Constraints (SCC)
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../ceph/" class="md-tabs__link">
          
  
    
  
  Ceph

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../linux/" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../networking/" class="md-tabs__link">
          
  
    
  
  Networking

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  OpenShift and Kubernetes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../openstack/" class="md-tabs__link">
          
  
    
  
  OpenStack

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../coding/" class="md-tabs__link">
          
  
    
  
  Coding

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
  
    
    <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andreas Karis Blog" class="md-nav__button md-logo" aria-label="Andreas Karis Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Andreas Karis Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../ceph/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Ceph
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Ceph
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ceph/ceph-manual-test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ceph manual test with qemu
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../linux/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cgroups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Containers in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/hugepages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hugepages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/ipxe-boot-environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iPXE boot environment on Fedora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/java-idrac-issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java Idrac Issues
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/meson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    meson
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/namespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    namespaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/old_java_version_with_xorgs_in_container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Old Java inside a container with xorgs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/protect-lenovo-battery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Protect Lenovo laptop battery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/org-gnome-shell-overrides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workaround for org.gnome.shell.overrides not installed
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/get-process-cgroup-info-and-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retrieving process cgroup resource usage and limit info
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/libvirt-uefi-without-secureboot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RHEL Booting a virtual machine with UEFI but without secure boot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/setting-journalctl-limits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting journalctl limits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/cgroups_cpu_quota/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using cgroups for CFS bandwidth control
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/udev-ethtool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    udev rules to apply ethtool settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux/selinux-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SELinux Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../networking/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Networking
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Networking
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/accept-source-routing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accept Source Routing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/arp_and_the_neighbor_table/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ARP and the Neighbor table
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/bpf-and-tcpdump/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BPF and tcpdump
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/bonding_in_linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bonding in Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/juniper_x520/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure Juniper switch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovn-interconnection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hands-on with OVN Interconnection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/haproxy-and-h2c/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    haproxy and HTTP/2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/install-openvswitch-on-rocky/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Open vSwitch on Rocky Linux 8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/geneve_tunneling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Geneve tunneling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/netlink/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Netlink
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/netlink-address-fields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Netlink and MAC addresses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovn_standalone_on_fedora/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVN standalone on Fedora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovs_recirculation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS packet recirculation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovs-vxlan-tunnels-and-dscp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS VXLAN tunnels and DSCP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/ovs_with_gdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OVS with GDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/packet-tracing-with-ovn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Packet tracing with OVN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/sctp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/useful-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/wireguard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wireguard
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenShift and Kubernetes
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            OpenShift and Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alertmanager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AlertManager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analyzing-cni/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analyzing CNI calls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ocp-custom-release-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building custom release images for OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpu-manager-with-custom-machine-config-pool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPU manager with custom MachineConfigPool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpu-isolation-in-openshift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPU isolation in Red Hat OpenShift Container Platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crio-conmon-runc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crio vs conmon vs runc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dedicated-service-monitors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DedicatedServiceMonitors in OpenShift Monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../etcd_perf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Etcd Performance tests
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../get-vs-list-api-calls/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get vs List API Calls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift_httpbin_tshark_sidecar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Httpbin tshark sidecar container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubernetes_cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hints for installing kubernetes on Fedora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../HPA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Horizontal Pod Autoscaler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../how_rhcos_updates_work/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How RHCOS updates work
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kubelet-filesystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How kubelet monitors filesystems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ocp4-infra-nodes-with-machineset-without-worker-label/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infra nodes with MachineSets without worker label
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingresscontroller_router_sharding_ocp_on_osp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress Controller Sharding OCP on OSP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingress-controller-sharding-on-separate-vip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingress Controller Sharding on separate VIP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift_mirror_registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing a cluster with a mirror registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../istio-1.6-on-ocp.4.x/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Istio 1.6 on OpenShift 4.x
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kata containers and the kata operatora
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kernel-ml-on-openshift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kernel-ml on OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ovn-kind-hybrid-overlay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kind with OVN Kubernetes Hybrid Overlay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kind-with-private-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kind with private registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../list_docker_registry_containers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    List container images in registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mounting-container-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mount a container image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/install_openshift_on_openstack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenShift on OpenStack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift-with-multipath/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenShift with iSCSI multipath
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patch-service-loadbalancer-ingress-ip/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Patch status.loadBalancer.ingress IP manually
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../private-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Private container registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../proxy-ocp-4.5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Proxy OCP 4.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rpm-ostree-failed-to-find-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rpm-ostreed failed to find image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../seccomp-defaults-ocp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Seccomp defaults in Red Hat OpenShift Container Platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Security Context Constraints (SCC)
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift-scc-with-mutating-webhooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCCs and mutating webhooks - a lesson learned
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fix-selinux-labels-coreos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SElinux labels fix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networking/sctp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SCTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../openshift_troubleshooting_etcd_state/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting etcd state
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../useful-ocp-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful commands for OpenShift
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../useful-ocp-sdn-commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful commands for OpenShift SDN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting_openshift_on_openstack_worker_creation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting OpenShift on OpenStack worker creation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../openstack/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenStack
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            OpenStack
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/reattach_to_running_deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reattach to running deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../openstack/using_clouds_yaml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using clouds.yaml
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../coding/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Coding
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Coding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/operator-sdk-reconciliation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller Reconciliation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/vimrc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    My vimrc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../coding/golang-ip-conversion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Golang IP address conversion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
        </div>
      </div>
    </div>
  
  
    
    <!--
    <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner">
          

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
</nav>
        </div>
      </div>
    </div>
    -->
  

          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="how-security-context-constraints-sccs-work-in-openshift">How Security Context Constraints (SCCs) work in OpenShift</h1>
<p>How SCCs work in OpenShift by example. The following tests were run in Red Hat OpenShift Platform 3.11. Depending on the version in use, the cluster's behavior may be slightly different.</p>
<h2 id="impact-of-the-default-restricted-scc">Impact of the default restricted SCC</h2>
<p>The following example spawns a statefulset with a pod as user 65000. This user falls not into the <code class="highlight">supplemental-groups</code> of the project and can hence not be used by the <code class="highlight">restricted</code> SCC. The deployment will fail:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>describe<span class="w"> </span>project<span class="w"> </span><span class="nb">test</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>scc
<span class="w">            </span>openshift.io/sa.scc.mcs<span class="o">=</span>s0:c10,c0
<span class="w">            </span>openshift.io/sa.scc.supplemental-groups<span class="o">=</span><span class="m">1000090000</span>/10000
<span class="w">            </span>openshift.io/sa.scc.uid-range<span class="o">=</span><span class="m">1000090000</span>/10000
</code></pre></div></td></tr></table></div></p>
<p>Storage class is a local provisioner with 4 100MB local mounts, set up with <a href="https://github.com/andreaskaris/kubernetes/tree/master/localvolume">https://github.com/andreaskaris/kubernetes/tree/master/localvolume</a>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>storageclass
NAME<span class="w">              </span>PROVISIONER<span class="w">                    </span>AGE
local-loopbacks<span class="w">   </span>kubernetes.io/no-provisioner<span class="w">   </span>3d
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pv
NAME<span class="w">                </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>RECLAIM<span class="w"> </span>POLICY<span class="w">   </span>STATUS<span class="w">      </span>CLAIM<span class="w">     </span>STORAGECLASS<span class="w">      </span>REASON<span class="w">    </span>AGE
local-pv-18dc9ec0<span class="w">   </span>92Mi<span class="w">       </span>RWO<span class="w">            </span>Delete<span class="w">           </span>Available<span class="w">             </span>local-loopbacks<span class="w">             </span>36s
local-pv-89b778f1<span class="w">   </span>92Mi<span class="w">       </span>RWO<span class="w">            </span>Delete<span class="w">           </span>Available<span class="w">             </span>local-loopbacks<span class="w">             </span>19m
local-pv-9e67e7d6<span class="w">   </span>92Mi<span class="w">       </span>RWO<span class="w">            </span>Delete<span class="w">           </span>Available<span class="w">             </span>local-loopbacks<span class="w">             </span>28m
local-pv-b6a7cd37<span class="w">   </span>92Mi<span class="w">       </span>RWO<span class="w">            </span>Delete<span class="w">           </span>Available<span class="w">             </span>local-loopbacks<span class="w">             </span>3d
</code></pre></div></td></tr></table></div></p>
<p><code class="highlight">statefulset.yaml</code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">Service</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">v1</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">clusterIP</span><span class="o">:</span><span class="w"> </span><span class="n">None</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">ports</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">exposed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">service</span>
<span class="w">  </span><span class="n">ports</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">http</span>
<span class="w">      </span><span class="n">port</span><span class="o">:</span><span class="w"> </span><span class="mi">80</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pods</span><span class="w"> </span><span class="n">having</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">selector</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="o">---</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">apps</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">StatefulSet</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">matchLabels</span><span class="o">:</span>
<span class="w">       </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">serviceName</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">replicas</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">template</span><span class="o">:</span>
<span class="w">    </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">      </span><span class="n">labels</span><span class="o">:</span>
<span class="w">        </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">    </span><span class="n">spec</span><span class="o">:</span>
<span class="w">      </span><span class="n">securityContext</span><span class="o">:</span>
<span class="w">        </span><span class="n">runAsUser</span><span class="o">:</span><span class="w"> </span><span class="mi">65000</span>
<span class="w">      </span><span class="n">containers</span><span class="o">:</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">image</span><span class="o">:</span><span class="w"> </span><span class="n">gcr</span><span class="o">.</span><span class="na">io</span><span class="sr">/google_containers/</span><span class="n">busybox</span>
<span class="w">          </span><span class="n">command</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;while true; do date; sleep 1; done&quot;</span>
<span class="w">          </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">busybox</span>
<span class="w">          </span><span class="n">volumeMounts</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">              </span><span class="n">mountPath</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span>
<span class="w">  </span><span class="n">volumeClaimTemplates</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">        </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">      </span><span class="n">spec</span><span class="o">:</span>
<span class="w">        </span><span class="n">accessModes</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;ReadWriteOnce&quot;</span><span class="o">]</span>
<span class="w">        </span><span class="n">storageClassName</span><span class="o">:</span><span class="w"> </span><span class="n">local</span><span class="o">-</span><span class="n">loopbacks</span>
<span class="w">        </span><span class="n">resources</span><span class="o">:</span>
<span class="w">          </span><span class="n">requests</span><span class="o">:</span>
<span class="w">            </span><span class="n">storage</span><span class="o">:</span><span class="w"> </span><span class="mi">90</span><span class="n">Mi</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>statefulset.yaml
</code></pre></div></td></tr></table></div>
<p>OpenShift's admission controller will complain that the range is not correct:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">pods</span>
<span class="k">No</span><span class="w"> </span><span class="n">resources</span><span class="w"> </span><span class="k">found</span><span class="p">.</span>
<span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">describe</span><span class="w"> </span><span class="n">statefulset</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tail</span>
<span class="w">  </span><span class="nl">StorageClass</span><span class="p">:</span><span class="w">  </span><span class="k">local</span><span class="o">-</span><span class="n">loopbacks</span>
<span class="w">  </span><span class="nl">Labels</span><span class="p">:</span><span class="w">        </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nl">Annotations</span><span class="p">:</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nl">Capacity</span><span class="p">:</span><span class="w">      </span><span class="mi">90</span><span class="n">Mi</span>
<span class="w">  </span><span class="n">Access</span><span class="w"> </span><span class="nl">Modes</span><span class="p">:</span><span class="w">  </span><span class="o">[</span><span class="n">ReadWriteOnce</span><span class="o">]</span>
<span class="nl">Events</span><span class="p">:</span>
<span class="w">  </span><span class="n">Type</span><span class="w">     </span><span class="n">Reason</span><span class="w">            </span><span class="n">Age</span><span class="w">                 </span><span class="k">From</span><span class="w">                    </span><span class="n">Message</span>
<span class="w">  </span><span class="o">----</span><span class="w">     </span><span class="o">------</span><span class="w">            </span><span class="o">----</span><span class="w">                </span><span class="o">----</span><span class="w">                    </span><span class="o">-------</span>
<span class="w">  </span><span class="n">Normal</span><span class="w">   </span><span class="n">SuccessfulCreate</span><span class="w">  </span><span class="mi">40</span><span class="n">s</span><span class="w">                 </span><span class="n">statefulset</span><span class="o">-</span><span class="n">controller</span><span class="w">  </span><span class="k">create</span><span class="w"> </span><span class="n">Claim</span><span class="w"> </span><span class="n">vol</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="n">Pod</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">StatefulSet</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">success</span>
<span class="w">  </span><span class="n">Warning</span><span class="w">  </span><span class="n">FailedCreate</span><span class="w">      </span><span class="mi">19</span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="n">x14</span><span class="w"> </span><span class="k">over</span><span class="w"> </span><span class="mi">40</span><span class="n">s</span><span class="p">)</span><span class="w">  </span><span class="n">statefulset</span><span class="o">-</span><span class="n">controller</span><span class="w">  </span><span class="k">create</span><span class="w"> </span><span class="n">Pod</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">StatefulSet</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">pods</span><span class="w"> </span><span class="ss">&quot;test-0&quot;</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nl">forbidden</span><span class="p">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">validate</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="k">constraint</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">spec.containers[0</span><span class="o">]</span><span class="p">.</span><span class="n">securityContext</span><span class="p">.</span><span class="n">securityContext</span><span class="p">.</span><span class="nl">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="n">Invalid</span><span class="w"> </span><span class="k">value</span><span class="err">:</span><span class="w"> </span><span class="mi">65000</span><span class="err">:</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nl">ranges</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">1000090000, 1000099999</span><span class="o">]</span><span class="err">]</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="fixing-failed-validation-of-security-context-constraints">Fixing failed validation of security context constraints</h2>
<p>There are 3 solutions to this. Either:</p>
<ul>
<li>create a new SCC (or modify the restricted policy which is not recommended) or </li>
<li>modify the runAsUser field to run the pod as a user inside range <code class="highlight"><span class="mf">1000090000</span><span class="p">,</span><span class="w"> </span><span class="mf">1000099999</span></code> or </li>
<li>change the namespace's <code class="highlight">openshift.io/sa.scc.uid-range</code>.</li>
</ul>
<h3 id="resetting-the-lab">Resetting the lab</h3>
<p>First, delete the statefulSet, PVC, etc. Continue once all is deleted:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>statefulset
No<span class="w"> </span>resources<span class="w"> </span>found.
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods
No<span class="w"> </span>resources<span class="w"> </span>found.
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pvc
No<span class="w"> </span>resources<span class="w"> </span>found.
</code></pre></div></td></tr></table></div></p>
<h3 id="changing-the-namespaces-openshiftiosasccuid-range">Changing the namespace's openshift.io/sa.scc.uid-range</h3>
<p>Let's change the namespace's <code class="highlight">uid-range</code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>edit<span class="w"> </span>namespace<span class="w"> </span><span class="nb">test</span>
namespace/test<span class="w"> </span>edited
$<span class="w"> </span>oc<span class="w"> </span>describe<span class="w"> </span>project<span class="w"> </span><span class="nb">test</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>scc
<span class="w">            </span>openshift.io/sa.scc.mcs<span class="o">=</span>s0:c10,c0
<span class="w">            </span>openshift.io/sa.scc.supplemental-groups<span class="o">=</span><span class="m">1000090000</span>/10000
<span class="w">            </span>openshift.io/sa.scc.uid-range<span class="o">=</span><span class="m">65000</span>/1000
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>statefulset.yaml
service/test<span class="w"> </span>created
statefulset.apps/test<span class="w"> </span>created
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>statefulset
NAME<span class="w">      </span>DESIRED<span class="w">   </span>CURRENT<span class="w">   </span>AGE
<span class="nb">test</span><span class="w">      </span><span class="m">1</span><span class="w">         </span><span class="m">1</span><span class="w">         </span>24s
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods
NAME<span class="w">      </span>READY<span class="w">     </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
test-0<span class="w">    </span><span class="m">1</span>/1<span class="w">       </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>26s
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pvc
NAME<span class="w">         </span>STATUS<span class="w">    </span>VOLUME<span class="w">              </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>STORAGECLASS<span class="w">      </span>AGE
vol-test-0<span class="w">   </span>Bound<span class="w">     </span>local-pv-9e67e7d6<span class="w">   </span>92Mi<span class="w">       </span>RWO<span class="w">            </span>local-loopbacks<span class="w">   </span>30s
</code></pre></div></td></tr></table></div>
<p>The pod was assigned to the restricted SCC:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>test-0<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>scc
<span class="w">    </span>openshift.io/scc:<span class="w"> </span>restricted
</code></pre></div></td></tr></table></div></p>
<p>This is because the restricted SCC is the default. If other SCCs were assigned to the default serviceaccount of the project, then SCC priorization would come into play. </p>
<p>For more about SCC priorization, see: <a href="https://docs.openshift.com/container-platform/3.11/architecture/additional_concepts/authorization.html#scc-prioritization">https://docs.openshift.com/container-platform/3.11/architecture/additional_concepts/authorization.html#scc-prioritization</a></p>
<p>On the worker that the pod runs at, verify the container's and processes' UID:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@node-0 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">ps</span><span class="w">  </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">test</span>
<span class="mi">47</span><span class="n">b2d7df970c</span><span class="w">        </span><span class="n">gcr</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">google_containers</span><span class="o">/</span><span class="n">busybox</span><span class="nv">@sha256</span><span class="err">:</span><span class="n">d8d3bc2c183ed2f9f10e7258f84971202325ee6011ba137112e01e30f206de67</span><span class="w">                          </span><span class="ss">&quot;/bin/sh -c &#39;while...&quot;</span><span class="w">   </span><span class="n">About</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">minute</span><span class="w"> </span><span class="n">ago</span><span class="w">   </span><span class="n">Up</span><span class="w"> </span><span class="n">About</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">minute</span><span class="w">                       </span><span class="n">k8s_busybox_test</span><span class="o">-</span><span class="mi">0</span><span class="n">_test_6dfbf91e</span><span class="o">-</span><span class="n">d5a1</span><span class="o">-</span><span class="mi">11</span><span class="n">ea</span><span class="o">-</span><span class="n">a312</span><span class="o">-</span><span class="n">fa163e8752f1_0</span>
<span class="mi">8</span><span class="n">b3ef77e9213</span><span class="w">        </span><span class="n">registry</span><span class="p">.</span><span class="n">redhat</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">openshift3</span><span class="o">/</span><span class="n">ose</span><span class="o">-</span><span class="nl">pod</span><span class="p">:</span><span class="n">v3</span><span class="mf">.11.248</span><span class="w">                                                                                   </span><span class="ss">&quot;/usr/bin/pod&quot;</span><span class="w">           </span><span class="n">About</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">minute</span><span class="w"> </span><span class="n">ago</span><span class="w">   </span><span class="n">Up</span><span class="w"> </span><span class="n">About</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">minute</span><span class="w">                       </span><span class="n">k8s_POD_test</span><span class="o">-</span><span class="mi">0</span><span class="n">_test_6dfbf91e</span><span class="o">-</span><span class="n">d5a1</span><span class="o">-</span><span class="mi">11</span><span class="n">ea</span><span class="o">-</span><span class="n">a312</span><span class="o">-</span><span class="n">fa163e8752f1_0</span>
<span class="o">[</span><span class="n">root@node-0 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">inspect</span><span class="w"> </span><span class="mi">47</span><span class="n">b2d7df970c</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="k">user</span>
<span class="w">            </span><span class="ss">&quot;UsernsMode&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="ss">&quot;User&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;65000&quot;</span><span class="p">,</span>
<span class="o">[</span><span class="n">root@node-0 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ps</span><span class="w"> </span><span class="n">aux</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s1">&#39;date; sleep 1&#39;</span>
<span class="mi">65000</span><span class="w">      </span><span class="mi">5172</span><span class="w">  </span><span class="mf">0.0</span><span class="w">  </span><span class="mf">0.0</span><span class="w">   </span><span class="mi">3164</span><span class="w">   </span><span class="mi">352</span><span class="w"> </span><span class="vm">?</span><span class="w">        </span><span class="n">Ss</span><span class="w">   </span><span class="mi">11</span><span class="err">:</span><span class="mi">53</span><span class="w">   </span><span class="mi">0</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="nc">date</span><span class="p">;</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">done</span>
<span class="n">root</span><span class="w">       </span><span class="mi">6616</span><span class="w">  </span><span class="mf">0.0</span><span class="w">  </span><span class="mf">0.0</span><span class="w"> </span><span class="mi">112808</span><span class="w">   </span><span class="mi">972</span><span class="w"> </span><span class="n">pts</span><span class="o">/</span><span class="mi">0</span><span class="w">    </span><span class="n">R</span><span class="o">+</span><span class="w">   </span><span class="mi">11</span><span class="err">:</span><span class="mi">55</span><span class="w">   </span><span class="mi">0</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="c1">--color=auto date; sleep 1</span>
</code></pre></div></td></tr></table></div></p>
<p>Also note that the FsGroupID was set automatically for the filesystem:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@node-0 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="k">local</span><span class="o">-</span><span class="n">storage</span><span class="o">/</span><span class="n">loopbacks</span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="n">al</span>
<span class="n">total</span><span class="w"> </span><span class="mi">8</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">         </span><span class="mi">42</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">30</span><span class="w"> </span><span class="p">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">         </span><span class="mi">23</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">28</span><span class="w"> </span><span class="p">..</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">10</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="n">a</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">55</span><span class="w"> </span><span class="n">b</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">1000090000</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">55</span><span class="w"> </span><span class="n">c</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">1024</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">30</span><span class="w"> </span><span class="n">d</span>
</code></pre></div></td></tr></table></div></p>
<p>And it was assigned as GID to the user inside the pod:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>test-0
/<span class="w"> </span>$<span class="w"> </span>id
<span class="nv">uid</span><span class="o">=</span><span class="m">65000</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span><span class="w"> </span><span class="nv">groups</span><span class="o">=</span><span class="m">1000090000</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="resetting-the-lab_1">Resetting the lab</h3>
<p>Delete the statefulSet, PVC, etc again. Continue once all is deleted:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>statefulset
No<span class="w"> </span>resources<span class="w"> </span>found.
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods
No<span class="w"> </span>resources<span class="w"> </span>found.
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pvc
No<span class="w"> </span>resources<span class="w"> </span>found.
</code></pre></div></td></tr></table></div></p>
<h3 id="creating-a-custom-scc">Creating a custom SCC</h3>
<p>Let's now modify <code class="highlight">pod.spec.securityContext</code> and set fsGroup:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">Service</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">v1</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">clusterIP</span><span class="o">:</span><span class="w"> </span><span class="n">None</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">ports</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">exposed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">service</span>
<span class="w">  </span><span class="n">ports</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">http</span>
<span class="w">      </span><span class="n">port</span><span class="o">:</span><span class="w"> </span><span class="mi">80</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pods</span><span class="w"> </span><span class="n">having</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">selector</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="o">---</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">apps</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">StatefulSet</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">matchLabels</span><span class="o">:</span>
<span class="w">       </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">serviceName</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">replicas</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">template</span><span class="o">:</span>
<span class="w">    </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">      </span><span class="n">labels</span><span class="o">:</span>
<span class="w">        </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">    </span><span class="n">spec</span><span class="o">:</span>
<span class="w">      </span><span class="n">securityContext</span><span class="o">:</span>
<span class="w">        </span><span class="n">runAsUser</span><span class="o">:</span><span class="w"> </span><span class="mi">65000</span>
<span class="w">        </span><span class="n">fsGroup</span><span class="o">:</span><span class="w"> </span><span class="mi">65000</span>
<span class="w">      </span><span class="n">containers</span><span class="o">:</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">image</span><span class="o">:</span><span class="w"> </span><span class="n">gcr</span><span class="o">.</span><span class="na">io</span><span class="sr">/google_containers/</span><span class="n">busybox</span>
<span class="w">          </span><span class="n">command</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;while true; do date; sleep 1; done&quot;</span>
<span class="w">          </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">busybox</span>
<span class="w">          </span><span class="n">volumeMounts</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">              </span><span class="n">mountPath</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span>
<span class="w">  </span><span class="n">volumeClaimTemplates</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">        </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">      </span><span class="n">spec</span><span class="o">:</span>
<span class="w">        </span><span class="n">accessModes</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;ReadWriteOnce&quot;</span><span class="o">]</span>
<span class="w">        </span><span class="n">storageClassName</span><span class="o">:</span><span class="w"> </span><span class="n">local</span><span class="o">-</span><span class="n">loopbacks</span>
<span class="w">        </span><span class="n">resources</span><span class="o">:</span>
<span class="w">          </span><span class="n">requests</span><span class="o">:</span>
<span class="w">            </span><span class="n">storage</span><span class="o">:</span><span class="w"> </span><span class="mi">90</span><span class="n">Mi</span>
</code></pre></div></td></tr></table></div></p>
<p>This of course must fail:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">statefulset</span><span class="p">.</span><span class="n">yaml</span><span class="w"> </span>
<span class="n">service</span><span class="o">/</span><span class="n">test</span><span class="w"> </span><span class="n">created</span>
<span class="n">statefulset</span><span class="p">.</span><span class="n">apps</span><span class="o">/</span><span class="n">test</span><span class="w"> </span><span class="n">created</span>
<span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">describe</span><span class="w"> </span><span class="n">statefulset</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tail</span>
<span class="w">  </span><span class="nl">StorageClass</span><span class="p">:</span><span class="w">  </span><span class="k">local</span><span class="o">-</span><span class="n">loopbacks</span>
<span class="w">  </span><span class="nl">Labels</span><span class="p">:</span><span class="w">        </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nl">Annotations</span><span class="p">:</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nl">Capacity</span><span class="p">:</span><span class="w">      </span><span class="mi">90</span><span class="n">Mi</span>
<span class="w">  </span><span class="n">Access</span><span class="w"> </span><span class="nl">Modes</span><span class="p">:</span><span class="w">  </span><span class="o">[</span><span class="n">ReadWriteOnce</span><span class="o">]</span>
<span class="nl">Events</span><span class="p">:</span>
<span class="w">  </span><span class="n">Type</span><span class="w">     </span><span class="n">Reason</span><span class="w">            </span><span class="n">Age</span><span class="w">               </span><span class="k">From</span><span class="w">                    </span><span class="n">Message</span>
<span class="w">  </span><span class="o">----</span><span class="w">     </span><span class="o">------</span><span class="w">            </span><span class="o">----</span><span class="w">              </span><span class="o">----</span><span class="w">                    </span><span class="o">-------</span>
<span class="w">  </span><span class="n">Normal</span><span class="w">   </span><span class="n">SuccessfulCreate</span><span class="w">  </span><span class="mi">7</span><span class="n">s</span><span class="w">                </span><span class="n">statefulset</span><span class="o">-</span><span class="n">controller</span><span class="w">  </span><span class="k">create</span><span class="w"> </span><span class="n">Claim</span><span class="w"> </span><span class="n">vol</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="n">Pod</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">StatefulSet</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">success</span>
<span class="w">  </span><span class="n">Warning</span><span class="w">  </span><span class="n">FailedCreate</span><span class="w">      </span><span class="mi">2</span><span class="n">s</span><span class="w"> </span><span class="p">(</span><span class="n">x11</span><span class="w"> </span><span class="k">over</span><span class="w"> </span><span class="mi">7</span><span class="n">s</span><span class="p">)</span><span class="w">  </span><span class="n">statefulset</span><span class="o">-</span><span class="n">controller</span><span class="w">  </span><span class="k">create</span><span class="w"> </span><span class="n">Pod</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">StatefulSet</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">failed</span><span class="w"> </span><span class="nl">error</span><span class="p">:</span><span class="w"> </span><span class="n">pods</span><span class="w"> </span><span class="ss">&quot;test-0&quot;</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nl">forbidden</span><span class="p">:</span><span class="w"> </span><span class="n">unable</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">validate</span><span class="w"> </span><span class="n">against</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">security</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="k">constraint</span><span class="err">:</span><span class="w"> </span><span class="o">[</span><span class="n">fsGroup: Invalid value: [</span><span class="o">]</span><span class="n">int64</span><span class="err">{</span><span class="mi">65000</span><span class="err">}:</span><span class="w"> </span><span class="mi">65000</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="k">group</span><span class="err">]</span>
</code></pre></div></td></tr></table></div></p>
<p>Let's create a custom SCC to change this. The following group was created by inspecting the <code class="highlight">restricted</code> SCC with <code class="highlight">oc get scc restricted -o yaml</code> and then by changing the name, the fsGroup ranges and by removing some of the metadata.</p>
<p><code class="highlight">restricted-fsgroup.yaml</code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">allowHostDirVolumePlugin</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="n">allowHostIPC</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="n">allowHostNetwork</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="n">allowHostPID</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="n">allowHostPorts</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="n">allowPrivilegeEscalation</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<span class="n">allowPrivilegedContainer</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="n">allowedCapabilities</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">security</span><span class="o">.</span><span class="na">openshift</span><span class="o">.</span><span class="na">io</span><span class="o">/</span><span class="n">v1</span>
<span class="n">defaultAddCapabilities</span><span class="o">:</span><span class="w"> </span><span class="kc">null</span>
<span class="n">fsGroup</span><span class="o">:</span>
<span class="w">  </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">MustRunAs</span>
<span class="w">  </span><span class="n">ranges</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">min</span><span class="o">:</span><span class="w"> </span><span class="mi">65000</span>
<span class="w">      </span><span class="n">max</span><span class="o">:</span><span class="w"> </span><span class="mi">66000</span>
<span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">SecurityContextConstraints</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">restricted</span><span class="o">-</span><span class="n">fsgroup</span>
<span class="err">#</span><span class="w"> </span><span class="n">priority</span><span class="o">:</span><span class="w"> </span><span class="mi">10</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">it</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">prioritize</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">SCC</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">doing</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">here</span>
<span class="n">readOnlyRootFilesystem</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span>
<span class="n">requiredDropCapabilities</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">KILL</span>
<span class="o">-</span><span class="w"> </span><span class="n">MKNOD</span>
<span class="o">-</span><span class="w"> </span><span class="n">SETUID</span>
<span class="o">-</span><span class="w"> </span><span class="n">SETGID</span>
<span class="n">runAsUser</span><span class="o">:</span>
<span class="w">  </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">MustRunAsRange</span>
<span class="n">seLinuxContext</span><span class="o">:</span>
<span class="w">  </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">MustRunAs</span>
<span class="n">supplementalGroups</span><span class="o">:</span>
<span class="w">  </span><span class="n">type</span><span class="o">:</span><span class="w"> </span><span class="n">RunAsAny</span>
<span class="n">users</span><span class="o">:</span><span class="w"> </span><span class="o">[]</span>
<span class="n">volumes</span><span class="o">:</span>
<span class="o">-</span><span class="w"> </span><span class="n">configMap</span>
<span class="o">-</span><span class="w"> </span><span class="n">downwardAPI</span>
<span class="o">-</span><span class="w"> </span><span class="n">emptyDir</span>
<span class="o">-</span><span class="w"> </span><span class="n">persistentVolumeClaim</span>
<span class="o">-</span><span class="w"> </span><span class="n">projected</span>
<span class="o">-</span><span class="w"> </span><span class="n">secret</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>restricted-fsgroup.yaml<span class="w"> </span>
securitycontextconstraints.security.openshift.io/restricted-fsgroup<span class="w"> </span>created
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>scc
NAME<span class="w">                 </span>PRIV<span class="w">      </span>CAPS<span class="w">      </span>SELINUX<span class="w">     </span>RUNASUSER<span class="w">          </span>FSGROUP<span class="w">     </span>SUPGROUP<span class="w">    </span>PRIORITY<span class="w">   </span>READONLYROOTFS<span class="w">   </span>VOLUMES
anyuid<span class="w">               </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span><span class="m">10</span><span class="w">         </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
hostaccess<span class="w">           </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>hostPath<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
hostmount-anyuid<span class="w">     </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>hostPath<span class="w"> </span>nfs<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
hostnetwork<span class="w">          </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>MustRunAs<span class="w">   </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
kube-state-metrics<span class="w">   </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>*<span class="o">]</span>
node-exporter<span class="w">        </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>*<span class="o">]</span>
nonroot<span class="w">              </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsNonRoot<span class="w">   </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
privileged<span class="w">           </span><span class="nb">true</span><span class="w">      </span><span class="o">[</span>*<span class="o">]</span><span class="w">       </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>*<span class="o">]</span>
restricted<span class="w">           </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
restricted-fsgroup<span class="w">   </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
</code></pre></div></td></tr></table></div>
<p>Add this restricted-fsgroup to the default service account's SCCs:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-scc-to-user<span class="w"> </span>restricted-fsgroup<span class="w"> </span>-z<span class="w"> </span>default
scc<span class="w"> </span><span class="s2">&quot;restricted-fsgroup&quot;</span><span class="w"> </span>added<span class="w"> </span>to:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;system:serviceaccount:test:default&quot;</span><span class="o">]</span>
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>scc<span class="w"> </span>restricted-fsgroup<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>users<span class="w"> </span>-A1
<span class="o">(</span>...<span class="o">)</span>
users:
-<span class="w"> </span>system:serviceaccount:test:default
<span class="o">(</span>...<span class="o">)</span>
</code></pre></div></td></tr></table></div></p>
<p>Delete the statefulSet, PVC, etc again. Continue once all is deleted:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>statefulset
No<span class="w"> </span>resources<span class="w"> </span>found.
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods
No<span class="w"> </span>resources<span class="w"> </span>found.
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pvc
No<span class="w"> </span>resources<span class="w"> </span>found.
</code></pre></div></td></tr></table></div></p>
<p>The statefulSet can now spawn the pod and the pod is assigned to SCC <code class="highlight">restricted-fsgroup</code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">statefulset</span><span class="p">.</span><span class="n">yaml</span>
<span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">pods</span>
<span class="n">NAME</span><span class="w">      </span><span class="n">READY</span><span class="w">     </span><span class="n">STATUS</span><span class="w">    </span><span class="n">RESTARTS</span><span class="w">   </span><span class="n">AGE</span>
<span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w">    </span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="w">       </span><span class="n">Running</span><span class="w">   </span><span class="mi">0</span><span class="w">          </span><span class="mi">17</span><span class="n">s</span>
<span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">describe</span><span class="w"> </span><span class="n">statefulset</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tail</span>
<span class="w">  </span><span class="nl">StorageClass</span><span class="p">:</span><span class="w">  </span><span class="k">local</span><span class="o">-</span><span class="n">loopbacks</span>
<span class="w">  </span><span class="nl">Labels</span><span class="p">:</span><span class="w">        </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nl">Annotations</span><span class="p">:</span><span class="w">   </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span>
<span class="w">  </span><span class="nl">Capacity</span><span class="p">:</span><span class="w">      </span><span class="mi">90</span><span class="n">Mi</span>
<span class="w">  </span><span class="n">Access</span><span class="w"> </span><span class="nl">Modes</span><span class="p">:</span><span class="w">  </span><span class="o">[</span><span class="n">ReadWriteOnce</span><span class="o">]</span>
<span class="nl">Events</span><span class="p">:</span>
<span class="w">  </span><span class="n">Type</span><span class="w">    </span><span class="n">Reason</span><span class="w">            </span><span class="n">Age</span><span class="w">   </span><span class="k">From</span><span class="w">                    </span><span class="n">Message</span>
<span class="w">  </span><span class="o">----</span><span class="w">    </span><span class="o">------</span><span class="w">            </span><span class="o">----</span><span class="w">  </span><span class="o">----</span><span class="w">                    </span><span class="o">-------</span>
<span class="w">  </span><span class="n">Normal</span><span class="w">  </span><span class="n">SuccessfulCreate</span><span class="w">  </span><span class="mi">30</span><span class="n">s</span><span class="w">   </span><span class="n">statefulset</span><span class="o">-</span><span class="n">controller</span><span class="w">  </span><span class="k">create</span><span class="w"> </span><span class="n">Claim</span><span class="w"> </span><span class="n">vol</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="n">Pod</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">StatefulSet</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">success</span>
<span class="w">  </span><span class="n">Normal</span><span class="w">  </span><span class="n">SuccessfulCreate</span><span class="w">  </span><span class="mi">30</span><span class="n">s</span><span class="w">   </span><span class="n">statefulset</span><span class="o">-</span><span class="n">controller</span><span class="w">  </span><span class="k">create</span><span class="w"> </span><span class="n">Pod</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">StatefulSet</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">successful</span>
<span class="err">$</span><span class="w"> </span><span class="n">oc</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">pod</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">yaml</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="n">scc</span>
<span class="w">    </span><span class="n">openshift</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="nl">scc</span><span class="p">:</span><span class="w"> </span><span class="n">restricted</span><span class="o">-</span><span class="n">fsgroup</span>
</code></pre></div></td></tr></table></div></p>
<p>The pod now runs with group ID 65000:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>test-0
/<span class="w"> </span>$<span class="w"> </span>id
<span class="nv">uid</span><span class="o">=</span><span class="m">65000</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span><span class="w"> </span><span class="nv">groups</span><span class="o">=</span><span class="m">65000</span>
</code></pre></div></td></tr></table></div></p>
<p>And that matches the group ID of the mount's directory:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@node-0 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="k">local</span><span class="o">-</span><span class="n">storage</span><span class="o">/</span><span class="n">loopbacks</span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="n">al</span>
<span class="n">total</span><span class="w"> </span><span class="mi">8</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">    </span><span class="mi">42</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">30</span><span class="w"> </span><span class="p">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">    </span><span class="mi">23</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">28</span><span class="w"> </span><span class="p">..</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">10</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="n">a</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">65000</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">55</span><span class="w"> </span><span class="n">b</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">55</span><span class="w"> </span><span class="n">c</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">1024</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">30</span><span class="w"> </span><span class="n">d</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="scc-matching-and-priority">SCC matching and priority</h2>
<p>Keep in mind that both SCCs are active at the same time - and will be selected depending on which SCC is matched by the requested pod.</p>
<h3 id="matching-based-on-allowed-security-context">Matching based on allowed security context</h3>
<p>Let's change <code class="highlight"><span class="n">fsGroup</span><span class="o">:</span><span class="w"> </span><span class="mi">65000</span></code> to <code class="highlight"><span class="n">fsGroup</span><span class="o">:</span><span class="w"> </span><span class="mi">1000090000</span></code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">Service</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">v1</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">clusterIP</span><span class="o">:</span><span class="w"> </span><span class="n">None</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">ports</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">exposed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">service</span>
<span class="w">  </span><span class="n">ports</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">http</span>
<span class="w">      </span><span class="n">port</span><span class="o">:</span><span class="w"> </span><span class="mi">80</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pods</span><span class="w"> </span><span class="n">having</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">selector</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="o">---</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">apps</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">StatefulSet</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">matchLabels</span><span class="o">:</span>
<span class="w">       </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">serviceName</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">replicas</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">template</span><span class="o">:</span>
<span class="w">    </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">      </span><span class="n">labels</span><span class="o">:</span>
<span class="w">        </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">    </span><span class="n">spec</span><span class="o">:</span>
<span class="w">      </span><span class="n">securityContext</span><span class="o">:</span>
<span class="w">        </span><span class="n">runAsUser</span><span class="o">:</span><span class="w"> </span><span class="mi">65000</span>
<span class="w">        </span><span class="n">fsGroup</span><span class="o">:</span><span class="w"> </span><span class="mi">1000090000</span>
<span class="w">      </span><span class="n">containers</span><span class="o">:</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">image</span><span class="o">:</span><span class="w"> </span><span class="n">gcr</span><span class="o">.</span><span class="na">io</span><span class="sr">/google_containers/</span><span class="n">busybox</span>
<span class="w">          </span><span class="n">command</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;while true; do date; sleep 1; done&quot;</span>
<span class="w">          </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">busybox</span>
<span class="w">          </span><span class="n">volumeMounts</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">              </span><span class="n">mountPath</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span>
<span class="w">  </span><span class="n">volumeClaimTemplates</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">        </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">      </span><span class="n">spec</span><span class="o">:</span>
<span class="w">        </span><span class="n">accessModes</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;ReadWriteOnce&quot;</span><span class="o">]</span>
<span class="w">        </span><span class="n">storageClassName</span><span class="o">:</span><span class="w"> </span><span class="n">local</span><span class="o">-</span><span class="n">loopbacks</span>
<span class="w">        </span><span class="n">resources</span><span class="o">:</span>
<span class="w">          </span><span class="n">requests</span><span class="o">:</span>
<span class="w">            </span><span class="n">storage</span><span class="o">:</span><span class="w"> </span><span class="mi">90</span><span class="n">Mi</span>
</code></pre></div></td></tr></table></div></p>
<p>Reset the lab again, then deploy the modified deployment.</p>
<p>Now, the pod's SCC is <code class="highlight">restricted</code> because the requested GID only matches the restricted but not the restricted-fsgroup SCC:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>statefulset.yaml
service/test<span class="w"> </span>created
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>test-0<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>scc
<span class="w">    </span>openshift.io/scc:<span class="w"> </span>restricted
</code></pre></div></td></tr></table></div></p>
<h3 id="name-as-tiebreaker">Name as tiebreaker</h3>
<p>Now, what happens if we remove the request for a specific fsGroup from the pod?
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">Service</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">v1</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">clusterIP</span><span class="o">:</span><span class="w"> </span><span class="n">None</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">ports</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">exposed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">service</span>
<span class="w">  </span><span class="n">ports</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">http</span>
<span class="w">      </span><span class="n">port</span><span class="o">:</span><span class="w"> </span><span class="mi">80</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pods</span><span class="w"> </span><span class="n">having</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">selector</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="o">---</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">apps</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">StatefulSet</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">matchLabels</span><span class="o">:</span>
<span class="w">       </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">serviceName</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">replicas</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">template</span><span class="o">:</span>
<span class="w">    </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">      </span><span class="n">labels</span><span class="o">:</span>
<span class="w">        </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">    </span><span class="n">spec</span><span class="o">:</span>
<span class="w">      </span><span class="n">securityContext</span><span class="o">:</span>
<span class="w">        </span><span class="n">runAsUser</span><span class="o">:</span><span class="w"> </span><span class="mi">65000</span>
<span class="w">      </span><span class="n">containers</span><span class="o">:</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">image</span><span class="o">:</span><span class="w"> </span><span class="n">gcr</span><span class="o">.</span><span class="na">io</span><span class="sr">/google_containers/</span><span class="n">busybox</span>
<span class="w">          </span><span class="n">command</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;while true; do date; sleep 1; done&quot;</span>
<span class="w">          </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">busybox</span>
<span class="w">          </span><span class="n">volumeMounts</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">              </span><span class="n">mountPath</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span>
<span class="w">  </span><span class="n">volumeClaimTemplates</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">        </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">      </span><span class="n">spec</span><span class="o">:</span>
<span class="w">        </span><span class="n">accessModes</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;ReadWriteOnce&quot;</span><span class="o">]</span>
<span class="w">        </span><span class="n">storageClassName</span><span class="o">:</span><span class="w"> </span><span class="n">local</span><span class="o">-</span><span class="n">loopbacks</span>
<span class="w">        </span><span class="n">resources</span><span class="o">:</span>
<span class="w">          </span><span class="n">requests</span><span class="o">:</span>
<span class="w">            </span><span class="n">storage</span><span class="o">:</span><span class="w"> </span><span class="mi">90</span><span class="n">Mi</span>
</code></pre></div></td></tr></table></div></p>
<p>Reset the lab again, then apply the statefulset.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>statefulset.yaml<span class="w"> </span>
service/test<span class="w"> </span>created
statefulset.apps/test<span class="w"> </span>created
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>test-0<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>scc
<span class="w">    </span>openshift.io/scc:<span class="w"> </span>restricted
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>test-0
/<span class="w"> </span>$<span class="w"> </span>id
<span class="nv">uid</span><span class="o">=</span><span class="m">65000</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span><span class="w"> </span><span class="nv">groups</span><span class="o">=</span><span class="m">1000090000</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@node-0 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="k">local</span><span class="o">-</span><span class="n">storage</span><span class="o">/</span><span class="n">loopbacks</span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="n">al</span>
<span class="n">total</span><span class="w"> </span><span class="mi">8</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">         </span><span class="mi">42</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">30</span><span class="w"> </span><span class="p">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">         </span><span class="mi">23</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">28</span><span class="w"> </span><span class="p">..</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">1000090000</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">10</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="n">a</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">55</span><span class="w"> </span><span class="n">b</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">55</span><span class="w"> </span><span class="n">c</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">1024</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">30</span><span class="w"> </span><span class="n">d</span>
</code></pre></div></td></tr></table></div>
<p>Both SCCs have the same priority, are equally restrictive. So the tiebreaker is the name:</p>
<ul>
<li><a href="https://docs.openshift.com/container-platform/3.11/architecture/additional_concepts/authorization.html#scc-prioritization">https://docs.openshift.com/container-platform/3.11/architecture/additional_concepts/authorization.html#scc-prioritization</a>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w">    </span><span class="nv">Highest</span><span class="w"> </span><span class="nv">priority</span><span class="w"> </span><span class="nv">first</span>,<span class="w"> </span><span class="nv">nil</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">considered</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">priority</span>

<span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="nv">priorities</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">equal</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">SCCs</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">sorted</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="nv">most</span><span class="w"> </span><span class="nv">restrictive</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">least</span><span class="w"> </span><span class="nv">restrictive</span>

<span class="w">    </span><span class="k">If</span><span class="w"> </span><span class="nv">both</span><span class="w"> </span><span class="nv">priorities</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">restrictions</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">equal</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">SCCs</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">sorted</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">name</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Let's suppose this had a different name:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>restricted-fsgroup.yaml
securitycontextconstraints.security.openshift.io<span class="w"> </span><span class="s2">&quot;restricted-fsgroup&quot;</span><span class="w"> </span>deleted
$<span class="w"> </span>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>fsgroup.yaml<span class="w"> </span>
securitycontextconstraints.security.openshift.io/fsgroup<span class="w"> </span>created
$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-scc-to-user<span class="w"> </span>fsgroup<span class="w"> </span>-z<span class="w"> </span>default
scc<span class="w"> </span><span class="s2">&quot;fsgroup&quot;</span><span class="w"> </span>added<span class="w"> </span>to:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;system:serviceaccount:test:default&quot;</span><span class="o">]</span>
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>scc
NAME<span class="w">                 </span>PRIV<span class="w">      </span>CAPS<span class="w">      </span>SELINUX<span class="w">     </span>RUNASUSER<span class="w">          </span>FSGROUP<span class="w">     </span>SUPGROUP<span class="w">    </span>PRIORITY<span class="w">   </span>READONLYROOTFS<span class="w">   </span>VOLUMES
anyuid<span class="w">               </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span><span class="m">10</span><span class="w">         </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
fsgroup<span class="w">              </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
hostaccess<span class="w">           </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>hostPath<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
hostmount-anyuid<span class="w">     </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>hostPath<span class="w"> </span>nfs<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
hostnetwork<span class="w">          </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>MustRunAs<span class="w">   </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
kube-state-metrics<span class="w">   </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>*<span class="o">]</span>
node-exporter<span class="w">        </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>*<span class="o">]</span>
nonroot<span class="w">              </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsNonRoot<span class="w">   </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
privileged<span class="w">           </span><span class="nb">true</span><span class="w">      </span><span class="o">[</span>*<span class="o">]</span><span class="w">       </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>*<span class="o">]</span>
restricted<span class="w">           </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
</code></pre></div></td></tr></table></div></p>
<p>Then we'd use the <code class="highlight">fsgroup</code> SCC:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>statefulset.yaml<span class="w"> </span>
service/test<span class="w"> </span>created
statefulset.apps/test<span class="w"> </span>created
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>test-0<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>scc
<span class="w">    </span>openshift.io/scc:<span class="w"> </span>fsgroup
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>test-0
id
/<span class="w"> </span>$<span class="w"> </span>id
<span class="nv">uid</span><span class="o">=</span><span class="m">65000</span><span class="w"> </span><span class="nv">gid</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span><span class="w"> </span><span class="nv">groups</span><span class="o">=</span><span class="m">65000</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="o">[</span><span class="n">root@node-0 ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="k">local</span><span class="o">-</span><span class="n">storage</span><span class="o">/</span><span class="n">loopbacks</span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="n">al</span>
<span class="n">total</span><span class="w"> </span><span class="mi">8</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">         </span><span class="mi">42</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">30</span><span class="w"> </span><span class="p">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">         </span><span class="mi">23</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">28</span><span class="w"> </span><span class="p">..</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w">      </span><span class="mi">65000</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">10</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="n">a</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">55</span><span class="w"> </span><span class="n">b</span>
<span class="n">drwxrwsr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">1024</span><span class="w"> </span><span class="n">Aug</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">55</span><span class="w"> </span><span class="n">c</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">       </span><span class="mi">1024</span><span class="w"> </span><span class="n">Jul</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">13</span><span class="err">:</span><span class="mi">30</span><span class="w"> </span><span class="n">d</span>
</code></pre></div></td></tr></table></div>
<h3 id="using-the-priority-field-as-a-tiebreaker">Using the priority field as a tiebreaker</h3>
<p>And is there a way to prioritize our policy without changing the name? Yes, with the priority field. Change the SCC's name again to <code class="highlight">restricted-fsgroup</code>. So based on the name, it would lose against <code class="highlight">restricted</code>. But also set the priority to <code class="highlight"><span class="mf">1</span></code> which is higher than <code class="highlight">restricted</code>s priority of <code class="highlight"><span class="mf">0</span></code>:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>restricted-fsgroup.yaml<span class="w"> </span>
allowHostDirVolumePlugin:<span class="w"> </span><span class="nb">false</span>
allowHostIPC:<span class="w"> </span><span class="nb">false</span>
allowHostNetwork:<span class="w"> </span><span class="nb">false</span>
allowHostPID:<span class="w"> </span><span class="nb">false</span>
allowHostPorts:<span class="w"> </span><span class="nb">false</span>
allowPrivilegeEscalation:<span class="w"> </span><span class="nb">true</span>
allowPrivilegedContainer:<span class="w"> </span><span class="nb">false</span>
allowedCapabilities:<span class="w"> </span>null
apiVersion:<span class="w"> </span>security.openshift.io/v1
defaultAddCapabilities:<span class="w"> </span>null
fsGroup:
<span class="w">  </span>type:<span class="w"> </span>MustRunAs
<span class="w">  </span>ranges:
<span class="w">    </span>-<span class="w"> </span>min:<span class="w"> </span><span class="m">65000</span>
<span class="w">      </span>max:<span class="w"> </span><span class="m">66000</span>
kind:<span class="w"> </span>SecurityContextConstraints
metadata:
<span class="w">  </span>name:<span class="w"> </span>restricted-fsgroup
readOnlyRootFilesystem:<span class="w"> </span><span class="nb">false</span>
requiredDropCapabilities:
-<span class="w"> </span>KILL
-<span class="w"> </span>MKNOD
-<span class="w"> </span>SETUID
-<span class="w"> </span>SETGID
runAsUser:
<span class="w">  </span>type:<span class="w"> </span>MustRunAsRange
seLinuxContext:
<span class="w">  </span>type:<span class="w"> </span>MustRunAs
supplementalGroups:
<span class="w">  </span>type:<span class="w"> </span>RunAsAny
users:<span class="w"> </span><span class="o">[]</span>
volumes:
-<span class="w"> </span>configMap
-<span class="w"> </span>downwardAPI
-<span class="w"> </span>emptyDir
-<span class="w"> </span>persistentVolumeClaim
-<span class="w"> </span>projected
-<span class="w"> </span>secret
priority:<span class="w"> </span><span class="m">1</span>
</code></pre></div></td></tr></table></div></p>
<p>After applying this, we see:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>scc
NAME<span class="w">                 </span>PRIV<span class="w">      </span>CAPS<span class="w">      </span>SELINUX<span class="w">     </span>RUNASUSER<span class="w">          </span>FSGROUP<span class="w">     </span>SUPGROUP<span class="w">    </span>PRIORITY<span class="w">   </span>READONLYROOTFS<span class="w">   </span>VOLUMES
anyuid<span class="w">               </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span><span class="m">10</span><span class="w">         </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
hostaccess<span class="w">           </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>hostPath<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
hostmount-anyuid<span class="w">     </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>hostPath<span class="w"> </span>nfs<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
hostnetwork<span class="w">          </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>MustRunAs<span class="w">   </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
kube-state-metrics<span class="w">   </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>*<span class="o">]</span>
node-exporter<span class="w">        </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>*<span class="o">]</span>
nonroot<span class="w">              </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsNonRoot<span class="w">   </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
privileged<span class="w">           </span><span class="nb">true</span><span class="w">      </span><span class="o">[</span>*<span class="o">]</span><span class="w">       </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">           </span>RunAsAny<span class="w">    </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>*<span class="o">]</span>
restricted<span class="w">           </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">    </span>&lt;none&gt;<span class="w">     </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
restricted-fsgroup<span class="w">   </span><span class="nb">false</span><span class="w">     </span><span class="o">[]</span><span class="w">        </span>MustRunAs<span class="w">   </span>MustRunAsRange<span class="w">     </span>MustRunAs<span class="w">   </span>RunAsAny<span class="w">    </span><span class="m">1</span><span class="w">          </span><span class="nb">false</span><span class="w">            </span><span class="o">[</span>configMap<span class="w"> </span>downwardAPI<span class="w"> </span>emptyDir<span class="w"> </span>persistentVolumeClaim<span class="w"> </span>projected<span class="w"> </span>secret<span class="o">]</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>test-0<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>scc
<span class="w">    </span>openshift.io/scc:<span class="w"> </span>restricted-fsgroup
</code></pre></div></td></tr></table></div>
<h3 id="demonstrating-that-priority-only-comes-into-play-if-sccs-overlap">Demonstrating that priority only comes into play if SCCs overlap</h3>
<p>But should we decide that we not like  a fsGroup within 65000-65999, we can request the namespace's default and still use <code class="highlight">restricted</code>, even though we changed the priority:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">Service</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">v1</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">clusterIP</span><span class="o">:</span><span class="w"> </span><span class="n">None</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">ports</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">exposed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">service</span>
<span class="w">  </span><span class="n">ports</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">http</span>
<span class="w">      </span><span class="n">port</span><span class="o">:</span><span class="w"> </span><span class="mi">80</span>
<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">route</span><span class="w"> </span><span class="n">traffic</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">pods</span><span class="w"> </span><span class="n">having</span><span class="w"> </span><span class="n">labels</span><span class="w"> </span><span class="n">matching</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">selector</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;test&quot;</span>
<span class="o">---</span>
<span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">apps</span><span class="o">/</span><span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">StatefulSet</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">selector</span><span class="o">:</span>
<span class="w">    </span><span class="n">matchLabels</span><span class="o">:</span>
<span class="w">       </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">serviceName</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">  </span><span class="n">replicas</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">  </span><span class="n">template</span><span class="o">:</span>
<span class="w">    </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">      </span><span class="n">labels</span><span class="o">:</span>
<span class="w">        </span><span class="n">app</span><span class="o">:</span><span class="w"> </span><span class="n">test</span>
<span class="w">    </span><span class="n">spec</span><span class="o">:</span>
<span class="w">      </span><span class="n">securityContext</span><span class="o">:</span>
<span class="w">        </span><span class="n">runAsUser</span><span class="o">:</span><span class="w"> </span><span class="mi">65000</span>
<span class="w">        </span><span class="n">fsGroup</span><span class="o">:</span><span class="w"> </span><span class="mi">1000090000</span>
<span class="w">      </span><span class="n">containers</span><span class="o">:</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">image</span><span class="o">:</span><span class="w"> </span><span class="n">gcr</span><span class="o">.</span><span class="na">io</span><span class="sr">/google_containers/</span><span class="n">busybox</span>
<span class="w">          </span><span class="n">command</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;/bin/sh&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="s2">&quot;while true; do date; sleep 1; done&quot;</span>
<span class="w">          </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">busybox</span>
<span class="w">          </span><span class="n">volumeMounts</span><span class="o">:</span>
<span class="w">            </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">              </span><span class="n">mountPath</span><span class="o">:</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span>
<span class="w">  </span><span class="n">volumeClaimTemplates</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">metadata</span><span class="o">:</span>
<span class="w">        </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">vol</span>
<span class="w">      </span><span class="n">spec</span><span class="o">:</span>
<span class="w">        </span><span class="n">accessModes</span><span class="o">:</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;ReadWriteOnce&quot;</span><span class="o">]</span>
<span class="w">        </span><span class="n">storageClassName</span><span class="o">:</span><span class="w"> </span><span class="n">local</span><span class="o">-</span><span class="n">loopbacks</span>
<span class="w">        </span><span class="n">resources</span><span class="o">:</span>
<span class="w">          </span><span class="n">requests</span><span class="o">:</span>
<span class="w">            </span><span class="n">storage</span><span class="o">:</span><span class="w"> </span><span class="mi">90</span><span class="n">Mi</span>
</code></pre></div></td></tr></table></div>
<p>See this:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code>$<span class="w"> </span>oc<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>statefulset.yaml<span class="w"> </span>
service/test<span class="w"> </span>created
statefulset.apps/test<span class="w"> </span>created
$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>test-0<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>scc
<span class="w">    </span>openshift.io/scc:<span class="w"> </span>restricted
</code></pre></div></td></tr></table></div></p>
<h2 id="summary">Summary</h2>
<p>Lessons learned: we can apply multiple SCCs to a ServiceAccount. The default SCC is always <code class="highlight">restricted</code>. The matching goes by priority first, then most restrictive policy, then by name. And if a policy does not match a specific request, another one might "jump in" and "help out". </p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="https://www.openshift.com/blog/managing-sccs-in-openshift">https://www.openshift.com/blog/managing-sccs-in-openshift</a></li>
<li><a href="https://docs.openshift.com/container-platform/3.11/admin_guide/manage_scc.html">https://docs.openshift.com/container-platform/3.11/admin_guide/manage_scc.html</a></li>
<li><a href="https://docs.openshift.com/container-platform/3.11/install_config/persistent_storage/pod_security_context.html">https://docs.openshift.com/container-platform/3.11/install_config/persistent_storage/pod_security_context.html</a></li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">September 15, 2020</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.prune", "navigation.top", "navigation.path", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>